export class WindowStateManager {
    constructor(main) {
        this.main = main;
        let that = this;
        history.pushState("PreventLeavingSite", "");
        window.addEventListener('popstate', (event) => {
            if (event.state == "PreventLeavingSite") {
                history.pushState("PreventLeavingSite", "");
                that.main.editor.pushHistoryState(false, that.main.editor.getPositionForHistory());
            }
            else if (this.oneTimeBackButtonListener == null) {
                this.backButtonListener(event);
            }
            if (this.oneTimeBackButtonListener != null) {
                this.oneTimeBackButtonListener();
                this.oneTimeBackButtonListener = null;
            }
        });
    }
    registerBackButtonListener(listener) {
        this.backButtonListener = listener;
    }
    registerOneTimeBackButtonListener(oneTimeBackButtonListener) {
        this.oneTimeBackButtonListener = oneTimeBackButtonListener;
        history.pushState({}, "");
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV2luZG93U3RhdGVNYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NsaWVudC9tYWluL2d1aS9XaW5kb3dTdGF0ZU1hbmFnZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBSUEsTUFBTSxPQUFPLGtCQUFrQjtJQUszQixZQUFvQixJQUFVO1FBQVYsU0FBSSxHQUFKLElBQUksQ0FBTTtRQUMxQixJQUFJLElBQUksR0FBRyxJQUFJLENBQUM7UUFDaEIsT0FBTyxDQUFDLFNBQVMsQ0FBQyxvQkFBb0IsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUM1QyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxFQUFFLENBQUMsS0FBb0IsRUFBRSxFQUFFO1lBQ3pELElBQUcsS0FBSyxDQUFDLEtBQUssSUFBSSxvQkFBb0IsRUFBQztnQkFDbkMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxvQkFBb0IsRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFDNUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLHFCQUFxQixFQUFFLENBQUMsQ0FBQzthQUN0RjtpQkFBTSxJQUFHLElBQUksQ0FBQyx5QkFBeUIsSUFBSSxJQUFJLEVBQUM7Z0JBQzdDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUNsQztZQUNELElBQUcsSUFBSSxDQUFDLHlCQUF5QixJQUFJLElBQUksRUFBQztnQkFDdEMsSUFBSSxDQUFDLHlCQUF5QixFQUFFLENBQUM7Z0JBQ2pDLElBQUksQ0FBQyx5QkFBeUIsR0FBRyxJQUFJLENBQUM7YUFDekM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUVQLENBQUM7SUFFRCwwQkFBMEIsQ0FBQyxRQUFrQztRQUN6RCxJQUFJLENBQUMsa0JBQWtCLEdBQUcsUUFBUSxDQUFDO0lBQ3ZDLENBQUM7SUFFRCxpQ0FBaUMsQ0FBQyx5QkFBcUM7UUFDbkUsSUFBSSxDQUFDLHlCQUF5QixHQUFHLHlCQUF5QixDQUFDO1FBQzNELE9BQU8sQ0FBQyxTQUFTLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQzlCLENBQUM7Q0FNSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1haW4gfSBmcm9tIFwiLi4vTWFpbi5qc1wiO1xyXG5cclxuZXhwb3J0IHR5cGUgV2luZG93QmFja0J1dHRvbkxpc3RlbmVyID0gKGV2ZW50OiBQb3BTdGF0ZUV2ZW50KSA9PiB2b2lkO1xyXG5cclxuZXhwb3J0IGNsYXNzIFdpbmRvd1N0YXRlTWFuYWdlciB7XHJcblxyXG4gICAgYmFja0J1dHRvbkxpc3RlbmVyOiBXaW5kb3dCYWNrQnV0dG9uTGlzdGVuZXI7XHJcbiAgICBvbmVUaW1lQmFja0J1dHRvbkxpc3RlbmVyOiAoKSA9PiB2b2lkO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgbWFpbjogTWFpbil7XHJcbiAgICAgICAgbGV0IHRoYXQgPSB0aGlzO1xyXG4gICAgICAgIGhpc3RvcnkucHVzaFN0YXRlKFwiUHJldmVudExlYXZpbmdTaXRlXCIsIFwiXCIpO1xyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdwb3BzdGF0ZScsIChldmVudDogUG9wU3RhdGVFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICBpZihldmVudC5zdGF0ZSA9PSBcIlByZXZlbnRMZWF2aW5nU2l0ZVwiKXtcclxuICAgICAgICAgICAgICAgIGhpc3RvcnkucHVzaFN0YXRlKFwiUHJldmVudExlYXZpbmdTaXRlXCIsIFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgdGhhdC5tYWluLmVkaXRvci5wdXNoSGlzdG9yeVN0YXRlKGZhbHNlLCB0aGF0Lm1haW4uZWRpdG9yLmdldFBvc2l0aW9uRm9ySGlzdG9yeSgpKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmKHRoaXMub25lVGltZUJhY2tCdXR0b25MaXN0ZW5lciA9PSBudWxsKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuYmFja0J1dHRvbkxpc3RlbmVyKGV2ZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZih0aGlzLm9uZVRpbWVCYWNrQnV0dG9uTGlzdGVuZXIgIT0gbnVsbCl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uZVRpbWVCYWNrQnV0dG9uTGlzdGVuZXIoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMub25lVGltZUJhY2tCdXR0b25MaXN0ZW5lciA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgcmVnaXN0ZXJCYWNrQnV0dG9uTGlzdGVuZXIobGlzdGVuZXI6IFdpbmRvd0JhY2tCdXR0b25MaXN0ZW5lcil7XHJcbiAgICAgICAgdGhpcy5iYWNrQnV0dG9uTGlzdGVuZXIgPSBsaXN0ZW5lcjtcclxuICAgIH1cclxuXHJcbiAgICByZWdpc3Rlck9uZVRpbWVCYWNrQnV0dG9uTGlzdGVuZXIob25lVGltZUJhY2tCdXR0b25MaXN0ZW5lcjogKCkgPT4gdm9pZCl7XHJcbiAgICAgICAgdGhpcy5vbmVUaW1lQmFja0J1dHRvbkxpc3RlbmVyID0gb25lVGltZUJhY2tCdXR0b25MaXN0ZW5lcjtcclxuICAgICAgICBoaXN0b3J5LnB1c2hTdGF0ZSh7fSwgXCJcIik7XHJcbiAgICB9XHJcblxyXG5cclxuXHJcbiAgICBcclxuXHJcbn0iXX0=