import { Module, ModuleStore } from "../compiler/parser/Module.js";
import { Evaluator } from "../interpreter/Evaluator.js";
export class Workspace {
    constructor(name, main, owner_id) {
        this.main = main;
        this.saved = true;
        this.name = name;
        this.owner_id = owner_id;
        this.moduleStore = new ModuleStore(main, true);
        this.evaluator = new Evaluator(this, main);
    }
    getWorkspaceData(withFiles) {
        let wd = {
            name: this.name,
            id: this.id,
            owner_id: this.owner_id,
            currentFileId: this.currentlyOpenModule == null ? null : this.currentlyOpenModule.file.id,
            files: [],
            version: this.version,
            repository_id: this.repository_id,
            has_write_permission_to_repository: this.has_write_permission_to_repository,
            language: 0,
            sql_baseDatabase: "",
            sql_history: "",
            sql_manipulateDatabaseStatements: ""
        };
        if (withFiles) {
            for (let m of this.moduleStore.getModules(false)) {
                wd.files.push(m.getFileData(this));
            }
        }
        return wd;
    }
    renderSynchronizeButton(panelElement) {
        var _a;
        let $buttonDiv = (_a = panelElement === null || panelElement === void 0 ? void 0 : panelElement.$htmlFirstLine) === null || _a === void 0 ? void 0 : _a.find('.jo_additionalButtonRepository');
        if ($buttonDiv == null)
            return;
        let that = this;
        let myMain = this.main;
        if (this.repository_id != null && this.owner_id == myMain.user.id) {
            let $button = jQuery('<div class="jo_startButton img_open-change jo_button jo_active" title="Workspace mit Repository synchronisieren"></div>');
            $buttonDiv.append($button);
            let that = this;
            $button.on('mousedown', (e) => e.stopPropagation());
            $button.on('click', (e) => {
                e.stopPropagation();
                that.synchronizeWithRepository();
            });
        }
        else {
            $buttonDiv.find('.jo_startButton').remove();
        }
    }
    synchronizeWithRepository() {
        let myMain = this.main;
        if (this.repository_id != null && this.owner_id == myMain.user.id) {
            myMain.networkManager.sendUpdates(() => {
                myMain.synchronizationManager.synchronizeWithWorkspace(this);
            }, true);
        }
    }
    static restoreFromData(ws, main) {
        let w = new Workspace(ws.name, main, ws.owner_id);
        w.id = ws.id;
        w.owner_id = ws.owner_id;
        w.version = ws.version;
        w.repository_id = ws.repository_id;
        w.has_write_permission_to_repository = ws.has_write_permission_to_repository;
        for (let f of ws.files) {
            let m = Module.restoreFromData(f, main);
            w.moduleStore.putModule(m);
            if (f.id == ws.currentFileId) {
                w.currentlyOpenModule = m;
            }
        }
        return w;
    }
    hasErrors() {
        return this.moduleStore.hasErrors();
    }
    getModuleByMonacoModel(model) {
        for (let m of this.moduleStore.getModules(false)) {
            if (m.model == model) {
                return m;
            }
        }
        return null;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV29ya3NwYWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NsaWVudC93b3Jrc3BhY2UvV29ya3NwYWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDbkUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBTXhELE1BQU0sT0FBTyxTQUFTO0lBc0JsQixZQUFZLElBQVksRUFBVSxJQUFjLEVBQUUsUUFBZ0I7UUFBaEMsU0FBSSxHQUFKLElBQUksQ0FBVTtRQU5oRCxVQUFLLEdBQVksSUFBSSxDQUFDO1FBT2xCLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxXQUFXLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQy9DLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxTQUFTLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQy9DLENBQUM7SUFFRCxnQkFBZ0IsQ0FBQyxTQUFrQjtRQUMvQixJQUFJLEVBQUUsR0FBa0I7WUFDcEIsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO1lBQ2YsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFO1lBQ1gsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRO1lBQ3ZCLGFBQWEsRUFBRSxJQUFJLENBQUMsbUJBQW1CLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUN6RixLQUFLLEVBQUUsRUFBRTtZQUNULE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTztZQUNyQixhQUFhLEVBQUUsSUFBSSxDQUFDLGFBQWE7WUFDakMsa0NBQWtDLEVBQUUsSUFBSSxDQUFDLGtDQUFrQztZQUMzRSxRQUFRLEVBQUUsQ0FBQztZQUNYLGdCQUFnQixFQUFFLEVBQUU7WUFDcEIsV0FBVyxFQUFFLEVBQUU7WUFDZixnQ0FBZ0MsRUFBRSxFQUFFO1NBQ3ZDLENBQUE7UUFFRCxJQUFHLFNBQVMsRUFBQztZQUNULEtBQUksSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLEVBQUM7Z0JBRTVDLEVBQUUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQzthQUV0QztTQUNKO1FBRUQsT0FBTyxFQUFFLENBQUM7SUFDZCxDQUFDO0lBR0QsdUJBQXVCLENBQUMsWUFBOEI7O1FBQ2xELElBQUksVUFBVSxTQUFHLFlBQVksYUFBWixZQUFZLHVCQUFaLFlBQVksQ0FBRSxjQUFjLDBDQUFFLElBQUksQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO1FBQ3RGLElBQUksVUFBVSxJQUFJLElBQUk7WUFBRSxPQUFPO1FBRS9CLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQztRQUNoQixJQUFJLE1BQU0sR0FBZSxJQUFJLENBQUMsSUFBSSxDQUFDO1FBRW5DLElBQUksSUFBSSxDQUFDLGFBQWEsSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLFFBQVEsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUMvRCxJQUFJLE9BQU8sR0FBRyxNQUFNLENBQUMseUhBQXlILENBQUMsQ0FBQztZQUNoSixVQUFVLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQzNCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQztZQUNoQixPQUFPLENBQUMsRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLGVBQWUsRUFBRSxDQUFDLENBQUM7WUFDcEQsT0FBTyxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRTtnQkFDdEIsQ0FBQyxDQUFDLGVBQWUsRUFBRSxDQUFDO2dCQUVwQixJQUFJLENBQUMseUJBQXlCLEVBQUUsQ0FBQztZQUVyQyxDQUFDLENBQUMsQ0FBQztTQUVOO2FBQU07WUFDSCxVQUFVLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7U0FDL0M7SUFDTCxDQUFDO0lBRUQseUJBQXlCO1FBQ3JCLElBQUksTUFBTSxHQUFlLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDbkMsSUFBRyxJQUFJLENBQUMsYUFBYSxJQUFJLElBQUksSUFBSSxJQUFJLENBQUMsUUFBUSxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFDO1lBQzdELE1BQU0sQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRTtnQkFDbkMsTUFBTSxDQUFDLHNCQUFzQixDQUFDLHdCQUF3QixDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2pFLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztTQUNaO0lBQ0wsQ0FBQztJQUVELE1BQU0sQ0FBQyxlQUFlLENBQUMsRUFBaUIsRUFBRSxJQUFVO1FBRWhELElBQUksQ0FBQyxHQUFHLElBQUksU0FBUyxDQUFDLEVBQUUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNsRCxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUM7UUFDYixDQUFDLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQyxRQUFRLENBQUM7UUFDekIsQ0FBQyxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDO1FBQ3ZCLENBQUMsQ0FBQyxhQUFhLEdBQUcsRUFBRSxDQUFDLGFBQWEsQ0FBQztRQUNuQyxDQUFDLENBQUMsa0NBQWtDLEdBQUcsRUFBRSxDQUFDLGtDQUFrQyxDQUFDO1FBRTdFLEtBQUksSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLEtBQUssRUFBQztZQUVsQixJQUFJLENBQUMsR0FBVyxNQUFNLENBQUMsZUFBZSxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNoRCxDQUFDLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUUzQixJQUFHLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLGFBQWEsRUFBQztnQkFDeEIsQ0FBQyxDQUFDLG1CQUFtQixHQUFHLENBQUMsQ0FBQzthQUM3QjtTQUVKO1FBRUQsT0FBTyxDQUFDLENBQUM7SUFFYixDQUFDO0lBRUQsU0FBUztRQUVMLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUV4QyxDQUFDO0lBRUQsc0JBQXNCLENBQUMsS0FBK0I7UUFDbEQsS0FBSSxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsRUFBQztZQUM1QyxJQUFHLENBQUMsQ0FBQyxLQUFLLElBQUksS0FBSyxFQUFDO2dCQUNoQixPQUFPLENBQUMsQ0FBQzthQUNaO1NBQ0o7UUFFRCxPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBXb3Jrc3BhY2VEYXRhIH0gZnJvbSBcIi4uL2NvbW11bmljYXRpb24vRGF0YS5qc1wiO1xyXG5pbXBvcnQgeyBNb2R1bGUsIE1vZHVsZVN0b3JlIH0gZnJvbSBcIi4uL2NvbXBpbGVyL3BhcnNlci9Nb2R1bGUuanNcIjtcclxuaW1wb3J0IHsgRXZhbHVhdG9yIH0gZnJvbSBcIi4uL2ludGVycHJldGVyL0V2YWx1YXRvci5qc1wiO1xyXG5pbXBvcnQgeyBBY2NvcmRpb25FbGVtZW50IH0gZnJvbSBcIi4uL21haW4vZ3VpL0FjY29yZGlvbi5qc1wiO1xyXG5pbXBvcnQgeyBNYWluIH0gZnJvbSBcIi4uL21haW4vTWFpbi5qc1wiO1xyXG5pbXBvcnQgeyBNYWluQmFzZSB9IGZyb20gXCIuLi9tYWluL01haW5CYXNlLmpzXCI7XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIFdvcmtzcGFjZSB7XHJcbiAgICBcclxuICAgIG5hbWU6IHN0cmluZztcclxuICAgIGlkOiBudW1iZXI7XHJcbiAgICBvd25lcl9pZDogbnVtYmVyO1xyXG5cclxuICAgIHZlcnNpb246IG51bWJlcjtcclxuICAgIC8vIHB1Ymxpc2hlZF90byAwOiBub25lOyAxOiBjbGFzczsgMjogc2Nob29sOyAzOiBhbGxcclxuICAgIHB1Ymxpc2hlZF90bzogbnVtYmVyO1xyXG4gICAgXHJcbiAgICByZXBvc2l0b3J5X2lkOiBudW1iZXI7ICAgIC8vIGlkIG9mIHJlcG9zaXRvcnktd29ya3NwYWNlXHJcbiAgICBoYXNfd3JpdGVfcGVybWlzc2lvbl90b19yZXBvc2l0b3J5OiBib29sZWFuOyAvLyB0cnVlIGlmIG93bmVyIG9mIHRoaXMgd29ya2luZyBjb3B5IGhhcyB3cml0ZSBwZXJtaXNzaW9uIHRvIHJlcG9zaXRvcnkgd29ya3NwYWNlXHJcblxyXG4gICAgbW9kdWxlU3RvcmU6IE1vZHVsZVN0b3JlO1xyXG4gICAgcGFuZWxFbGVtZW50OiBBY2NvcmRpb25FbGVtZW50O1xyXG4gICAgY3VycmVudGx5T3Blbk1vZHVsZTogTW9kdWxlO1xyXG4gICAgc2F2ZWQ6IGJvb2xlYW4gPSB0cnVlO1xyXG5cclxuICAgIGNvbXBpbGVyTWVzc2FnZTogc3RyaW5nO1xyXG5cclxuICAgIGV2YWx1YXRvcjogRXZhbHVhdG9yO1xyXG4gICAgXHJcbiAgICBjb25zdHJ1Y3RvcihuYW1lOiBzdHJpbmcsIHByaXZhdGUgbWFpbjogTWFpbkJhc2UsIG93bmVyX2lkOiBudW1iZXIpe1xyXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgdGhpcy5vd25lcl9pZCA9IG93bmVyX2lkO1xyXG4gICAgICAgIHRoaXMubW9kdWxlU3RvcmUgPSBuZXcgTW9kdWxlU3RvcmUobWFpbiwgdHJ1ZSk7XHJcbiAgICAgICAgdGhpcy5ldmFsdWF0b3IgPSBuZXcgRXZhbHVhdG9yKHRoaXMsIG1haW4pO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBnZXRXb3Jrc3BhY2VEYXRhKHdpdGhGaWxlczogYm9vbGVhbik6IFdvcmtzcGFjZURhdGEge1xyXG4gICAgICAgIGxldCB3ZDogV29ya3NwYWNlRGF0YSA9IHtcclxuICAgICAgICAgICAgbmFtZTogdGhpcy5uYW1lLFxyXG4gICAgICAgICAgICBpZDogdGhpcy5pZCxcclxuICAgICAgICAgICAgb3duZXJfaWQ6IHRoaXMub3duZXJfaWQsXHJcbiAgICAgICAgICAgIGN1cnJlbnRGaWxlSWQ6IHRoaXMuY3VycmVudGx5T3Blbk1vZHVsZSA9PSBudWxsID8gbnVsbCA6IHRoaXMuY3VycmVudGx5T3Blbk1vZHVsZS5maWxlLmlkLFxyXG4gICAgICAgICAgICBmaWxlczogW10sXHJcbiAgICAgICAgICAgIHZlcnNpb246IHRoaXMudmVyc2lvbixcclxuICAgICAgICAgICAgcmVwb3NpdG9yeV9pZDogdGhpcy5yZXBvc2l0b3J5X2lkLFxyXG4gICAgICAgICAgICBoYXNfd3JpdGVfcGVybWlzc2lvbl90b19yZXBvc2l0b3J5OiB0aGlzLmhhc193cml0ZV9wZXJtaXNzaW9uX3RvX3JlcG9zaXRvcnksXHJcbiAgICAgICAgICAgIGxhbmd1YWdlOiAwLFxyXG4gICAgICAgICAgICBzcWxfYmFzZURhdGFiYXNlOiBcIlwiLFxyXG4gICAgICAgICAgICBzcWxfaGlzdG9yeTogXCJcIixcclxuICAgICAgICAgICAgc3FsX21hbmlwdWxhdGVEYXRhYmFzZVN0YXRlbWVudHM6IFwiXCJcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHdpdGhGaWxlcyl7XHJcbiAgICAgICAgICAgIGZvcihsZXQgbSBvZiB0aGlzLm1vZHVsZVN0b3JlLmdldE1vZHVsZXMoZmFsc2UpKXtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgd2QuZmlsZXMucHVzaChtLmdldEZpbGVEYXRhKHRoaXMpKTtcclxuICAgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gd2Q7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHJlbmRlclN5bmNocm9uaXplQnV0dG9uKHBhbmVsRWxlbWVudDogQWNjb3JkaW9uRWxlbWVudCkge1xyXG4gICAgICAgIGxldCAkYnV0dG9uRGl2ID0gcGFuZWxFbGVtZW50Py4kaHRtbEZpcnN0TGluZT8uZmluZCgnLmpvX2FkZGl0aW9uYWxCdXR0b25SZXBvc2l0b3J5Jyk7XHJcbiAgICAgICAgaWYgKCRidXR0b25EaXYgPT0gbnVsbCkgcmV0dXJuO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGxldCB0aGF0ID0gdGhpcztcclxuICAgICAgICBsZXQgbXlNYWluOiBNYWluID0gPE1haW4+dGhpcy5tYWluO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5yZXBvc2l0b3J5X2lkICE9IG51bGwgJiYgdGhpcy5vd25lcl9pZCA9PSBteU1haW4udXNlci5pZCkge1xyXG4gICAgICAgICAgICBsZXQgJGJ1dHRvbiA9IGpRdWVyeSgnPGRpdiBjbGFzcz1cImpvX3N0YXJ0QnV0dG9uIGltZ19vcGVuLWNoYW5nZSBqb19idXR0b24gam9fYWN0aXZlXCIgdGl0bGU9XCJXb3Jrc3BhY2UgbWl0IFJlcG9zaXRvcnkgc3luY2hyb25pc2llcmVuXCI+PC9kaXY+Jyk7XHJcbiAgICAgICAgICAgICRidXR0b25EaXYuYXBwZW5kKCRidXR0b24pO1xyXG4gICAgICAgICAgICBsZXQgdGhhdCA9IHRoaXM7XHJcbiAgICAgICAgICAgICRidXR0b24ub24oJ21vdXNlZG93bicsIChlKSA9PiBlLnN0b3BQcm9wYWdhdGlvbigpKTtcclxuICAgICAgICAgICAgJGJ1dHRvbi5vbignY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGF0LnN5bmNocm9uaXplV2l0aFJlcG9zaXRvcnkoKTtcclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAkYnV0dG9uRGl2LmZpbmQoJy5qb19zdGFydEJ1dHRvbicpLnJlbW92ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzeW5jaHJvbml6ZVdpdGhSZXBvc2l0b3J5KCl7XHJcbiAgICAgICAgbGV0IG15TWFpbjogTWFpbiA9IDxNYWluPnRoaXMubWFpbjtcclxuICAgICAgICBpZih0aGlzLnJlcG9zaXRvcnlfaWQgIT0gbnVsbCAmJiB0aGlzLm93bmVyX2lkID09IG15TWFpbi51c2VyLmlkKXtcclxuICAgICAgICAgICAgbXlNYWluLm5ldHdvcmtNYW5hZ2VyLnNlbmRVcGRhdGVzKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIG15TWFpbi5zeW5jaHJvbml6YXRpb25NYW5hZ2VyLnN5bmNocm9uaXplV2l0aFdvcmtzcGFjZSh0aGlzKTtcclxuICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyByZXN0b3JlRnJvbURhdGEod3M6IFdvcmtzcGFjZURhdGEsIG1haW46IE1haW4pOiBXb3Jrc3BhY2Uge1xyXG5cclxuICAgICAgICBsZXQgdyA9IG5ldyBXb3Jrc3BhY2Uod3MubmFtZSwgbWFpbiwgd3Mub3duZXJfaWQpO1xyXG4gICAgICAgIHcuaWQgPSB3cy5pZDtcclxuICAgICAgICB3Lm93bmVyX2lkID0gd3Mub3duZXJfaWQ7XHJcbiAgICAgICAgdy52ZXJzaW9uID0gd3MudmVyc2lvbjtcclxuICAgICAgICB3LnJlcG9zaXRvcnlfaWQgPSB3cy5yZXBvc2l0b3J5X2lkO1xyXG4gICAgICAgIHcuaGFzX3dyaXRlX3Blcm1pc3Npb25fdG9fcmVwb3NpdG9yeSA9IHdzLmhhc193cml0ZV9wZXJtaXNzaW9uX3RvX3JlcG9zaXRvcnk7XHJcblxyXG4gICAgICAgIGZvcihsZXQgZiBvZiB3cy5maWxlcyl7XHJcblxyXG4gICAgICAgICAgICBsZXQgbTogTW9kdWxlID0gTW9kdWxlLnJlc3RvcmVGcm9tRGF0YShmLCBtYWluKTtcclxuICAgICAgICAgICAgdy5tb2R1bGVTdG9yZS5wdXRNb2R1bGUobSk7XHJcblxyXG4gICAgICAgICAgICBpZihmLmlkID09IHdzLmN1cnJlbnRGaWxlSWQpe1xyXG4gICAgICAgICAgICAgICAgdy5jdXJyZW50bHlPcGVuTW9kdWxlID0gbTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB3O1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBoYXNFcnJvcnMoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHRoaXMubW9kdWxlU3RvcmUuaGFzRXJyb3JzKCk7XHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgZ2V0TW9kdWxlQnlNb25hY29Nb2RlbChtb2RlbDogbW9uYWNvLmVkaXRvci5JVGV4dE1vZGVsKTogTW9kdWxlIHtcclxuICAgICAgICBmb3IobGV0IG0gb2YgdGhpcy5tb2R1bGVTdG9yZS5nZXRNb2R1bGVzKGZhbHNlKSl7XHJcbiAgICAgICAgICAgIGlmKG0ubW9kZWwgPT0gbW9kZWwpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbn1cclxuXHJcbiJdfQ==