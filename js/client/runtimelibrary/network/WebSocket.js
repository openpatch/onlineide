import { Klass } from "../../compiler/types/Class.js";
import { intPrimitiveType, stringPrimitiveType, voidPrimitiveType } from "../../compiler/types/PrimitiveTypes.js";
import { Method, Parameterlist } from "../../compiler/types/Types.js";
import { InterpreterState } from "../../interpreter/Interpreter.js";
import { RuntimeObject } from "../../interpreter/RuntimeObject.js";
import { WebSocketClientHelper } from "./WebSocketClient.js";
import { ajax } from "../../communication/AjaxHelper.js";
import { ArrayType } from "../../compiler/types/Array.js";
export class WebSocketClass extends Klass {
    constructor(module) {
        super("WebSocket", module, "Ein Objekt der Klasse WebSocket kann Daten über das Internet senden und empfangen. Um die Klasse benutzen zu können, musst Du eine eigene Klasse schreiben, die die Klasse WebSocket erweitert und die Methoden onConnect, onMessage, onOtherClientConnected und onOtherClientDisconnected überschreibt.");
        this.setBaseClass(module.typeStore.getType("Object"));
        let webSocketClientType = module.typeStore.getType("WebSocketClient");
        let systemClassType = module.typeStore.getType("System");
        this.addMethod(new Method("WebSocket", new Parameterlist([]), null, (parameters) => {
            var _a, _b;
            let o = parameters[0].value;
            let interpreter = (_b = (_a = this.module) === null || _a === void 0 ? void 0 : _a.main) === null || _b === void 0 ? void 0 : _b.getInterpreter();
            let wh = new WebSocketHelper(o, interpreter, webSocketClientType, systemClassType);
            o.intrinsicData["Helper"] = wh;
        }, false, false, 'Instanziert ein neues WebSocket-Objekt.', true));
        this.addMethod(new Method("open", new Parameterlist([
            { identifier: "sessionCode", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "nickName", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), null, (parameters) => {
            let o = parameters[0].value;
            let sessionCode = parameters[1].value;
            let nickName = parameters[2].value;
            let wh = o.intrinsicData["Helper"];
            wh.connect(sessionCode, nickName);
            o.intrinsicData["Helper"] = wh;
        }, false, false, 'Startet die Verbindung mit dem Server. Den SessionCode kannst Du frei wählen. Mit allen anderen Clients, die eine Verbindung mit demselben SessionCode aufbauen, kannst Du anschließend Daten austauschen. Auch der Nickname ist frei wählbar. Er ist für alle anderen Clients sichtbar.', false));
        this.addMethod(new Method("sendToAll", new Parameterlist([
            { identifier: "message", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "messageType", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), voidPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            let wh = o.intrinsicData["Helper"];
            let message = parameters[1].value;
            let messageType = parameters[2].value;
            wh.sendToAll(message, messageType);
        }, false, false, 'Sendet Daten (message) an alle anderen Clients. Den messageType kannst Du frei wählen. Die empfangenden Clients bekommen ihn zusammen mit den Daten übermittelt. Tipp: Du kannst auch Objekte senden, musst sie dazu aber vorher serialisieren, d.h. mithilfe der Methode toJson in eine Zeichenkette verwandeln.', false));
        this.addMethod(new Method("findClients", new Parameterlist([
            { identifier: "count", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), voidPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            let wh = o.intrinsicData["Helper"];
            let count = parameters[1].value;
            wh.findClientsFromCount(count);
        }, false, false, 'Sucht die übergebene Anzahl von "kontaktbereiten" Clients, d.h. solchen Clients, die exakt dieselbe Suchanfrage abgegeben haben. Findet der Server die Clients, so ruft er bei allen beteiligten Clients onClientsFound auf.', false));
        this.addMethod(new Method("findClients", new Parameterlist([
            { identifier: "nicknames", type: new ArrayType(stringPrimitiveType), declaration: null, usagePositions: null, isFinal: true },
        ]), voidPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            let wh = o.intrinsicData["Helper"];
            let nickNamesValues = parameters[1].value;
            let nicknames = nickNamesValues.map((nnv) => nnv.value);
            wh.findClientsFromNicknames(nicknames);
        }, false, false, 'Sucht die Clients mit den angegebenen Nicknames. Haben sie eine entsprechende Suchanfrage (d.h. dieselben Nicknames) abgegeben, so so ruft der Server bei allen beteiligten Clients onClientsFound auf.', false));
        this.addMethod(new Method("findClient", new Parameterlist([
            { identifier: "nickname", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), voidPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            let wh = o.intrinsicData["Helper"];
            let nickName = parameters[1].value;
            wh.findClientsFromNicknames([nickName]);
        }, false, false, 'Sucht den Client mit dem angegebenen Nickname. Hat er eine entsprechende Suchanfrage (d.h. mit dem Nickname DIESES clients) abgegeben, so so ruft der Server bei beiden Clients onClientsFound auf.', false));
        this.addMethod(new Method("close", new Parameterlist([]), voidPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            let wh = o.intrinsicData["Helper"];
            wh.disconnect();
        }, false, false, 'Beendet die Verbindung. Bei allen anderen Clients, die sich mit derselben sessionId verbunden haben, wird daraufhin die Methode onOtherClientDisconnected aufgerufen.', false));
        this.addMethod(new Method("onOpen", new Parameterlist([]), null, null, // no statements!
        false, false, "Wird aufgerufen, sobald die Verbindung mit dem Server zustandegekommen ist.", false));
        this.addMethod(new Method("onClose", new Parameterlist([]), null, null, // no statements!
        false, false, "Wird aufgerufen, nachdem die Verbindung geschlossen wurde.", false));
        this.addMethod(new Method("onMessage", new Parameterlist([
            { identifier: "sender", type: webSocketClientType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "message", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "messageType", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), null, null, // no statements!
        false, false, "Wird immer dann aufgerufen, wenn eine Nachricht eines anderen Clients empfangen wurde.", false));
        this.addMethod(new Method("onOtherClientConnected", new Parameterlist([
            { identifier: "otherClient", type: webSocketClientType, declaration: null, usagePositions: null, isFinal: true }
        ]), null, null, // no statements!
        false, false, "Wird immer dann aufgerufen, wenn sich ein anderer Client unter Nutzung desselben sessionCodes mit dem Server verbunden hat.", false));
        this.addMethod(new Method("onOtherClientDisConnected", new Parameterlist([
            { identifier: "otherClient", type: webSocketClientType, declaration: null, usagePositions: null, isFinal: true }
        ]), null, null, // no statements!
        false, false, "Wird immer dann aufgerufen, wenn ein anderer Client unter Nutzung desselben sessionCodes die Verbindung mit dem Server beendet hat.", false));
        this.addMethod(new Method("onClientsFound", new Parameterlist([
            { identifier: "clients", type: new ArrayType(webSocketClientType), declaration: null, usagePositions: null, isFinal: true },
            { identifier: "ownIndex", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true }
        ]), null, null, // no statements!
        false, false, "Wird aufgerufen, wenn die durch die Methoden findClient bzw. findClients zuvor gesuchten Clients gefunden wurden.", false));
    }
}
export class WebSocketHelper {
    constructor(runtimeObject, interpreter, webSocketClientType, systemClassType) {
        this.runtimeObject = runtimeObject;
        this.interpreter = interpreter;
        this.webSocketClientType = webSocketClientType;
        this.systemClassType = systemClassType;
        this.clientList = [];
        this.idToClientMap = {};
        this.isOpen = false;
        this.unsentMessages = [];
        let klass = runtimeObject.class;
        // [[Entries]]:Array(4)
        // 0:{"Test3()" => Method}
        // 1:{"onConnect()" => Method}
        // 2:{"onMessage(WebSocketClient, String, String)" => Method}
        // 3:{"toJson()" => Method}
        this.onOpenMethod = klass.methods.find(m => m.signature == "onOpen()");
        this.onCloseMethod = klass.methods.find(m => m.signature == "onClose()");
        this.onMessageMethod = klass.methods.find(m => m.signature == "onMessage(WebSocketClient, String, String)");
        this.onClientConnectedMethod = klass.methods.find(m => m.signature == "onOtherClientConnected(WebSocketClient)");
        this.onClientDisconnectedMethod = klass.methods.find(m => m.signature == "onOtherClientDisconnected(WebSocketClient)");
        this.onClientsFoundMethod = klass.methods.find(m => m.signature == "onClientsFound(WebSocketClient[], int)");
    }
    connect(sessionCode, nickName) {
        if (this.interpreter.main.isEmbedded()) {
            this.interpreter.throwException("Die Netzwerkfunktionalitäten stehen nur eingeloggten Nutzern in der Entwicklungsumgebung zur Verfügung und können daher leider hier nicht ausprobiert werden.");
            return;
        }
        ajax('getWebSocketToken', {}, (response) => {
            let url = (window.location.protocol.startsWith("https") ? "wss://" : "ws://") + window.location.host + "/websocket";
            this.connection = new WebSocket(url);
            this.connection.onerror = (error) => { this.onError(error); };
            this.connection.onclose = (event) => { this.onClose(event); };
            this.connection.onmessage = (event) => { this.onMessage(event); };
            this.connection.onopen = (event) => {
                let request = {
                    command: 1,
                    token: response.token,
                    nickname: nickName,
                    sessionCode: sessionCode
                };
                this.interpreter.webSocketsToCloseAfterProgramHalt.push(this.connection);
                this.isOpen = true;
                this.sendIntern(JSON.stringify(request));
                this.onOpen();
            };
        });
    }
    sendIntern(message) {
        if (!this.isOpen) {
            this.unsentMessages.push(message);
        }
        else {
            try {
                this.connection.send(message);
            }
            catch (exception) {
                console.log(exception);
            }
        }
    }
    onClose(event) {
        this.isOpen = false;
        this.runMethod(this.onCloseMethod, []);
    }
    sendToClient(clientId, data, dataType) {
        let message = {
            command: 3,
            data: data,
            dataType: dataType,
            recipient_id: clientId
        };
        this.sendIntern(JSON.stringify(message));
    }
    sendToAll(data, dataType) {
        let message = {
            command: 2,
            data: data,
            dataType: dataType
        };
        this.sendIntern(JSON.stringify(message));
    }
    disconnect() {
        let message = {
            command: 4
        };
        this.sendIntern(JSON.stringify(message));
        this.connection.close();
        let wtr = this.interpreter.webSocketsToCloseAfterProgramHalt;
        wtr.splice(wtr.indexOf(this.connection), 1);
    }
    onMessage(event) {
        let response = JSON.parse(event.data);
        if (response.command == undefined)
            return;
        switch (response.command) {
            case 1: // new Client
                let clientRuntimeObject = new RuntimeObject(this.webSocketClientType);
                let wch = new WebSocketClientHelper(clientRuntimeObject, this, response.user_id, response.rufname, response.familienname, response.username, response.nickname);
                clientRuntimeObject.intrinsicData["Helper"] = wch;
                this.clientList.push(wch);
                this.idToClientMap[response.user_id] = wch;
                this.runMethod(this.onClientConnectedMethod, [{ type: this.webSocketClientType, value: clientRuntimeObject }]);
                break;
            case 2: // message
                let clientHelper = this.idToClientMap[response.from_client_id];
                if (clientHelper == null)
                    return;
                this.runMethod(this.onMessageMethod, [
                    { type: this.webSocketClientType, value: clientHelper.runtimeObject },
                    { type: stringPrimitiveType, value: response.data },
                    { type: stringPrimitiveType, value: response.dataType }
                ]);
                break;
            case 3: // other client disconnected
                let clientHelper1 = this.idToClientMap[response.disconnecting_client_id];
                if (clientHelper1 == null)
                    return;
                this.clientList.splice(this.clientList.indexOf(clientHelper1), 1);
                this.idToClientMap[response.disconnecting_client_id] = undefined;
                this.runMethod(this.onClientDisconnectedMethod, [
                    { type: this.webSocketClientType, value: clientHelper1.runtimeObject }
                ]);
                break;
            case 4: // time synchronization
                this.systemClassType.deltaTimeMillis = response.currentTimeMills - Date.now();
                this.client_id = response.client_id;
                break;
            case 5: // keep alive
                break;
            case 6: // Clients found
                this.onClientsFound(response);
                break;
        }
    }
    onClientsFound(response) {
        let own_index = 0;
        let otherClients = [];
        for (let client of response.clients) {
            if (client.id == this.client_id) {
                own_index = client.index;
            }
            else {
                let otherClient = this.idToClientMap[client.id];
                if (otherClient != null) {
                    otherClient.index = client.index;
                    otherClients.push({
                        type: this.webSocketClientType,
                        value: otherClient.runtimeObject
                    });
                }
            }
        }
        let arrayValue = {
            type: new ArrayType(this.webSocketClientType),
            value: otherClients
        };
        this.runMethod(this.onClientsFoundMethod, [arrayValue, { type: intPrimitiveType, value: own_index }]);
    }
    onError(error) {
        this.interpreter.throwException("Kommunikationsfehler beim WebSocket");
    }
    onOpen() {
        this.isOpen = true;
        if (this.unsentMessages.length > 0) {
            this.unsentMessages.forEach(m => this.sendIntern(m));
            this.unsentMessages = [];
        }
        this.runMethod(this.onOpenMethod, []);
    }
    runMethod(method, stackElements) {
        if (method == null)
            return;
        stackElements.splice(0, 0, {
            type: this.runtimeObject.class,
            value: this.runtimeObject
        });
        if (this.interpreter.state == InterpreterState.waitingForInput) {
            this.interpreter.executeImmediatelyInNewStackframe(method.program, stackElements);
        }
        else {
            this.interpreter.runTimer(method, stackElements, () => { }, false);
        }
    }
    findClientsFromCount(count) {
        let message = {
            command: 6,
            count: count,
            nicknames: []
        };
        this.sendIntern(JSON.stringify(message));
    }
    findClientsFromNicknames(nicknames) {
        let message = {
            command: 6,
            count: nicknames.length,
            nicknames: nicknames
        };
        this.sendIntern(JSON.stringify(message));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV2ViU29ja2V0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2NsaWVudC9ydW50aW1lbGlicmFyeS9uZXR3b3JrL1dlYlNvY2tldC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLG1CQUFtQixFQUFFLGlCQUFpQixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDbEgsT0FBTyxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQVMsTUFBTSwrQkFBK0IsQ0FBQztBQUM3RSxPQUFPLEVBQWUsZ0JBQWdCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNqRixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFFbkUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFN0QsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBRXpELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUUxRCxNQUFNLE9BQU8sY0FBZSxTQUFRLEtBQUs7SUFFckMsWUFBWSxNQUFjO1FBQ3RCLEtBQUssQ0FBQyxXQUFXLEVBQUUsTUFBTSxFQUFFLDBTQUEwUyxDQUFDLENBQUM7UUFFdlUsSUFBSSxDQUFDLFlBQVksQ0FBUSxNQUFNLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQzdELElBQUksbUJBQW1CLEdBQVUsTUFBTSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUM3RSxJQUFJLGVBQWUsR0FBZ0IsTUFBTSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFdEUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxXQUFXLEVBQUUsSUFB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QUFDO1lBQ1YsS0FBSyxFQUFFLEtBQUs7WUFDWixTQUFTLEVBQUUsRUFBRTtTQUNoQixDQUFBO1FBRUQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUVELHdCQUF3QixDQUFDLFNBQW1CO1FBQ3hDLElBQUksT0FBTyxHQUFnQztZQUN2QyxPQUFPLEVBQUUsQ0FBQztZQUNWLEtBQUssRUFBRSxTQUFTLENBQUMsTUFBTTtZQUN2QixTQUFTLEVBQUUsU0FBUztTQUN2QixDQUFBO1FBRUQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFDN0MsQ0FBQztDQUdKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTW9kdWxlIH0gZnJvbSBcIi4uLy4uL2NvbXBpbGVyL3BhcnNlci9Nb2R1bGUuanNcIjtcclxuaW1wb3J0IHsgS2xhc3MgfSBmcm9tIFwiLi4vLi4vY29tcGlsZXIvdHlwZXMvQ2xhc3MuanNcIjtcclxuaW1wb3J0IHsgaW50UHJpbWl0aXZlVHlwZSwgc3RyaW5nUHJpbWl0aXZlVHlwZSwgdm9pZFByaW1pdGl2ZVR5cGUgfSBmcm9tIFwiLi4vLi4vY29tcGlsZXIvdHlwZXMvUHJpbWl0aXZlVHlwZXMuanNcIjtcclxuaW1wb3J0IHsgTWV0aG9kLCBQYXJhbWV0ZXJsaXN0LCBWYWx1ZSB9IGZyb20gXCIuLi8uLi9jb21waWxlci90eXBlcy9UeXBlcy5qc1wiO1xyXG5pbXBvcnQgeyBJbnRlcnByZXRlciwgSW50ZXJwcmV0ZXJTdGF0ZSB9IGZyb20gXCIuLi8uLi9pbnRlcnByZXRlci9JbnRlcnByZXRlci5qc1wiO1xyXG5pbXBvcnQgeyBSdW50aW1lT2JqZWN0IH0gZnJvbSBcIi4uLy4uL2ludGVycHJldGVyL1J1bnRpbWVPYmplY3QuanNcIjtcclxuaW1wb3J0IHsgV2ViU29ja2V0UmVxdWVzdENvbm5lY3QsIFdlYlNvY2tldFJlcXVlc3REaXNjb25uZWN0LCBXZWJTb2NrZXRSZXF1ZXN0U2VuZFRvQWxsLCBXZWJTb2NrZXRSZXF1ZXN0U2VuZFRvQ2xpZW50LCBXZWJTb2NrZXRSZXNwb25zZU90aGVyQ2xpZW50RGlzY29ubmVjdGVkLCBXZWJTb2NrZXRSZXNwb25zZU1lc3NhZ2UsIFdlYlNvY2tldFJlc3BvbnNlTmV3Q2xpZW50LCBXZWJTb2NrZXRSZXNwb25zZSwgR2V0V2ViU29ja2V0VG9rZW5SZXNwb25zZSwgV2ViU29ja2V0UmVzcG9uc2VQYWlyaW5nRm91bmQsIFdlYlNvY2tldFJlcXVlc3RGaW5kUGFpcmluZyB9IGZyb20gXCIuLi8uLi9jb21tdW5pY2F0aW9uL0RhdGEuanNcIjtcclxuaW1wb3J0IHsgV2ViU29ja2V0Q2xpZW50SGVscGVyIH0gZnJvbSBcIi4vV2ViU29ja2V0Q2xpZW50LmpzXCI7XHJcbmltcG9ydCB7IFRpbGluZ1Nwcml0ZSB9IGZyb20gXCJwaXhpLmpzXCI7XHJcbmltcG9ydCB7IGFqYXggfSBmcm9tIFwiLi4vLi4vY29tbXVuaWNhdGlvbi9BamF4SGVscGVyLmpzXCI7XHJcbmltcG9ydCB7IFN5c3RlbUNsYXNzIH0gZnJvbSBcIi4uL1N5c3RlbS5qc1wiO1xyXG5pbXBvcnQgeyBBcnJheVR5cGUgfSBmcm9tIFwiLi4vLi4vY29tcGlsZXIvdHlwZXMvQXJyYXkuanNcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBXZWJTb2NrZXRDbGFzcyBleHRlbmRzIEtsYXNzIHtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihtb2R1bGU6IE1vZHVsZSkge1xyXG4gICAgICAgIHN1cGVyKFwiV2ViU29ja2V0XCIsIG1vZHVsZSwgXCJFaW4gT2JqZWt0IGRlciBLbGFzc2UgV2ViU29ja2V0IGthbm4gRGF0ZW4gw7xiZXIgZGFzIEludGVybmV0IHNlbmRlbiB1bmQgZW1wZmFuZ2VuLiBVbSBkaWUgS2xhc3NlIGJlbnV0emVuIHp1IGvDtm5uZW4sIG11c3N0IER1IGVpbmUgZWlnZW5lIEtsYXNzZSBzY2hyZWliZW4sIGRpZSBkaWUgS2xhc3NlIFdlYlNvY2tldCBlcndlaXRlcnQgdW5kIGRpZSBNZXRob2RlbiBvbkNvbm5lY3QsIG9uTWVzc2FnZSwgb25PdGhlckNsaWVudENvbm5lY3RlZCB1bmQgb25PdGhlckNsaWVudERpc2Nvbm5lY3RlZCDDvGJlcnNjaHJlaWJ0LlwiKTtcclxuXHJcbiAgICAgICAgdGhpcy5zZXRCYXNlQ2xhc3MoPEtsYXNzPm1vZHVsZS50eXBlU3RvcmUuZ2V0VHlwZShcIk9iamVjdFwiKSk7XHJcbiAgICAgICAgbGV0IHdlYlNvY2tldENsaWVudFR5cGUgPSA8S2xhc3M+bW9kdWxlLnR5cGVTdG9yZS5nZXRUeXBlKFwiV2ViU29ja2V0Q2xpZW50XCIpO1xyXG4gICAgICAgIGxldCBzeXN0ZW1DbGFzc1R5cGUgPSA8U3lzdGVtQ2xhc3M+bW9kdWxlLnR5cGVTdG9yZS5nZXRUeXBlKFwiU3lzdGVtXCIpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiV2ViU29ja2V0XCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICBdKSwgbnVsbCxcclxuICAgICAgICAgICAgKHBhcmFtZXRlcnMpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgbzogUnVudGltZU9iamVjdCA9IHBhcmFtZXRlcnNbMF0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IGludGVycHJldGVyID0gdGhpcy5tb2R1bGU/Lm1haW4/LmdldEludGVycHJldGVyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHdoID0gbmV3IFdlYlNvY2tldEhlbHBlcihvLCBpbnRlcnByZXRlciwgd2ViU29ja2V0Q2xpZW50VHlwZSwgc3lzdGVtQ2xhc3NUeXBlKTtcclxuXHJcbiAgICAgICAgICAgICAgICBvLmludHJpbnNpY0RhdGFbXCJIZWxwZXJcIl0gPSB3aDtcclxuXHJcbiAgICAgICAgICAgIH0sIGZhbHNlLCBmYWxzZSwgJ0luc3RhbnppZXJ0IGVpbiBuZXVlcyBXZWJTb2NrZXQtT2JqZWt0LicsIHRydWUpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcIm9wZW5cIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwic2Vzc2lvbkNvZGVcIiwgdHlwZTogc3RyaW5nUHJpbWl0aXZlVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH0sXHJcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJuaWNrTmFtZVwiLCB0eXBlOiBzdHJpbmdQcmltaXRpdmVUeXBlLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfSxcclxuICAgICAgICBdKSwgbnVsbCxcclxuICAgICAgICAgICAgKHBhcmFtZXRlcnMpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgbzogUnVudGltZU9iamVjdCA9IHBhcmFtZXRlcnNbMF0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICBsZXQgc2Vzc2lvbkNvZGU6IHN0cmluZyA9IHBhcmFtZXRlcnNbMV0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICBsZXQgbmlja05hbWU6IHN0cmluZyA9IHBhcmFtZXRlcnNbMl0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHdoOiBXZWJTb2NrZXRIZWxwZXIgPSBvLmludHJpbnNpY0RhdGFbXCJIZWxwZXJcIl07XHJcbiAgICAgICAgICAgICAgICB3aC5jb25uZWN0KHNlc3Npb25Db2RlLCBuaWNrTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgby5pbnRyaW5zaWNEYXRhW1wiSGVscGVyXCJdID0gd2g7XHJcblxyXG4gICAgICAgICAgICB9LCBmYWxzZSwgZmFsc2UsICdTdGFydGV0IGRpZSBWZXJiaW5kdW5nIG1pdCBkZW0gU2VydmVyLiBEZW4gU2Vzc2lvbkNvZGUga2FubnN0IER1IGZyZWkgd8OkaGxlbi4gTWl0IGFsbGVuIGFuZGVyZW4gQ2xpZW50cywgZGllIGVpbmUgVmVyYmluZHVuZyBtaXQgZGVtc2VsYmVuIFNlc3Npb25Db2RlIGF1ZmJhdWVuLCBrYW5uc3QgRHUgYW5zY2hsaWXDn2VuZCBEYXRlbiBhdXN0YXVzY2hlbi4gQXVjaCBkZXIgTmlja25hbWUgaXN0IGZyZWkgd8OkaGxiYXIuIEVyIGlzdCBmw7xyIGFsbGUgYW5kZXJlbiBDbGllbnRzIHNpY2h0YmFyLicsXHJcbiAgICAgICAgICAgIGZhbHNlKSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJzZW5kVG9BbGxcIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwibWVzc2FnZVwiLCB0eXBlOiBzdHJpbmdQcmltaXRpdmVUeXBlLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfSxcclxuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcIm1lc3NhZ2VUeXBlXCIsIHR5cGU6IHN0cmluZ1ByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9LFxyXG4gICAgICAgIF0pLCB2b2lkUHJpbWl0aXZlVHlwZSxcclxuICAgICAgICAgICAgKHBhcmFtZXRlcnMpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgbzogUnVudGltZU9iamVjdCA9IHBhcmFtZXRlcnNbMF0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICBsZXQgd2g6IFdlYlNvY2tldEhlbHBlciA9IG8uaW50cmluc2ljRGF0YVtcIkhlbHBlclwiXTtcclxuICAgICAgICAgICAgICAgIGxldCBtZXNzYWdlOiBzdHJpbmcgPSBwYXJhbWV0ZXJzWzFdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgbGV0IG1lc3NhZ2VUeXBlOiBzdHJpbmcgPSBwYXJhbWV0ZXJzWzJdLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgIHdoLnNlbmRUb0FsbChtZXNzYWdlLCBtZXNzYWdlVHlwZSk7XHJcblxyXG4gICAgICAgICAgICB9LCBmYWxzZSwgZmFsc2UsICdTZW5kZXQgRGF0ZW4gKG1lc3NhZ2UpIGFuIGFsbGUgYW5kZXJlbiBDbGllbnRzLiBEZW4gbWVzc2FnZVR5cGUga2FubnN0IER1IGZyZWkgd8OkaGxlbi4gRGllIGVtcGZhbmdlbmRlbiBDbGllbnRzIGJla29tbWVuIGlobiB6dXNhbW1lbiBtaXQgZGVuIERhdGVuIMO8YmVybWl0dGVsdC4gVGlwcDogRHUga2FubnN0IGF1Y2ggT2JqZWt0ZSBzZW5kZW4sIG11c3N0IHNpZSBkYXp1IGFiZXIgdm9yaGVyIHNlcmlhbGlzaWVyZW4sIGQuaC4gbWl0aGlsZmUgZGVyIE1ldGhvZGUgdG9Kc29uIGluIGVpbmUgWmVpY2hlbmtldHRlIHZlcndhbmRlbG4uJywgZmFsc2UpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcImZpbmRDbGllbnRzXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcImNvdW50XCIsIHR5cGU6IGludFByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9LFxyXG4gICAgICAgIF0pLCB2b2lkUHJpbWl0aXZlVHlwZSxcclxuICAgICAgICAgICAgKHBhcmFtZXRlcnMpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgbzogUnVudGltZU9iamVjdCA9IHBhcmFtZXRlcnNbMF0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICBsZXQgd2g6IFdlYlNvY2tldEhlbHBlciA9IG8uaW50cmluc2ljRGF0YVtcIkhlbHBlclwiXTtcclxuICAgICAgICAgICAgICAgIGxldCBjb3VudDogbnVtYmVyID0gcGFyYW1ldGVyc1sxXS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICB3aC5maW5kQ2xpZW50c0Zyb21Db3VudChjb3VudCk7XHJcblxyXG4gICAgICAgICAgICB9LCBmYWxzZSwgZmFsc2UsICdTdWNodCBkaWUgw7xiZXJnZWJlbmUgQW56YWhsIHZvbiBcImtvbnRha3RiZXJlaXRlblwiIENsaWVudHMsIGQuaC4gc29sY2hlbiBDbGllbnRzLCBkaWUgZXhha3QgZGllc2VsYmUgU3VjaGFuZnJhZ2UgYWJnZWdlYmVuIGhhYmVuLiBGaW5kZXQgZGVyIFNlcnZlciBkaWUgQ2xpZW50cywgc28gcnVmdCBlciBiZWkgYWxsZW4gYmV0ZWlsaWd0ZW4gQ2xpZW50cyBvbkNsaWVudHNGb3VuZCBhdWYuJywgZmFsc2UpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcImZpbmRDbGllbnRzXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcIm5pY2tuYW1lc1wiLCB0eXBlOiBuZXcgQXJyYXlUeXBlKHN0cmluZ1ByaW1pdGl2ZVR5cGUpLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfSxcclxuICAgICAgICBdKSwgdm9pZFByaW1pdGl2ZVR5cGUsXHJcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IG86IFJ1bnRpbWVPYmplY3QgPSBwYXJhbWV0ZXJzWzBdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgbGV0IHdoOiBXZWJTb2NrZXRIZWxwZXIgPSBvLmludHJpbnNpY0RhdGFbXCJIZWxwZXJcIl07XHJcbiAgICAgICAgICAgICAgICBsZXQgbmlja05hbWVzVmFsdWVzOiBWYWx1ZVtdID0gcGFyYW1ldGVyc1sxXS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgbmlja25hbWVzOiBzdHJpbmdbXSA9IG5pY2tOYW1lc1ZhbHVlcy5tYXAoKG5udikgPT4gbm52LnZhbHVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICB3aC5maW5kQ2xpZW50c0Zyb21OaWNrbmFtZXMobmlja25hbWVzKTtcclxuXHJcbiAgICAgICAgICAgIH0sIGZhbHNlLCBmYWxzZSwgJ1N1Y2h0IGRpZSBDbGllbnRzIG1pdCBkZW4gYW5nZWdlYmVuZW4gTmlja25hbWVzLiBIYWJlbiBzaWUgZWluZSBlbnRzcHJlY2hlbmRlIFN1Y2hhbmZyYWdlIChkLmguIGRpZXNlbGJlbiBOaWNrbmFtZXMpIGFiZ2VnZWJlbiwgc28gc28gcnVmdCBkZXIgU2VydmVyIGJlaSBhbGxlbiBiZXRlaWxpZ3RlbiBDbGllbnRzIG9uQ2xpZW50c0ZvdW5kIGF1Zi4nLCBmYWxzZSkpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiZmluZENsaWVudFwiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJuaWNrbmFtZVwiLCB0eXBlOiBzdHJpbmdQcmltaXRpdmVUeXBlLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfSxcclxuICAgICAgICBdKSwgdm9pZFByaW1pdGl2ZVR5cGUsXHJcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IG86IFJ1bnRpbWVPYmplY3QgPSBwYXJhbWV0ZXJzWzBdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgbGV0IHdoOiBXZWJTb2NrZXRIZWxwZXIgPSBvLmludHJpbnNpY0RhdGFbXCJIZWxwZXJcIl07XHJcbiAgICAgICAgICAgICAgICBsZXQgbmlja05hbWU6IHN0cmluZyA9IHBhcmFtZXRlcnNbMV0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgd2guZmluZENsaWVudHNGcm9tTmlja25hbWVzKFtuaWNrTmFtZV0pO1xyXG5cclxuICAgICAgICAgICAgfSwgZmFsc2UsIGZhbHNlLCAnU3VjaHQgZGVuIENsaWVudCBtaXQgZGVtIGFuZ2VnZWJlbmVuIE5pY2tuYW1lLiBIYXQgZXIgZWluZSBlbnRzcHJlY2hlbmRlIFN1Y2hhbmZyYWdlIChkLmguIG1pdCBkZW0gTmlja25hbWUgRElFU0VTIGNsaWVudHMpIGFiZ2VnZWJlbiwgc28gc28gcnVmdCBkZXIgU2VydmVyIGJlaSBiZWlkZW4gQ2xpZW50cyBvbkNsaWVudHNGb3VuZCBhdWYuJywgZmFsc2UpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcImNsb3NlXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICBdKSwgdm9pZFByaW1pdGl2ZVR5cGUsXHJcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IG86IFJ1bnRpbWVPYmplY3QgPSBwYXJhbWV0ZXJzWzBdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgbGV0IHdoOiBXZWJTb2NrZXRIZWxwZXIgPSBvLmludHJpbnNpY0RhdGFbXCJIZWxwZXJcIl07XHJcblxyXG4gICAgICAgICAgICAgICAgd2guZGlzY29ubmVjdCgpO1xyXG5cclxuICAgICAgICAgICAgfSwgZmFsc2UsIGZhbHNlLCAnQmVlbmRldCBkaWUgVmVyYmluZHVuZy4gQmVpIGFsbGVuIGFuZGVyZW4gQ2xpZW50cywgZGllIHNpY2ggbWl0IGRlcnNlbGJlbiBzZXNzaW9uSWQgdmVyYnVuZGVuIGhhYmVuLCB3aXJkIGRhcmF1ZmhpbiBkaWUgTWV0aG9kZSBvbk90aGVyQ2xpZW50RGlzY29ubmVjdGVkIGF1ZmdlcnVmZW4uJywgZmFsc2UpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcIm9uT3BlblwiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgXSksIG51bGwsXHJcbiAgICAgICAgICAgIG51bGwsIC8vIG5vIHN0YXRlbWVudHMhXHJcbiAgICAgICAgICAgIGZhbHNlLCBmYWxzZSwgXCJXaXJkIGF1ZmdlcnVmZW4sIHNvYmFsZCBkaWUgVmVyYmluZHVuZyBtaXQgZGVtIFNlcnZlciB6dXN0YW5kZWdla29tbWVuIGlzdC5cIiwgZmFsc2UpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcIm9uQ2xvc2VcIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgIF0pLCBudWxsLFxyXG4gICAgICAgICAgICBudWxsLCAvLyBubyBzdGF0ZW1lbnRzIVxyXG4gICAgICAgICAgICBmYWxzZSwgZmFsc2UsIFwiV2lyZCBhdWZnZXJ1ZmVuLCBuYWNoZGVtIGRpZSBWZXJiaW5kdW5nIGdlc2NobG9zc2VuIHd1cmRlLlwiLCBmYWxzZSkpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwib25NZXNzYWdlXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcInNlbmRlclwiLCB0eXBlOiB3ZWJTb2NrZXRDbGllbnRUeXBlLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfSxcclxuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcIm1lc3NhZ2VcIiwgdHlwZTogc3RyaW5nUHJpbWl0aXZlVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH0sXHJcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJtZXNzYWdlVHlwZVwiLCB0eXBlOiBzdHJpbmdQcmltaXRpdmVUeXBlLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfSxcclxuICAgICAgICBdKSwgbnVsbCxcclxuICAgICAgICAgICAgbnVsbCwgLy8gbm8gc3RhdGVtZW50cyFcclxuICAgICAgICAgICAgZmFsc2UsIGZhbHNlLCBcIldpcmQgaW1tZXIgZGFubiBhdWZnZXJ1ZmVuLCB3ZW5uIGVpbmUgTmFjaHJpY2h0IGVpbmVzIGFuZGVyZW4gQ2xpZW50cyBlbXBmYW5nZW4gd3VyZGUuXCIsIGZhbHNlKSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJvbk90aGVyQ2xpZW50Q29ubmVjdGVkXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcIm90aGVyQ2xpZW50XCIsIHR5cGU6IHdlYlNvY2tldENsaWVudFR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9XHJcbiAgICAgICAgXSksIG51bGwsXHJcbiAgICAgICAgICAgIG51bGwsIC8vIG5vIHN0YXRlbWVudHMhXHJcbiAgICAgICAgICAgIGZhbHNlLCBmYWxzZSwgXCJXaXJkIGltbWVyIGRhbm4gYXVmZ2VydWZlbiwgd2VubiBzaWNoIGVpbiBhbmRlcmVyIENsaWVudCB1bnRlciBOdXR6dW5nIGRlc3NlbGJlbiBzZXNzaW9uQ29kZXMgbWl0IGRlbSBTZXJ2ZXIgdmVyYnVuZGVuIGhhdC5cIiwgZmFsc2UpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcIm9uT3RoZXJDbGllbnREaXNDb25uZWN0ZWRcIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwib3RoZXJDbGllbnRcIiwgdHlwZTogd2ViU29ja2V0Q2xpZW50VHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH1cclxuICAgICAgICBdKSwgbnVsbCxcclxuICAgICAgICAgICAgbnVsbCwgLy8gbm8gc3RhdGVtZW50cyFcclxuICAgICAgICAgICAgZmFsc2UsIGZhbHNlLCBcIldpcmQgaW1tZXIgZGFubiBhdWZnZXJ1ZmVuLCB3ZW5uIGVpbiBhbmRlcmVyIENsaWVudCB1bnRlciBOdXR6dW5nIGRlc3NlbGJlbiBzZXNzaW9uQ29kZXMgZGllIFZlcmJpbmR1bmcgbWl0IGRlbSBTZXJ2ZXIgYmVlbmRldCBoYXQuXCIsIGZhbHNlKSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJvbkNsaWVudHNGb3VuZFwiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJjbGllbnRzXCIsIHR5cGU6IG5ldyBBcnJheVR5cGUod2ViU29ja2V0Q2xpZW50VHlwZSksIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9LFxyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwib3duSW5kZXhcIiwgdHlwZTogaW50UHJpbWl0aXZlVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH1cclxuICAgICAgICBdKSwgbnVsbCxcclxuICAgICAgICAgICAgbnVsbCwgLy8gbm8gc3RhdGVtZW50cyFcclxuICAgICAgICAgICAgZmFsc2UsIGZhbHNlLCBcIldpcmQgYXVmZ2VydWZlbiwgd2VubiBkaWUgZHVyY2ggZGllIE1ldGhvZGVuIGZpbmRDbGllbnQgYnp3LiBmaW5kQ2xpZW50cyB6dXZvciBnZXN1Y2h0ZW4gQ2xpZW50cyBnZWZ1bmRlbiB3dXJkZW4uXCIsIGZhbHNlKSk7XHJcblxyXG4gICAgfVxyXG5cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBXZWJTb2NrZXRIZWxwZXIge1xyXG5cclxuICAgIG9uT3Blbk1ldGhvZDogTWV0aG9kO1xyXG4gICAgb25DbG9zZU1ldGhvZDogTWV0aG9kO1xyXG4gICAgb25NZXNzYWdlTWV0aG9kOiBNZXRob2Q7XHJcbiAgICBvbkNsaWVudENvbm5lY3RlZE1ldGhvZDogTWV0aG9kO1xyXG4gICAgb25DbGllbnREaXNjb25uZWN0ZWRNZXRob2Q6IE1ldGhvZDtcclxuICAgIG9uQ2xpZW50c0ZvdW5kTWV0aG9kOiBNZXRob2Q7XHJcblxyXG4gICAgY2xpZW50TGlzdDogV2ViU29ja2V0Q2xpZW50SGVscGVyW10gPSBbXTtcclxuICAgIGlkVG9DbGllbnRNYXA6IHsgW2lkOiBudW1iZXJdOiBXZWJTb2NrZXRDbGllbnRIZWxwZXIgfSA9IHt9O1xyXG5cclxuICAgIGNvbm5lY3Rpb246IFdlYlNvY2tldDtcclxuICAgIGNsaWVudF9pZDogbnVtYmVyOyAvLyBvd24gY2xpZW50LWlkXHJcbiAgICBpc09wZW46IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJ1bnRpbWVPYmplY3Q6IFJ1bnRpbWVPYmplY3QsIHByaXZhdGUgaW50ZXJwcmV0ZXI6IEludGVycHJldGVyLFxyXG4gICAgICAgIHByaXZhdGUgd2ViU29ja2V0Q2xpZW50VHlwZTogS2xhc3MsIHByaXZhdGUgc3lzdGVtQ2xhc3NUeXBlOiBTeXN0ZW1DbGFzcykge1xyXG5cclxuICAgICAgICBsZXQga2xhc3M6IEtsYXNzID0gPEtsYXNzPnJ1bnRpbWVPYmplY3QuY2xhc3M7XHJcblxyXG4gICAgICAgIC8vIFtbRW50cmllc11dOkFycmF5KDQpXHJcbiAgICAgICAgLy8gMDp7XCJUZXN0MygpXCIgPT4gTWV0aG9kfVxyXG4gICAgICAgIC8vIDE6e1wib25Db25uZWN0KClcIiA9PiBNZXRob2R9XHJcbiAgICAgICAgLy8gMjp7XCJvbk1lc3NhZ2UoV2ViU29ja2V0Q2xpZW50LCBTdHJpbmcsIFN0cmluZylcIiA9PiBNZXRob2R9XHJcbiAgICAgICAgLy8gMzp7XCJ0b0pzb24oKVwiID0+IE1ldGhvZH1cclxuXHJcbiAgICAgICAgdGhpcy5vbk9wZW5NZXRob2QgPSBrbGFzcy5tZXRob2RzLmZpbmQobSA9PiBtLnNpZ25hdHVyZSA9PSBcIm9uT3BlbigpXCIpO1xyXG4gICAgICAgIHRoaXMub25DbG9zZU1ldGhvZCA9IGtsYXNzLm1ldGhvZHMuZmluZChtID0+IG0uc2lnbmF0dXJlID09IFwib25DbG9zZSgpXCIpO1xyXG4gICAgICAgIHRoaXMub25NZXNzYWdlTWV0aG9kID0ga2xhc3MubWV0aG9kcy5maW5kKG0gPT4gbS5zaWduYXR1cmUgPT0gXCJvbk1lc3NhZ2UoV2ViU29ja2V0Q2xpZW50LCBTdHJpbmcsIFN0cmluZylcIik7XHJcbiAgICAgICAgdGhpcy5vbkNsaWVudENvbm5lY3RlZE1ldGhvZCA9IGtsYXNzLm1ldGhvZHMuZmluZChtID0+IG0uc2lnbmF0dXJlID09IFwib25PdGhlckNsaWVudENvbm5lY3RlZChXZWJTb2NrZXRDbGllbnQpXCIpO1xyXG4gICAgICAgIHRoaXMub25DbGllbnREaXNjb25uZWN0ZWRNZXRob2QgPSBrbGFzcy5tZXRob2RzLmZpbmQobSA9PiBtLnNpZ25hdHVyZSA9PSBcIm9uT3RoZXJDbGllbnREaXNjb25uZWN0ZWQoV2ViU29ja2V0Q2xpZW50KVwiKTtcclxuICAgICAgICB0aGlzLm9uQ2xpZW50c0ZvdW5kTWV0aG9kID0ga2xhc3MubWV0aG9kcy5maW5kKG0gPT4gbS5zaWduYXR1cmUgPT0gXCJvbkNsaWVudHNGb3VuZChXZWJTb2NrZXRDbGllbnRbXSwgaW50KVwiKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgY29ubmVjdChzZXNzaW9uQ29kZTogc3RyaW5nLCBuaWNrTmFtZTogc3RyaW5nKSB7XHJcblxyXG4gICAgICAgIGlmKHRoaXMuaW50ZXJwcmV0ZXIubWFpbi5pc0VtYmVkZGVkKCkpe1xyXG4gICAgICAgICAgICB0aGlzLmludGVycHJldGVyLnRocm93RXhjZXB0aW9uKFwiRGllIE5ldHp3ZXJrZnVua3Rpb25hbGl0w6R0ZW4gc3RlaGVuIG51ciBlaW5nZWxvZ2d0ZW4gTnV0emVybiBpbiBkZXIgRW50d2lja2x1bmdzdW1nZWJ1bmcgenVyIFZlcmbDvGd1bmcgdW5kIGvDtm5uZW4gZGFoZXIgbGVpZGVyIGhpZXIgbmljaHQgYXVzcHJvYmllcnQgd2VyZGVuLlwiKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGFqYXgoJ2dldFdlYlNvY2tldFRva2VuJywge30sIChyZXNwb25zZTogR2V0V2ViU29ja2V0VG9rZW5SZXNwb25zZSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgbGV0IHVybDogc3RyaW5nID0gKHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbC5zdGFydHNXaXRoKFwiaHR0cHNcIikgPyBcIndzczovL1wiIDogXCJ3czovL1wiKSArIHdpbmRvdy5sb2NhdGlvbi5ob3N0ICsgXCIvd2Vic29ja2V0XCI7XHJcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbiA9IG5ldyBXZWJTb2NrZXQodXJsKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbi5vbmVycm9yID0gKGVycm9yOiBFdmVudCkgPT4geyB0aGlzLm9uRXJyb3IoZXJyb3IpOyB9XHJcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbi5vbmNsb3NlID0gKGV2ZW50OiBDbG9zZUV2ZW50KSA9PiB7IHRoaXMub25DbG9zZShldmVudCk7IH1cclxuICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uLm9ubWVzc2FnZSA9IChldmVudDogTWVzc2FnZUV2ZW50KSA9PiB7IHRoaXMub25NZXNzYWdlKGV2ZW50KTsgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uLm9ub3BlbiA9IChldmVudDogRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCByZXF1ZXN0OiBXZWJTb2NrZXRSZXF1ZXN0Q29ubmVjdCA9IHtcclxuICAgICAgICAgICAgICAgICAgICBjb21tYW5kOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIHRva2VuOiByZXNwb25zZS50b2tlbixcclxuICAgICAgICAgICAgICAgICAgICBuaWNrbmFtZTogbmlja05hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbkNvZGU6IHNlc3Npb25Db2RlXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnRlcnByZXRlci53ZWJTb2NrZXRzVG9DbG9zZUFmdGVyUHJvZ3JhbUhhbHQucHVzaCh0aGlzLmNvbm5lY3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc09wZW4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZW5kSW50ZXJuKEpTT04uc3RyaW5naWZ5KHJlcXVlc3QpKTtcclxuICAgICAgICAgICAgICAgIHRoaXMub25PcGVuKCk7XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICB1bnNlbnRNZXNzYWdlczogc3RyaW5nW10gPSBbXTtcclxuICAgIHNlbmRJbnRlcm4obWVzc2FnZTogc3RyaW5nKSB7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5pc09wZW4pIHtcclxuICAgICAgICAgICAgdGhpcy51bnNlbnRNZXNzYWdlcy5wdXNoKG1lc3NhZ2UpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24uc2VuZChtZXNzYWdlKTtcclxuICAgICAgICAgICAgfSBjYXRjaCAoZXhjZXB0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhleGNlcHRpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uQ2xvc2UoZXZlbnQ6IENsb3NlRXZlbnQpIHtcclxuICAgICAgICB0aGlzLmlzT3BlbiA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMucnVuTWV0aG9kKHRoaXMub25DbG9zZU1ldGhvZCwgW10pO1xyXG4gICAgfVxyXG5cclxuICAgIHNlbmRUb0NsaWVudChjbGllbnRJZDogbnVtYmVyLCBkYXRhOiBzdHJpbmcsIGRhdGFUeXBlOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgbWVzc2FnZTogV2ViU29ja2V0UmVxdWVzdFNlbmRUb0NsaWVudCA9IHtcclxuICAgICAgICAgICAgY29tbWFuZDogMyxcclxuICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgZGF0YVR5cGU6IGRhdGFUeXBlLFxyXG4gICAgICAgICAgICByZWNpcGllbnRfaWQ6IGNsaWVudElkXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnNlbmRJbnRlcm4oSlNPTi5zdHJpbmdpZnkobWVzc2FnZSkpO1xyXG4gICAgfVxyXG5cclxuICAgIHNlbmRUb0FsbChkYXRhOiBzdHJpbmcsIGRhdGFUeXBlOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgbWVzc2FnZTogV2ViU29ja2V0UmVxdWVzdFNlbmRUb0FsbCA9IHtcclxuICAgICAgICAgICAgY29tbWFuZDogMixcclxuICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgZGF0YVR5cGU6IGRhdGFUeXBlXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnNlbmRJbnRlcm4oSlNPTi5zdHJpbmdpZnkobWVzc2FnZSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGRpc2Nvbm5lY3QoKSB7XHJcbiAgICAgICAgbGV0IG1lc3NhZ2U6IFdlYlNvY2tldFJlcXVlc3REaXNjb25uZWN0ID0ge1xyXG4gICAgICAgICAgICBjb21tYW5kOiA0XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnNlbmRJbnRlcm4oSlNPTi5zdHJpbmdpZnkobWVzc2FnZSkpO1xyXG4gICAgICAgIHRoaXMuY29ubmVjdGlvbi5jbG9zZSgpO1xyXG4gICAgICAgIGxldCB3dHIgPSB0aGlzLmludGVycHJldGVyLndlYlNvY2tldHNUb0Nsb3NlQWZ0ZXJQcm9ncmFtSGFsdDtcclxuICAgICAgICB3dHIuc3BsaWNlKHd0ci5pbmRleE9mKHRoaXMuY29ubmVjdGlvbiksIDEpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uTWVzc2FnZShldmVudDogTWVzc2FnZUV2ZW50KSB7XHJcblxyXG4gICAgICAgIGxldCByZXNwb25zZTogV2ViU29ja2V0UmVzcG9uc2UgPSBKU09OLnBhcnNlKGV2ZW50LmRhdGEpO1xyXG4gICAgICAgIGlmIChyZXNwb25zZS5jb21tYW5kID09IHVuZGVmaW5lZCkgcmV0dXJuO1xyXG5cclxuICAgICAgICBzd2l0Y2ggKHJlc3BvbnNlLmNvbW1hbmQpIHtcclxuICAgICAgICAgICAgY2FzZSAxOiAvLyBuZXcgQ2xpZW50XHJcbiAgICAgICAgICAgICAgICBsZXQgY2xpZW50UnVudGltZU9iamVjdCA9IG5ldyBSdW50aW1lT2JqZWN0KHRoaXMud2ViU29ja2V0Q2xpZW50VHlwZSk7XHJcbiAgICAgICAgICAgICAgICBsZXQgd2NoOiBXZWJTb2NrZXRDbGllbnRIZWxwZXIgPSBuZXcgV2ViU29ja2V0Q2xpZW50SGVscGVyKGNsaWVudFJ1bnRpbWVPYmplY3QsIHRoaXMsIHJlc3BvbnNlLnVzZXJfaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UucnVmbmFtZSwgcmVzcG9uc2UuZmFtaWxpZW5uYW1lLCByZXNwb25zZS51c2VybmFtZSwgcmVzcG9uc2Uubmlja25hbWUpO1xyXG4gICAgICAgICAgICAgICAgY2xpZW50UnVudGltZU9iamVjdC5pbnRyaW5zaWNEYXRhW1wiSGVscGVyXCJdID0gd2NoO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbGllbnRMaXN0LnB1c2god2NoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaWRUb0NsaWVudE1hcFtyZXNwb25zZS51c2VyX2lkXSA9IHdjaDtcclxuICAgICAgICAgICAgICAgIHRoaXMucnVuTWV0aG9kKHRoaXMub25DbGllbnRDb25uZWN0ZWRNZXRob2QsIFt7IHR5cGU6IHRoaXMud2ViU29ja2V0Q2xpZW50VHlwZSwgdmFsdWU6IGNsaWVudFJ1bnRpbWVPYmplY3QgfV0pO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgMjogLy8gbWVzc2FnZVxyXG4gICAgICAgICAgICAgICAgbGV0IGNsaWVudEhlbHBlciA9IHRoaXMuaWRUb0NsaWVudE1hcFtyZXNwb25zZS5mcm9tX2NsaWVudF9pZF07XHJcbiAgICAgICAgICAgICAgICBpZiAoY2xpZW50SGVscGVyID09IG51bGwpIHJldHVybjtcclxuICAgICAgICAgICAgICAgIHRoaXMucnVuTWV0aG9kKHRoaXMub25NZXNzYWdlTWV0aG9kLCBbXHJcbiAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiB0aGlzLndlYlNvY2tldENsaWVudFR5cGUsIHZhbHVlOiBjbGllbnRIZWxwZXIucnVudGltZU9iamVjdCB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHsgdHlwZTogc3RyaW5nUHJpbWl0aXZlVHlwZSwgdmFsdWU6IHJlc3BvbnNlLmRhdGEgfSxcclxuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6IHN0cmluZ1ByaW1pdGl2ZVR5cGUsIHZhbHVlOiByZXNwb25zZS5kYXRhVHlwZSB9XHJcbiAgICAgICAgICAgICAgICBdKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDM6IC8vIG90aGVyIGNsaWVudCBkaXNjb25uZWN0ZWRcclxuICAgICAgICAgICAgICAgIGxldCBjbGllbnRIZWxwZXIxID0gdGhpcy5pZFRvQ2xpZW50TWFwW3Jlc3BvbnNlLmRpc2Nvbm5lY3RpbmdfY2xpZW50X2lkXTtcclxuICAgICAgICAgICAgICAgIGlmIChjbGllbnRIZWxwZXIxID09IG51bGwpIHJldHVybjtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xpZW50TGlzdC5zcGxpY2UodGhpcy5jbGllbnRMaXN0LmluZGV4T2YoY2xpZW50SGVscGVyMSksIDEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pZFRvQ2xpZW50TWFwW3Jlc3BvbnNlLmRpc2Nvbm5lY3RpbmdfY2xpZW50X2lkXSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIHRoaXMucnVuTWV0aG9kKHRoaXMub25DbGllbnREaXNjb25uZWN0ZWRNZXRob2QsIFtcclxuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6IHRoaXMud2ViU29ja2V0Q2xpZW50VHlwZSwgdmFsdWU6IGNsaWVudEhlbHBlcjEucnVudGltZU9iamVjdCB9XHJcbiAgICAgICAgICAgICAgICBdKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDQ6IC8vIHRpbWUgc3luY2hyb25pemF0aW9uXHJcbiAgICAgICAgICAgICAgICB0aGlzLnN5c3RlbUNsYXNzVHlwZS5kZWx0YVRpbWVNaWxsaXMgPSByZXNwb25zZS5jdXJyZW50VGltZU1pbGxzIC0gRGF0ZS5ub3coKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xpZW50X2lkID0gcmVzcG9uc2UuY2xpZW50X2lkXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSA1OiAvLyBrZWVwIGFsaXZlXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSA2OiAvLyBDbGllbnRzIGZvdW5kXHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uQ2xpZW50c0ZvdW5kKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbkNsaWVudHNGb3VuZChyZXNwb25zZTogV2ViU29ja2V0UmVzcG9uc2VQYWlyaW5nRm91bmQpIHtcclxuICAgICAgICBsZXQgb3duX2luZGV4OiBudW1iZXIgPSAwO1xyXG4gICAgICAgIGxldCBvdGhlckNsaWVudHM6IFZhbHVlW10gPSBbXTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgY2xpZW50IG9mIHJlc3BvbnNlLmNsaWVudHMpIHtcclxuICAgICAgICAgICAgaWYgKGNsaWVudC5pZCA9PSB0aGlzLmNsaWVudF9pZCkge1xyXG4gICAgICAgICAgICAgICAgb3duX2luZGV4ID0gY2xpZW50LmluZGV4O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbGV0IG90aGVyQ2xpZW50ID0gdGhpcy5pZFRvQ2xpZW50TWFwW2NsaWVudC5pZF07XHJcbiAgICAgICAgICAgICAgICBpZiAob3RoZXJDbGllbnQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG90aGVyQ2xpZW50LmluZGV4ID0gY2xpZW50LmluZGV4O1xyXG4gICAgICAgICAgICAgICAgICAgIG90aGVyQ2xpZW50cy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdGhpcy53ZWJTb2NrZXRDbGllbnRUeXBlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogb3RoZXJDbGllbnQucnVudGltZU9iamVjdFxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgYXJyYXlWYWx1ZTogVmFsdWUgPSB7XHJcbiAgICAgICAgICAgIHR5cGU6IG5ldyBBcnJheVR5cGUodGhpcy53ZWJTb2NrZXRDbGllbnRUeXBlKSxcclxuICAgICAgICAgICAgdmFsdWU6IG90aGVyQ2xpZW50c1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5ydW5NZXRob2QodGhpcy5vbkNsaWVudHNGb3VuZE1ldGhvZCwgW2FycmF5VmFsdWUsIHsgdHlwZTogaW50UHJpbWl0aXZlVHlwZSwgdmFsdWU6IG93bl9pbmRleCB9XSk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIG9uRXJyb3IoZXJyb3I6IEV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5pbnRlcnByZXRlci50aHJvd0V4Y2VwdGlvbihcIktvbW11bmlrYXRpb25zZmVobGVyIGJlaW0gV2ViU29ja2V0XCIpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uT3BlbigpIHtcclxuICAgICAgICB0aGlzLmlzT3BlbiA9IHRydWU7XHJcbiAgICAgICAgaWYodGhpcy51bnNlbnRNZXNzYWdlcy5sZW5ndGggPiAwKXtcclxuICAgICAgICAgICAgdGhpcy51bnNlbnRNZXNzYWdlcy5mb3JFYWNoKG0gPT4gdGhpcy5zZW5kSW50ZXJuKG0pKTtcclxuICAgICAgICAgICAgdGhpcy51bnNlbnRNZXNzYWdlcyA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJ1bk1ldGhvZCh0aGlzLm9uT3Blbk1ldGhvZCwgW10pO1xyXG4gICAgfVxyXG5cclxuICAgIHJ1bk1ldGhvZChtZXRob2Q6IE1ldGhvZCwgc3RhY2tFbGVtZW50czogVmFsdWVbXSkge1xyXG4gICAgICAgIGlmIChtZXRob2QgPT0gbnVsbCkgcmV0dXJuO1xyXG4gICAgICAgIHN0YWNrRWxlbWVudHMuc3BsaWNlKDAsIDAsIHtcclxuICAgICAgICAgICAgdHlwZTogdGhpcy5ydW50aW1lT2JqZWN0LmNsYXNzLFxyXG4gICAgICAgICAgICB2YWx1ZTogdGhpcy5ydW50aW1lT2JqZWN0XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmludGVycHJldGVyLnN0YXRlID09IEludGVycHJldGVyU3RhdGUud2FpdGluZ0ZvcklucHV0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW50ZXJwcmV0ZXIuZXhlY3V0ZUltbWVkaWF0ZWx5SW5OZXdTdGFja2ZyYW1lKG1ldGhvZC5wcm9ncmFtLCBzdGFja0VsZW1lbnRzKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmludGVycHJldGVyLnJ1blRpbWVyKG1ldGhvZCwgc3RhY2tFbGVtZW50cywgKCkgPT4geyB9LCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZpbmRDbGllbnRzRnJvbUNvdW50KGNvdW50OiBudW1iZXIpIHtcclxuICAgICAgICBsZXQgbWVzc2FnZTogV2ViU29ja2V0UmVxdWVzdEZpbmRQYWlyaW5nID0ge1xyXG4gICAgICAgICAgICBjb21tYW5kOiA2LFxyXG4gICAgICAgICAgICBjb3VudDogY291bnQsXHJcbiAgICAgICAgICAgIG5pY2tuYW1lczogW11cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc2VuZEludGVybihKU09OLnN0cmluZ2lmeShtZXNzYWdlKSk7XHJcbiAgICB9XHJcblxyXG4gICAgZmluZENsaWVudHNGcm9tTmlja25hbWVzKG5pY2tuYW1lczogc3RyaW5nW10pIHtcclxuICAgICAgICBsZXQgbWVzc2FnZTogV2ViU29ja2V0UmVxdWVzdEZpbmRQYWlyaW5nID0ge1xyXG4gICAgICAgICAgICBjb21tYW5kOiA2LFxyXG4gICAgICAgICAgICBjb3VudDogbmlja25hbWVzLmxlbmd0aCxcclxuICAgICAgICAgICAgbmlja25hbWVzOiBuaWNrbmFtZXNcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc2VuZEludGVybihKU09OLnN0cmluZ2lmeShtZXNzYWdlKSk7XHJcbiAgICB9XHJcblxyXG5cclxufSJdfQ==