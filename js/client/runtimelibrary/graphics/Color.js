import { Klass, Visibility } from "../../compiler/types/Class.js";
import { Method, Parameterlist, Attribute } from "../../compiler/types/Types.js";
import { intPrimitiveType, doublePrimitiveType, stringPrimitiveType, booleanPrimitiveType } from "../../compiler/types/PrimitiveTypes.js";
import { RuntimeObject } from "../../interpreter/RuntimeObject.js";
import { ColorHelper } from "./ColorHelper.js";
export class ColorClass extends Klass {
    constructor(module) {
        super("Color", module, "Farbe");
        this.setBaseClass(module.typeStore.getType("Object"));
        for (let colorName in ColorHelper.predefinedColors) {
            let intColor = ColorHelper.predefinedColors[colorName];
            let r = new RuntimeObject(this);
            let red = (intColor & 0xff0000) >> 16;
            let green = (intColor & 0xff00) >> 8;
            let blue = (intColor & 0xff);
            let id = {
                red: red,
                green: green,
                blue: blue,
                hex: ColorHelper.intColorToHexRGB(intColor)
            };
            r.intrinsicData = id;
            this.addAttribute(new Attribute(colorName, this, (value) => { value.value = r; }, true, Visibility.public, true, "Die Farbe " + colorName + " (" + ColorHelper.intColorToHexRGB(intColor) + " oder " + ColorHelper.intColorToRGB(intColor)));
        }
        this.setupAttributeIndicesRecursive();
        this.staticClass.setupAttributeIndicesRecursive();
        this.staticClass.classObject = new RuntimeObject(this.staticClass);
        this.addMethod(new Method("Color", new Parameterlist([
            { identifier: "red", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "green", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "blue", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true }
        ]), null, (parameters) => {
            let o = parameters[0].value;
            let red = Math.trunc(parameters[1].value);
            let green = Math.trunc(parameters[2].value);
            let blue = Math.trunc(parameters[3].value);
            let intrinsicData = {
                red: red,
                green: green,
                blue: blue,
                hex: "rgb(" + red + ", " + green + ", " + blue + ")"
            };
            o.intrinsicData = intrinsicData;
        }, false, false, 'Instanziert eine neue Farbe. Red, green und blue sind die Farbanteile, jeweils als integer-Zahlen im Bereich von 0 bis 255.', true));
        this.addMethod(new Method("randomColor", new Parameterlist([]), intPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            return Math.floor(Math.random() * 0xffffff);
        }, false, true, 'Gibt eine zufällige Farbe (ohne Transparenz) zurück.', false));
        this.addMethod(new Method("randomColor", new Parameterlist([
            { identifier: "minimumRGBValue", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), intPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            let min = parameters[1].value;
            if (min < 0)
                min = 0;
            if (min > 255)
                min = 255;
            let r = Math.floor(Math.random() * (256 - min)) + min;
            let g = Math.floor(Math.random() * (256 - min)) + min;
            let b = Math.floor(Math.random() * (256 - min)) + min;
            return 0x10000 * r + 0x100 * g + b;
        }, false, true, 'Gibt eine zufällige Farbe (ohne Transparenz) zurück. Min ist der Mindestwert für den Rot-, Grün- und Blauanteil, wobei jeder der Anteile und daher auch min zwischen 0 und 255 (jeweils einschließlich) liegen muss.', false));
        this.addMethod(new Method("randomColor", new Parameterlist([
            { identifier: "minimumRGBValue", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "maximumRGBValue", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), intPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            let min = parameters[1].value;
            let max = parameters[1].value;
            if (min < 0)
                min = 0;
            if (min > 255)
                min = 255;
            if (max < 0)
                max = 0;
            if (max > 255)
                max = 255;
            if (max < min) {
                let z = max;
                max = min;
                min = z;
            }
            let r = Math.floor(Math.random() * (max - min + 1)) + min;
            let g = Math.floor(Math.random() * (max - min + 1)) + min;
            let b = Math.floor(Math.random() * (max - min + 1)) + min;
            return 0x10000 * r + 0x100 * g + b;
        }, false, true, 'Gibt eine zufällige Farbe (ohne Transparenz) zurück. Min ist der Mindestwert für den Rot-, Grün- und Blauanteil, max der Höchstwert, wobei jeder der Anteile und daher auch min zwischen 0 und 255 (jeweils einschließlich) liegen muss.', false));
        this.addMethod(new Method("toString", new Parameterlist([]), stringPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            return (o.intrinsicData).hex;
        }, false, false, 'Verwandelt die Farbe in einen String.', false));
        this.addMethod(new Method("equals", new Parameterlist([
            { identifier: "otherColor", type: this, declaration: null, usagePositions: null, isFinal: true },
        ]), booleanPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            let o1 = parameters[1].value;
            let d = (o.intrinsicData);
            let d1 = (o1.intrinsicData);
            return (d.red == d1.red && d.green == d1.green && d.blue == d1.blue);
        }, false, false, 'Vergleicht zwei Farben', false));
        this.addMethod(new Method("getRed", new Parameterlist([]), intPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            return (o.intrinsicData).red;
        }, false, false, 'Gibt den Rotanteil der Farbe zurück (0 - 255).', false));
        this.addMethod(new Method("getGreen", new Parameterlist([]), intPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            return (o.intrinsicData).green;
        }, false, false, 'Gibt den Grünanteil der Farbe zurück (0 - 255).', false));
        this.addMethod(new Method("getBlue", new Parameterlist([]), intPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            return (o.intrinsicData).blue;
        }, false, false, 'Gibt den Blauanteil der Farbe zurück (0 - 255).', false));
        this.addMethod(new Method("fromRGB", new Parameterlist([
            { identifier: "red", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "green", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "blue", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), intPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            let r = parameters[1].value;
            let g = parameters[2].value;
            let b = parameters[3].value;
            return (r * 0x10000 + g * 0x100 + b);
        }, false, true, 'Berechnet aus Rot-, Grün- und Blauwert (alle zwischen 0 und 255) die Farbe.', false));
        this.addMethod(new Method("fromRGBA", new Parameterlist([
            { identifier: "red", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "green", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "blue", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "alpha", type: doublePrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), stringPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            let r = parameters[1].value;
            let g = parameters[2].value;
            let b = parameters[3].value;
            let a = parameters[4].value;
            let color = (r * 0x1000000 + g * 0x10000 + b * 0x100 + Math.floor(a * 255)).toString(16);
            while (color.length < 8)
                color = "0" + color;
            return "#" + color;
        }, false, true, 'Berechnet aus Rot-, Grün- und Blauwert (alle zwischen 0 und 255) sowie Alpha-Wert (zwischen 0 und 1) die Farbe.', false));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29sb3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvY2xpZW50L3J1bnRpbWVsaWJyYXJ5L2dyYXBoaWNzL0NvbG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFFbEUsT0FBTyxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQUUsU0FBUyxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDakYsT0FBTyxFQUFFLGdCQUFnQixFQUFFLG1CQUFtQixFQUFxQixtQkFBbUIsRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQzdKLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUVuRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFXL0MsTUFBTSxPQUFPLFVBQVcsU0FBUSxLQUFLO0lBRWpDLFlBQVksTUFBYztRQUV0QixLQUFLLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQztRQUVoQyxJQUFJLENBQUMsWUFBWSxDQUFRLE1BQU0sQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFFN0QsS0FBSyxJQUFJLFNBQVMsSUFBSSxXQUFXLENBQUMsZ0JBQWdCLEVBQUU7WUFFaEQsSUFBSSxRQUFRLEdBQUcsV0FBVyxDQUFDLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRXZELElBQUksQ0FBQyxHQUFrQixJQUFJLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUUvQyxJQUFJLEdBQUcsR0FBRyxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDdEMsSUFBSSxLQUFLLEdBQUcsQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3JDLElBQUksSUFBSSxHQUFH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S2xhc3MsIFZpc2liaWxpdHkgfSBmcm9tIFwiLi4vLi4vY29tcGlsZXIvdHlwZXMvQ2xhc3MuanNcIjtcclxuaW1wb3J0IHsgTW9kdWxlIH0gZnJvbSBcIi4uLy4uL2NvbXBpbGVyL3BhcnNlci9Nb2R1bGUuanNcIjtcclxuaW1wb3J0IHsgTWV0aG9kLCBQYXJhbWV0ZXJsaXN0LCBBdHRyaWJ1dGUgfSBmcm9tIFwiLi4vLi4vY29tcGlsZXIvdHlwZXMvVHlwZXMuanNcIjtcclxuaW1wb3J0IHsgaW50UHJpbWl0aXZlVHlwZSwgZG91YmxlUHJpbWl0aXZlVHlwZSwgdm9pZFByaW1pdGl2ZVR5cGUsIHN0cmluZ1ByaW1pdGl2ZVR5cGUsIGJvb2xlYW5QcmltaXRpdmVUeXBlIH0gZnJvbSBcIi4uLy4uL2NvbXBpbGVyL3R5cGVzL1ByaW1pdGl2ZVR5cGVzLmpzXCI7XHJcbmltcG9ydCB7IFJ1bnRpbWVPYmplY3QgfSBmcm9tIFwiLi4vLi4vaW50ZXJwcmV0ZXIvUnVudGltZU9iamVjdC5qc1wiO1xyXG5pbXBvcnQgeyBTaGFwZUhlbHBlciB9IGZyb20gXCIuL1NoYXBlLmpzXCI7XHJcbmltcG9ydCB7IENvbG9ySGVscGVyIH0gZnJvbSBcIi4vQ29sb3JIZWxwZXIuanNcIjtcclxuaW1wb3J0IHsgRmlsbGVkU2hhcGVIZWxwZXIgfSBmcm9tIFwiLi9GaWxsZWRTaGFwZS5qc1wiO1xyXG5pbXBvcnQgeyBXb3JsZEhlbHBlciwgV29ybGRDbGFzcyB9IGZyb20gXCIuL1dvcmxkLmpzXCI7XHJcblxyXG5leHBvcnQgdHlwZSBDb2xvckNsYXNzSW50cmluc2ljRGF0YSA9IHtcclxuICAgIHJlZDogbnVtYmVyLFxyXG4gICAgZ3JlZW46IG51bWJlcixcclxuICAgIGJsdWU6IG51bWJlcixcclxuICAgIGhleDogc3RyaW5nXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBDb2xvckNsYXNzIGV4dGVuZHMgS2xhc3Mge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKG1vZHVsZTogTW9kdWxlKSB7XHJcblxyXG4gICAgICAgIHN1cGVyKFwiQ29sb3JcIiwgbW9kdWxlLCBcIkZhcmJlXCIpO1xyXG5cclxuICAgICAgICB0aGlzLnNldEJhc2VDbGFzcyg8S2xhc3M+bW9kdWxlLnR5cGVTdG9yZS5nZXRUeXBlKFwiT2JqZWN0XCIpKTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgY29sb3JOYW1lIGluIENvbG9ySGVscGVyLnByZWRlZmluZWRDb2xvcnMpIHtcclxuXHJcbiAgICAgICAgICAgIGxldCBpbnRDb2xvciA9IENvbG9ySGVscGVyLnByZWRlZmluZWRDb2xvcnNbY29sb3JOYW1lXTtcclxuXHJcbiAgICAgICAgICAgIGxldCByOiBSdW50aW1lT2JqZWN0ID0gbmV3IFJ1bnRpbWVPYmplY3QodGhpcyk7XHJcblxyXG4gICAgICAgICAgICBsZXQgcmVkID0gKGludENvbG9yICYgMHhmZjAwMDApID4+IDE2O1xyXG4gICAgICAgICAgICBsZXQgZ3JlZW4gPSAoaW50Q29sb3IgJiAweGZmMDApID4+IDg7XHJcbiAgICAgICAgICAgIGxldCBibHVlID0gKGludENvbG9yICYgMHhmZik7XHJcblxyXG4gICAgICAgICAgICBsZXQgaWQ6IENvbG9yQ2xhc3NJbnRyaW5zaWNEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgcmVkOiByZWQsXHJcbiAgICAgICAgICAgICAgICBncmVlbjogZ3JlZW4sXHJcbiAgICAgICAgICAgICAgICBibHVlOiBibHVlLFxyXG4gICAgICAgICAgICAgICAgaGV4OiBDb2xvckhlbHBlci5pbnRDb2xvclRvSGV4UkdCKGludENvbG9yKVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByLmludHJpbnNpY0RhdGEgPSBpZDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuYWRkQXR0cmlidXRlKG5ldyBBdHRyaWJ1dGUoY29sb3JOYW1lLCB0aGlzLFxyXG4gICAgICAgICAgICAgICAgKHZhbHVlKSA9PiB7IHZhbHVlLnZhbHVlID0gciB9LCB0cnVlLCBWaXNpYmlsaXR5LnB1YmxpYywgdHJ1ZSxcclxuICAgICAgICAgICAgICAgIFwiRGllIEZhcmJlIFwiICsgY29sb3JOYW1lICsgXCIgKFwiICsgQ29sb3JIZWxwZXIuaW50Q29sb3JUb0hleFJHQihpbnRDb2xvcikgKyBcIiBvZGVyIFwiICsgQ29sb3JIZWxwZXIuaW50Q29sb3JUb1JHQihpbnRDb2xvcikpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc2V0dXBBdHRyaWJ1dGVJbmRpY2VzUmVjdXJzaXZlKCk7XHJcbiAgICAgICAgdGhpcy5zdGF0aWNDbGFzcy5zZXR1cEF0dHJpYnV0ZUluZGljZXNSZWN1cnNpdmUoKTtcclxuXHJcbiAgICAgICAgdGhpcy5zdGF0aWNDbGFzcy5jbGFzc09iamVjdCA9IG5ldyBSdW50aW1lT2JqZWN0KHRoaXMuc3RhdGljQ2xhc3MpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiQ29sb3JcIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwicmVkXCIsIHR5cGU6IGludFByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9LFxyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwiZ3JlZW5cIiwgdHlwZTogaW50UHJpbWl0aXZlVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH0sXHJcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJibHVlXCIsIHR5cGU6IGludFByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9XHJcbiAgICAgICAgXSksIG51bGwsXHJcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbzogUnVudGltZU9iamVjdCA9IHBhcmFtZXRlcnNbMF0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVkOiBudW1iZXIgPSBNYXRoLnRydW5jKHBhcmFtZXRlcnNbMV0udmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgbGV0IGdyZWVuOiBudW1iZXIgPSBNYXRoLnRydW5jKHBhcmFtZXRlcnNbMl0udmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgbGV0IGJsdWU6IG51bWJlciA9IE1hdGgudHJ1bmMocGFyYW1ldGVyc1szXS52YWx1ZSk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGxldCBpbnRyaW5zaWNEYXRhOiBDb2xvckNsYXNzSW50cmluc2ljRGF0YSA9IHtcclxuICAgICAgICAgICAgICAgICAgICByZWQ6IHJlZCxcclxuICAgICAgICAgICAgICAgICAgICBncmVlbjogZ3JlZW4sXHJcbiAgICAgICAgICAgICAgICAgICAgYmx1ZTogYmx1ZSxcclxuICAgICAgICAgICAgICAgICAgICBoZXg6IFwicmdiKFwiICsgcmVkICsgXCIsIFwiICsgZ3JlZW4gKyBcIiwgXCIgKyBibHVlICsgXCIpXCJcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgby5pbnRyaW5zaWNEYXRhID0gaW50cmluc2ljRGF0YTtcclxuXHJcbiAgICAgICAgICAgIH0sIGZhbHNlLCBmYWxzZSwgJ0luc3RhbnppZXJ0IGVpbmUgbmV1ZSBGYXJiZS4gUmVkLCBncmVlbiB1bmQgYmx1ZSBzaW5kIGRpZSBGYXJiYW50ZWlsZSwgamV3ZWlscyBhbHMgaW50ZWdlci1aYWhsZW4gaW0gQmVyZWljaCB2b24gMCBiaXMgMjU1LidcclxuICAgICAgICAgICAgLCB0cnVlKSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJyYW5kb21Db2xvclwiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgXSksIGludFByaW1pdGl2ZVR5cGUsXHJcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbzogUnVudGltZU9iamVjdCA9IHBhcmFtZXRlcnNbMF0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDB4ZmZmZmZmKTtcclxuXHJcbiAgICAgICAgICAgIH0sIGZhbHNlLCB0cnVlLCAnR2lidCBlaW5lIHp1ZsOkbGxpZ2UgRmFyYmUgKG9obmUgVHJhbnNwYXJlbnopIHp1csO8Y2suJ1xyXG4gICAgICAgICAgICAsIGZhbHNlKSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJyYW5kb21Db2xvclwiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJtaW5pbXVtUkdCVmFsdWVcIiwgdHlwZTogaW50UHJpbWl0aXZlVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH0sXHJcbiAgICAgICAgXSksIGludFByaW1pdGl2ZVR5cGUsXHJcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbzogUnVudGltZU9iamVjdCA9IHBhcmFtZXRlcnNbMF0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICBsZXQgbWluOiBudW1iZXIgPSBwYXJhbWV0ZXJzWzFdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKG1pbiA8IDApIG1pbiA9IDA7XHJcbiAgICAgICAgICAgICAgICBpZiAobWluID4gMjU1KSBtaW4gPSAyNTU7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHI6IG51bWJlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgyNTYgLSBtaW4pKSArIG1pbjtcclxuICAgICAgICAgICAgICAgIGxldCBnOiBudW1iZXIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMjU2IC0gbWluKSkgKyBtaW47XHJcbiAgICAgICAgICAgICAgICBsZXQgYjogbnVtYmVyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDI1NiAtIG1pbikpICsgbWluO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiAweDEwMDAwICogciArIDB4MTAwICogZyArIGI7XHJcblxyXG4gICAgICAgICAgICB9LCBmYWxzZSwgdHJ1ZSwgJ0dpYnQgZWluZSB6dWbDpGxsaWdlIEZhcmJlIChvaG5lIFRyYW5zcGFyZW56KSB6dXLDvGNrLiBNaW4gaXN0IGRlciBNaW5kZXN0d2VydCBmw7xyIGRlbiBSb3QtLCBHcsO8bi0gdW5kIEJsYXVhbnRlaWwsIHdvYmVpIGplZGVyIGRlciBBbnRlaWxlIHVuZCBkYWhlciBhdWNoIG1pbiB6d2lzY2hlbiAwIHVuZCAyNTUgKGpld2VpbHMgZWluc2NobGllw59saWNoKSBsaWVnZW4gbXVzcy4nXHJcbiAgICAgICAgICAgICwgZmFsc2UpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcInJhbmRvbUNvbG9yXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcIm1pbmltdW1SR0JWYWx1ZVwiLCB0eXBlOiBpbnRQcmltaXRpdmVUeXBlLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfSxcclxuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcIm1heGltdW1SR0JWYWx1ZVwiLCB0eXBlOiBpbnRQcmltaXRpdmVUeXBlLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfSxcclxuICAgICAgICBdKSwgaW50UHJpbWl0aXZlVHlwZSxcclxuICAgICAgICAgICAgKHBhcmFtZXRlcnMpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBvOiBSdW50aW1lT2JqZWN0ID0gcGFyYW1ldGVyc1swXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIGxldCBtaW46IG51bWJlciA9IHBhcmFtZXRlcnNbMV0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICBsZXQgbWF4OiBudW1iZXIgPSBwYXJhbWV0ZXJzWzFdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKG1pbiA8IDApIG1pbiA9IDA7XHJcbiAgICAgICAgICAgICAgICBpZiAobWluID4gMjU1KSBtaW4gPSAyNTU7XHJcbiAgICAgICAgICAgICAgICBpZiAobWF4IDwgMCkgbWF4ID0gMDtcclxuICAgICAgICAgICAgICAgIGlmIChtYXggPiAyNTUpIG1heCA9IDI1NTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZihtYXggPCBtaW4pe1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCB6ID0gbWF4O1xyXG4gICAgICAgICAgICAgICAgICAgIG1heCA9IG1pbjtcclxuICAgICAgICAgICAgICAgICAgICBtaW4gPSB6O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGxldCByOiBudW1iZXIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluICsgMSkpICsgbWluO1xyXG4gICAgICAgICAgICAgICAgbGV0IGc6IG51bWJlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSkgKyBtaW47XHJcbiAgICAgICAgICAgICAgICBsZXQgYjogbnVtYmVyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gMHgxMDAwMCAqIHIgKyAweDEwMCAqIGcgKyBiO1xyXG5cclxuICAgICAgICAgICAgfSwgZmFsc2UsIHRydWUsICdHaWJ0IGVpbmUgenVmw6RsbGlnZSBGYXJiZSAob2huZSBUcmFuc3BhcmVueikgenVyw7xjay4gTWluIGlzdCBkZXIgTWluZGVzdHdlcnQgZsO8ciBkZW4gUm90LSwgR3LDvG4tIHVuZCBCbGF1YW50ZWlsLCBtYXggZGVyIEjDtmNoc3R3ZXJ0LCB3b2JlaSBqZWRlciBkZXIgQW50ZWlsZSB1bmQgZGFoZXIgYXVjaCBtaW4gendpc2NoZW4gMCB1bmQgMjU1IChqZXdlaWxzIGVpbnNjaGxpZcOfbGljaCkgbGllZ2VuIG11c3MuJ1xyXG4gICAgICAgICAgICAsIGZhbHNlKSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJ0b1N0cmluZ1wiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgXSksIHN0cmluZ1ByaW1pdGl2ZVR5cGUsXHJcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbzogUnVudGltZU9iamVjdCA9IHBhcmFtZXRlcnNbMF0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICg8Q29sb3JDbGFzc0ludHJpbnNpY0RhdGE+KG8uaW50cmluc2ljRGF0YSkpLmhleDtcclxuXHJcbiAgICAgICAgICAgIH0sIGZhbHNlLCBmYWxzZSwgJ1ZlcndhbmRlbHQgZGllIEZhcmJlIGluIGVpbmVuIFN0cmluZy4nLCBmYWxzZSkpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiZXF1YWxzXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcIm90aGVyQ29sb3JcIiwgdHlwZTogdGhpcywgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH0sXHJcbiAgICAgICAgXSksIGJvb2xlYW5QcmltaXRpdmVUeXBlLFxyXG4gICAgICAgICAgICAocGFyYW1ldGVycykgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IG86IFJ1bnRpbWVPYmplY3QgPSBwYXJhbWV0ZXJzWzBdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgbGV0IG8xOiBSdW50aW1lT2JqZWN0ID0gcGFyYW1ldGVyc1sxXS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgZCA9IDxDb2xvckNsYXNzSW50cmluc2ljRGF0YT4oby5pbnRyaW5zaWNEYXRhKTtcclxuICAgICAgICAgICAgICAgIGxldCBkMSA9IDxDb2xvckNsYXNzSW50cmluc2ljRGF0YT4obzEuaW50cmluc2ljRGF0YSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIChkLnJlZCA9PSBkMS5yZWQgJiYgZC5ncmVlbiA9PSBkMS5ncmVlbiAmJiBkLmJsdWUgPT0gZDEuYmx1ZSk7XHJcblxyXG4gICAgICAgICAgICB9LCBmYWxzZSwgZmFsc2UsICdWZXJnbGVpY2h0IHp3ZWkgRmFyYmVuJywgZmFsc2UpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcImdldFJlZFwiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgXSksIGludFByaW1pdGl2ZVR5cGUsXHJcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbzogUnVudGltZU9iamVjdCA9IHBhcmFtZXRlcnNbMF0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICg8Q29sb3JDbGFzc0ludHJpbnNpY0RhdGE+KG8uaW50cmluc2ljRGF0YSkpLnJlZDtcclxuXHJcbiAgICAgICAgICAgIH0sIGZhbHNlLCBmYWxzZSwgJ0dpYnQgZGVuIFJvdGFudGVpbCBkZXIgRmFyYmUgenVyw7xjayAoMCAtIDI1NSkuJywgZmFsc2UpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcImdldEdyZWVuXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICBdKSwgaW50UHJpbWl0aXZlVHlwZSxcclxuICAgICAgICAgICAgKHBhcmFtZXRlcnMpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBvOiBSdW50aW1lT2JqZWN0ID0gcGFyYW1ldGVyc1swXS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKDxDb2xvckNsYXNzSW50cmluc2ljRGF0YT4oby5pbnRyaW5zaWNEYXRhKSkuZ3JlZW47XHJcblxyXG4gICAgICAgICAgICB9LCBmYWxzZSwgZmFsc2UsICdHaWJ0IGRlbiBHcsO8bmFudGVpbCBkZXIgRmFyYmUgenVyw7xjayAoMCAtIDI1NSkuJywgZmFsc2UpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcImdldEJsdWVcIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgIF0pLCBpbnRQcmltaXRpdmVUeXBlLFxyXG4gICAgICAgICAgICAocGFyYW1ldGVycykgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IG86IFJ1bnRpbWVPYmplY3QgPSBwYXJhbWV0ZXJzWzBdLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiAoPENvbG9yQ2xhc3NJbnRyaW5zaWNEYXRhPihvLmludHJpbnNpY0RhdGEpKS5ibHVlO1xyXG5cclxuICAgICAgICAgICAgfSwgZmFsc2UsIGZhbHNlLCAnR2lidCBkZW4gQmxhdWFudGVpbCBkZXIgRmFyYmUgenVyw7xjayAoMCAtIDI1NSkuJywgZmFsc2UpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcImZyb21SR0JcIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwicmVkXCIsIHR5cGU6IGludFByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9LFxyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwiZ3JlZW5cIiwgdHlwZTogaW50UHJpbWl0aXZlVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH0sXHJcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJibHVlXCIsIHR5cGU6IGludFByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9LFxyXG4gICAgICAgIF0pLCBpbnRQcmltaXRpdmVUeXBlLFxyXG4gICAgICAgICAgICAocGFyYW1ldGVycykgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IG86IFJ1bnRpbWVPYmplY3QgPSBwYXJhbWV0ZXJzWzBdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgbGV0IHI6IG51bWJlciA9IHBhcmFtZXRlcnNbMV0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICBsZXQgZzogbnVtYmVyID0gcGFyYW1ldGVyc1syXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIGxldCBiOiBudW1iZXIgPSBwYXJhbWV0ZXJzWzNdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIChyICogMHgxMDAwMCArIGcgKiAweDEwMCArIGIpO1xyXG5cclxuICAgICAgICAgICAgfSwgZmFsc2UsIHRydWUsICdCZXJlY2huZXQgYXVzIFJvdC0sIEdyw7xuLSB1bmQgQmxhdXdlcnQgKGFsbGUgendpc2NoZW4gMCB1bmQgMjU1KSBkaWUgRmFyYmUuJywgZmFsc2UpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcImZyb21SR0JBXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcInJlZFwiLCB0eXBlOiBpbnRQcmltaXRpdmVUeXBlLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfSxcclxuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcImdyZWVuXCIsIHR5cGU6IGludFByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9LFxyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwiYmx1ZVwiLCB0eXBlOiBpbnRQcmltaXRpdmVUeXBlLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfSxcclxuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcImFscGhhXCIsIHR5cGU6IGRvdWJsZVByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9LFxyXG4gICAgICAgIF0pLCBzdHJpbmdQcmltaXRpdmVUeXBlLFxyXG4gICAgICAgICAgICAocGFyYW1ldGVycykgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IG86IFJ1bnRpbWVPYmplY3QgPSBwYXJhbWV0ZXJzWzBdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgbGV0IHI6IG51bWJlciA9IHBhcmFtZXRlcnNbMV0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICBsZXQgZzogbnVtYmVyID0gcGFyYW1ldGVyc1syXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIGxldCBiOiBudW1iZXIgPSBwYXJhbWV0ZXJzWzNdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgbGV0IGE6IG51bWJlciA9IHBhcmFtZXRlcnNbNF0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICBsZXQgY29sb3I6IHN0cmluZyA9IChyICogMHgxMDAwMDAwICsgZyAqIDB4MTAwMDAgKyBiICogMHgxMDAgKyBNYXRoLmZsb29yKGEgKiAyNTUpKS50b1N0cmluZygxNik7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoY29sb3IubGVuZ3RoIDwgOCkgY29sb3IgPSBcIjBcIiArIGNvbG9yO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBcIiNcIiArIGNvbG9yO1xyXG5cclxuICAgICAgICAgICAgfSwgZmFsc2UsIHRydWUsICdCZXJlY2huZXQgYXVzIFJvdC0sIEdyw7xuLSB1bmQgQmxhdXdlcnQgKGFsbGUgendpc2NoZW4gMCB1bmQgMjU1KSBzb3dpZSBBbHBoYS1XZXJ0ICh6d2lzY2hlbiAwIHVuZCAxKSBkaWUgRmFyYmUuJywgZmFsc2UpKTtcclxuXHJcbiAgICB9XHJcblxyXG59XHJcblxyXG4iXX0=