import { Klass, Visibility } from "./Class.js";
import { Attribute, Method, Parameterlist } from "./Types.js";
import { RuntimeObject } from "../../interpreter/RuntimeObject.js";
import { ArrayType } from "./Array.js";
import { stringPrimitiveType, intPrimitiveType, objectType } from "./PrimitiveTypes.js";
export class EnumRuntimeObject extends RuntimeObject {
    constructor(en, enumValue) {
        super(en);
        this.enumValue = enumValue;
    }
}
export class Enum extends Klass {
    constructor(identifier, module, enumValueNodes) {
        super(identifier, module);
        this.enumInfoList = [];
        this.identifierToInfoMap = {};
        this.indexToInfoMap = {};
        this.valueList = null;
        this.baseClass = objectType;
        let i = 0;
        for (let evn of enumValueNodes) {
            let attribute = new Attribute(evn.identifier, this, null, true, Visibility.public, true);
            if (evn.position != null) {
                attribute.declaration = {
                    module: module,
                    position: evn.position
                };
                attribute.usagePositions.set(module, [evn.position]);
            }
            this.staticClass.addAttribute(attribute);
            let ev = {
                identifier: evn.identifier,
                ordinal: i++
            };
            this.enumInfoList.push(ev);
            this.identifierToInfoMap[evn.identifier] = ev;
            this.indexToInfoMap[ev.ordinal] = ev;
        }
        if (module.isSystemModule) {
            this.valueList = {
                type: new ArrayType(this),
                value: []
            };
            for (let ei of this.enumInfoList) {
                ei.object = new EnumRuntimeObject(this, ei);
                this.valueList.value.push({
                    type: this,
                    value: ei.object
                });
            }
        }
        let that = this;
        this.staticClass.addMethod(new Method("getValues", new Parameterlist([]), new ArrayType(this), (parameters) => {
            if (this.valueList == null) {
                let values = [];
                for (let vi of this.enumInfoList) {
                    values.push({
                        type: that,
                        value: vi.object
                    });
                }
                this.valueList = {
                    type: new ArrayType(that),
                    value: values
                };
            }
            return this.valueList;
        }, false, true));
        this.addMethod(new Method("toString", new Parameterlist([]), stringPrimitiveType, (parameters) => {
            let erto = (parameters[0].value);
            return erto.enumValue.identifier;
        }, false, false));
        this.addMethod(new Method("toOrdinal", new Parameterlist([]), intPrimitiveType, (parameters) => {
            let erto = (parameters[0].value);
            return erto.enumValue.ordinal;
        }, false, false));
    }
    getOrdinal(valueIdentifier) {
        let enumInfo = this.identifierToInfoMap[valueIdentifier];
        if (enumInfo == null)
            return -1;
        return enumInfo.ordinal;
    }
    debugOutput(value, maxLength = 40) {
        let enumObject = value.value;
        return this.identifier + "." + enumObject.enumValue.identifier;
    }
    canCastTo(type) {
        if (type == intPrimitiveType) {
            return true;
        }
        return super.canCastTo(type);
    }
    castTo(value, type) {
        if (type == intPrimitiveType) {
            let en = value.value;
            return {
                type: intPrimitiveType,
                value: en.enumValue.ordinal
            };
        }
        return super.castTo(value, type);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW51bS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9jbGllbnQvY29tcGlsZXIvdHlwZXMvRW51bS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUMvQyxPQUFPLEVBQVMsU0FBUyxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQVEsTUFBTSxZQUFZLENBQUM7QUFFM0UsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQ25FLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFHdkMsT0FBTyxFQUFFLG1CQUFtQixFQUFFLGdCQUFnQixFQUFFLFVBQVUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRXhGLE1BQU0sT0FBTyxpQkFBa0IsU0FBUSxhQUFhO0lBSWhELFlBQVksRUFBUSxFQUFFLFNBQW1CO1FBQ3JDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNWLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO0lBQy9CLENBQUM7Q0FFSjtBQVdELE1BQU0sT0FBTyxJQUFLLFNBQVEsS0FBSztJQXFCM0IsWUFBWSxVQUFrQixFQUFFLE1BQWMsRUFBRSxjQUErQjtRQUUzRSxLQUFLLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBckI5QixpQkFBWSxHQUFlLEVBQUUsQ0FBQztRQUM5Qix3QkFBbUIsR0FBdUMsRUFBRSxDQUFDO1FBQzdELG1CQUFjLEdBQWtDLEVBQUUsQ0FBQztRQUVuRCxjQUFTLEdBQVUsSUFBSSxDQUFDO1FBa0JwQixJQUFJLENBQUMsU0FBUyxHQUFHLFVBQVUsQ0FBQztRQUU1QixJQUFJLENBQUMsR0FBVyxDQUFDLENBQUM7UUFFbEIsS0FBSyxJQUFJLEdBQUcsSUFBSSxjQUFjLEVBQUU7WUFFNUIsSUFBSSxTQUFTLEdBQWMsSUFBSSxTQUFTLENBQUMsR0FB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TztnQkFDSCxJQUFJLEVBQUUsZ0JBQWdCO2dCQUN0QixLQUFLLEVBQUUsRUFBRSxDQUFDLFNBQVMsQ0FBQyxPQUFPO2FBQzlCLENBQUM7U0FDTDtRQUVELE9BQU8sS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDckMsQ0FBQztDQUdKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJvZ3JhbSB9IGZyb20gXCIuLi9wYXJzZXIvUHJvZ3JhbS5qc1wiO1xyXG5pbXBvcnQgeyBLbGFzcywgVmlzaWJpbGl0eSB9IGZyb20gXCIuL0NsYXNzLmpzXCI7XHJcbmltcG9ydCB7IFZhbHVlLCBBdHRyaWJ1dGUsIE1ldGhvZCwgUGFyYW1ldGVybGlzdCwgVHlwZSB9IGZyb20gXCIuL1R5cGVzLmpzXCI7XHJcbmltcG9ydCB7IE1vZHVsZSB9IGZyb20gXCIuLi9wYXJzZXIvTW9kdWxlLmpzXCI7XHJcbmltcG9ydCB7IFJ1bnRpbWVPYmplY3QgfSBmcm9tIFwiLi4vLi4vaW50ZXJwcmV0ZXIvUnVudGltZU9iamVjdC5qc1wiO1xyXG5pbXBvcnQgeyBBcnJheVR5cGUgfSBmcm9tIFwiLi9BcnJheS5qc1wiO1xyXG5pbXBvcnQgeyBUZXh0UG9zaXRpb24gfSBmcm9tIFwiLi4vbGV4ZXIvVG9rZW4uanNcIjtcclxuaW1wb3J0IHsgRW51bVZhbHVlTm9kZSB9IGZyb20gXCIuLi9wYXJzZXIvQVNULmpzXCI7XHJcbmltcG9ydCB7IHN0cmluZ1ByaW1pdGl2ZVR5cGUsIGludFByaW1pdGl2ZVR5cGUsIG9iamVjdFR5cGUgfSBmcm9tIFwiLi9QcmltaXRpdmVUeXBlcy5qc1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEVudW1SdW50aW1lT2JqZWN0IGV4dGVuZHMgUnVudGltZU9iamVjdCB7XHJcblxyXG4gICAgZW51bVZhbHVlOiBFbnVtSW5mbztcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihlbjogRW51bSwgZW51bVZhbHVlOiBFbnVtSW5mbykge1xyXG4gICAgICAgIHN1cGVyKGVuKTtcclxuICAgICAgICB0aGlzLmVudW1WYWx1ZSA9IGVudW1WYWx1ZTtcclxuICAgIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIEVudW1JbmZvID0ge1xyXG4gICAgaWRlbnRpZmllcjogc3RyaW5nLFxyXG4gICAgb3JkaW5hbDogbnVtYmVyLFxyXG4gICAgcG9zaXRpb24/OiBUZXh0UG9zaXRpb24sXHJcbiAgICBvYmplY3Q/OiBFbnVtUnVudGltZU9iamVjdCxcclxuICAgIGNvbnN0cnVjdG9yQ2FsbFByb2dyYW0/OiBQcm9ncmFtXHJcbn1cclxuXHJcblxyXG5leHBvcnQgY2xhc3MgRW51bSBleHRlbmRzIEtsYXNzIHtcclxuXHJcbiAgICBlbnVtSW5mb0xpc3Q6IEVudW1JbmZvW10gPSBbXTtcclxuICAgIGlkZW50aWZpZXJUb0luZm9NYXA6IHsgW2lkZW50aWZpZXI6IHN0cmluZ106IEVudW1JbmZvIH0gPSB7fTtcclxuICAgIGluZGV4VG9JbmZvTWFwOiB7IFtpbmRleDogbnVtYmVyXTogRW51bUluZm8gfSA9IHt9O1xyXG5cclxuICAgIHZhbHVlTGlzdDogVmFsdWUgPSBudWxsO1xyXG5cclxuICAgIGdldE9yZGluYWwodmFsdWVJZGVudGlmaWVyOiBzdHJpbmcpOiBudW1iZXIge1xyXG5cclxuICAgICAgICBsZXQgZW51bUluZm86IEVudW1JbmZvID0gdGhpcy5pZGVudGlmaWVyVG9JbmZvTWFwW3ZhbHVlSWRlbnRpZmllcl07XHJcbiAgICAgICAgaWYgKGVudW1JbmZvID09IG51bGwpIHJldHVybiAtMTtcclxuICAgICAgICByZXR1cm4gZW51bUluZm8ub3JkaW5hbDtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGRlYnVnT3V0cHV0KHZhbHVlOiBWYWx1ZSwgbWF4TGVuZ3RoOiBudW1iZXIgPSA0MCk6IHN0cmluZyB7XHJcbiAgICAgICAgbGV0IGVudW1PYmplY3QgPSA8RW51bVJ1bnRpbWVPYmplY3Q+dmFsdWUudmFsdWU7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaWRlbnRpZmllciArIFwiLlwiICsgZW51bU9iamVjdC5lbnVtVmFsdWUuaWRlbnRpZmllcjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdHJ1Y3RvcihpZGVudGlmaWVyOiBzdHJpbmcsIG1vZHVsZTogTW9kdWxlLCBlbnVtVmFsdWVOb2RlczogRW51bVZhbHVlTm9kZVtdKSB7XHJcblxyXG4gICAgICAgIHN1cGVyKGlkZW50aWZpZXIsIG1vZHVsZSk7XHJcbiAgICAgICAgdGhpcy5iYXNlQ2xhc3MgPSBvYmplY3RUeXBlO1xyXG5cclxuICAgICAgICBsZXQgaTogbnVtYmVyID0gMDtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgZXZuIG9mIGVudW1WYWx1ZU5vZGVzKSB7XHJcblxyXG4gICAgICAgICAgICBsZXQgYXR0cmlidXRlOiBBdHRyaWJ1dGUgPSBuZXcgQXR0cmlidXRlKGV2bi5pZGVudGlmaWVyLCB0aGlzLCBudWxsLCB0cnVlLCBWaXNpYmlsaXR5LnB1YmxpYywgdHJ1ZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoZXZuLnBvc2l0aW9uICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZS5kZWNsYXJhdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgICAgICBtb2R1bGU6IG1vZHVsZSxcclxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogZXZuLnBvc2l0aW9uXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlLnVzYWdlUG9zaXRpb25zLnNldChtb2R1bGUsIFtldm4ucG9zaXRpb25dKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5zdGF0aWNDbGFzcy5hZGRBdHRyaWJ1dGUoXHJcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVcclxuICAgICAgICAgICAgKTtcclxuXHJcblxyXG4gICAgICAgICAgICBsZXQgZXY6IEVudW1JbmZvID0ge1xyXG4gICAgICAgICAgICAgICAgaWRlbnRpZmllcjogZXZuLmlkZW50aWZpZXIsXHJcbiAgICAgICAgICAgICAgICBvcmRpbmFsOiBpKytcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5lbnVtSW5mb0xpc3QucHVzaChldik7XHJcbiAgICAgICAgICAgIHRoaXMuaWRlbnRpZmllclRvSW5mb01hcFtldm4uaWRlbnRpZmllcl0gPSBldjtcclxuICAgICAgICAgICAgdGhpcy5pbmRleFRvSW5mb01hcFtldi5vcmRpbmFsXSA9IGV2O1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKG1vZHVsZS5pc1N5c3RlbU1vZHVsZSl7XHJcbiAgICAgICAgICAgIHRoaXMudmFsdWVMaXN0ID0ge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogbmV3IEFycmF5VHlwZSh0aGlzKSxcclxuICAgICAgICAgICAgICAgIHZhbHVlOiBbXVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBmb3IobGV0IGVpIG9mIHRoaXMuZW51bUluZm9MaXN0KXtcclxuXHJcbiAgICAgICAgICAgICAgICBlaS5vYmplY3QgPSBuZXcgRW51bVJ1bnRpbWVPYmplY3QodGhpcywgZWkpO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMudmFsdWVMaXN0LnZhbHVlLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IHRoaXMsXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGVpLm9iamVjdFxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IHRoYXQgPSB0aGlzO1xyXG5cclxuICAgICAgICB0aGlzLnN0YXRpY0NsYXNzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiZ2V0VmFsdWVzXCIsXHJcbiAgICAgICAgICAgIG5ldyBQYXJhbWV0ZXJsaXN0KFtdKSwgbmV3IEFycmF5VHlwZSh0aGlzKSwgKHBhcmFtZXRlcnM6IFZhbHVlW10pID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy52YWx1ZUxpc3QgPT0gbnVsbCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBsZXQgdmFsdWVzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgdmkgb2YgdGhpcy5lbnVtSW5mb0xpc3QpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHRoYXQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmkub2JqZWN0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWVMaXN0ID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBuZXcgQXJyYXlUeXBlKHRoYXQpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWVzXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy52YWx1ZUxpc3Q7XHJcblxyXG4gICAgICAgICAgICB9LCBmYWxzZSwgdHJ1ZSlcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwidG9TdHJpbmdcIixcclxuICAgICAgICAgICAgbmV3IFBhcmFtZXRlcmxpc3QoW10pLCBzdHJpbmdQcmltaXRpdmVUeXBlLCAocGFyYW1ldGVyczogVmFsdWVbXSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBlcnRvOiBFbnVtUnVudGltZU9iamVjdCA9IDxFbnVtUnVudGltZU9iamVjdD4ocGFyYW1ldGVyc1swXS52YWx1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVydG8uZW51bVZhbHVlLmlkZW50aWZpZXI7XHJcblxyXG4gICAgICAgICAgICB9LCBmYWxzZSwgZmFsc2UpXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcInRvT3JkaW5hbFwiLFxyXG4gICAgICAgICAgICBuZXcgUGFyYW1ldGVybGlzdChbXSksIGludFByaW1pdGl2ZVR5cGUsIChwYXJhbWV0ZXJzOiBWYWx1ZVtdKSA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IGVydG86IEVudW1SdW50aW1lT2JqZWN0ID0gPEVudW1SdW50aW1lT2JqZWN0PihwYXJhbWV0ZXJzWzBdLnZhbHVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJ0by5lbnVtVmFsdWUub3JkaW5hbDtcclxuXHJcbiAgICAgICAgICAgIH0sIGZhbHNlLCBmYWxzZSlcclxuICAgICAgICApO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2FuQ2FzdFRvKHR5cGU6IFR5cGUpOiBib29sZWFuIHtcclxuXHJcbiAgICAgICAgaWYgKHR5cGUgPT0gaW50UHJpbWl0aXZlVHlwZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzdXBlci5jYW5DYXN0VG8odHlwZSk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjYXN0VG8odmFsdWU6IFZhbHVlLCB0eXBlOiBUeXBlKTogVmFsdWUge1xyXG5cclxuICAgICAgICBpZiAodHlwZSA9PSBpbnRQcmltaXRpdmVUeXBlKSB7XHJcbiAgICAgICAgICAgIGxldCBlbiA9IDxFbnVtUnVudGltZU9iamVjdD52YWx1ZS52YWx1ZTtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IGludFByaW1pdGl2ZVR5cGUsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogZW4uZW51bVZhbHVlLm9yZGluYWxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzdXBlci5jYXN0VG8odmFsdWUsIHR5cGUpO1xyXG4gICAgfVxyXG5cclxuXHJcbn0iXX0=