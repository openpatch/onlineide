export class ViewModeController {
    constructor($buttonsContainer, main) {
        this.$buttonsContainer = $buttonsContainer;
        this.main = main;
        this.$buttonMap = {};
        this.highContrast = false;
        this.editorHasFullWidth = false;
        this.$buttonEditorFullscreen = jQuery('<div title="Editor in voller Breite" class="img_whole-window jo_button jo_active" style="padding: 1px; margin-right: 8px"></div>');
        this.$buttonPresentationMode = jQuery('<div title="Präsentation (Beamer)" class="img_presentation-mode jo_button jo_active" syle="padding: 1px"></div>');
        this.$buttonMonitorMode = jQuery('<div title="Monitor" class="img_monitor-mode jo_button jo_active" style="margin-left: 5px; padding: 1px"></div>');
        $buttonsContainer.append(this.$buttonEditorFullscreen, this.$buttonPresentationMode, this.$buttonMonitorMode);
        this.$buttonMap = {
            "presentation": this.$buttonPresentationMode,
            "monitor": this.$buttonMonitorMode
        };
        let am = this.main.actionManager;
        am.registerAction("editor.fullwidth", [], () => {
            this.toggleEditorFullwidth();
        }, "Editor auf die volle Breite erweitern", this.$buttonEditorFullscreen);
        am.registerAction("viewmode.presentation", [], () => {
            this.setMode("presentation");
        }, "Präsentationsansicht", this.$buttonPresentationMode);
        am.registerAction("viewmode.monitor", [], () => {
            this.setMode("monitor");
        }, "Monitoransicht", this.$buttonMonitorMode);
    }
    toggleEditorFullwidth() {
        if (this.editorHasFullWidth) {
            this.$buttonEditorFullscreen.removeClass('img_whole-window-back');
            this.$buttonEditorFullscreen.addClass('img_whole-window');
            this.$buttonEditorFullscreen.attr('title', 'Editor in voller Breite');
            jQuery('#rightdiv').css('width', this.rightDivWidth + "px");
            jQuery('#editor>.monaco-editor').css('width', this.editorWidth + 'px');
            jQuery('#rightdiv').show(600);
            jQuery('#leftpanel').show(600);
            jQuery('#controls').show();
        }
        else {
            this.$buttonEditorFullscreen.removeClass('img_whole-window');
            this.$buttonEditorFullscreen.addClass('img_whole-window-back');
            this.$buttonEditorFullscreen.attr('title', 'Editor in normaler Breite');
            this.rightDivWidth = Number.parseInt(jQuery('#rightdiv').css('width').replace('px', ''));
            this.editorWidth = Number.parseInt(jQuery('#editor>.monaco-editor').css('width').replace('px', ''));
            jQuery('#rightdiv').hide(600);
            jQuery('#leftpanel').hide(600);
            jQuery('#controls').hide();
            this.main.getInterpreter().stop();
        }
        setTimeout(() => {
            this.main.getMonacoEditor().layout();
        }, 800);
        this.editorHasFullWidth = !this.editorHasFullWidth;
    }
    setMode(mode, saveSettings = true) {
        let otherMode = mode == "presentation" ? "monitor" : "presentation";
        this.$buttonMap[mode].addClass("jo_pressed");
        this.$buttonMap[otherMode].removeClass("jo_pressed");
        let settings = this.main.user.settings;
        let viewModes = settings.viewModes;
        let viewMode = viewModes[mode];
        viewModes.viewModeChosen = mode;
        this.main.themeManager.switchTheme(viewMode.theme);
        this.main.editor.setFontSize(viewMode.fontSize);
        if (this.highContrast != viewMode.highContrast) {
            let editor = this.main.getMonacoEditor();
            editor.getAction("editor.action.toggleHighContrast").run();
            this.highContrast = !this.highContrast;
        }
        if (saveSettings)
            this.saveSettings();
    }
    saveFontSize(fontSizePx) {
        let viewMode = this.getChosenViewMode();
        viewMode.fontSize = fontSizePx;
        this.saveSettings();
    }
    setTheme(theme) {
        let viewMode = this.getChosenViewMode();
        viewMode.theme = theme;
        this.main.themeManager.switchTheme(viewMode.theme);
        this.saveSettings();
    }
    toggleHighContrast() {
        let viewMode = this.getChosenViewMode();
        viewMode.highContrast = !viewMode.highContrast;
        let editor = this.main.getMonacoEditor();
        editor.getAction("editor.action.toggleHighContrast").run();
        this.saveSettings();
    }
    getChosenViewMode() {
        let viewModes = this.main.user.settings.viewModes;
        return viewModes[viewModes.viewModeChosen];
    }
    saveSettings() {
        this.main.userDataDirty = true;
    }
    initViewMode() {
        let settings = this.main.user.settings;
        if (settings["viewModes"] == null) {
            settings["viewModes"] = {
                monitor: null,
                presentation: null,
                viewModeChosen: "monitor"
            };
        }
        if (settings.viewModes.monitor == null) {
            settings.viewModes.monitor = {
                fontSize: 14,
                highContrast: false,
                theme: "dark"
            };
            settings.viewModes.presentation = {
                fontSize: 18,
                highContrast: false,
                theme: "light"
            };
            this.saveSettings();
        }
        this.setMode(settings.viewModes.viewModeChosen, false);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVmlld01vZGVDb250cm9sbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2NsaWVudC9tYWluL2d1aS9WaWV3TW9kZUNvbnRyb2xsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBSUEsTUFBTSxPQUFPLGtCQUFrQjtJQWMzQixZQUFvQixpQkFBc0MsRUFBVSxJQUFVO1FBQTFELHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBcUI7UUFBVSxTQUFJLEdBQUosSUFBSSxDQUFNO1FBUjlFLGVBQVUsR0FBMkMsRUFBRSxDQUFDO1FBRXhELGlCQUFZLEdBQVksS0FBSyxDQUFDO1FBQzlCLHVCQUFrQixHQUFZLEtBQUssQ0FBQztRQU9oQyxJQUFJLENBQUMsdUJBQXVCLEdBQUcsTUFBTSxDQUFDLGtJQUFrSSxDQUFDLENBQUM7UUFDMUssSUFBSSxDQUFDLHVCQUF1QixHQUFHLE1BQU0sQ0FBQyxpSEFBaUgsQ0FBQyxDQUFDO1FBQ3pKLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxNQUFNLENBQUMsaUhBQWlILENBQUMsQ0FBQztRQUNwSixpQkFBaUIsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLHVCQUF1QixFQUFFLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQztRQUU5RyxJQUFJLENBQUMsVUFBVSxHQUFHO1lBQ2QsY0FBYyxFQUFFLElBQUksQ0FBQyx1QkFBdUI7WUFDNUMsU0FBUyxFQUFFLElBQUksQ0FBQyxrQkFBa0I7U0FDckMsQ0FBQztRQUVGLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDO1FBRWpDLEVBQUUsQ0FBQyxjQUFjLENBQUMsa0JBQWtCLEVBQUUsRUFBRSxFQUNwQyxHQUFHLEVBQUU7WUFDRCxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUNqQyxDQUFDLEVBQUUsdUNBQXVDLEVBQUUsSUFBSSxDQUFDLHVCQUF1QixDQUFD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LEVBQUUsSUFBSTtnQkFDbEIsY0FBYyxFQUFFLFNBQVM7YUFDNUIsQ0FBQTtTQUNKO1FBRUQsSUFBSSxRQUFRLENBQUMsU0FBUyxDQUFDLE9BQU8sSUFBSSxJQUFJLEVBQUU7WUFDcEMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxPQUFPLEdBQUc7Z0JBQ3pCLFFBQVEsRUFBRSxFQUFFO2dCQUNaLFlBQVksRUFBRSxLQUFLO2dCQUNuQixLQUFLLEVBQUUsTUFBTTthQUNoQixDQUFDO1lBRUYsUUFBUSxDQUFDLFNBQVMsQ0FBQyxZQUFZLEdBQUc7Z0JBQzlCLFFBQVEsRUFBRSxFQUFFO2dCQUNaLFlBQVksRUFBRSxLQUFLO2dCQUNuQixLQUFLLEVBQUUsT0FBTzthQUNqQixDQUFBO1lBQ0QsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1NBQ3ZCO1FBQ0QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLGNBQWMsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUMzRCxDQUFDO0NBR0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUaGVtZU1hbmFnZXIgfSBmcm9tIFwiLi9UaGVtZU1hbmFnZXJcIjtcclxuaW1wb3J0IHsgTWFpbiB9IGZyb20gXCIuLi9NYWluXCI7XHJcbmltcG9ydCB7IFZpZXdNb2RlcywgVmlld01vZGUgfSBmcm9tIFwiLi4vLi4vY29tbXVuaWNhdGlvbi9EYXRhXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgVmlld01vZGVDb250cm9sbGVyIHtcclxuXHJcbiAgICAkYnV0dG9uRWRpdG9yRnVsbHNjcmVlbjogSlF1ZXJ5PEhUTUxFbGVtZW50PjtcclxuICAgICRidXR0b25QcmVzZW50YXRpb25Nb2RlOiBKUXVlcnk8SFRNTEVsZW1lbnQ+O1xyXG4gICAgJGJ1dHRvbk1vbml0b3JNb2RlOiBKUXVlcnk8SFRNTEVsZW1lbnQ+O1xyXG5cclxuICAgICRidXR0b25NYXA6IHsgW2tleTogc3RyaW5nXTogSlF1ZXJ5PEhUTUxFbGVtZW50PiB9ID0ge307XHJcblxyXG4gICAgaGlnaENvbnRyYXN0OiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBlZGl0b3JIYXNGdWxsV2lkdGg6IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgICByaWdodERpdldpZHRoOiBudW1iZXI7XHJcbiAgICBlZGl0b3JXaWR0aDogbnVtYmVyO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgJGJ1dHRvbnNDb250YWluZXI6IEpRdWVyeTxIVE1MRWxlbWVudD4sIHByaXZhdGUgbWFpbjogTWFpbikge1xyXG5cclxuICAgICAgICB0aGlzLiRidXR0b25FZGl0b3JGdWxsc2NyZWVuID0galF1ZXJ5KCc8ZGl2IHRpdGxlPVwiRWRpdG9yIGluIHZvbGxlciBCcmVpdGVcIiBjbGFzcz1cImltZ193aG9sZS13aW5kb3cgam9fYnV0dG9uIGpvX2FjdGl2ZVwiIHN0eWxlPVwicGFkZGluZzogMXB4OyBtYXJnaW4tcmlnaHQ6IDhweFwiPjwvZGl2PicpO1xyXG4gICAgICAgIHRoaXMuJGJ1dHRvblByZXNlbnRhdGlvbk1vZGUgPSBqUXVlcnkoJzxkaXYgdGl0bGU9XCJQcsOkc2VudGF0aW9uIChCZWFtZXIpXCIgY2xhc3M9XCJpbWdfcHJlc2VudGF0aW9uLW1vZGUgam9fYnV0dG9uIGpvX2FjdGl2ZVwiIHN5bGU9XCJwYWRkaW5nOiAxcHhcIj48L2Rpdj4nKTtcclxuICAgICAgICB0aGlzLiRidXR0b25Nb25pdG9yTW9kZSA9IGpRdWVyeSgnPGRpdiB0aXRsZT1cIk1vbml0b3JcIiBjbGFzcz1cImltZ19tb25pdG9yLW1vZGUgam9fYnV0dG9uIGpvX2FjdGl2ZVwiIHN0eWxlPVwibWFyZ2luLWxlZnQ6IDVweDsgcGFkZGluZzogMXB4XCI+PC9kaXY+Jyk7XHJcbiAgICAgICAgJGJ1dHRvbnNDb250YWluZXIuYXBwZW5kKHRoaXMuJGJ1dHRvbkVkaXRvckZ1bGxzY3JlZW4sIHRoaXMuJGJ1dHRvblByZXNlbnRhdGlvbk1vZGUsIHRoaXMuJGJ1dHRvbk1vbml0b3JNb2RlKTtcclxuXHJcbiAgICAgICAgdGhpcy4kYnV0dG9uTWFwID0ge1xyXG4gICAgICAgICAgICBcInByZXNlbnRhdGlvblwiOiB0aGlzLiRidXR0b25QcmVzZW50YXRpb25Nb2RlLFxyXG4gICAgICAgICAgICBcIm1vbml0b3JcIjogdGhpcy4kYnV0dG9uTW9uaXRvck1vZGVcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBsZXQgYW0gPSB0aGlzLm1haW4uYWN0aW9uTWFuYWdlcjtcclxuXHJcbiAgICAgICAgYW0ucmVnaXN0ZXJBY3Rpb24oXCJlZGl0b3IuZnVsbHdpZHRoXCIsIFtdLFxyXG4gICAgICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZUVkaXRvckZ1bGx3aWR0aCgpO1xyXG4gICAgICAgICAgICB9LCBcIkVkaXRvciBhdWYgZGllIHZvbGxlIEJyZWl0ZSBlcndlaXRlcm5cIiwgdGhpcy4kYnV0dG9uRWRpdG9yRnVsbHNjcmVlbik7XHJcblxyXG4gICAgICAgIGFtLnJlZ2lzdGVyQWN0aW9uKFwidmlld21vZGUucHJlc2VudGF0aW9uXCIsIFtdLFxyXG4gICAgICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldE1vZGUoXCJwcmVzZW50YXRpb25cIik7XHJcbiAgICAgICAgICAgIH0sIFwiUHLDpHNlbnRhdGlvbnNhbnNpY2h0XCIsIHRoaXMuJGJ1dHRvblByZXNlbnRhdGlvbk1vZGUpO1xyXG5cclxuICAgICAgICBhbS5yZWdpc3RlckFjdGlvbihcInZpZXdtb2RlLm1vbml0b3JcIiwgW10sXHJcbiAgICAgICAgICAgICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0TW9kZShcIm1vbml0b3JcIik7XHJcbiAgICAgICAgICAgIH0sIFwiTW9uaXRvcmFuc2ljaHRcIiwgdGhpcy4kYnV0dG9uTW9uaXRvck1vZGUpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICB0b2dnbGVFZGl0b3JGdWxsd2lkdGgoKSB7XHJcbiAgICAgICAgaWYodGhpcy5lZGl0b3JIYXNGdWxsV2lkdGgpe1xyXG4gICAgICAgICAgICB0aGlzLiRidXR0b25FZGl0b3JGdWxsc2NyZWVuLnJlbW92ZUNsYXNzKCdpbWdfd2hvbGUtd2luZG93LWJhY2snKTtcclxuICAgICAgICAgICAgdGhpcy4kYnV0dG9uRWRpdG9yRnVsbHNjcmVlbi5hZGRDbGFzcygnaW1nX3dob2xlLXdpbmRvdycpO1xyXG4gICAgICAgICAgICB0aGlzLiRidXR0b25FZGl0b3JGdWxsc2NyZWVuLmF0dHIoJ3RpdGxlJywgJ0VkaXRvciBpbiB2b2xsZXIgQnJlaXRlJyk7XHJcbiAgICAgICAgICAgIGpRdWVyeSgnI3JpZ2h0ZGl2JykuY3NzKCd3aWR0aCcsIHRoaXMucmlnaHREaXZXaWR0aCArIFwicHhcIik7XHJcbiAgICAgICAgICAgIGpRdWVyeSgnI2VkaXRvcj4ubW9uYWNvLWVkaXRvcicpLmNzcygnd2lkdGgnLCB0aGlzLmVkaXRvcldpZHRoICsgJ3B4Jyk7XHJcblxyXG4gICAgICAgICAgICBqUXVlcnkoJyNyaWdodGRpdicpLnNob3coNjAwKTtcclxuICAgICAgICAgICAgalF1ZXJ5KCcjbGVmdHBhbmVsJykuc2hvdyg2MDApO1xyXG4gICAgICAgICAgICBqUXVlcnkoJyNjb250cm9scycpLnNob3coKTtcclxuXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy4kYnV0dG9uRWRpdG9yRnVsbHNjcmVlbi5yZW1vdmVDbGFzcygnaW1nX3dob2xlLXdpbmRvdycpO1xyXG4gICAgICAgICAgICB0aGlzLiRidXR0b25FZGl0b3JGdWxsc2NyZWVuLmFkZENsYXNzKCdpbWdfd2hvbGUtd2luZG93LWJhY2snKTtcclxuICAgICAgICAgICAgdGhpcy4kYnV0dG9uRWRpdG9yRnVsbHNjcmVlbi5hdHRyKCd0aXRsZScsICdFZGl0b3IgaW4gbm9ybWFsZXIgQnJlaXRlJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLnJpZ2h0RGl2V2lkdGggPSBOdW1iZXIucGFyc2VJbnQoalF1ZXJ5KCcjcmlnaHRkaXYnKS5jc3MoJ3dpZHRoJykucmVwbGFjZSgncHgnLCAnJykpO1xyXG4gICAgICAgICAgICB0aGlzLmVkaXRvcldpZHRoID0gTnVtYmVyLnBhcnNlSW50KGpRdWVyeSgnI2VkaXRvcj4ubW9uYWNvLWVkaXRvcicpLmNzcygnd2lkdGgnKS5yZXBsYWNlKCdweCcsICcnKSk7XHJcblxyXG4gICAgICAgICAgICBqUXVlcnkoJyNyaWdodGRpdicpLmhpZGUoNjAwKTtcclxuICAgICAgICAgICAgalF1ZXJ5KCcjbGVmdHBhbmVsJykuaGlkZSg2MDApO1xyXG4gICAgICAgICAgICBqUXVlcnkoJyNjb250cm9scycpLmhpZGUoKTtcclxuICAgICAgICAgICAgdGhpcy5tYWluLmdldEludGVycHJldGVyKCkuc3RvcCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc2V0VGltZW91dCgoKT0+e1xyXG4gICAgICAgICAgICB0aGlzLm1haW4uZ2V0TW9uYWNvRWRpdG9yKCkubGF5b3V0KCk7XHJcbiAgICAgICAgfSwgODAwKTtcclxuXHJcbiAgICAgICAgdGhpcy5lZGl0b3JIYXNGdWxsV2lkdGggPSAhdGhpcy5lZGl0b3JIYXNGdWxsV2lkdGg7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0TW9kZShtb2RlOiBcInByZXNlbnRhdGlvblwiIHwgXCJtb25pdG9yXCIsIHNhdmVTZXR0aW5nczogYm9vbGVhbiA9IHRydWUpIHtcclxuXHJcbiAgICAgICAgbGV0IG90aGVyTW9kZSA9IG1vZGUgPT0gXCJwcmVzZW50YXRpb25cIiA/IFwibW9uaXRvclwiIDogXCJwcmVzZW50YXRpb25cIjtcclxuXHJcbiAgICAgICAgdGhpcy4kYnV0dG9uTWFwW21vZGVdLmFkZENsYXNzKFwiam9fcHJlc3NlZFwiKTtcclxuICAgICAgICB0aGlzLiRidXR0b25NYXBbb3RoZXJNb2RlXS5yZW1vdmVDbGFzcyhcImpvX3ByZXNzZWRcIik7XHJcblxyXG4gICAgICAgIGxldCBzZXR0aW5ncyA9IHRoaXMubWFpbi51c2VyLnNldHRpbmdzO1xyXG4gICAgICAgIGxldCB2aWV3TW9kZXMgPSBzZXR0aW5ncy52aWV3TW9kZXM7XHJcblxyXG4gICAgICAgIGxldCB2aWV3TW9kZSA9IHZpZXdNb2Rlc1ttb2RlXTtcclxuICAgICAgICB2aWV3TW9kZXMudmlld01vZGVDaG9zZW4gPSBtb2RlO1xyXG5cclxuICAgICAgICB0aGlzLm1haW4udGhlbWVNYW5hZ2VyLnN3aXRjaFRoZW1lKHZpZXdNb2RlLnRoZW1lKTtcclxuXHJcbiAgICAgICAgdGhpcy5tYWluLmVkaXRvci5zZXRGb250U2l6ZSh2aWV3TW9kZS5mb250U2l6ZSk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmhpZ2hDb250cmFzdCAhPSB2aWV3TW9kZS5oaWdoQ29udHJhc3QpIHtcclxuICAgICAgICAgICAgbGV0IGVkaXRvciA9IHRoaXMubWFpbi5nZXRNb25hY29FZGl0b3IoKTtcclxuICAgICAgICAgICAgZWRpdG9yLmdldEFjdGlvbihcImVkaXRvci5hY3Rpb24udG9nZ2xlSGlnaENvbnRyYXN0XCIpLnJ1bigpO1xyXG4gICAgICAgICAgICB0aGlzLmhpZ2hDb250cmFzdCA9ICF0aGlzLmhpZ2hDb250cmFzdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChzYXZlU2V0dGluZ3MpIHRoaXMuc2F2ZVNldHRpbmdzKCk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHNhdmVGb250U2l6ZShmb250U2l6ZVB4OiBudW1iZXIpIHtcclxuICAgICAgICBsZXQgdmlld01vZGUgPSB0aGlzLmdldENob3NlblZpZXdNb2RlKCk7XHJcbiAgICAgICAgdmlld01vZGUuZm9udFNpemUgPSBmb250U2l6ZVB4O1xyXG4gICAgICAgIHRoaXMuc2F2ZVNldHRpbmdzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VGhlbWUodGhlbWU6IHN0cmluZykge1xyXG4gICAgICAgIGxldCB2aWV3TW9kZSA9IHRoaXMuZ2V0Q2hvc2VuVmlld01vZGUoKTtcclxuICAgICAgICB2aWV3TW9kZS50aGVtZSA9IHRoZW1lO1xyXG4gICAgICAgIHRoaXMubWFpbi50aGVtZU1hbmFnZXIuc3dpdGNoVGhlbWUodmlld01vZGUudGhlbWUpO1xyXG4gICAgICAgIHRoaXMuc2F2ZVNldHRpbmdzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdG9nZ2xlSGlnaENvbnRyYXN0KCkge1xyXG4gICAgICAgIGxldCB2aWV3TW9kZSA9IHRoaXMuZ2V0Q2hvc2VuVmlld01vZGUoKTtcclxuICAgICAgICB2aWV3TW9kZS5oaWdoQ29udHJhc3QgPSAhdmlld01vZGUuaGlnaENvbnRyYXN0O1xyXG4gICAgICAgIGxldCBlZGl0b3IgPSB0aGlzLm1haW4uZ2V0TW9uYWNvRWRpdG9yKCk7XHJcbiAgICAgICAgZWRpdG9yLmdldEFjdGlvbihcImVkaXRvci5hY3Rpb24udG9nZ2xlSGlnaENvbnRyYXN0XCIpLnJ1bigpO1xyXG4gICAgICAgIHRoaXMuc2F2ZVNldHRpbmdzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q2hvc2VuVmlld01vZGUoKTogVmlld01vZGUge1xyXG4gICAgICAgIGxldCB2aWV3TW9kZXMgPSB0aGlzLm1haW4udXNlci5zZXR0aW5ncy52aWV3TW9kZXM7XHJcbiAgICAgICAgcmV0dXJuIHZpZXdNb2Rlc1t2aWV3TW9kZXMudmlld01vZGVDaG9zZW5dO1xyXG4gICAgfVxyXG5cclxuICAgIHNhdmVTZXR0aW5ncygpIHtcclxuICAgICAgICB0aGlzLm1haW4udXNlckRhdGFEaXJ0eSA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdFZpZXdNb2RlKCkge1xyXG4gICAgICAgIGxldCBzZXR0aW5ncyA9IHRoaXMubWFpbi51c2VyLnNldHRpbmdzO1xyXG5cclxuICAgICAgICBpZiAoc2V0dGluZ3NbXCJ2aWV3TW9kZXNcIl0gPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBzZXR0aW5nc1tcInZpZXdNb2Rlc1wiXSA9IHtcclxuICAgICAgICAgICAgICAgIG1vbml0b3I6IG51bGwsXHJcbiAgICAgICAgICAgICAgICBwcmVzZW50YXRpb246IG51bGwsXHJcbiAgICAgICAgICAgICAgICB2aWV3TW9kZUNob3NlbjogXCJtb25pdG9yXCJcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHNldHRpbmdzLnZpZXdNb2Rlcy5tb25pdG9yID09IG51bGwpIHtcclxuICAgICAgICAgICAgc2V0dGluZ3Mudmlld01vZGVzLm1vbml0b3IgPSB7XHJcbiAgICAgICAgICAgICAgICBmb250U2l6ZTogMTQsXHJcbiAgICAgICAgICAgICAgICBoaWdoQ29udHJhc3Q6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgdGhlbWU6IFwiZGFya1wiXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBzZXR0aW5ncy52aWV3TW9kZXMucHJlc2VudGF0aW9uID0ge1xyXG4gICAgICAgICAgICAgICAgZm9udFNpemU6IDE4LFxyXG4gICAgICAgICAgICAgICAgaGlnaENvbnRyYXN0OiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHRoZW1lOiBcImxpZ2h0XCJcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNldE1vZGUoc2V0dGluZ3Mudmlld01vZGVzLnZpZXdNb2RlQ2hvc2VuLCBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG5cclxufSJdfQ==