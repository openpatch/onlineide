import { AccordionPanel } from "./Accordion.js";
import { ajax } from "../../communication/AjaxHelper.js";
import { Helper } from "./Helper.js";
export class TeacherExplorer {
    constructor(main, classData) {
        this.main = main;
        this.classData = classData;
    }
    removePanels() {
        this.classPanel.remove();
        this.studentPanel.remove();
    }
    initGUI() {
        this.initStudentPanel();
        this.initClassPanel();
        this.renderClasses(this.classData);
    }
    initStudentPanel() {
        let that = this;
        this.studentPanel = new AccordionPanel(this.main.projectExplorer.accordion, "SchÃ¼ler/innen", "2", null, "", "student", false);
        this.studentPanel.selectCallback = (ae) => {
            that.main.networkManager.sendUpdates(() => {
                let request = {
                    ws_userId: ae.id,
                    userId: this.main.user.id,
                    language: 0
                };
                ajax("getWorkspaces", request, (response) => {
                    if (response.success == true) {
                        if (that.main.workspacesOwnerId == that.main.user.id) {
                            that.ownWorkspaces = that.main.workspaceList.slice();
                            that.currentOwnWorkspace = that.main.currentWorkspace;
                        }
                        that.main.restoreWorkspaces(response.workspaces);
                        that.main.workspacesOwnerId = ae.id;
                        that.main.projectExplorer.setExplorerColor("rgba(255, 0, 0, 0.2");
                        that.main.projectExplorer.$homeAction.show();
                        Helper.showHelper("homeButtonHelper", this.main);
                        that.main.bottomDiv.showHomeworkTab();
                        that.main.bottomDiv.homeworkManager.attachToWorkspaces(that.main.workspaceList);
                    }
                    this.main.networkManager.updateFrequencyInSeconds = this.main.networkManager.teacherUpdateFrequencyInSeconds;
                    this.main.networkManager.secondsTillNextUpdate = this.main.networkManager.teacherUpdateFrequencyInSeconds;
                });
            });
        };
    }
    restoreOwnWorkspaces() {
        let main = this.main;
        // main.monaco.setModel(monaco.editor.createModel("Keine Datei vorhanden.", "text"));
        main.getMonacoEditor().updateOptions({ readOnly: true });
        main.workspaceList = this.ownWorkspaces;
        main.currentWorkspace = this.currentOwnWorkspace;
        main.workspacesOwnerId = main.user.id;
        main.projectExplorer.setExplorerColor(null);
        main.projectExplorer.renderWorkspaces(main.workspaceList);
        if (main.currentWorkspace == null && main.workspaceList.length > 0) {
            main.currentWorkspace = main.workspaceList[0];
        }
        if (main.currentWorkspace != null) {
            main.projectExplorer.setWorkspaceActive(main.currentWorkspace, true);
        }
        this.studentPanel.select(null, false);
    }
    initClassPanel() {
        let that = this;
        this.classPanel = new AccordionPanel(this.main.projectExplorer.accordion, "Klassen", "1", null, "", "class", false);
        this.classPanel.selectCallback = (ea) => {
            that.main.networkManager.sendUpdates(() => {
                let classData = ea;
                if (classData != null) {
                    this.renderStudents(classData.students);
                }
            });
        };
    }
    renderStudents(userDataList) {
        this.studentPanel.clear();
        userDataList.sort((a, b) => {
            if (a.familienname > b.familienname)
                return 1;
            if (b.familienname > a.familienname)
                return -1;
            if (a.rufname > b.rufname)
                return 1;
            if (b.rufname > a.rufname)
                return -1;
            return 0;
        });
        for (let ud of userDataList) {
            let ae = {
                name: ud.rufname + " " + ud.familienname,
                sortName: ud.familienname + " " + ud.rufname,
                externalElement: ud
            };
            this.studentPanel.addElement(ae);
        }
    }
    renderClasses(classDataList) {
        this.studentPanel.clear();
        classDataList.sort((a, b) => {
            if (a.name > b.name)
                return 1;
            if (b.name > a.name)
                return -1;
            return 0;
        });
        for (let cd of classDataList) {
            let ae = {
                name: cd.name,
                externalElement: cd
            };
            this.classPanel.addElement(ae);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGVhY2hlckV4cGxvcmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2NsaWVudC9tYWluL2d1aS9UZWFjaGVyRXhwbG9yZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGNBQWMsRUFBb0IsTUFBTSxnQkFBZ0IsQ0FBQztBQUdsRSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFFekQsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUVyQyxNQUFNLE9BQU8sZUFBZTtJQVN4QixZQUFvQixJQUFVLEVBQVUsU0FBc0I7UUFBMUMsU0FBSSxHQUFKLElBQUksQ0FBTTtRQUFVLGNBQVMsR0FBVCxTQUFTLENBQWE7SUFFOUQsQ0FBQztJQUVELFlBQVk7UUFDUixJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLENBQUM7SUFDL0IsQ0FBQztJQUVELE9BQU87UUFFSCxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUV4QixJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFFdEIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7SUFFdkMsQ0FBQztJQUVELGdCQUFnQjtRQUVaLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQztRQUVoQixJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLFNBQVMsRUFDdEUsZUFBZSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQzFCLEVBQUUsRUFBRSxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFFMUIsSUFBSSxDQUFDLFlBQVksQ0FBQyxjQUFjLEdBQUcsQ0FBQyxFQUFZLEVBQUUsRUFBRTtZQUVoRCxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMs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QUFFLENBQUMsQ0FBQztTQUNsQztJQUVMLENBQUM7Q0FHSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFjY29yZGlvblBhbmVsLCBBY2NvcmRpb25FbGVtZW50IH0gZnJvbSBcIi4vQWNjb3JkaW9uLmpzXCI7XHJcbmltcG9ydCB7IE1haW4gfSBmcm9tIFwiLi4vTWFpbi5qc1wiO1xyXG5pbXBvcnQgeyBDbGFzc0RhdGEsIFVzZXJEYXRhLCBDUlVEVXNlclJlcXVlc3QsIENSVURDbGFzc1JlcXVlc3QsIEdldFdvcmtzcGFjZXNSZXNwb25zZSwgR2V0V29ya3NwYWNlc1JlcXVlc3QsIFdvcmtzcGFjZXMgfSBmcm9tIFwiLi4vLi4vY29tbXVuaWNhdGlvbi9EYXRhLmpzXCI7XHJcbmltcG9ydCB7IGFqYXggfSBmcm9tIFwiLi4vLi4vY29tbXVuaWNhdGlvbi9BamF4SGVscGVyLmpzXCI7XHJcbmltcG9ydCB7IFdvcmtzcGFjZSB9IGZyb20gXCIuLi8uLi93b3Jrc3BhY2UvV29ya3NwYWNlLmpzXCI7XHJcbmltcG9ydCB7IEhlbHBlciB9IGZyb20gXCIuL0hlbHBlci5qc1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFRlYWNoZXJFeHBsb3JlciB7XHJcblxyXG4gICAgc3R1ZGVudFBhbmVsOiBBY2NvcmRpb25QYW5lbDtcclxuICAgIGNsYXNzUGFuZWw6IEFjY29yZGlvblBhbmVsO1xyXG5cclxuICAgIC8vIHNhdmUgdGhlbSBoZXJlIHdoZW4gZGlzcGxheWluZyBwdXBpbHMgd29ya3NwYWNlczpcclxuICAgIG93bldvcmtzcGFjZXM6IFdvcmtzcGFjZVtdO1xyXG4gICAgY3VycmVudE93bldvcmtzcGFjZTogV29ya3NwYWNlO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgbWFpbjogTWFpbiwgcHJpdmF0ZSBjbGFzc0RhdGE6IENsYXNzRGF0YVtdKSB7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZVBhbmVscygpIHtcclxuICAgICAgICB0aGlzLmNsYXNzUGFuZWwucmVtb3ZlKCk7XHJcbiAgICAgICAgdGhpcy5zdHVkZW50UGFuZWwucmVtb3ZlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdEdVSSgpIHtcclxuXHJcbiAgICAgICAgdGhpcy5pbml0U3R1ZGVudFBhbmVsKCk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5pdENsYXNzUGFuZWwoKTtcclxuXHJcbiAgICAgICAgdGhpcy5yZW5kZXJDbGFzc2VzKHRoaXMuY2xhc3NEYXRhKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgaW5pdFN0dWRlbnRQYW5lbCgpIHtcclxuXHJcbiAgICAgICAgbGV0IHRoYXQgPSB0aGlzO1xyXG5cclxuICAgICAgICB0aGlzLnN0dWRlbnRQYW5lbCA9IG5ldyBBY2NvcmRpb25QYW5lbCh0aGlzLm1haW4ucHJvamVjdEV4cGxvcmVyLmFjY29yZGlvbixcclxuICAgICAgICAgICAgXCJTY2jDvGxlci9pbm5lblwiLCBcIjJcIiwgbnVsbCxcclxuICAgICAgICAgICAgXCJcIiwgXCJzdHVkZW50XCIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgdGhpcy5zdHVkZW50UGFuZWwuc2VsZWN0Q2FsbGJhY2sgPSAoYWU6IFVzZXJEYXRhKSA9PiB7XHJcblxyXG4gICAgICAgICAgICB0aGF0Lm1haW4ubmV0d29ya01hbmFnZXIuc2VuZFVwZGF0ZXMoKCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCByZXF1ZXN0OiBHZXRXb3Jrc3BhY2VzUmVxdWVzdCA9IHtcclxuICAgICAgICAgICAgICAgICAgICB3c191c2VySWQ6IGFlLmlkLFxyXG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogdGhpcy5tYWluLnVzZXIuaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IDBcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBhamF4KFwiZ2V0V29ya3NwYWNlc1wiLCByZXF1ZXN0LCAocmVzcG9uc2U6IEdldFdvcmtzcGFjZXNSZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzID09IHRydWUpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGF0Lm1haW4ud29ya3NwYWNlc093bmVySWQgPT0gdGhhdC5tYWluLnVzZXIuaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQub3duV29ya3NwYWNlcyA9IHRoYXQubWFpbi53b3Jrc3BhY2VMaXN0LnNsaWNlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmN1cnJlbnRPd25Xb3Jrc3BhY2UgPSB0aGF0Lm1haW4uY3VycmVudFdvcmtzcGFjZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5tYWluLnJlc3RvcmVXb3Jrc3BhY2VzKHJlc3BvbnNlLndvcmtzcGFjZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Lm1haW4ud29ya3NwYWNlc093bmVySWQgPSBhZS5pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5tYWluLnByb2plY3RFeHBsb3Jlci5zZXRFeHBsb3JlckNvbG9yKFwicmdiYSgyNTUsIDAsIDAsIDAuMlwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5tYWluLnByb2plY3RFeHBsb3Jlci4kaG9tZUFjdGlvbi5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEhlbHBlci5zaG93SGVscGVyKFwiaG9tZUJ1dHRvbkhlbHBlclwiLCB0aGlzLm1haW4pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5tYWluLmJvdHRvbURpdi5zaG93SG9tZXdvcmtUYWIoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5tYWluLmJvdHRvbURpdi5ob21ld29ya01hbmFnZXIuYXR0YWNoVG9Xb3Jrc3BhY2VzKHRoYXQubWFpbi53b3Jrc3BhY2VMaXN0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWFpbi5uZXR3b3JrTWFuYWdlci51cGRhdGVGcmVxdWVuY3lJblNlY29uZHMgPSB0aGlzLm1haW4ubmV0d29ya01hbmFnZXIudGVhY2hlclVwZGF0ZUZyZXF1ZW5jeUluU2Vjb25kcztcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm1haW4ubmV0d29ya01hbmFnZXIuc2Vjb25kc1RpbGxOZXh0VXBkYXRlID0gdGhpcy5tYWluLm5ldHdvcmtNYW5hZ2VyLnRlYWNoZXJVcGRhdGVGcmVxdWVuY3lJblNlY29uZHM7XHJcblxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHJlc3RvcmVPd25Xb3Jrc3BhY2VzKCkge1xyXG4gICAgICAgIGxldCBtYWluID0gdGhpcy5tYWluO1xyXG5cclxuICAgICAgICAvLyBtYWluLm1vbmFjby5zZXRNb2RlbChtb25hY28uZWRpdG9yLmNyZWF0ZU1vZGVsKFwiS2VpbmUgRGF0ZWkgdm9yaGFuZGVuLlwiLCBcInRleHRcIikpO1xyXG4gICAgICAgIG1haW4uZ2V0TW9uYWNvRWRpdG9yKCkudXBkYXRlT3B0aW9ucyh7IHJlYWRPbmx5OiB0cnVlIH0pO1xyXG5cclxuICAgICAgICBtYWluLndvcmtzcGFjZUxpc3QgPSB0aGlzLm93bldvcmtzcGFjZXM7XHJcbiAgICAgICAgbWFpbi5jdXJyZW50V29ya3NwYWNlID0gdGhpcy5jdXJyZW50T3duV29ya3NwYWNlO1xyXG4gICAgICAgIG1haW4ud29ya3NwYWNlc093bmVySWQgPSBtYWluLnVzZXIuaWQ7XHJcbiAgICAgICAgbWFpbi5wcm9qZWN0RXhwbG9yZXIuc2V0RXhwbG9yZXJDb2xvcihudWxsKTtcclxuXHJcbiAgICAgICAgbWFpbi5wcm9qZWN0RXhwbG9yZXIucmVuZGVyV29ya3NwYWNlcyhtYWluLndvcmtzcGFjZUxpc3QpO1xyXG5cclxuICAgICAgICBpZiAobWFpbi5jdXJyZW50V29ya3NwYWNlID09IG51bGwgJiYgbWFpbi53b3Jrc3BhY2VMaXN0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgbWFpbi5jdXJyZW50V29ya3NwYWNlID0gbWFpbi53b3Jrc3BhY2VMaXN0WzBdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG1haW4uY3VycmVudFdvcmtzcGFjZSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIG1haW4ucHJvamVjdEV4cGxvcmVyLnNldFdvcmtzcGFjZUFjdGl2ZShtYWluLmN1cnJlbnRXb3Jrc3BhY2UsIHRydWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5zdHVkZW50UGFuZWwuc2VsZWN0KG51bGwsIGZhbHNlKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgaW5pdENsYXNzUGFuZWwoKSB7XHJcbiAgICAgICAgbGV0IHRoYXQgPSB0aGlzO1xyXG5cclxuICAgICAgICB0aGlzLmNsYXNzUGFuZWwgPSBuZXcgQWNjb3JkaW9uUGFuZWwodGhpcy5tYWluLnByb2plY3RFeHBsb3Jlci5hY2NvcmRpb24sXHJcbiAgICAgICAgICAgIFwiS2xhc3NlblwiLCBcIjFcIiwgbnVsbCwgXCJcIiwgXCJjbGFzc1wiLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIHRoaXMuY2xhc3NQYW5lbC5zZWxlY3RDYWxsYmFjayA9IChlYSkgPT4ge1xyXG4gICAgICAgICAgICB0aGF0Lm1haW4ubmV0d29ya01hbmFnZXIuc2VuZFVwZGF0ZXMoKCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBjbGFzc0RhdGEgPSA8Q2xhc3NEYXRhPmVhO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNsYXNzRGF0YSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJTdHVkZW50cyhjbGFzc0RhdGEuc3R1ZGVudHMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICB9XHJcblxyXG4gICAgcmVuZGVyU3R1ZGVudHModXNlckRhdGFMaXN0OiBVc2VyRGF0YVtdKSB7XHJcbiAgICAgICAgdGhpcy5zdHVkZW50UGFuZWwuY2xlYXIoKTtcclxuXHJcbiAgICAgICAgdXNlckRhdGFMaXN0LnNvcnQoKGEsIGIpID0+IHtcclxuICAgICAgICAgICAgaWYgKGEuZmFtaWxpZW5uYW1lID4gYi5mYW1pbGllbm5hbWUpIHJldHVybiAxO1xyXG4gICAgICAgICAgICBpZiAoYi5mYW1pbGllbm5hbWUgPiBhLmZhbWlsaWVubmFtZSkgcmV0dXJuIC0xO1xyXG4gICAgICAgICAgICBpZiAoYS5ydWZuYW1lID4gYi5ydWZuYW1lKSByZXR1cm4gMTtcclxuICAgICAgICAgICAgaWYgKGIucnVmbmFtZSA+IGEucnVmbmFtZSkgcmV0dXJuIC0xO1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICBmb3IgKGxldCB1ZCBvZiB1c2VyRGF0YUxpc3QpIHtcclxuICAgICAgICAgICAgbGV0IGFlOiBBY2NvcmRpb25FbGVtZW50ID0ge1xyXG4gICAgICAgICAgICAgICAgbmFtZTogdWQucnVmbmFtZSArIFwiIFwiICsgdWQuZmFtaWxpZW5uYW1lLFxyXG4gICAgICAgICAgICAgICAgc29ydE5hbWU6IHVkLmZhbWlsaWVubmFtZSArIFwiIFwiICsgdWQucnVmbmFtZSxcclxuICAgICAgICAgICAgICAgIGV4dGVybmFsRWxlbWVudDogdWRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnN0dWRlbnRQYW5lbC5hZGRFbGVtZW50KGFlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlckNsYXNzZXMoY2xhc3NEYXRhTGlzdDogQ2xhc3NEYXRhW10pIHtcclxuICAgICAgICB0aGlzLnN0dWRlbnRQYW5lbC5jbGVhcigpO1xyXG5cclxuICAgICAgICBjbGFzc0RhdGFMaXN0LnNvcnQoKGEsIGIpID0+IHtcclxuICAgICAgICAgICAgaWYgKGEubmFtZSA+IGIubmFtZSkgcmV0dXJuIDE7XHJcbiAgICAgICAgICAgIGlmIChiLm5hbWUgPiBhLm5hbWUpIHJldHVybiAtMTtcclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgZm9yIChsZXQgY2Qgb2YgY2xhc3NEYXRhTGlzdCkge1xyXG4gICAgICAgICAgICBsZXQgYWU6IEFjY29yZGlvbkVsZW1lbnQgPSB7XHJcbiAgICAgICAgICAgICAgICBuYW1lOiBjZC5uYW1lLFxyXG4gICAgICAgICAgICAgICAgZXh0ZXJuYWxFbGVtZW50OiBjZFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuY2xhc3NQYW5lbC5hZGRFbGVtZW50KGFlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuXHJcbn0iXX0=