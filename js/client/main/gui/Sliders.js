import { ZoomControl } from "./diagrams/ZoomControl.js";
export class Sliders {
    constructor(main) {
        this.main = main;
    }
    initSliders() {
        let that = this;
        let mousePointer = window.PointerEvent ? "pointer" : "mouse";
        jQuery('#slider1').on(mousePointer + "down", (md) => {
            let x = md.clientX;
            jQuery(document).on(mousePointer + "move.slider1", (mm) => {
                let dx = mm.clientX - x;
                that.moveLeftPanel(dx);
                x = mm.clientX;
            });
            jQuery(document).on(mousePointer + "up.slider1", () => {
                jQuery(document).off(mousePointer + "move.slider1");
                jQuery(document).off(mousePointer + "up.slider1");
            });
        });
        jQuery('#slider2').on(mousePointer + "down", (md) => {
            let y = md.clientY;
            jQuery(document).on(mousePointer + "move.slider2", (mm) => {
                let dy = mm.clientY - y;
                that.moveBottomDiv(dy);
                y = mm.clientY;
            });
            jQuery(document).on(mousePointer + "up.slider2", () => {
                jQuery(document).off(mousePointer + "move.slider2");
                jQuery(document).off(mousePointer + "up.slider2");
            });
        });
        jQuery('#slider3').on(mousePointer + "down", (md) => {
            let x = md.clientX;
            ZoomControl.preventFading = true;
            jQuery(document).on(mousePointer + "move.slider3", (mm) => {
                let dx = mm.clientX - x;
                that.moveRightDiv(dx);
                x = mm.clientX;
                mm.stopPropagation();
            });
            jQuery(document).on(mousePointer + "up.slider3", () => {
                jQuery(document).off(mousePointer + "move.slider3");
                jQuery(document).off(mousePointer + "up.slider3");
                ZoomControl.preventFading = false;
            });
        });
        let sliderknobLeft = jQuery('<div class="jo_sliderknob img_knob jo_button jo_active" style="left: -8px" draggable="false"></div>');
        jQuery('#slider2').append(sliderknobLeft);
        sliderknobLeft.on(mousePointer + 'down', (md) => {
            let y = md.clientY;
            let x = md.clientX;
            md.stopPropagation();
            ZoomControl.preventFading = true;
            jQuery(document).on(mousePointer + "move.knobleft", (mm) => {
                let dy = mm.clientY - y;
                let dx = mm.clientX - x;
                mm.stopPropagation();
                that.moveLeftPanel(dx);
                that.moveBottomDiv(dy);
                x += dx;
                y += dy;
            });
            jQuery(document).on(mousePointer + "up.knobleft", () => {
                jQuery(document).off(mousePointer + "move.knobleft");
                jQuery(document).off(mousePointer + "up.knobleft");
                ZoomControl.preventFading = false;
            });
        });
        let sliderknobRight = jQuery('<div class="jo_sliderknob img_knob jo_button jo_active" style="right: -8px" draggable="false"></div>');
        jQuery('#slider2').append(sliderknobRight);
        sliderknobRight.on(mousePointer + 'down', (md) => {
            let y = md.clientY;
            let x = md.clientX;
            md.stopPropagation();
            ZoomControl.preventFading = true;
            jQuery(document).on(mousePointer + "move.knobright", (mm) => {
                let dy = mm.clientY - y;
                let dx = mm.clientX - x;
                mm.stopPropagation();
                that.moveRightDiv(dx);
                that.moveBottomDiv(dy);
                x += dx;
                y += dy;
            });
            jQuery(document).on(mousePointer + "up.knobright", () => {
                jQuery(document).off(mousePointer + "move.knobright");
                jQuery(document).off(mousePointer + "up.knobright");
                ZoomControl.preventFading = false;
            });
        });
    }
    moveRightDiv(dx) {
        let $editor = jQuery('#editor>.monaco-editor');
        let $rightDiv = jQuery('#rightdiv');
        let width = Number.parseInt($rightDiv.css('width').replace('px', ''));
        $rightDiv.css('width', (width - dx) + "px");
        let mewidth = Number.parseInt($editor.css('width').replace('px', ''));
        $editor.css('width', (mewidth + dx) + "px");
        this.main.getMonacoEditor().layout();
        if (this.main.bottomDiv.homeworkManager.diffEditor != null) {
            this.main.bottomDiv.homeworkManager.diffEditor.layout();
        }
        jQuery('.jo_graphics').trigger('sizeChanged');
        width += dx;
    }
    moveBottomDiv(dy) {
        let $editor = jQuery('#editor>.monaco-editor');
        let $bottomDiv = jQuery('#bottomdiv-outer');
        let height = Number.parseInt($bottomDiv.css('height').replace('px', ''));
        $bottomDiv.css('height', (height - dy) + "px");
        let meheight = Number.parseInt($editor.css('height').replace('px', ''));
        $editor.css('height', (meheight + dy) + "px");
        this.main.getMonacoEditor().layout();
        if (this.main.bottomDiv.homeworkManager.diffEditor != null) {
            this.main.bottomDiv.homeworkManager.diffEditor.layout();
        }
    }
    moveLeftPanel(dx) {
        let $leftPanel = jQuery('#leftpanel');
        let $editor = jQuery('#editor>.monaco-editor');
        let width = Number.parseInt($leftPanel.css('width').replace('px', ''));
        $leftPanel.css('width', (width + dx) + "px");
        let mewidth = Number.parseInt($editor.css('width').replace('px', ''));
        $editor.css('width', (mewidth - dx) + "px");
        this.main.getMonacoEditor().layout();
        if (this.main.bottomDiv.homeworkManager.diffEditor != null) {
            this.main.bottomDiv.homeworkManager.diffEditor.layout();
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2xpZGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9jbGllbnQvbWFpbi9ndWkvU2xpZGVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFFeEQsTUFBTSxPQUFPLE9BQU87SUFJaEIsWUFBWSxJQUFVO1FBQ2xCLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0lBQ3JCLENBQUM7SUFFRCxXQUFXO1FBQ1AsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBRWhCLElBQUksWUFBWSxHQUFHLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1FBRTdELE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxFQUFFLENBQUMsWUFBWSxHQUFHLE1BQU0sRUFBRSxDQUFDLEVBQXlCLEVBQUUsRUFBRTtZQUV2RSxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDO1lBRW5CLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsWUFBWSxHQUFHLGNBQWMsRUFBRSxDQUFDLEVBQXlCLEVBQUUsRUFBRTtnQkFDN0UsSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUM7Z0JBRXhCLElBQUksQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBRXZCLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDO1lBQ25CLENBQUMsQ0FBQyxDQUFDO1lBRUgsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxZQUFZLEdBQUcsWUFBWSxFQUFFLEdBQUcsRUFBRTtnQkFDbEQsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEdBQUcsY0FBYyxDQUFDLENBQUM7Z0JBQ3BELE1BQU0sQ0FBQyxRQUFRLENBQUMs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QUFHLENBQUMsT0FBTyxFQUFFLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDO1FBRTVDLElBQUksT0FBTyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDdEUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7UUFFNUMsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNyQyxJQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQyxVQUFVLElBQUksSUFBSSxFQUFDO1lBQ3RELElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLENBQUM7U0FDM0Q7UUFFRCxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQzlDLEtBQUssSUFBSSxFQUFFLENBQUM7SUFDcEIsQ0FBQztJQUNHLGFBQWEsQ0FBQyxFQUFVO1FBQ3BCLElBQUksT0FBTyxHQUFHLE1BQU0sQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO1FBQy9DLElBQUksVUFBVSxHQUFHLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBRTVDLElBQUksTUFBTSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDekUsVUFBVSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7UUFFL0MsSUFBSSxRQUFRLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN4RSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQztRQUU5QyxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ3JDLElBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLFVBQVUsSUFBSSxJQUFJLEVBQUM7WUFDdEQsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQztTQUMzRDtJQUNULENBQUM7SUFFRyxhQUFhLENBQUMsRUFBVTtRQUNwQixJQUFJLFVBQVUsR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDdEMsSUFBSSxPQUFPLEdBQUcsTUFBTSxDQUFDLHdCQUF3QixDQUFDLENBQUM7UUFFL0MsSUFBSSxLQUFLLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN2RSxVQUFVLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQztRQUU3QyxJQUFJLE9BQU8sR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3RFLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDO1FBQzVDLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDckMsSUFBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsVUFBVSxJQUFJLElBQUksRUFBQztZQUN0RCxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRSxDQUFDO1NBQzNEO0lBRUwsQ0FBQztDQUlKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgam9fbW91c2VEZXRlY3RlZCB9IGZyb20gXCIuLi8uLi90b29scy9IdG1sVG9vbHMuanNcIjtcclxuaW1wb3J0IHsgTWFpbiB9IGZyb20gXCIuLi9NYWluLmpzXCI7XHJcbmltcG9ydCB7IFpvb21Db250cm9sIH0gZnJvbSBcIi4vZGlhZ3JhbXMvWm9vbUNvbnRyb2wuanNcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBTbGlkZXJzIHtcclxuXHJcbiAgICBtYWluOiBNYWluO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKG1haW46IE1haW4pIHtcclxuICAgICAgICB0aGlzLm1haW4gPSBtYWluO1xyXG4gICAgfVxyXG5cclxuICAgIGluaXRTbGlkZXJzKCkge1xyXG4gICAgICAgIGxldCB0aGF0ID0gdGhpcztcclxuXHJcbiAgICAgICAgbGV0IG1vdXNlUG9pbnRlciA9IHdpbmRvdy5Qb2ludGVyRXZlbnQgPyBcInBvaW50ZXJcIiA6IFwibW91c2VcIjtcclxuXHJcbiAgICAgICAgalF1ZXJ5KCcjc2xpZGVyMScpLm9uKG1vdXNlUG9pbnRlciArIFwiZG93blwiLCAobWQ6IEpRdWVyeS5Nb3VzZURvd25FdmVudCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgbGV0IHggPSBtZC5jbGllbnRYO1xyXG5cclxuICAgICAgICAgICAgalF1ZXJ5KGRvY3VtZW50KS5vbihtb3VzZVBvaW50ZXIgKyBcIm1vdmUuc2xpZGVyMVwiLCAobW06IEpRdWVyeS5Nb3VzZU1vdmVFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IGR4ID0gbW0uY2xpZW50WCAtIHg7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRoYXQubW92ZUxlZnRQYW5lbChkeCk7XHJcblxyXG4gICAgICAgICAgICAgICAgeCA9IG1tLmNsaWVudFg7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgalF1ZXJ5KGRvY3VtZW50KS5vbihtb3VzZVBvaW50ZXIgKyBcInVwLnNsaWRlcjFcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgalF1ZXJ5KGRvY3VtZW50KS5vZmYobW91c2VQb2ludGVyICsgXCJtb3ZlLnNsaWRlcjFcIik7XHJcbiAgICAgICAgICAgICAgICBqUXVlcnkoZG9jdW1lbnQpLm9mZihtb3VzZVBvaW50ZXIgKyBcInVwLnNsaWRlcjFcIik7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGpRdWVyeSgnI3NsaWRlcjInKS5vbihtb3VzZVBvaW50ZXIgKyBcImRvd25cIiwgKG1kOiBKUXVlcnkuTW91c2VEb3duRXZlbnQpID0+IHtcclxuXHJcbiAgICAgICAgICAgIGxldCB5ID0gbWQuY2xpZW50WTtcclxuXHJcbiAgICAgICAgICAgIGpRdWVyeShkb2N1bWVudCkub24obW91c2VQb2ludGVyICsgXCJtb3ZlLnNsaWRlcjJcIiwgKG1tOiBKUXVlcnkuTW91c2VNb3ZlRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBkeSA9IG1tLmNsaWVudFkgLSB5O1xyXG5cclxuICAgICAgICAgICAgICAgIHRoYXQubW92ZUJvdHRvbURpdihkeSk7XHJcblxyXG4gICAgICAgICAgICAgICAgeSA9IG1tLmNsaWVudFk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgalF1ZXJ5KGRvY3VtZW50KS5vbihtb3VzZVBvaW50ZXIgKyBcInVwLnNsaWRlcjJcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgalF1ZXJ5KGRvY3VtZW50KS5vZmYobW91c2VQb2ludGVyICsgXCJtb3ZlLnNsaWRlcjJcIik7XHJcbiAgICAgICAgICAgICAgICBqUXVlcnkoZG9jdW1lbnQpLm9mZihtb3VzZVBvaW50ZXIgKyBcInVwLnNsaWRlcjJcIik7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGpRdWVyeSgnI3NsaWRlcjMnKS5vbihtb3VzZVBvaW50ZXIgKyBcImRvd25cIiwgKG1kOiBKUXVlcnkuTW91c2VEb3duRXZlbnQpID0+IHtcclxuXHJcbiAgICAgICAgICAgIGxldCB4ID0gbWQuY2xpZW50WDtcclxuICAgICAgICAgICAgWm9vbUNvbnRyb2wucHJldmVudEZhZGluZyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICBqUXVlcnkoZG9jdW1lbnQpLm9uKG1vdXNlUG9pbnRlciArIFwibW92ZS5zbGlkZXIzXCIsIChtbTogSlF1ZXJ5Lk1vdXNlTW92ZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgZHggPSBtbS5jbGllbnRYIC0geDtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGF0Lm1vdmVSaWdodERpdihkeCk7XHJcblxyXG4gICAgICAgICAgICAgICAgeCA9IG1tLmNsaWVudFg7XHJcbiAgICAgICAgICAgICAgICBtbS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBqUXVlcnkoZG9jdW1lbnQpLm9uKG1vdXNlUG9pbnRlciArIFwidXAuc2xpZGVyM1wiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBqUXVlcnkoZG9jdW1lbnQpLm9mZihtb3VzZVBvaW50ZXIgKyBcIm1vdmUuc2xpZGVyM1wiKTtcclxuICAgICAgICAgICAgICAgIGpRdWVyeShkb2N1bWVudCkub2ZmKG1vdXNlUG9pbnRlciArIFwidXAuc2xpZGVyM1wiKTtcclxuICAgICAgICAgICAgICAgIFpvb21Db250cm9sLnByZXZlbnRGYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgbGV0IHNsaWRlcmtub2JMZWZ0ID0galF1ZXJ5KCc8ZGl2IGNsYXNzPVwiam9fc2xpZGVya25vYiBpbWdfa25vYiBqb19idXR0b24gam9fYWN0aXZlXCIgc3R5bGU9XCJsZWZ0OiAtOHB4XCIgZHJhZ2dhYmxlPVwiZmFsc2VcIj48L2Rpdj4nKTtcclxuICAgICAgICBqUXVlcnkoJyNzbGlkZXIyJykuYXBwZW5kKHNsaWRlcmtub2JMZWZ0KTtcclxuICAgICAgICBzbGlkZXJrbm9iTGVmdC5vbihtb3VzZVBvaW50ZXIgKyAnZG93bicsIChtZDogSlF1ZXJ5Lk1vdXNlRG93bkV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCB5ID0gbWQuY2xpZW50WTtcclxuICAgICAgICAgICAgbGV0IHggPSBtZC5jbGllbnRYO1xyXG5cclxuICAgICAgICAgICAgbWQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgIFpvb21Db250cm9sLnByZXZlbnRGYWRpbmcgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgalF1ZXJ5KGRvY3VtZW50KS5vbihtb3VzZVBvaW50ZXIgKyBcIm1vdmUua25vYmxlZnRcIiwgKG1tOiBKUXVlcnkuTW91c2VNb3ZlRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBkeSA9IG1tLmNsaWVudFkgLSB5O1xyXG4gICAgICAgICAgICAgICAgbGV0IGR4ID0gbW0uY2xpZW50WCAtIHg7XHJcbiAgICAgICAgICAgICAgICBtbS5zdG9wUHJvcGFnYXRpb24oKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGF0Lm1vdmVMZWZ0UGFuZWwoZHgpO1xyXG4gICAgICAgICAgICAgICAgdGhhdC5tb3ZlQm90dG9tRGl2KGR5KTtcclxuXHJcbiAgICAgICAgICAgICAgICB4ICs9IGR4O1xyXG4gICAgICAgICAgICAgICAgeSArPSBkeTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBqUXVlcnkoZG9jdW1lbnQpLm9uKG1vdXNlUG9pbnRlciArIFwidXAua25vYmxlZnRcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgalF1ZXJ5KGRvY3VtZW50KS5vZmYobW91c2VQb2ludGVyICsgXCJtb3ZlLmtub2JsZWZ0XCIpO1xyXG4gICAgICAgICAgICAgICAgalF1ZXJ5KGRvY3VtZW50KS5vZmYobW91c2VQb2ludGVyICsgXCJ1cC5rbm9ibGVmdFwiKTtcclxuICAgICAgICAgICAgICAgIFpvb21Db250cm9sLnByZXZlbnRGYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBsZXQgc2xpZGVya25vYlJpZ2h0ID0galF1ZXJ5KCc8ZGl2IGNsYXNzPVwiam9fc2xpZGVya25vYiBpbWdfa25vYiBqb19idXR0b24gam9fYWN0aXZlXCIgc3R5bGU9XCJyaWdodDogLThweFwiIGRyYWdnYWJsZT1cImZhbHNlXCI+PC9kaXY+Jyk7XHJcbiAgICAgICAgalF1ZXJ5KCcjc2xpZGVyMicpLmFwcGVuZChzbGlkZXJrbm9iUmlnaHQpO1xyXG4gICAgICAgIHNsaWRlcmtub2JSaWdodC5vbihtb3VzZVBvaW50ZXIgKyAnZG93bicsIChtZDogSlF1ZXJ5Lk1vdXNlRG93bkV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCB5ID0gbWQuY2xpZW50WTtcclxuICAgICAgICAgICAgbGV0IHggPSBtZC5jbGllbnRYO1xyXG5cclxuICAgICAgICAgICAgbWQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgIFpvb21Db250cm9sLnByZXZlbnRGYWRpbmcgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgalF1ZXJ5KGRvY3VtZW50KS5vbihtb3VzZVBvaW50ZXIgKyBcIm1vdmUua25vYnJpZ2h0XCIsIChtbTogSlF1ZXJ5Lk1vdXNlTW92ZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgZHkgPSBtbS5jbGllbnRZIC0geTtcclxuICAgICAgICAgICAgICAgIGxldCBkeCA9IG1tLmNsaWVudFggLSB4O1xyXG4gICAgICAgICAgICAgICAgbW0uc3RvcFByb3BhZ2F0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhhdC5tb3ZlUmlnaHREaXYoZHgpO1xyXG4gICAgICAgICAgICAgICAgdGhhdC5tb3ZlQm90dG9tRGl2KGR5KTtcclxuXHJcbiAgICAgICAgICAgICAgICB4ICs9IGR4O1xyXG4gICAgICAgICAgICAgICAgeSArPSBkeTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBqUXVlcnkoZG9jdW1lbnQpLm9uKG1vdXNlUG9pbnRlciArIFwidXAua25vYnJpZ2h0XCIsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGpRdWVyeShkb2N1bWVudCkub2ZmKG1vdXNlUG9pbnRlciArIFwibW92ZS5rbm9icmlnaHRcIik7XHJcbiAgICAgICAgICAgICAgICBqUXVlcnkoZG9jdW1lbnQpLm9mZihtb3VzZVBvaW50ZXIgKyBcInVwLmtub2JyaWdodFwiKTtcclxuICAgICAgICAgICAgICAgIFpvb21Db250cm9sLnByZXZlbnRGYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuICAgIFxyXG4gICAgbW92ZVJpZ2h0RGl2KGR4OiBudW1iZXIpIHtcclxuICAgICAgICBsZXQgJGVkaXRvciA9IGpRdWVyeSgnI2VkaXRvcj4ubW9uYWNvLWVkaXRvcicpO1xyXG4gICAgICAgIGxldCAkcmlnaHREaXYgPSBqUXVlcnkoJyNyaWdodGRpdicpO1xyXG5cclxuICAgICAgICBsZXQgd2lkdGggPSBOdW1iZXIucGFyc2VJbnQoJHJpZ2h0RGl2LmNzcygnd2lkdGgnKS5yZXBsYWNlKCdweCcsICcnKSk7XHJcbiAgICAgICAgJHJpZ2h0RGl2LmNzcygnd2lkdGgnLCAod2lkdGggLSBkeCkgKyBcInB4XCIpO1xyXG5cclxuICAgICAgICBsZXQgbWV3aWR0aCA9IE51bWJlci5wYXJzZUludCgkZWRpdG9yLmNzcygnd2lkdGgnKS5yZXBsYWNlKCdweCcsICcnKSk7XHJcbiAgICAgICAgJGVkaXRvci5jc3MoJ3dpZHRoJywgKG1ld2lkdGggKyBkeCkgKyBcInB4XCIpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMubWFpbi5nZXRNb25hY29FZGl0b3IoKS5sYXlvdXQoKTtcclxuICAgICAgICBpZih0aGlzLm1haW4uYm90dG9tRGl2LmhvbWV3b3JrTWFuYWdlci5kaWZmRWRpdG9yICE9IG51bGwpe1xyXG4gICAgICAgICAgICB0aGlzLm1haW4uYm90dG9tRGl2LmhvbWV3b3JrTWFuYWdlci5kaWZmRWRpdG9yLmxheW91dCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgalF1ZXJ5KCcuam9fZ3JhcGhpY3MnKS50cmlnZ2VyKCdzaXplQ2hhbmdlZCcpO1xyXG4gICAgICAgIHdpZHRoICs9IGR4O1xyXG59XHJcbiAgICBtb3ZlQm90dG9tRGl2KGR5OiBudW1iZXIpIHtcclxuICAgICAgICBsZXQgJGVkaXRvciA9IGpRdWVyeSgnI2VkaXRvcj4ubW9uYWNvLWVkaXRvcicpO1xyXG4gICAgICAgIGxldCAkYm90dG9tRGl2ID0galF1ZXJ5KCcjYm90dG9tZGl2LW91dGVyJyk7XHJcblxyXG4gICAgICAgIGxldCBoZWlnaHQgPSBOdW1iZXIucGFyc2VJbnQoJGJvdHRvbURpdi5jc3MoJ2hlaWdodCcpLnJlcGxhY2UoJ3B4JywgJycpKTtcclxuICAgICAgICAkYm90dG9tRGl2LmNzcygnaGVpZ2h0JywgKGhlaWdodCAtIGR5KSArIFwicHhcIik7XHJcblxyXG4gICAgICAgIGxldCBtZWhlaWdodCA9IE51bWJlci5wYXJzZUludCgkZWRpdG9yLmNzcygnaGVpZ2h0JykucmVwbGFjZSgncHgnLCAnJykpO1xyXG4gICAgICAgICRlZGl0b3IuY3NzKCdoZWlnaHQnLCAobWVoZWlnaHQgKyBkeSkgKyBcInB4XCIpO1xyXG5cclxuICAgICAgICB0aGlzLm1haW4uZ2V0TW9uYWNvRWRpdG9yKCkubGF5b3V0KCk7XHJcbiAgICAgICAgaWYodGhpcy5tYWluLmJvdHRvbURpdi5ob21ld29ya01hbmFnZXIuZGlmZkVkaXRvciAhPSBudWxsKXtcclxuICAgICAgICAgICAgdGhpcy5tYWluLmJvdHRvbURpdi5ob21ld29ya01hbmFnZXIuZGlmZkVkaXRvci5sYXlvdXQoKTtcclxuICAgICAgICB9XHJcbn1cclxuXHJcbiAgICBtb3ZlTGVmdFBhbmVsKGR4OiBudW1iZXIpIHtcclxuICAgICAgICBsZXQgJGxlZnRQYW5lbCA9IGpRdWVyeSgnI2xlZnRwYW5lbCcpO1xyXG4gICAgICAgIGxldCAkZWRpdG9yID0galF1ZXJ5KCcjZWRpdG9yPi5tb25hY28tZWRpdG9yJyk7XHJcblxyXG4gICAgICAgIGxldCB3aWR0aCA9IE51bWJlci5wYXJzZUludCgkbGVmdFBhbmVsLmNzcygnd2lkdGgnKS5yZXBsYWNlKCdweCcsICcnKSk7XHJcbiAgICAgICAgJGxlZnRQYW5lbC5jc3MoJ3dpZHRoJywgKHdpZHRoICsgZHgpICsgXCJweFwiKTtcclxuXHJcbiAgICAgICAgbGV0IG1ld2lkdGggPSBOdW1iZXIucGFyc2VJbnQoJGVkaXRvci5jc3MoJ3dpZHRoJykucmVwbGFjZSgncHgnLCAnJykpO1xyXG4gICAgICAgICRlZGl0b3IuY3NzKCd3aWR0aCcsIChtZXdpZHRoIC0gZHgpICsgXCJweFwiKTtcclxuICAgICAgICB0aGlzLm1haW4uZ2V0TW9uYWNvRWRpdG9yKCkubGF5b3V0KCk7XHJcbiAgICAgICAgaWYodGhpcy5tYWluLmJvdHRvbURpdi5ob21ld29ya01hbmFnZXIuZGlmZkVkaXRvciAhPSBudWxsKXtcclxuICAgICAgICAgICAgdGhpcy5tYWluLmJvdHRvbURpdi5ob21ld29ya01hbmFnZXIuZGlmZkVkaXRvci5sYXlvdXQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuXHJcblxyXG59Il19