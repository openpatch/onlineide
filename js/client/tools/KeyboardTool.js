import { InterpreterState } from "../interpreter/Interpreter.js";
export class KeyboardTool {
    constructor(element, main) {
        this.main = main;
        this.pressedKeys = {};
        this.keyPressedCallbacks = [];
        this.keyUpCallbacks = [];
        this.keyDownCallbacks = [];
        this.registerListeners(element);
    }
    unregisterListeners() {
        this.element.off("keydown");
        this.element.off("keyup");
        this.element.off("keypressed");
    }
    registerListeners(element) {
        this.element = element;
        let that = this;
        element.on("keydown", (e) => {
            let key = e.key;
            if (key == null)
                return true;
            if (e.shiftKey)
                key = "shift+" + key;
            if (e.ctrlKey)
                key = "ctrl" + key;
            if (e.altKey)
                key = "alt" + key;
            that.pressedKeys[key.toLowerCase()] = true;
            for (let kpc of that.keyDownCallbacks) {
                kpc(key);
            }
            // prevent <html>-Element from scrolling in embedded mode
            if (this.main.isEmbedded() && this.main.getInterpreter().state == InterpreterState.running && !this.main.getMonacoEditor().hasTextFocus()) {
                if (["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"].indexOf(e.key) >= 0)
                    e.preventDefault();
            }
            return true;
        });
        element.on("keyup", (e) => {
            let key = e.key;
            if (key == null)
                return true;
            if (typeof key == "undefined")
                return;
            if (e.shiftKey)
                key = "shift+" + key;
            if (e.ctrlKey)
                key = "ctrl" + key;
            if (e.altKey)
                key = "alt" + key;
            that.pressedKeys[key.toLowerCase()] = false;
            for (let kpc of that.keyUpCallbacks) {
                kpc(key);
            }
            return true;
        });
        element.on("keypress", (e) => {
            let k = e.key;
            if (e.shiftKey && k.length > 1) {
                k = "[shift]+" + k;
            }
            if (e.ctrlKey && k.length > 1) {
                k = "[ctrl]+" + k;
            }
            if (e.altKey && k.length > 1) {
                k = "[alt]+" + k;
            }
            for (let kpc of that.keyPressedCallbacks) {
                kpc(k);
            }
            return true;
        });
    }
    isPressed(key) {
        if (key == null)
            return null;
        return this.pressedKeys[key.toLowerCase()] == true;
    }
    unsubscribeAllListeners() {
        this.keyPressedCallbacks = [];
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiS2V5Ym9hcmRUb29sLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NsaWVudC90b29scy9LZXlib2FyZFRvb2wudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFHakUsTUFBTSxPQUFPLFlBQVk7SUFVckIsWUFBWSxPQUFvQixFQUFVLElBQWM7UUFBZCxTQUFJLEdBQUosSUFBSSxDQUFVO1FBTnhELGdCQUFXLEdBQTZCLEVBQUUsQ0FBQztRQUUzQyx3QkFBbUIsR0FBOEIsRUFBRSxDQUFDO1FBQ3BELG1CQUFjLEdBQThCLEVBQUUsQ0FBQztRQUMvQyxxQkFBZ0IsR0FBOEIsRUFBRSxDQUFDO1FBRzdDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBRUQsbUJBQW1CO1FBQ2YsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDNUIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDMUIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDbkMsQ0FBQztJQUVPLGlCQUFpQixDQUFDLE9BQW9CO1FBQzFDLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBQ3ZCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQztRQUNoQixPQUFPLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFO1lBQ3hCLElBQUksR0FBRyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUM7WUFDaEIsSUFBRyxHQUFHLElBQUksSUFBSTtnQkFBRSxPQUFPLElBQUksQ0FBQztZQUM1QixJQUFHLENBQUMsQ0FBQyxRQUFRO2dCQUFFLEdBQUcsR0FBRyxRQUFRLEdBQUcsR0FBRyxDQUFDO1lBQ3BDLElB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LE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLENBQUMsSUFBSSxJQUFJLENBQUM7SUFDdkQsQ0FBQztJQUVELHVCQUF1QjtRQUNuQixJQUFJLENBQUMsbUJBQW1CLEdBQUcsRUFBRSxDQUFDO0lBQ2xDLENBQUM7Q0FHSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEludGVycHJldGVyU3RhdGUgfSBmcm9tIFwiLi4vaW50ZXJwcmV0ZXIvSW50ZXJwcmV0ZXIuanNcIjtcclxuaW1wb3J0IHsgTWFpbkJhc2UgfSBmcm9tIFwiLi4vbWFpbi9NYWluQmFzZS5qc1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEtleWJvYXJkVG9vbCB7XHJcbiAgICBcclxuICAgIGVsZW1lbnQ6IEpRdWVyeTxhbnk+O1xyXG5cclxuICAgIHByZXNzZWRLZXlzOiB7W2tleTogc3RyaW5nXTogYm9vbGVhbn0gPSB7fTtcclxuXHJcbiAgICBrZXlQcmVzc2VkQ2FsbGJhY2tzOiAoKGtleTogc3RyaW5nKSA9PiB2b2lkKVtdID0gW107XHJcbiAgICBrZXlVcENhbGxiYWNrczogKChrZXk6IHN0cmluZykgPT4gdm9pZClbXSA9IFtdO1xyXG4gICAga2V5RG93bkNhbGxiYWNrczogKChrZXk6IHN0cmluZykgPT4gdm9pZClbXSA9IFtdO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGVsZW1lbnQ6IEpRdWVyeTxhbnk+LCBwcml2YXRlIG1haW46IE1haW5CYXNlKXtcclxuICAgICAgICB0aGlzLnJlZ2lzdGVyTGlzdGVuZXJzKGVsZW1lbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIHVucmVnaXN0ZXJMaXN0ZW5lcnMoKXtcclxuICAgICAgICB0aGlzLmVsZW1lbnQub2ZmKFwia2V5ZG93blwiKTtcclxuICAgICAgICB0aGlzLmVsZW1lbnQub2ZmKFwia2V5dXBcIik7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50Lm9mZihcImtleXByZXNzZWRcIik7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZWdpc3Rlckxpc3RlbmVycyhlbGVtZW50OiBKUXVlcnk8YW55Pil7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcclxuICAgICAgICBsZXQgdGhhdCA9IHRoaXM7XHJcbiAgICAgICAgZWxlbWVudC5vbihcImtleWRvd25cIiwgKGUpID0+IHtcclxuICAgICAgICAgICAgbGV0IGtleSA9IGUua2V5O1xyXG4gICAgICAgICAgICBpZihrZXkgPT0gbnVsbCkgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIGlmKGUuc2hpZnRLZXkpIGtleSA9IFwic2hpZnQrXCIgKyBrZXk7XHJcbiAgICAgICAgICAgIGlmKGUuY3RybEtleSkga2V5ID0gXCJjdHJsXCIgKyBrZXk7XHJcbiAgICAgICAgICAgIGlmKGUuYWx0S2V5KSBrZXkgPSBcImFsdFwiICsga2V5O1xyXG4gICAgICAgICAgICB0aGF0LnByZXNzZWRLZXlzW2tleS50b0xvd2VyQ2FzZSgpXSA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICBmb3IobGV0IGtwYyBvZiB0aGF0LmtleURvd25DYWxsYmFja3Mpe1xyXG4gICAgICAgICAgICAgICAga3BjKGtleSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIHByZXZlbnQgPGh0bWw+LUVsZW1lbnQgZnJvbSBzY3JvbGxpbmcgaW4gZW1iZWRkZWQgbW9kZVxyXG4gICAgICAgICAgICBpZih0aGlzLm1haW4uaXNFbWJlZGRlZCgpICYmIHRoaXMubWFpbi5nZXRJbnRlcnByZXRlcigpLnN0YXRlID09IEludGVycHJldGVyU3RhdGUucnVubmluZyAmJiAhdGhpcy5tYWluLmdldE1vbmFjb0VkaXRvcigpLmhhc1RleHRGb2N1cygpKXtcclxuICAgICAgICAgICAgICAgIGlmKFtcIkFycm93VXBcIiwgXCJBcnJvd0Rvd25cIiwgXCJBcnJvd0xlZnRcIiwgXCJBcnJvd1JpZ2h0XCJdLmluZGV4T2YoZS5rZXkpID49IDApXHJcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBlbGVtZW50Lm9uKFwia2V5dXBcIiwgKGUpID0+IHtcclxuICAgICAgICAgICAgbGV0IGtleSA9IGUua2V5O1xyXG4gICAgICAgICAgICBpZihrZXkgPT0gbnVsbCkgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIGlmKHR5cGVvZiBrZXkgPT0gXCJ1bmRlZmluZWRcIikgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgaWYoZS5zaGlmdEtleSkga2V5ID0gXCJzaGlmdCtcIiArIGtleTtcclxuICAgICAgICAgICAgaWYoZS5jdHJsS2V5KSBrZXkgPSBcImN0cmxcIiArIGtleTtcclxuICAgICAgICAgICAgaWYoZS5hbHRLZXkpIGtleSA9IFwiYWx0XCIgKyBrZXk7XHJcbiAgICAgICAgICAgIHRoYXQucHJlc3NlZEtleXNba2V5LnRvTG93ZXJDYXNlKCldID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICBmb3IobGV0IGtwYyBvZiB0aGF0LmtleVVwQ2FsbGJhY2tzKXtcclxuICAgICAgICAgICAgICAgIGtwYyhrZXkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGVsZW1lbnQub24oXCJrZXlwcmVzc1wiLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgayA9IGUua2V5O1xyXG4gICAgICAgICAgICBpZihlLnNoaWZ0S2V5ICYmIGsubGVuZ3RoID4gMSl7XHJcbiAgICAgICAgICAgICAgICBrID0gXCJbc2hpZnRdK1wiICsgaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihlLmN0cmxLZXkgJiYgay5sZW5ndGggPiAxKXtcclxuICAgICAgICAgICAgICAgIGsgPSBcIltjdHJsXStcIiArIGs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoZS5hbHRLZXkgJiYgay5sZW5ndGggPiAxKXtcclxuICAgICAgICAgICAgICAgIGsgPSBcIlthbHRdK1wiICsgaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3IobGV0IGtwYyBvZiB0aGF0LmtleVByZXNzZWRDYWxsYmFja3Mpe1xyXG4gICAgICAgICAgICAgICAga3BjKGspO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBpc1ByZXNzZWQoa2V5OiBzdHJpbmcpe1xyXG4gICAgICAgIGlmKGtleSA9PSBudWxsKSByZXR1cm4gbnVsbDtcclxuICAgICAgICByZXR1cm4gdGhpcy5wcmVzc2VkS2V5c1trZXkudG9Mb3dlckNhc2UoKV0gPT0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICB1bnN1YnNjcmliZUFsbExpc3RlbmVycygpIHtcclxuICAgICAgICB0aGlzLmtleVByZXNzZWRDYWxsYmFja3MgPSBbXTtcclxuICAgIH1cclxuXHJcblxyXG59Il19