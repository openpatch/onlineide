import { stringPrimitiveType, charPrimitiveType, intPrimitiveType } from "../compiler/types/PrimitiveTypes.js";
export class InputManager {
    constructor($runDiv, main) {
        this.$runDiv = $runDiv;
        this.main = main;
    }
    readInput(method, parameters, callback) {
        let returnType = method.getReturnType();
        let message = parameters[1].value;
        let defaultValue = parameters.length == 3 ? parameters[2].value : null;
        let printManager = this.main.getInterpreter().printManager;
        if (message != null && message != "") {
            printManager.beginOfLineState = true;
            printManager.println("\n" + message);
            printManager.doPrinting();
        }
        this.$input = jQuery('<input class="jo_newInput" type="text"/>');
        let $od = printManager.$outputDiv;
        $od.append(this.$input);
        let dvt = defaultValue == null ? "" : defaultValue;
        this.$input.val(dvt);
        let that = this;
        // this.$runDiv.find('.jo_run-input-button').on('mousedown', (e)=>{
        //     e.preventDefault();
        //     that.onSubmit(returnType, callback);
        // });
        this.$input.on('keydown', (e) => {
            if (e.key == "Enter") {
                that.onSubmit(returnType, callback);
            }
        });
        setTimeout(() => {
            that.$input.focus();
        }, 200);
        printManager.$outputDiv.on('mousedown.inputmanager', (e) => {
            setTimeout(() => {
                that.$input.focus();
            }, 200);
        });
    }
    onSubmit(type, callback) {
        let v = (this.$input.val());
        let printManager = this.main.getInterpreter().printManager;
        let valueAndError = this.parse(v, type);
        if (valueAndError.error != null) {
            // jQuery('<div style="color: red">' + valueAndError.error + '</div>').insertBefore(this.$input);
            this.$input.detach();
            printManager.println(valueAndError.error, "#ff0000");
            printManager.doPrinting();
            printManager.$outputDiv.append(this.$input);
            this.$input[0].scrollIntoView();
            this.$input.focus();
            return;
        }
        printManager.$outputDiv.off('mousedown.inputmanager');
        printManager.println(v);
        this.$input.off('keydown');
        this.hide();
        callback(valueAndError.value);
    }
    parse(v, type) {
        if (type == stringPrimitiveType) {
            return {
                error: null,
                value: { value: v, type: type }
            };
        }
        if (type == charPrimitiveType) {
            if (v.length == 0)
                return { error: "Leere Eingabe. Erwartet wird ein Zeichen.", value: null };
            if (v.length > 1)
                return { error: "Zu lange Eingabe. Erwartet wird ein Zeichen.", value: null };
            return {
                error: null,
                value: { value: v, type: type }
            };
        }
        if (type == charPrimitiveType) {
            if (v != "true" && v != "false")
                return { error: "Erwartet wird true oder false.", value: null };
            return {
                error: null,
                value: { value: v == "true", type: type }
            };
        }
        v = v.replace(",", ".");
        let n = Number(v);
        if (n == null) {
            return { error: "Erwartet wird eine Zahl.", value: null };
        }
        if (type == intPrimitiveType) {
            if (n != Math.round(n))
                return { error: "Erwartet wird eine ganze Zahl.", value: null };
            return {
                error: null,
                value: { value: Math.round(n), type: type }
            };
        }
        return {
            error: null,
            value: { value: n, type: type }
        };
    }
    hide() {
        if (this.$input != null) {
            this.$input.remove();
            this.$input = null;
        }
        // this.$runDiv.find('.jo_run-input').css('display', 'none');
        // this.$runDiv.find('.jo_run-input-button').off('mousedown');
        // this.$runDiv.find('.jo_run-input-input').off('keydown');
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW5wdXRNYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NsaWVudC9pbnRlcnByZXRlci9JbnB1dE1hbmFnZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLG1CQUFtQixFQUFFLGlCQUFpQixFQUFFLGdCQUFnQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFJL0csTUFBTSxPQUFPLFlBQVk7SUFJckIsWUFBb0IsT0FBNEIsRUFBVSxJQUFjO1FBQXBELFlBQU8sR0FBUCxPQUFPLENBQXFCO1FBQVUsU0FBSSxHQUFKLElBQUksQ0FBVTtJQUV4RSxDQUFDO0lBRU0sU0FBUyxDQUFDLE1BQWMsRUFBRSxVQUFtQixFQUFFLFFBQWdDO1FBRWxGLElBQUksVUFBVSxHQUFHLE1BQU0sQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUN4QyxJQUFJLE9BQU8sR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1FBQ2xDLElBQUksWUFBWSxHQUFHLFVBQVUsQ0FBQyxNQUFNLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFFdkUsSUFBSSxZQUFZLEdBQWlCLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUMsWUFBWSxDQUFDO1FBQ3pFLElBQUcsT0FBTyxJQUFJLElBQUksSUFBSSxPQUFPLElBQUksRUFBRSxFQUFDO1lBQ2hDLFlBQVksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUM7WUFDckMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDLENBQUM7WUFDckMsWUFBWSxDQUFDLFVBQVUsRUFBRSxDQUFDO1NBQzdCO1FBRUQsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsMENBQTBDLENBQUMsQ0FBQztRQUVqRSxJQUFJLEdBQUcsR0FBRyxZ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ckYsT0FBTztnQkFDSCxLQUFLLEVBQUUsSUFBSTtnQkFDWCxLQUFLLEVBQUUsRUFBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFDO2FBQzVDLENBQUE7U0FDSjtRQUVELE9BQU87WUFDSCxLQUFLLEVBQUUsSUFBSTtZQUNYLEtBQUssRUFBRSxFQUFDLEtBQUssRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBQztTQUNoQyxDQUFBO0lBRUwsQ0FBQztJQUdELElBQUk7UUFFQSxJQUFHLElBQUksQ0FBQyxNQUFNLElBQUksSUFBSSxFQUFDO1lBQ25CLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDckIsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7U0FDdEI7UUFFRCw2REFBNkQ7UUFFN0QsOERBQThEO1FBRTlELDJEQUEyRDtJQUUvRCxDQUFDO0NBR0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUeXBlLCBNZXRob2QsIFZhbHVlIH0gZnJvbSBcIi4uL2NvbXBpbGVyL3R5cGVzL1R5cGVzLmpzXCI7XHJcbmltcG9ydCB7IHN0cmluZ1ByaW1pdGl2ZVR5cGUsIGNoYXJQcmltaXRpdmVUeXBlLCBpbnRQcmltaXRpdmVUeXBlIH0gZnJvbSBcIi4uL2NvbXBpbGVyL3R5cGVzL1ByaW1pdGl2ZVR5cGVzLmpzXCI7XHJcbmltcG9ydCB7IE1haW5CYXNlIH0gZnJvbSBcIi4uL21haW4vTWFpbkJhc2UuanNcIjtcclxuaW1wb3J0IHsgUHJpbnRNYW5hZ2VyIH0gZnJvbSBcIi4uL21haW4vZ3VpL1ByaW50TWFuYWdlci5qc1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIElucHV0TWFuYWdlciB7XHJcblxyXG4gICAgJGlucHV0OiBKUXVlcnk8SFRNTElucHV0RWxlbWVudD47XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSAkcnVuRGl2OiBKUXVlcnk8SFRNTEVsZW1lbnQ+LCBwcml2YXRlIG1haW46IE1haW5CYXNlKXtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHJlYWRJbnB1dChtZXRob2Q6IE1ldGhvZCwgcGFyYW1ldGVyczogVmFsdWVbXSwgY2FsbGJhY2s6ICh2YWx1ZTogVmFsdWUpID0+IHZvaWQpe1xyXG5cclxuICAgICAgICBsZXQgcmV0dXJuVHlwZSA9IG1ldGhvZC5nZXRSZXR1cm5UeXBlKCk7XHJcbiAgICAgICAgbGV0IG1lc3NhZ2UgPSBwYXJhbWV0ZXJzWzFdLnZhbHVlO1xyXG4gICAgICAgIGxldCBkZWZhdWx0VmFsdWUgPSBwYXJhbWV0ZXJzLmxlbmd0aCA9PSAzID8gcGFyYW1ldGVyc1syXS52YWx1ZSA6IG51bGw7XHJcblxyXG4gICAgICAgIGxldCBwcmludE1hbmFnZXI6IFByaW50TWFuYWdlciA9IHRoaXMubWFpbi5nZXRJbnRlcnByZXRlcigpLnByaW50TWFuYWdlcjtcclxuICAgICAgICBpZihtZXNzYWdlICE9IG51bGwgJiYgbWVzc2FnZSAhPSBcIlwiKXtcclxuICAgICAgICAgICAgcHJpbnRNYW5hZ2VyLmJlZ2luT2ZMaW5lU3RhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICBwcmludE1hbmFnZXIucHJpbnRsbihcIlxcblwiICsgbWVzc2FnZSk7XHJcbiAgICAgICAgICAgIHByaW50TWFuYWdlci5kb1ByaW50aW5nKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLiRpbnB1dCA9IGpRdWVyeSgnPGlucHV0IGNsYXNzPVwiam9fbmV3SW5wdXRcIiB0eXBlPVwidGV4dFwiLz4nKTtcclxuXHJcbiAgICAgICAgbGV0ICRvZCA9IHByaW50TWFuYWdlci4kb3V0cHV0RGl2O1xyXG4gICAgICAgICRvZC5hcHBlbmQodGhpcy4kaW5wdXQpO1xyXG5cclxuICAgICAgICBsZXQgZHZ0ID0gZGVmYXVsdFZhbHVlID09IG51bGwgPyBcIlwiIDogZGVmYXVsdFZhbHVlO1xyXG4gICAgICAgIHRoaXMuJGlucHV0LnZhbChkdnQpO1xyXG5cclxuICAgICAgICBsZXQgdGhhdCA9IHRoaXM7XHJcblxyXG4gICAgICAgIC8vIHRoaXMuJHJ1bkRpdi5maW5kKCcuam9fcnVuLWlucHV0LWJ1dHRvbicpLm9uKCdtb3VzZWRvd24nLCAoZSk9PntcclxuICAgICAgICAvLyAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIC8vICAgICB0aGF0Lm9uU3VibWl0KHJldHVyblR5cGUsIGNhbGxiYWNrKTtcclxuICAgICAgICAvLyB9KTtcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLiRpbnB1dC5vbigna2V5ZG93bicsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIGlmKGUua2V5ID09IFwiRW50ZXJcIil7XHJcbiAgICAgICAgICAgICAgICB0aGF0Lm9uU3VibWl0KHJldHVyblR5cGUsIGNhbGxiYWNrKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGF0LiRpbnB1dC5mb2N1cygpO1xyXG4gICAgICAgIH0sIDIwMCk7XHJcblxyXG4gICAgICAgIHByaW50TWFuYWdlci4kb3V0cHV0RGl2Lm9uKCdtb3VzZWRvd24uaW5wdXRtYW5hZ2VyJywgKGUpID0+IHtcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGF0LiRpbnB1dC5mb2N1cygpO1xyXG4gICAgICAgICAgICB9LCAyMDApO1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgfVxyXG5cclxuICAgIG9uU3VibWl0KHR5cGU6IFR5cGUsIGNhbGxiYWNrOiAodmFsdWU6IFZhbHVlKSA9PiB2b2lkKXtcclxuICAgICAgICBsZXQgdjogc3RyaW5nID0gPHN0cmluZz4odGhpcy4kaW5wdXQudmFsKCkpO1xyXG4gICAgICAgIGxldCBwcmludE1hbmFnZXIgPSB0aGlzLm1haW4uZ2V0SW50ZXJwcmV0ZXIoKS5wcmludE1hbmFnZXI7XHJcblxyXG4gICAgICAgIGxldCB2YWx1ZUFuZEVycm9yID0gdGhpcy5wYXJzZSh2LCB0eXBlKTtcclxuXHJcbiAgICAgICAgaWYodmFsdWVBbmRFcnJvci5lcnJvciAhPSBudWxsKXtcclxuICAgICAgICAgICAgLy8galF1ZXJ5KCc8ZGl2IHN0eWxlPVwiY29sb3I6IHJlZFwiPicgKyB2YWx1ZUFuZEVycm9yLmVycm9yICsgJzwvZGl2PicpLmluc2VydEJlZm9yZSh0aGlzLiRpbnB1dCk7XHJcbiAgICAgICAgICAgIHRoaXMuJGlucHV0LmRldGFjaCgpO1xyXG4gICAgICAgICAgICBwcmludE1hbmFnZXIucHJpbnRsbih2YWx1ZUFuZEVycm9yLmVycm9yLCBcIiNmZjAwMDBcIik7XHJcbiAgICAgICAgICAgIHByaW50TWFuYWdlci5kb1ByaW50aW5nKCk7XHJcbiAgICAgICAgICAgIHByaW50TWFuYWdlci4kb3V0cHV0RGl2LmFwcGVuZCh0aGlzLiRpbnB1dCk7XHJcbiAgICAgICAgICAgIHRoaXMuJGlucHV0WzBdLnNjcm9sbEludG9WaWV3KCk7XHJcbiAgICAgICAgICAgIHRoaXMuJGlucHV0LmZvY3VzKCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcHJpbnRNYW5hZ2VyLiRvdXRwdXREaXYub2ZmKCdtb3VzZWRvd24uaW5wdXRtYW5hZ2VyJyk7XHJcbiAgICAgICAgcHJpbnRNYW5hZ2VyLnByaW50bG4odik7XHJcbiAgICAgICAgdGhpcy4kaW5wdXQub2ZmKCdrZXlkb3duJyk7XHJcbiAgICAgICAgdGhpcy5oaWRlKCk7XHJcblxyXG4gICAgICAgIGNhbGxiYWNrKHZhbHVlQW5kRXJyb3IudmFsdWUpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBwYXJzZSh2OiBzdHJpbmcsIHR5cGU6IFR5cGUpOnt2YWx1ZTogVmFsdWUsIGVycm9yOiBzdHJpbmd9IHtcclxuXHJcbiAgICAgICAgaWYodHlwZSA9PSBzdHJpbmdQcmltaXRpdmVUeXBlKXtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGVycm9yOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IHt2YWx1ZTogdiwgdHlwZTogdHlwZX1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYodHlwZSA9PSBjaGFyUHJpbWl0aXZlVHlwZSl7XHJcbiAgICAgICAgICAgIGlmKHYubGVuZ3RoID09IDApIHJldHVybiB7ZXJyb3I6IFwiTGVlcmUgRWluZ2FiZS4gRXJ3YXJ0ZXQgd2lyZCBlaW4gWmVpY2hlbi5cIiwgdmFsdWU6IG51bGx9O1xyXG4gICAgICAgICAgICBpZih2Lmxlbmd0aCA+IDEpIHJldHVybiB7ZXJyb3I6IFwiWnUgbGFuZ2UgRWluZ2FiZS4gRXJ3YXJ0ZXQgd2lyZCBlaW4gWmVpY2hlbi5cIiwgdmFsdWU6IG51bGx9O1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZXJyb3I6IG51bGwsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZToge3ZhbHVlOiB2LCB0eXBlOiB0eXBlfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZih0eXBlID09IGNoYXJQcmltaXRpdmVUeXBlKXtcclxuICAgICAgICAgICAgaWYodiAhPSBcInRydWVcIiAmJiB2ICE9IFwiZmFsc2VcIikgcmV0dXJuIHtlcnJvcjogXCJFcndhcnRldCB3aXJkIHRydWUgb2RlciBmYWxzZS5cIiwgdmFsdWU6IG51bGx9O1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZXJyb3I6IG51bGwsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZToge3ZhbHVlOiB2ID09IFwidHJ1ZVwiLCB0eXBlOiB0eXBlfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2ID0gdi5yZXBsYWNlKFwiLFwiLCBcIi5cIik7XHJcblxyXG4gICAgICAgIGxldCBuID0gTnVtYmVyKHYpO1xyXG5cclxuICAgICAgICBpZihuID09IG51bGwpe1xyXG4gICAgICAgICAgICByZXR1cm4ge2Vycm9yOiBcIkVyd2FydGV0IHdpcmQgZWluZSBaYWhsLlwiLCB2YWx1ZTogbnVsbH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZih0eXBlID09IGludFByaW1pdGl2ZVR5cGUpe1xyXG4gICAgICAgICAgICBpZihuICE9IE1hdGgucm91bmQobikpIHJldHVybiB7ZXJyb3I6IFwiRXJ3YXJ0ZXQgd2lyZCBlaW5lIGdhbnplIFphaGwuXCIsIHZhbHVlOiBudWxsfTtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGVycm9yOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IHt2YWx1ZTogTWF0aC5yb3VuZChuKSwgdHlwZTogdHlwZX1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZXJyb3I6IG51bGwsXHJcbiAgICAgICAgICAgIHZhbHVlOiB7dmFsdWU6IG4sIHR5cGU6IHR5cGV9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcblxyXG4gICAgaGlkZSgpe1xyXG5cclxuICAgICAgICBpZih0aGlzLiRpbnB1dCAhPSBudWxsKXtcclxuICAgICAgICAgICAgdGhpcy4kaW5wdXQucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuJGlucHV0ID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHRoaXMuJHJ1bkRpdi5maW5kKCcuam9fcnVuLWlucHV0JykuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTtcclxuXHJcbiAgICAgICAgLy8gdGhpcy4kcnVuRGl2LmZpbmQoJy5qb19ydW4taW5wdXQtYnV0dG9uJykub2ZmKCdtb3VzZWRvd24nKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyB0aGlzLiRydW5EaXYuZmluZCgnLmpvX3J1bi1pbnB1dC1pbnB1dCcpLm9mZigna2V5ZG93bicpO1xyXG5cclxuICAgIH1cclxuXHJcblxyXG59Il19