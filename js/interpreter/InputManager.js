import { stringPrimitiveType, charPrimitiveType, intPrimitiveType } from "../compiler/types/PrimitiveTypes.js";
export class InputManager {
    constructor($runDiv, main) {
        this.$runDiv = $runDiv;
        this.main = main;
    }
    readInput(method, parameters, callback) {
        let returnType = method.getReturnType();
        let message = parameters[1].value;
        let defaultValue = parameters.length == 3 ? parameters[2].value : null;
        let printManager = this.main.getInterpreter().printManager;
        if (message != null && message != "") {
            printManager.beginOfLineState = true;
            printManager.println("\n" + message);
            printManager.doPrinting();
        }
        this.$input = jQuery('<input class="jo_newInput" type="text"/>');
        let $od = printManager.$outputDiv;
        $od.append(this.$input);
        let dvt = defaultValue == null ? "" : defaultValue;
        this.$input.val(dvt);
        let that = this;
        // this.$runDiv.find('.jo_run-input-button').on('mousedown', (e)=>{
        //     e.preventDefault();
        //     that.onSubmit(returnType, callback);
        // });
        this.$input.on('keydown', (e) => {
            if (e.key == "Enter") {
                that.onSubmit(returnType, callback);
            }
        });
        setTimeout(() => {
            that.$input.focus();
        }, 200);
        printManager.$outputDiv.on('mousedown.inputmanager', (e) => {
            setTimeout(() => {
                var _a;
                (_a = that.$input) === null || _a === void 0 ? void 0 : _a.focus();
            }, 200);
        });
    }
    onSubmit(type, callback) {
        let v = (this.$input.val());
        let printManager = this.main.getInterpreter().printManager;
        let valueAndError = this.parse(v, type);
        if (valueAndError.error != null) {
            // jQuery('<div style="color: red">' + valueAndError.error + '</div>').insertBefore(this.$input);
            this.$input.detach();
            printManager.println(valueAndError.error, "#ff0000");
            printManager.doPrinting();
            printManager.$outputDiv.append(this.$input);
            this.$input[0].scrollIntoView();
            this.$input.focus();
            return;
        }
        printManager.$outputDiv.off('mousedown.inputmanager');
        printManager.println(v);
        this.$input.off('keydown');
        this.hide();
        callback(valueAndError.value);
    }
    parse(v, type) {
        if (type == stringPrimitiveType) {
            return {
                error: null,
                value: { value: v, type: type }
            };
        }
        if (type == charPrimitiveType) {
            if (v.length == 0)
                return { error: "Leere Eingabe. Erwartet wird ein Zeichen.", value: null };
            if (v.length > 1)
                return { error: "Zu lange Eingabe. Erwartet wird ein Zeichen.", value: null };
            return {
                error: null,
                value: { value: v, type: type }
            };
        }
        if (type == charPrimitiveType) {
            if (v != "true" && v != "false")
                return { error: "Erwartet wird true oder false.", value: null };
            return {
                error: null,
                value: { value: v == "true", type: type }
            };
        }
        v = v.replace(",", ".");
        let n = Number(v);
        if (n == null) {
            return { error: "Erwartet wird eine Zahl.", value: null };
        }
        if (type == intPrimitiveType) {
            if (n != Math.round(n))
                return { error: "Erwartet wird eine ganze Zahl.", value: null };
            return {
                error: null,
                value: { value: Math.round(n), type: type }
            };
        }
        return {
            error: null,
            value: { value: n, type: type }
        };
    }
    hide() {
        if (this.$input != null) {
            this.$input.remove();
            this.$input = null;
        }
        // this.$runDiv.find('.jo_run-input').css('display', 'none');
        // this.$runDiv.find('.jo_run-input-button').off('mousedown');
        // this.$runDiv.find('.jo_run-input-input').off('keydown');
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW5wdXRNYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NsaWVudC9pbnRlcnByZXRlci9JbnB1dE1hbmFnZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLG1CQUFtQixFQUFFLGlCQUFpQixFQUFFLGdCQUFnQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFJL0csTUFBTSxPQUFPLFlBQVk7SUFJckIsWUFBb0IsT0FBNEIsRUFBVSxJQUFjO1FBQXBELFlBQU8sR0FBUCxPQUFPLENBQXFCO1FBQVUsU0FBSSxHQUFKLElBQUksQ0FBVTtJQUV4RSxDQUFDO0lBRU0sU0FBUyxDQUFDLE1BQWMsRUFBRSxVQUFtQixFQUFFLFFBQWdDO1FBRWxGLElBQUksVUFBVSxHQUFHLE1BQU0sQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUN4QyxJQUFJLE9BQU8sR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1FBQ2xDLElBQUksWUFBWSxHQUFHLFVBQVUsQ0FBQyxNQUFNLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFFdkUsSUFBSSxZQUFZLEdBQWlCLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUMsWUFBWSxDQUFDO1FBQ3pFLElBQUcsT0FBTyxJQUFJLElBQUksSUFBSSxPQUFPLElBQUksRUFBRSxFQUFDO1lBQ2hDLFlBQVksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUM7WUFDckMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDLENBQUM7WUFDckMsWUFBWSxDQUFDLFVBQVUsRUFBRSxDQUFDO1NBQzdCO1FBRUQsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsMENBQTBDLENBQUMsQ0FBQztRQUVqRSxJQUFJLEdBQUcsR0FBRyxZQUFZ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RixPQUFPO2dCQUNILEtBQUssRUFBRSxJQUFJO2dCQUNYLEtBQUssRUFBRSxFQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUM7YUFDNUMsQ0FBQTtTQUNKO1FBRUQsT0FBTztZQUNILEtBQUssRUFBRSxJQUFJO1lBQ1gsS0FBSyxFQUFFLEVBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFDO1NBQ2hDLENBQUE7SUFFTCxDQUFDO0lBR0QsSUFBSTtRQUVBLElBQUcsSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLEVBQUM7WUFDbkIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNyQixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztTQUN0QjtRQUVELDZEQUE2RDtRQUU3RCw4REFBOEQ7UUFFOUQsMkRBQTJEO0lBRS9ELENBQUM7Q0FHSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFR5cGUsIE1ldGhvZCwgVmFsdWUgfSBmcm9tIFwiLi4vY29tcGlsZXIvdHlwZXMvVHlwZXMuanNcIjtcclxuaW1wb3J0IHsgc3RyaW5nUHJpbWl0aXZlVHlwZSwgY2hhclByaW1pdGl2ZVR5cGUsIGludFByaW1pdGl2ZVR5cGUgfSBmcm9tIFwiLi4vY29tcGlsZXIvdHlwZXMvUHJpbWl0aXZlVHlwZXMuanNcIjtcclxuaW1wb3J0IHsgTWFpbkJhc2UgfSBmcm9tIFwiLi4vbWFpbi9NYWluQmFzZS5qc1wiO1xyXG5pbXBvcnQgeyBQcmludE1hbmFnZXIgfSBmcm9tIFwiLi4vbWFpbi9ndWkvUHJpbnRNYW5hZ2VyLmpzXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgSW5wdXRNYW5hZ2VyIHtcclxuXHJcbiAgICAkaW5wdXQ6IEpRdWVyeTxIVE1MSW5wdXRFbGVtZW50PjtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlICRydW5EaXY6IEpRdWVyeTxIVE1MRWxlbWVudD4sIHByaXZhdGUgbWFpbjogTWFpbkJhc2Upe1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcmVhZElucHV0KG1ldGhvZDogTWV0aG9kLCBwYXJhbWV0ZXJzOiBWYWx1ZVtdLCBjYWxsYmFjazogKHZhbHVlOiBWYWx1ZSkgPT4gdm9pZCl7XHJcblxyXG4gICAgICAgIGxldCByZXR1cm5UeXBlID0gbWV0aG9kLmdldFJldHVyblR5cGUoKTtcclxuICAgICAgICBsZXQgbWVzc2FnZSA9IHBhcmFtZXRlcnNbMV0udmFsdWU7XHJcbiAgICAgICAgbGV0IGRlZmF1bHRWYWx1ZSA9IHBhcmFtZXRlcnMubGVuZ3RoID09IDMgPyBwYXJhbWV0ZXJzWzJdLnZhbHVlIDogbnVsbDtcclxuXHJcbiAgICAgICAgbGV0IHByaW50TWFuYWdlcjogUHJpbnRNYW5hZ2VyID0gdGhpcy5tYWluLmdldEludGVycHJldGVyKCkucHJpbnRNYW5hZ2VyO1xyXG4gICAgICAgIGlmKG1lc3NhZ2UgIT0gbnVsbCAmJiBtZXNzYWdlICE9IFwiXCIpe1xyXG4gICAgICAgICAgICBwcmludE1hbmFnZXIuYmVnaW5PZkxpbmVTdGF0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIHByaW50TWFuYWdlci5wcmludGxuKFwiXFxuXCIgKyBtZXNzYWdlKTtcclxuICAgICAgICAgICAgcHJpbnRNYW5hZ2VyLmRvUHJpbnRpbmcoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuJGlucHV0ID0galF1ZXJ5KCc8aW5wdXQgY2xhc3M9XCJqb19uZXdJbnB1dFwiIHR5cGU9XCJ0ZXh0XCIvPicpO1xyXG5cclxuICAgICAgICBsZXQgJG9kID0gcHJpbnRNYW5hZ2VyLiRvdXRwdXREaXY7XHJcbiAgICAgICAgJG9kLmFwcGVuZCh0aGlzLiRpbnB1dCk7XHJcblxyXG4gICAgICAgIGxldCBkdnQgPSBkZWZhdWx0VmFsdWUgPT0gbnVsbCA/IFwiXCIgOiBkZWZhdWx0VmFsdWU7XHJcbiAgICAgICAgdGhpcy4kaW5wdXQudmFsKGR2dCk7XHJcblxyXG4gICAgICAgIGxldCB0aGF0ID0gdGhpcztcclxuXHJcbiAgICAgICAgLy8gdGhpcy4kcnVuRGl2LmZpbmQoJy5qb19ydW4taW5wdXQtYnV0dG9uJykub24oJ21vdXNlZG93bicsIChlKT0+e1xyXG4gICAgICAgIC8vICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgLy8gICAgIHRoYXQub25TdWJtaXQocmV0dXJuVHlwZSwgY2FsbGJhY2spO1xyXG4gICAgICAgIC8vIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuJGlucHV0Lm9uKCdrZXlkb3duJywgKGUpID0+IHtcclxuICAgICAgICAgICAgaWYoZS5rZXkgPT0gXCJFbnRlclwiKXtcclxuICAgICAgICAgICAgICAgIHRoYXQub25TdWJtaXQocmV0dXJuVHlwZSwgY2FsbGJhY2spO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoYXQuJGlucHV0LmZvY3VzKCk7XHJcbiAgICAgICAgfSwgMjAwKTtcclxuXHJcbiAgICAgICAgcHJpbnRNYW5hZ2VyLiRvdXRwdXREaXYub24oJ21vdXNlZG93bi5pbnB1dG1hbmFnZXInLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoYXQuJGlucHV0Py5mb2N1cygpO1xyXG4gICAgICAgICAgICB9LCAyMDApO1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgfVxyXG5cclxuICAgIG9uU3VibWl0KHR5cGU6IFR5cGUsIGNhbGxiYWNrOiAodmFsdWU6IFZhbHVlKSA9PiB2b2lkKXtcclxuICAgICAgICBsZXQgdjogc3RyaW5nID0gPHN0cmluZz4odGhpcy4kaW5wdXQudmFsKCkpO1xyXG4gICAgICAgIGxldCBwcmludE1hbmFnZXIgPSB0aGlzLm1haW4uZ2V0SW50ZXJwcmV0ZXIoKS5wcmludE1hbmFnZXI7XHJcblxyXG4gICAgICAgIGxldCB2YWx1ZUFuZEVycm9yID0gdGhpcy5wYXJzZSh2LCB0eXBlKTtcclxuXHJcbiAgICAgICAgaWYodmFsdWVBbmRFcnJvci5lcnJvciAhPSBudWxsKXtcclxuICAgICAgICAgICAgLy8galF1ZXJ5KCc8ZGl2IHN0eWxlPVwiY29sb3I6IHJlZFwiPicgKyB2YWx1ZUFuZEVycm9yLmVycm9yICsgJzwvZGl2PicpLmluc2VydEJlZm9yZSh0aGlzLiRpbnB1dCk7XHJcbiAgICAgICAgICAgIHRoaXMuJGlucHV0LmRldGFjaCgpO1xyXG4gICAgICAgICAgICBwcmludE1hbmFnZXIucHJpbnRsbih2YWx1ZUFuZEVycm9yLmVycm9yLCBcIiNmZjAwMDBcIik7XHJcbiAgICAgICAgICAgIHByaW50TWFuYWdlci5kb1ByaW50aW5nKCk7XHJcbiAgICAgICAgICAgIHByaW50TWFuYWdlci4kb3V0cHV0RGl2LmFwcGVuZCh0aGlzLiRpbnB1dCk7XHJcbiAgICAgICAgICAgIHRoaXMuJGlucHV0WzBdLnNjcm9sbEludG9WaWV3KCk7XHJcbiAgICAgICAgICAgIHRoaXMuJGlucHV0LmZvY3VzKCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcHJpbnRNYW5hZ2VyLiRvdXRwdXREaXYub2ZmKCdtb3VzZWRvd24uaW5wdXRtYW5hZ2VyJyk7XHJcbiAgICAgICAgcHJpbnRNYW5hZ2VyLnByaW50bG4odik7XHJcbiAgICAgICAgdGhpcy4kaW5wdXQub2ZmKCdrZXlkb3duJyk7XHJcbiAgICAgICAgdGhpcy5oaWRlKCk7XHJcblxyXG4gICAgICAgIGNhbGxiYWNrKHZhbHVlQW5kRXJyb3IudmFsdWUpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBwYXJzZSh2OiBzdHJpbmcsIHR5cGU6IFR5cGUpOnt2YWx1ZTogVmFsdWUsIGVycm9yOiBzdHJpbmd9IHtcclxuXHJcbiAgICAgICAgaWYodHlwZSA9PSBzdHJpbmdQcmltaXRpdmVUeXBlKXtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGVycm9yOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IHt2YWx1ZTogdiwgdHlwZTogdHlwZX1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYodHlwZSA9PSBjaGFyUHJpbWl0aXZlVHlwZSl7XHJcbiAgICAgICAgICAgIGlmKHYubGVuZ3RoID09IDApIHJldHVybiB7ZXJyb3I6IFwiTGVlcmUgRWluZ2FiZS4gRXJ3YXJ0ZXQgd2lyZCBlaW4gWmVpY2hlbi5cIiwgdmFsdWU6IG51bGx9O1xyXG4gICAgICAgICAgICBpZih2Lmxlbmd0aCA+IDEpIHJldHVybiB7ZXJyb3I6IFwiWnUgbGFuZ2UgRWluZ2FiZS4gRXJ3YXJ0ZXQgd2lyZCBlaW4gWmVpY2hlbi5cIiwgdmFsdWU6IG51bGx9O1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZXJyb3I6IG51bGwsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZToge3ZhbHVlOiB2LCB0eXBlOiB0eXBlfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZih0eXBlID09IGNoYXJQcmltaXRpdmVUeXBlKXtcclxuICAgICAgICAgICAgaWYodiAhPSBcInRydWVcIiAmJiB2ICE9IFwiZmFsc2VcIikgcmV0dXJuIHtlcnJvcjogXCJFcndhcnRldCB3aXJkIHRydWUgb2RlciBmYWxzZS5cIiwgdmFsdWU6IG51bGx9O1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZXJyb3I6IG51bGwsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZToge3ZhbHVlOiB2ID09IFwidHJ1ZVwiLCB0eXBlOiB0eXBlfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2ID0gdi5yZXBsYWNlKFwiLFwiLCBcIi5cIik7XHJcblxyXG4gICAgICAgIGxldCBuID0gTnVtYmVyKHYpO1xyXG5cclxuICAgICAgICBpZihuID09IG51bGwpe1xyXG4gICAgICAgICAgICByZXR1cm4ge2Vycm9yOiBcIkVyd2FydGV0IHdpcmQgZWluZSBaYWhsLlwiLCB2YWx1ZTogbnVsbH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZih0eXBlID09IGludFByaW1pdGl2ZVR5cGUpe1xyXG4gICAgICAgICAgICBpZihuICE9IE1hdGgucm91bmQobikpIHJldHVybiB7ZXJyb3I6IFwiRXJ3YXJ0ZXQgd2lyZCBlaW5lIGdhbnplIFphaGwuXCIsIHZhbHVlOiBudWxsfTtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGVycm9yOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IHt2YWx1ZTogTWF0aC5yb3VuZChuKSwgdHlwZTogdHlwZX1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZXJyb3I6IG51bGwsXHJcbiAgICAgICAgICAgIHZhbHVlOiB7dmFsdWU6IG4sIHR5cGU6IHR5cGV9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcblxyXG4gICAgaGlkZSgpe1xyXG5cclxuICAgICAgICBpZih0aGlzLiRpbnB1dCAhPSBudWxsKXtcclxuICAgICAgICAgICAgdGhpcy4kaW5wdXQucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuJGlucHV0ID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHRoaXMuJHJ1bkRpdi5maW5kKCcuam9fcnVuLWlucHV0JykuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTtcclxuXHJcbiAgICAgICAgLy8gdGhpcy4kcnVuRGl2LmZpbmQoJy5qb19ydW4taW5wdXQtYnV0dG9uJykub2ZmKCdtb3VzZWRvd24nKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyB0aGlzLiRydW5EaXYuZmluZCgnLmpvX3J1bi1pbnB1dC1pbnB1dCcpLm9mZigna2V5ZG93bicpO1xyXG5cclxuICAgIH1cclxuXHJcblxyXG59Il19