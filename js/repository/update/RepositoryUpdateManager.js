import { makeDiv, setSelectItems, getSelectedObject } from "../../tools/HtmlTools.js";
import { ajax } from "../../communication/AjaxHelper.js";
export class RepositoryUpdateManager {
    constructor(main) {
        this.main = main;
        this.guiReady = false;
        this.publishedToItems = [];
        this.repositoryOwnerItems = [];
        this.users = [];
    }
    initGUI() {
        this.guiReady = true;
        let that = this;
        let $updateDiv = jQuery('#updateRepo-div');
        $updateDiv.append(this.$mainHeading = makeDiv('updateRepo-mainHeading', "createUpdateRepo-mainHeading", ""));
        this.$mainHeading.append(makeDiv("", "", "Repositories verwalten"));
        this.$mainHeading.append(this.$exitButton = makeDiv("", "jo_synchro_button", "Zurück zum Programmieren", { "background-color": "var(--speedcontrol-grip)", "color": "var(--fontColorLight)", "font-size": "10pt" }));
        this.$exitButton.on("click", () => { that.exitButtonClicked(); });
        let $divBelow = makeDiv("updateRepo-divBelow");
        $updateDiv.append($divBelow);
        let $divLeft = makeDiv("updateRepo-divLeft");
        $divBelow.append($divLeft);
        $divLeft.append(makeDiv('', 'updateRepo-minorHeading', 'Repositories:'));
        this.$repoListDiv = makeDiv("updateRepo-repoListDiv");
        $divLeft.append(this.$repoListDiv);
        let $rightDiv = makeDiv("updateRepo-divRight");
        $divBelow.append($rightDiv);
        let $settingsDiv = makeDiv("", "createUpdateRepo-settingsDiv");
        $rightDiv.append($settingsDiv);
        $settingsDiv.append(jQuery('<div class="createUpdateRepo-settingsLabel">Name des Repositorys:</div>'));
        $settingsDiv.append(this.$repoName = jQuery('<input type="text" class="createUpdateRepo-inputcolumn"></input>'));
        this.$repoName.on("input", () => { that.enableSaveButton(); });
        $settingsDiv.append(jQuery('<div class="createUpdateRepo-settingsLabel">Beschreibung:</div>'));
        $settingsDiv.append(this.$repoDescription = jQuery('<textarea class="createUpdateRepo-inputcolumn" style="min-height: 4em"></textarea>'));
        this.$repoDescription.on("input", () => { that.enableSaveButton(); });
        $settingsDiv.append(jQuery('<div class="createUpdateRepo-settingsLabel">Veröffentlicht für:</div>'));
        $settingsDiv.append(this.$repoPublishedTo = jQuery('<select class="createUpdateRepo-inputcolumn"></select>'));
        this.$repoPublishedTo.on("change", () => { that.enableSaveButton(); });
        $settingsDiv.append(jQuery('<div class="createUpdateRepo-settingsLabel">Eigentümer:</div>'));
        $settingsDiv.append(this.$repoOwner = jQuery('<select class="createUpdateRepo-inputcolumn"></select>'));
        this.$repoOwner.on("change", () => { that.enableSaveButton(); });
        $rightDiv.append(this.$userlistDiv = makeDiv("updateRepo-userlistDiv"));
        this.$userlistDiv.append(makeDiv(null, "updateRepo-userlistheading", "Benutzer, die das Repository nutzen", { "grid-column": 1 }));
        this.$userlistDiv.append(makeDiv(null, "updateRepo-userlistheading", "Schreibberechtigung", { "grid-column": 2 }));
        let $buttonDiv = makeDiv("updateRepo-buttonDiv");
        $buttonDiv.append(this.$saveButton = makeDiv("", "jo_synchro_button", "Änderungen speichern", { "background-color": "var(--updateButtonBackground)", "color": "var(--updateButtonColor)" }));
        this.$saveButton.on("click", () => { that.saveButtonClicked(); });
        this.$saveButton.hide();
        $rightDiv.append($buttonDiv);
    }
    enableSaveButton() {
        this.$saveButton.show();
    }
    show(repository_id) {
        if (!this.guiReady) {
            this.initGUI();
        }
        let $synchroDiv = jQuery('#updateRepo-div');
        $synchroDiv.css('visibility', 'visible');
        let $mainDiv = jQuery('#main');
        $mainDiv.css('visibility', 'hidden');
        let user = this.main.user;
        let is_student = !(user.is_teacher || user.is_admin || user.is_schooladmin);
        this.publishedToItems = [
            { value: 0, object: 0, caption: "Keine Veröffentlichung (privates Repository)" },
            { value: 1, object: 1, caption: is_student ? "Veröffentlicht für alle Schüler/innen der Klasse" : "Veröffentlicht für alle Schüler/innen der unterrichteten Klassen" },
            { value: 2, object: 2, caption: "Veröffentlicht für alle Schüler/innen der Schule" },
        ];
        setSelectItems(this.$repoPublishedTo, this.publishedToItems);
        this.$saveButton.show();
        let grlq = {
            onlyOwnRepositories: true
        };
        this.$repoListDiv.empty();
        let that = this;
        ajax('getRepositoryList', grlq, (response) => {
            let $firstDiv;
            let firstRepInfo;
            response.repositories.forEach(repInfo => {
                let $div = makeDiv('', 'updateRepo-repoListItem', repInfo.name);
                this.$repoListDiv.append($div);
                $div.on('click', (e) => {
                    that.selectRepository($div, repInfo);
                });
                $div.data('repoInfo', repInfo);
                if (firstRepInfo == null) {
                    firstRepInfo = repInfo;
                    $firstDiv = $div;
                }
            });
            if ($firstDiv != null) {
                this.selectRepository($firstDiv, firstRepInfo);
            }
        });
        this.main.windowStateManager.registerOneTimeBackButtonListener(() => {
            that.hide();
        });
    }
    selectRepository($repoDiv, repInfo) {
        if (this.$saveButton.is(":visible")) {
            let selectedItem = this.$repoListDiv.find('.active').first();
            let repoData = selectedItem.data('repoInfo');
            if (repoData) {
                alert(`Deine Änderungen am Repository "${repoData.name}" wurden nicht gespeichert.`);
            }
        }
        this.$saveButton.hide();
        this.$repoListDiv.find('.updateRepo-repoListItem').removeClass('active');
        $repoDiv.addClass('active');
        this.$repoName.val(repInfo.name);
        this.$repoDescription.val(repInfo.description);
        this.$repoPublishedTo.val(repInfo.published_to);
        this.$repoOwner.empty();
        this.$userlistDiv.children().not('.updateRepo-userlistheading').remove();
        let req = { repository_id: repInfo.id };
        let that = this;
        ajax('getRepositoryUserList', req, (response) => {
            response.repositoryUserList.forEach(userData => {
                let $userDiv = makeDiv("", "updateRepo-userDiv", `${userData.firstName} ${userData.lastName} (${userData.username})`, { 'grid-column': 1 });
                let $canWriteDiv = makeDiv("", "canWriteDiv", "", { 'grid-column': 2 });
                let $canWriteCheckBox = jQuery('<input type="checkbox">');
                $canWriteDiv.append($canWriteCheckBox);
                //@ts-ignore
                $canWriteCheckBox.attr('checked', userData.canWrite);
                $canWriteCheckBox.data('user', userData);
                $canWriteCheckBox.on("change", () => { that.enableSaveButton(); });
                that.$userlistDiv.append($userDiv, $canWriteDiv);
            });
            that.$repoOwner.empty();
            setSelectItems(that.$repoOwner, response.repositoryUserList.map(userData => {
                let se = {
                    caption: `${userData.firstName} ${userData.lastName} (${userData.username})`,
                    object: userData,
                    value: userData.user_id + ""
                };
                return se;
            }));
        });
    }
    hide() {
        let $synchroDiv = jQuery('#updateRepo-div');
        $synchroDiv.css('visibility', 'hidden');
        let $mainDiv = jQuery('#main');
        $mainDiv.css('visibility', 'visible');
    }
    saveButtonClicked() {
        let that = this;
        let selectedItem = this.$repoListDiv.find('.active').first();
        let repoData = selectedItem.data('repoInfo');
        let name = this.$repoName.val();
        let owner = getSelectedObject(this.$repoOwner);
        let published_to = getSelectedObject(this.$repoPublishedTo);
        let updateRepositoryRequest = {
            owner_id: owner.user_id,
            description: this.$repoDescription.val(),
            published_to: published_to,
            repository_id: repoData.id,
            name: name
        };
        ajax("updateRepository", updateRepositoryRequest, (response) => {
            repoData.name = name;
            repoData.owner_id = owner.user_id;
            repoData.owner_name = owner.firstName + " " + owner.lastName;
            repoData.owner_username = owner.username;
            repoData.published_to = published_to;
            repoData.description = updateRepositoryRequest.description;
            // update user write access:
            let writeAccessList = [];
            that.$userlistDiv.find('input').each((index, element) => {
                let $element = jQuery(element);
                let user = $element.data('user');
                writeAccessList.push({
                    has_write_access: jQuery(element).is(':checked'),
                    user_id: user.user_id
                });
            });
            let request = {
                repository_id: repoData.id,
                writeAccessList: writeAccessList
            };
            ajax('updateRepositoryUserWriteAccess', request, (response) => {
                alert('Die Änderungen wurden erfolgreich gespeichert.');
                that.$saveButton.hide();
            });
        });
    }
    exitButtonClicked() {
        window.history.back();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVwb3NpdG9yeVVwZGF0ZU1hbmFnZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY2xpZW50L3JlcG9zaXRvcnkvdXBkYXRlL1JlcG9zaXRvcnlVcGRhdGVNYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSxPQUFPLEVBQWMsY0FBYyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFFbEcsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBS3pELE1BQU0sT0FBTyx1QkFBdUI7SUEyQmhDLFlBQW1CLElBQVU7UUFBVixTQUFJLEdBQUosSUFBSSxDQUFNO1FBekI3QixhQUFRLEdBQVksS0FBSyxDQUFDO1FBaUIxQixxQkFBZ0IsR0FBaUIsRUFBRSxDQUFDO1FBRXBDLHlCQUFvQixHQUFpQixFQUFFLENBQUM7UUFFeEMsVUFBSyxHQUFxQixFQUFFLENBQUM7SUFLN0IsQ0FBQztJQUVELE9BQU87UUFDSCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUNyQixJQUFJLElBQUksR0FBRyxJQUFJLENBQUM7UUFDaEIsSUFBSSxVQUFVLEdBQUcsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFFM0MsVUFBVSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxHQUFHLE9BQU8sQ0FBQyx3QkFBd0IsRUFBRSw4QkFBOEIsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzdHLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLHdCQUF3QixDQUFDLENBQUMsQ0FBQztRQUNwRSxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBVyxHQUFHLE9BQU8sQ0FBQyxFQUFFLEVBQUUsbUJBQW1CLEVBQUUsMEJBQTBCLEVBQUUsRUFBRSxrQkFBa0IsRUFBRSwwQkFB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TUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUMxQixDQUFDO0NBR0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNYWluIH0gZnJvbSBcIi4uLy4uL21haW4vTWFpbi5qc1wiO1xyXG5pbXBvcnQgeyBXb3Jrc3BhY2UgfSBmcm9tIFwiLi4vLi4vd29ya3NwYWNlL1dvcmtzcGFjZS5qc1wiO1xyXG5pbXBvcnQgeyBtYWtlRGl2LCBTZWxlY3RJdGVtLCBzZXRTZWxlY3RJdGVtcywgZ2V0U2VsZWN0ZWRPYmplY3QgfSBmcm9tIFwiLi4vLi4vdG9vbHMvSHRtbFRvb2xzLmpzXCI7XHJcbmltcG9ydCB7IFJlcG9zaXRvcnlVc2VyLCBHZXRSZXBvc2l0b3J5UmVxdWVzdCwgR2V0UmVwb3NpdG9yeVJlc3BvbnNlLCBHZXRSZXBvc2l0b3J5VXNlckxpc3RSZXF1ZXN0LCBHZXRSZXBvc2l0b3J5VXNlckxpc3RSZXNwb25zZSwgVXNlckRhdGEsIEdldFJlcG9zaXRvcnlMaXN0UmVxdWVzdCwgR2V0UmVwb3NpdG9yeUxpc3RSZXNwb25zZSwgUmVwb3NpdG9yeUluZm8sIFVwZGF0ZVJlcG9zaXRvcnlSZXF1ZXN0LCBVcGRhdGVSZXBvc2l0b3J5UmVzcG9uc2UsIFJlcG9zaXRvcnlVc2VyV3JpdGVBY2Nlc3NEYXRhLCBVcGRhdGVSZXBvc2l0b3J5VXNlcldyaXRlQWNjZXNzUmVxdWVzdCwgVXBkYXRlUmVwb3NpdG9yeVVzZXJXcml0ZUFjY2Vzc1Jlc3BvbnNlIH0gZnJvbSBcIi4uLy4uL2NvbW11bmljYXRpb24vRGF0YS5qc1wiO1xyXG5pbXBvcnQgeyBhamF4IH0gZnJvbSBcIi4uLy4uL2NvbW11bmljYXRpb24vQWpheEhlbHBlci5qc1wiO1xyXG5pbXBvcnQgeyBUZWFjaGVyc1dpdGhDbGFzc2VzTUkgfSBmcm9tIFwiLi4vLi4vYWRtaW5pc3RyYXRpb24vVGVhY2hlcnNXaXRoQ2xhc3Nlcy5qc1wiO1xyXG5pbXBvcnQgeyBUaWxpbmdTcHJpdGUgfSBmcm9tIFwicGl4aS5qc1wiO1xyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBSZXBvc2l0b3J5VXBkYXRlTWFuYWdlciB7XHJcblxyXG4gICAgZ3VpUmVhZHk6IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgICAkbWFpbkhlYWRpbmc6IEpRdWVyeTxIVE1MRGl2RWxlbWVudD47XHJcblxyXG4gICAgJHJlcG9OYW1lOiBKUXVlcnk8SFRNTElucHV0RWxlbWVudD47XHJcbiAgICAkcmVwb0Rlc2NyaXB0aW9uOiBKUXVlcnk8SFRNTFRleHRBcmVhRWxlbWVudD47XHJcbiAgICAkcmVwb1B1Ymxpc2hlZFRvOiBKUXVlcnk8SFRNTFNlbGVjdEVsZW1lbnQ+O1xyXG4gICAgJHJlcG9Pd25lcjogSlF1ZXJ5PEhUTUxTZWxlY3RFbGVtZW50PjtcclxuXHJcbiAgICAkcmVwb0xpc3REaXY6IEpRdWVyeTxIVE1MRWxlbWVudD47XHJcblxyXG4gICAgJHVzZXJsaXN0RGl2OiBKUXVlcnk8SFRNTEVsZW1lbnQ+O1xyXG5cclxuICAgICRleGl0QnV0dG9uOiBKUXVlcnk8SFRNTEVsZW1lbnQ+O1xyXG4gICAgJHNhdmVCdXR0b246IEpRdWVyeTxIVE1MRWxlbWVudD47XHJcbiAgICAkZGVsZXRlQnV0dG9uOiBKUXVlcnk8SFRNTEVsZW1lbnQ+O1xyXG5cclxuICAgIHB1Ymxpc2hlZFRvSXRlbXM6IFNlbGVjdEl0ZW1bXSA9IFtdO1xyXG5cclxuICAgIHJlcG9zaXRvcnlPd25lckl0ZW1zOiBTZWxlY3RJdGVtW10gPSBbXTtcclxuXHJcbiAgICB1c2VyczogUmVwb3NpdG9yeVVzZXJbXSA9IFtdO1xyXG5cclxuICAgIHdvcmtzcGFjZTogV29ya3NwYWNlO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBtYWluOiBNYWluKSB7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdEdVSSgpIHtcclxuICAgICAgICB0aGlzLmd1aVJlYWR5ID0gdHJ1ZTtcclxuICAgICAgICBsZXQgdGhhdCA9IHRoaXM7XHJcbiAgICAgICAgbGV0ICR1cGRhdGVEaXYgPSBqUXVlcnkoJyN1cGRhdGVSZXBvLWRpdicpO1xyXG5cclxuICAgICAgICAkdXBkYXRlRGl2LmFwcGVuZCh0aGlzLiRtYWluSGVhZGluZyA9IG1ha2VEaXYoJ3VwZGF0ZVJlcG8tbWFpbkhlYWRpbmcnLCBcImNyZWF0ZVVwZGF0ZVJlcG8tbWFpbkhlYWRpbmdcIiwgXCJcIikpO1xyXG4gICAgICAgIHRoaXMuJG1haW5IZWFkaW5nLmFwcGVuZChtYWtlRGl2KFwiXCIsIFwiXCIsIFwiUmVwb3NpdG9yaWVzIHZlcndhbHRlblwiKSk7XHJcbiAgICAgICAgdGhpcy4kbWFpbkhlYWRpbmcuYXBwZW5kKHRoaXMuJGV4aXRCdXR0b24gPSBtYWtlRGl2KFwiXCIsIFwiam9fc3luY2hyb19idXR0b25cIiwgXCJadXLDvGNrIHp1bSBQcm9ncmFtbWllcmVuXCIsIHsgXCJiYWNrZ3JvdW5kLWNvbG9yXCI6IFwidmFyKC0tc3BlZWRjb250cm9sLWdyaXApXCIsIFwiY29sb3JcIjogXCJ2YXIoLS1mb250Q29sb3JMaWdodClcIiwgXCJmb250LXNpemVcIjogXCIxMHB0XCIgfSkpO1xyXG4gICAgICAgIHRoaXMuJGV4aXRCdXR0b24ub24oXCJjbGlja1wiLCAoKSA9PiB7IHRoYXQuZXhpdEJ1dHRvbkNsaWNrZWQoKSB9KVxyXG5cclxuXHJcbiAgICAgICAgbGV0ICRkaXZCZWxvdyA9IG1ha2VEaXYoXCJ1cGRhdGVSZXBvLWRpdkJlbG93XCIpO1xyXG4gICAgICAgICR1cGRhdGVEaXYuYXBwZW5kKCRkaXZCZWxvdyk7XHJcblxyXG4gICAgICAgIGxldCAkZGl2TGVmdCA9IG1ha2VEaXYoXCJ1cGRhdGVSZXBvLWRpdkxlZnRcIik7XHJcbiAgICAgICAgJGRpdkJlbG93LmFwcGVuZCgkZGl2TGVmdCk7XHJcblxyXG4gICAgICAgICRkaXZMZWZ0LmFwcGVuZChtYWtlRGl2KCcnLCAndXBkYXRlUmVwby1taW5vckhlYWRpbmcnLCAnUmVwb3NpdG9yaWVzOicpKTtcclxuXHJcbiAgICAgICAgdGhpcy4kcmVwb0xpc3REaXYgPSBtYWtlRGl2KFwidXBkYXRlUmVwby1yZXBvTGlzdERpdlwiKTtcclxuICAgICAgICAkZGl2TGVmdC5hcHBlbmQodGhpcy4kcmVwb0xpc3REaXYpO1xyXG5cclxuICAgICAgICBsZXQgJHJpZ2h0RGl2ID0gbWFrZURpdihcInVwZGF0ZVJlcG8tZGl2UmlnaHRcIik7XHJcbiAgICAgICAgJGRpdkJlbG93LmFwcGVuZCgkcmlnaHREaXYpO1xyXG5cclxuICAgICAgICBsZXQgJHNldHRpbmdzRGl2ID0gbWFrZURpdihcIlwiLCBcImNyZWF0ZVVwZGF0ZVJlcG8tc2V0dGluZ3NEaXZcIik7XHJcbiAgICAgICAgJHJpZ2h0RGl2LmFwcGVuZCgkc2V0dGluZ3NEaXYpO1xyXG5cclxuICAgICAgICAkc2V0dGluZ3NEaXYuYXBwZW5kKGpRdWVyeSgnPGRpdiBjbGFzcz1cImNyZWF0ZVVwZGF0ZVJlcG8tc2V0dGluZ3NMYWJlbFwiPk5hbWUgZGVzIFJlcG9zaXRvcnlzOjwvZGl2PicpKTtcclxuICAgICAgICAkc2V0dGluZ3NEaXYuYXBwZW5kKHRoaXMuJHJlcG9OYW1lID0galF1ZXJ5KCc8aW5wdXQgdHlwZT1cInRleHRcIiBjbGFzcz1cImNyZWF0ZVVwZGF0ZVJlcG8taW5wdXRjb2x1bW5cIj48L2lucHV0PicpKTtcclxuICAgICAgICB0aGlzLiRyZXBvTmFtZS5vbihcImlucHV0XCIsICgpID0+IHsgdGhhdC5lbmFibGVTYXZlQnV0dG9uKCkgfSk7XHJcblxyXG4gICAgICAgICRzZXR0aW5nc0Rpdi5hcHBlbmQoalF1ZXJ5KCc8ZGl2IGNsYXNzPVwiY3JlYXRlVXBkYXRlUmVwby1zZXR0aW5nc0xhYmVsXCI+QmVzY2hyZWlidW5nOjwvZGl2PicpKTtcclxuICAgICAgICAkc2V0dGluZ3NEaXYuYXBwZW5kKHRoaXMuJHJlcG9EZXNjcmlwdGlvbiA9IGpRdWVyeSgnPHRleHRhcmVhIGNsYXNzPVwiY3JlYXRlVXBkYXRlUmVwby1pbnB1dGNvbHVtblwiIHN0eWxlPVwibWluLWhlaWdodDogNGVtXCI+PC90ZXh0YXJlYT4nKSk7XHJcbiAgICAgICAgdGhpcy4kcmVwb0Rlc2NyaXB0aW9uLm9uKFwiaW5wdXRcIiwgKCkgPT4geyB0aGF0LmVuYWJsZVNhdmVCdXR0b24oKSB9KTtcclxuXHJcblxyXG4gICAgICAgICRzZXR0aW5nc0Rpdi5hcHBlbmQoalF1ZXJ5KCc8ZGl2IGNsYXNzPVwiY3JlYXRlVXBkYXRlUmVwby1zZXR0aW5nc0xhYmVsXCI+VmVyw7ZmZmVudGxpY2h0IGbDvHI6PC9kaXY+JykpO1xyXG4gICAgICAgICRzZXR0aW5nc0Rpdi5hcHBlbmQodGhpcy4kcmVwb1B1Ymxpc2hlZFRvID0galF1ZXJ5KCc8c2VsZWN0IGNsYXNzPVwiY3JlYXRlVXBkYXRlUmVwby1pbnB1dGNvbHVtblwiPjwvc2VsZWN0PicpKTtcclxuICAgICAgICB0aGlzLiRyZXBvUHVibGlzaGVkVG8ub24oXCJjaGFuZ2VcIiwgKCkgPT4geyB0aGF0LmVuYWJsZVNhdmVCdXR0b24oKSB9KTtcclxuXHJcbiAgICAgICAgJHNldHRpbmdzRGl2LmFwcGVuZChqUXVlcnkoJzxkaXYgY2xhc3M9XCJjcmVhdGVVcGRhdGVSZXBvLXNldHRpbmdzTGFiZWxcIj5FaWdlbnTDvG1lcjo8L2Rpdj4nKSk7XHJcbiAgICAgICAgJHNldHRpbmdzRGl2LmFwcGVuZCh0aGlzLiRyZXBvT3duZXIgPSBqUXVlcnkoJzxzZWxlY3QgY2xhc3M9XCJjcmVhdGVVcGRhdGVSZXBvLWlucHV0Y29sdW1uXCI+PC9zZWxlY3Q+JykpO1xyXG4gICAgICAgIHRoaXMuJHJlcG9Pd25lci5vbihcImNoYW5nZVwiLCAoKSA9PiB7IHRoYXQuZW5hYmxlU2F2ZUJ1dHRvbigpIH0pO1xyXG5cclxuICAgICAgICAkcmlnaHREaXYuYXBwZW5kKHRoaXMuJHVzZXJsaXN0RGl2ID0gbWFrZURpdihcInVwZGF0ZVJlcG8tdXNlcmxpc3REaXZcIikpO1xyXG5cclxuICAgICAgICB0aGlzLiR1c2VybGlzdERpdi5hcHBlbmQobWFrZURpdihudWxsLCBcInVwZGF0ZVJlcG8tdXNlcmxpc3RoZWFkaW5nXCIsIFwiQmVudXR6ZXIsIGRpZSBkYXMgUmVwb3NpdG9yeSBudXR6ZW5cIiwgeyBcImdyaWQtY29sdW1uXCI6IDEgfSkpXHJcbiAgICAgICAgdGhpcy4kdXNlcmxpc3REaXYuYXBwZW5kKG1ha2VEaXYobnVsbCwgXCJ1cGRhdGVSZXBvLXVzZXJsaXN0aGVhZGluZ1wiLCBcIlNjaHJlaWJiZXJlY2h0aWd1bmdcIiwgeyBcImdyaWQtY29sdW1uXCI6IDIgfSkpXHJcblxyXG4gICAgICAgIGxldCAkYnV0dG9uRGl2ID0gbWFrZURpdihcInVwZGF0ZVJlcG8tYnV0dG9uRGl2XCIpO1xyXG5cclxuICAgICAgICAkYnV0dG9uRGl2LmFwcGVuZCh0aGlzLiRzYXZlQnV0dG9uID0gbWFrZURpdihcIlwiLCBcImpvX3N5bmNocm9fYnV0dG9uXCIsIFwiw4RuZGVydW5nZW4gc3BlaWNoZXJuXCIsIHsgXCJiYWNrZ3JvdW5kLWNvbG9yXCI6IFwidmFyKC0tdXBkYXRlQnV0dG9uQmFja2dyb3VuZClcIiwgXCJjb2xvclwiOiBcInZhcigtLXVwZGF0ZUJ1dHRvbkNvbG9yKVwiIH0pKTtcclxuICAgICAgICB0aGlzLiRzYXZlQnV0dG9uLm9uKFwiY2xpY2tcIiwgKCkgPT4geyB0aGF0LnNhdmVCdXR0b25DbGlja2VkKCkgfSlcclxuICAgICAgICB0aGlzLiRzYXZlQnV0dG9uLmhpZGUoKTtcclxuXHJcbiAgICAgICAgJHJpZ2h0RGl2LmFwcGVuZCgkYnV0dG9uRGl2KTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgZW5hYmxlU2F2ZUJ1dHRvbigpIHtcclxuICAgICAgICB0aGlzLiRzYXZlQnV0dG9uLnNob3coKTtcclxuICAgIH1cclxuXHJcbiAgICBzaG93KHJlcG9zaXRvcnlfaWQ6IG51bWJlcikge1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuZ3VpUmVhZHkpIHtcclxuICAgICAgICAgICAgdGhpcy5pbml0R1VJKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgJHN5bmNocm9EaXYgPSBqUXVlcnkoJyN1cGRhdGVSZXBvLWRpdicpO1xyXG4gICAgICAgICRzeW5jaHJvRGl2LmNzcygndmlzaWJpbGl0eScsICd2aXNpYmxlJyk7XHJcbiAgICAgICAgbGV0ICRtYWluRGl2ID0galF1ZXJ5KCcjbWFpbicpO1xyXG4gICAgICAgICRtYWluRGl2LmNzcygndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcclxuXHJcbiAgICAgICAgbGV0IHVzZXIgPSB0aGlzLm1haW4udXNlcjtcclxuICAgICAgICBsZXQgaXNfc3R1ZGVudCA9ICEodXNlci5pc190ZWFjaGVyIHx8IHVzZXIuaXNfYWRtaW4gfHwgdXNlci5pc19zY2hvb2xhZG1pbik7XHJcblxyXG4gICAgICAgIHRoaXMucHVibGlzaGVkVG9JdGVtcyA9IFtcclxuICAgICAgICAgICAgeyB2YWx1ZTogMCwgb2JqZWN0OiAwLCBjYXB0aW9uOiBcIktlaW5lIFZlcsO2ZmZlbnRsaWNodW5nIChwcml2YXRlcyBSZXBvc2l0b3J5KVwiIH0sXHJcbiAgICAgICAgICAgIHsgdmFsdWU6IDEsIG9iamVjdDogMSwgY2FwdGlvbjogaXNfc3R1ZGVudCA/IFwiVmVyw7ZmZmVudGxpY2h0IGbDvHIgYWxsZSBTY2jDvGxlci9pbm5lbiBkZXIgS2xhc3NlXCIgOiBcIlZlcsO2ZmZlbnRsaWNodCBmw7xyIGFsbGUgU2Now7xsZXIvaW5uZW4gZGVyIHVudGVycmljaHRldGVuIEtsYXNzZW5cIiB9LFxyXG4gICAgICAgICAgICB7IHZhbHVlOiAyLCBvYmplY3Q6IDIsIGNhcHRpb246IFwiVmVyw7ZmZmVudGxpY2h0IGbDvHIgYWxsZSBTY2jDvGxlci9pbm5lbiBkZXIgU2NodWxlXCIgfSxcclxuICAgICAgICBdO1xyXG5cclxuICAgICAgICBzZXRTZWxlY3RJdGVtcyh0aGlzLiRyZXBvUHVibGlzaGVkVG8sIHRoaXMucHVibGlzaGVkVG9JdGVtcyk7XHJcblxyXG4gICAgICAgIHRoaXMuJHNhdmVCdXR0b24uc2hvdygpO1xyXG5cclxuICAgICAgICBsZXQgZ3JscTogR2V0UmVwb3NpdG9yeUxpc3RSZXF1ZXN0ID0ge1xyXG4gICAgICAgICAgICBvbmx5T3duUmVwb3NpdG9yaWVzOiB0cnVlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLiRyZXBvTGlzdERpdi5lbXB0eSgpO1xyXG4gICAgICAgIGxldCB0aGF0ID0gdGhpcztcclxuICAgICAgICBhamF4KCdnZXRSZXBvc2l0b3J5TGlzdCcsIGdybHEsIChyZXNwb25zZTogR2V0UmVwb3NpdG9yeUxpc3RSZXNwb25zZSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgbGV0ICRmaXJzdERpdjogSlF1ZXJ5PEhUTUxEaXZFbGVtZW50PjtcclxuICAgICAgICAgICAgbGV0IGZpcnN0UmVwSW5mbzogUmVwb3NpdG9yeUluZm87XHJcblxyXG4gICAgICAgICAgICByZXNwb25zZS5yZXBvc2l0b3JpZXMuZm9yRWFjaChyZXBJbmZvID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCAkZGl2ID0gbWFrZURpdignJywgJ3VwZGF0ZVJlcG8tcmVwb0xpc3RJdGVtJywgcmVwSW5mby5uYW1lKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuJHJlcG9MaXN0RGl2LmFwcGVuZCgkZGl2KTtcclxuICAgICAgICAgICAgICAgICRkaXYub24oJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGF0LnNlbGVjdFJlcG9zaXRvcnkoJGRpdiwgcmVwSW5mbyk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgJGRpdi5kYXRhKCdyZXBvSW5mbycsIHJlcEluZm8pO1xyXG4gICAgICAgICAgICAgICAgaWYgKGZpcnN0UmVwSW5mbyA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlyc3RSZXBJbmZvID0gcmVwSW5mbztcclxuICAgICAgICAgICAgICAgICAgICAkZmlyc3REaXYgPSAkZGl2O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGlmICgkZmlyc3REaXYgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RSZXBvc2l0b3J5KCRmaXJzdERpdiwgZmlyc3RSZXBJbmZvKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIHRoaXMubWFpbi53aW5kb3dTdGF0ZU1hbmFnZXIucmVnaXN0ZXJPbmVUaW1lQmFja0J1dHRvbkxpc3RlbmVyKCgpID0+IHtcclxuICAgICAgICAgICAgdGhhdC5oaWRlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICBzZWxlY3RSZXBvc2l0b3J5KCRyZXBvRGl2OiBKUXVlcnk8SFRNTERpdkVsZW1lbnQ+LCByZXBJbmZvOiBSZXBvc2l0b3J5SW5mbykge1xyXG4gICAgICAgIGlmICh0aGlzLiRzYXZlQnV0dG9uLmlzKFwiOnZpc2libGVcIikpIHtcclxuICAgICAgICAgICAgbGV0IHNlbGVjdGVkSXRlbSA9IHRoaXMuJHJlcG9MaXN0RGl2LmZpbmQoJy5hY3RpdmUnKS5maXJzdCgpO1xyXG4gICAgICAgICAgICBsZXQgcmVwb0RhdGE6IFJlcG9zaXRvcnlJbmZvID0gPGFueT5zZWxlY3RlZEl0ZW0uZGF0YSgncmVwb0luZm8nKTtcclxuICAgICAgICAgICAgaWYocmVwb0RhdGEpe1xyXG4gICAgICAgICAgICAgICAgYWxlcnQoYERlaW5lIMOEbmRlcnVuZ2VuIGFtIFJlcG9zaXRvcnkgXCIke3JlcG9EYXRhLm5hbWV9XCIgd3VyZGVuIG5pY2h0IGdlc3BlaWNoZXJ0LmApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLiRzYXZlQnV0dG9uLmhpZGUoKTtcclxuICAgICAgICB0aGlzLiRyZXBvTGlzdERpdi5maW5kKCcudXBkYXRlUmVwby1yZXBvTGlzdEl0ZW0nKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgJHJlcG9EaXYuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgIHRoaXMuJHJlcG9OYW1lLnZhbChyZXBJbmZvLm5hbWUpO1xyXG4gICAgICAgIHRoaXMuJHJlcG9EZXNjcmlwdGlvbi52YWwocmVwSW5mby5kZXNjcmlwdGlvbik7XHJcbiAgICAgICAgdGhpcy4kcmVwb1B1Ymxpc2hlZFRvLnZhbChyZXBJbmZvLnB1Ymxpc2hlZF90byk7XHJcblxyXG4gICAgICAgIHRoaXMuJHJlcG9Pd25lci5lbXB0eSgpO1xyXG4gICAgICAgIHRoaXMuJHVzZXJsaXN0RGl2LmNoaWxkcmVuKCkubm90KCcudXBkYXRlUmVwby11c2VybGlzdGhlYWRpbmcnKS5yZW1vdmUoKTtcclxuXHJcbiAgICAgICAgbGV0IHJlcTogR2V0UmVwb3NpdG9yeVVzZXJMaXN0UmVxdWVzdCA9IHsgcmVwb3NpdG9yeV9pZDogcmVwSW5mby5pZCB9O1xyXG4gICAgICAgIGxldCB0aGF0ID0gdGhpcztcclxuXHJcbiAgICAgICAgYWpheCgnZ2V0UmVwb3NpdG9yeVVzZXJMaXN0JywgcmVxLCAocmVzcG9uc2U6IEdldFJlcG9zaXRvcnlVc2VyTGlzdFJlc3BvbnNlKSA9PiB7XHJcblxyXG4gICAgICAgICAgICByZXNwb25zZS5yZXBvc2l0b3J5VXNlckxpc3QuZm9yRWFjaCh1c2VyRGF0YSA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0ICR1c2VyRGl2ID0gbWFrZURpdihcIlwiLCBcInVwZGF0ZVJlcG8tdXNlckRpdlwiLCBgJHt1c2VyRGF0YS5maXJzdE5hbWV9ICR7dXNlckRhdGEubGFzdE5hbWV9ICgke3VzZXJEYXRhLnVzZXJuYW1lfSlgLCB7ICdncmlkLWNvbHVtbic6IDEgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0ICRjYW5Xcml0ZURpdiA9IG1ha2VEaXYoXCJcIiwgXCJjYW5Xcml0ZURpdlwiLCBcIlwiLCB7ICdncmlkLWNvbHVtbic6IDIgfSk7XHJcbiAgICAgICAgICAgICAgICBsZXQgJGNhbldyaXRlQ2hlY2tCb3ggPSBqUXVlcnkoJzxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIj4nKTtcclxuICAgICAgICAgICAgICAgICRjYW5Xcml0ZURpdi5hcHBlbmQoJGNhbldyaXRlQ2hlY2tCb3gpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgICAgJGNhbldyaXRlQ2hlY2tCb3guYXR0cignY2hlY2tlZCcsIHVzZXJEYXRhLmNhbldyaXRlKTtcclxuICAgICAgICAgICAgICAgICRjYW5Xcml0ZUNoZWNrQm94LmRhdGEoJ3VzZXInLCB1c2VyRGF0YSk7XHJcbiAgICAgICAgICAgICAgICAkY2FuV3JpdGVDaGVja0JveC5vbihcImNoYW5nZVwiLCAoKSA9PiB7IHRoYXQuZW5hYmxlU2F2ZUJ1dHRvbigpIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoYXQuJHVzZXJsaXN0RGl2LmFwcGVuZCgkdXNlckRpdiwgJGNhbldyaXRlRGl2KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGF0LiRyZXBvT3duZXIuZW1wdHkoKTtcclxuICAgICAgICAgICAgc2V0U2VsZWN0SXRlbXModGhhdC4kcmVwb093bmVyLCByZXNwb25zZS5yZXBvc2l0b3J5VXNlckxpc3QubWFwKHVzZXJEYXRhID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBzZTogU2VsZWN0SXRlbSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBjYXB0aW9uOiBgJHt1c2VyRGF0YS5maXJzdE5hbWV9ICR7dXNlckRhdGEubGFzdE5hbWV9ICgke3VzZXJEYXRhLnVzZXJuYW1lfSlgLFxyXG4gICAgICAgICAgICAgICAgICAgIG9iamVjdDogdXNlckRhdGEsXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHVzZXJEYXRhLnVzZXJfaWQgKyBcIlwiXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc2U7XHJcbiAgICAgICAgICAgIH0pKVxyXG5cclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgfVxyXG5cclxuICAgIGhpZGUoKSB7XHJcbiAgICAgICAgbGV0ICRzeW5jaHJvRGl2ID0galF1ZXJ5KCcjdXBkYXRlUmVwby1kaXYnKTtcclxuICAgICAgICAkc3luY2hyb0Rpdi5jc3MoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XHJcbiAgICAgICAgbGV0ICRtYWluRGl2ID0galF1ZXJ5KCcjbWFpbicpO1xyXG4gICAgICAgICRtYWluRGl2LmNzcygndmlzaWJpbGl0eScsICd2aXNpYmxlJyk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHNhdmVCdXR0b25DbGlja2VkKCkge1xyXG5cclxuICAgICAgICBsZXQgdGhhdCA9IHRoaXM7XHJcblxyXG4gICAgICAgIGxldCBzZWxlY3RlZEl0ZW0gPSB0aGlzLiRyZXBvTGlzdERpdi5maW5kKCcuYWN0aXZlJykuZmlyc3QoKTtcclxuICAgICAgICBsZXQgcmVwb0RhdGE6IFJlcG9zaXRvcnlJbmZvID0gPGFueT5zZWxlY3RlZEl0ZW0uZGF0YSgncmVwb0luZm8nKTtcclxuXHJcbiAgICAgICAgbGV0IG5hbWU6IHN0cmluZyA9IDxzdHJpbmc+dGhpcy4kcmVwb05hbWUudmFsKCk7XHJcbiAgICAgICAgbGV0IG93bmVyOiBSZXBvc2l0b3J5VXNlciA9IGdldFNlbGVjdGVkT2JqZWN0KHRoaXMuJHJlcG9Pd25lcik7XHJcbiAgICAgICAgbGV0IHB1Ymxpc2hlZF90bzogbnVtYmVyID0gZ2V0U2VsZWN0ZWRPYmplY3QodGhpcy4kcmVwb1B1Ymxpc2hlZFRvKTtcclxuXHJcbiAgICAgICAgbGV0IHVwZGF0ZVJlcG9zaXRvcnlSZXF1ZXN0OiBVcGRhdGVSZXBvc2l0b3J5UmVxdWVzdCA9IHtcclxuICAgICAgICAgICAgb3duZXJfaWQ6IG93bmVyLnVzZXJfaWQsXHJcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiA8c3RyaW5nPnRoaXMuJHJlcG9EZXNjcmlwdGlvbi52YWwoKSxcclxuICAgICAgICAgICAgcHVibGlzaGVkX3RvOiBwdWJsaXNoZWRfdG8sXHJcbiAgICAgICAgICAgIHJlcG9zaXRvcnlfaWQ6IHJlcG9EYXRhLmlkLFxyXG4gICAgICAgICAgICBuYW1lOiBuYW1lXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgYWpheChcInVwZGF0ZVJlcG9zaXRvcnlcIiwgdXBkYXRlUmVwb3NpdG9yeVJlcXVlc3QsIChyZXNwb25zZTogVXBkYXRlUmVwb3NpdG9yeVJlc3BvbnNlKSA9PiB7XHJcblxyXG4gICAgICAgICAgICByZXBvRGF0YS5uYW1lID0gbmFtZTtcclxuICAgICAgICAgICAgcmVwb0RhdGEub3duZXJfaWQgPSBvd25lci51c2VyX2lkO1xyXG4gICAgICAgICAgICByZXBvRGF0YS5vd25lcl9uYW1lID0gb3duZXIuZmlyc3ROYW1lICsgXCIgXCIgKyBvd25lci5sYXN0TmFtZTtcclxuICAgICAgICAgICAgcmVwb0RhdGEub3duZXJfdXNlcm5hbWUgPSBvd25lci51c2VybmFtZTtcclxuICAgICAgICAgICAgcmVwb0RhdGEucHVibGlzaGVkX3RvID0gcHVibGlzaGVkX3RvO1xyXG4gICAgICAgICAgICByZXBvRGF0YS5kZXNjcmlwdGlvbiA9IHVwZGF0ZVJlcG9zaXRvcnlSZXF1ZXN0LmRlc2NyaXB0aW9uO1xyXG5cclxuICAgICAgICAgICAgLy8gdXBkYXRlIHVzZXIgd3JpdGUgYWNjZXNzOlxyXG5cclxuICAgICAgICAgICAgbGV0IHdyaXRlQWNjZXNzTGlzdDogUmVwb3NpdG9yeVVzZXJXcml0ZUFjY2Vzc0RhdGFbXSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgdGhhdC4kdXNlcmxpc3REaXYuZmluZCgnaW5wdXQnKS5lYWNoKChpbmRleCwgZWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0ICRlbGVtZW50ID0galF1ZXJ5KGVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgbGV0IHVzZXI6IFJlcG9zaXRvcnlVc2VyID0gPGFueT4kZWxlbWVudC5kYXRhKCd1c2VyJyk7XHJcbiAgICAgICAgICAgICAgICB3cml0ZUFjY2Vzc0xpc3QucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgaGFzX3dyaXRlX2FjY2VzczogPGFueT5qUXVlcnkoZWxlbWVudCkuaXMoJzpjaGVja2VkJyksXHJcbiAgICAgICAgICAgICAgICAgICAgdXNlcl9pZDogdXNlci51c2VyX2lkXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBsZXQgcmVxdWVzdDogVXBkYXRlUmVwb3NpdG9yeVVzZXJXcml0ZUFjY2Vzc1JlcXVlc3QgPSB7XHJcbiAgICAgICAgICAgICAgICByZXBvc2l0b3J5X2lkOiByZXBvRGF0YS5pZCxcclxuICAgICAgICAgICAgICAgIHdyaXRlQWNjZXNzTGlzdDogd3JpdGVBY2Nlc3NMaXN0XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGFqYXgoJ3VwZGF0ZVJlcG9zaXRvcnlVc2VyV3JpdGVBY2Nlc3MnLCByZXF1ZXN0LCAocmVzcG9uc2U6IFVwZGF0ZVJlcG9zaXRvcnlVc2VyV3JpdGVBY2Nlc3NSZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgYWxlcnQoJ0RpZSDDhG5kZXJ1bmdlbiB3dXJkZW4gZXJmb2xncmVpY2ggZ2VzcGVpY2hlcnQuJylcclxuICAgICAgICAgICAgICAgIHRoYXQuJHNhdmVCdXR0b24uaGlkZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuXHJcbiAgICB9XHJcblxyXG5cclxuICAgIGV4aXRCdXR0b25DbGlja2VkKCkge1xyXG4gICAgICAgIHdpbmRvdy5oaXN0b3J5LmJhY2soKTtcclxuICAgIH1cclxuXHJcblxyXG59Il19