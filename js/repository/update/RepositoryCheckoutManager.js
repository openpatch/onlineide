import { makeDiv, setSelectItems, getSelectedObject } from "../../tools/HtmlTools.js";
import { ajax } from "../../communication/AjaxHelper.js";
export class RepositoryCheckoutManager {
    constructor(main) {
        this.main = main;
        this.guiReady = false;
        this.filterbuttonOptions = ["alle", "private", "f端r die Klasse freigegebene", "f端r die Schule freigegebene"];
        this.repositories = [];
    }
    initGUI() {
        this.guiReady = true;
        let that = this;
        let $checkoutDiv = jQuery('#checkoutRepo-div');
        $checkoutDiv.append(this.$mainHeading = makeDiv('checkoutRepo-mainHeading', "createUpdateRepo-mainHeading", ""));
        this.$mainHeading.append(makeDiv("", "", "Checkout Repository - Workspace mit Repository verbinden"));
        this.$mainHeading.append(this.$exitButton = makeDiv("", "jo_synchro_button", "Zur端ck zum Programmieren", { "background-color": "var(--speedcontrol-grip)", "color": "var(--fontColorLight)", "font-size": "10pt" }));
        this.$exitButton.on("click", () => { that.exitButtonClicked(); });
        let $divBelow = makeDiv("checkoutRepo-divBelow");
        $checkoutDiv.append($divBelow);
        let $chooseWorkspaceDiv = makeDiv("", "checkoutRepo-chooseDiv");
        $divBelow.append($chooseWorkspaceDiv);
        $chooseWorkspaceDiv.append(makeDiv("", "checkoutRepo-minorHeading", "Diesen Worspace mit dem Repository verbinden:"));
        this.$workspaceDropdown = jQuery('<select></select>');
        $chooseWorkspaceDiv.append(this.$workspaceDropdown);
        let $codeDiv = makeDiv("", "checkoutRepo-chooseDiv");
        $divBelow.append($codeDiv);
        $codeDiv.append(makeDiv("", "checkoutRepo-minorHeading", "Alternativ zur Auswahl unten Eingabe eines Repository-Codes:"));
        this.$codeInput = jQuery('<input type="text"></input>');
        $codeDiv.append(this.$codeInput);
        this.$codeInput.on("input", (e) => {
            let text = that.$codeInput.val();
            if (text == '') {
                this.$repoListDiv.show();
            }
            else {
                this.$repoListDiv.hide();
            }
        });
        let $publishedToFilterDiv = makeDiv("", "checkoutRepo-chooseDiv");
        $divBelow.append($publishedToFilterDiv);
        $publishedToFilterDiv.append(makeDiv("", "checkoutRepo-minorHeading", "Diese Repositories anzeigen:"));
        this.$filterButtonDiv = jQuery('<fieldset></fieldset>');
        $publishedToFilterDiv.append(this.$filterButtonDiv);
        this.filterbuttonOptions.forEach((value, index) => {
            let $radioButton = jQuery(`<input type="radio" id="b${index}" name="publishedFilter" value="${index}" ${index == 0 ? "checked" : ""}>`);
            $radioButton.data('value', index);
            $radioButton.on("change", (e) => {
                that.showRepositories();
            });
            this.$filterButtonDiv.append($radioButton);
            this.$filterButtonDiv.append(jQuery(`<label for="b${index}">${value}</label>`));
        });
        let $inputFilterDiv = makeDiv("", "checkoutRepo-chooseDiv");
        $divBelow.append($inputFilterDiv);
        $inputFilterDiv.append(makeDiv("", "checkoutRepo-minorHeading", "Filter/Suche:"));
        this.$filterInput = jQuery('<input type="text"></input>');
        $inputFilterDiv.append(this.$filterInput);
        this.$filterInput.on("input", (e) => {
            that.showRepositories();
        });
        $divBelow.append(makeDiv('', 'updateRepo-minorHeading', 'Repositories:', { 'margin-bottom': '10px', 'margin-top': '20px' }));
        this.$repoListDiv = makeDiv('checkoutRepo-repoListDiv', 'jo_scrollable');
        $divBelow.append(this.$repoListDiv);
        let $buttonDiv = makeDiv("updateRepo-buttonDiv");
        $buttonDiv.append(this.$checkoutButton = makeDiv("", "jo_synchro_button", "Checkout", { "background-color": "var(--updateButtonBackground)", "color": "var(--updateButtonColor)" }));
        this.$checkoutButton.on("click", () => { that.checkoutButtonClicked(); });
        $divBelow.append($buttonDiv);
    }
    show(workspace) {
        if (!this.guiReady) {
            this.initGUI();
        }
        let $checkoutDiv = jQuery('#checkoutRepo-div');
        $checkoutDiv.css('visibility', 'visible');
        let $mainDiv = jQuery('#main');
        $mainDiv.css('visibility', 'hidden');
        let user = this.main.user;
        let grlq = {
            onlyOwnRepositories: false
        };
        this.$repoListDiv.empty();
        let that = this;
        ajax('getRepositoryList', grlq, (response) => {
            this.repositories = response.repositories;
            this.showRepositories();
        });
        // Init Workspace-Dropdown
        this.$workspaceDropdown.empty();
        setSelectItems(this.$workspaceDropdown, [{
                caption: "Neuen Workspace erstellen",
                object: null,
                value: -1
            }].concat(this.main.workspaceList.filter(ws => ws.repository_id == null && !ws.isFolder).map(ws => {
            return {
                caption: ws.name,
                object: ws,
                value: ws.id
            };
        })), -1);
        this.main.windowStateManager.registerOneTimeBackButtonListener(() => {
            that.hide();
        });
    }
    showRepositories() {
        let that = this;
        this.$repoListDiv.find('.checkoutRepo-repoListItem').remove();
        let published_to = this.$filterButtonDiv.find('input:checked').data('value') - 1;
        let filteredRepositories = published_to < 0 ? this.repositories :
            this.repositories.filter(repoInfo => repoInfo.published_to == published_to);
        let filterSearch = this.$filterInput.val();
        filterSearch = filterSearch.toLocaleLowerCase();
        if (filterSearch != "") {
            filteredRepositories = filteredRepositories.filter(repInfo => [repInfo.owner_username, repInfo.owner_name, repInfo.name, repInfo.description].join(" ").toLocaleLowerCase().indexOf(filterSearch) >= 0);
        }
        filteredRepositories.forEach(repInfo => {
            let $div = makeDiv('', 'checkoutRepo-repoListItem');
            let $divLeft = makeDiv('', 'checkoutRepo-repoListItemLeft');
            $div.append($divLeft);
            $divLeft.append(makeDiv('', 'checkoutRepo-repoListName', repInfo.name));
            $divLeft.append(makeDiv('', 'checkoutRepo-repoListOwner', repInfo.owner_name + " (" + repInfo.owner_username + ")"));
            let $divRight = makeDiv('', 'checkoutRepo-repoListItemRight', repInfo.description);
            $div.append($divRight);
            this.$repoListDiv.append($div);
            $div.data('repoInfo', repInfo);
            $div.on("click", () => {
                that.selectRepository($div, repInfo);
            });
        });
        this.selectFirstRepository();
    }
    selectRepository($repoDiv, repInfo) {
        this.$repoListDiv.find('.checkoutRepo-repoListItem').removeClass('active');
        if ($repoDiv != null) {
            $repoDiv.addClass('active');
        }
    }
    selectFirstRepository() {
        this.$repoListDiv.find('.checkoutRepo-repoListItem').removeClass('active');
        this.$repoListDiv.find('.checkoutRepo-repoListItem').first().addClass('active');
    }
    hide() {
        let $synchroDiv = jQuery('#checkoutRepo-div');
        $synchroDiv.css('visibility', 'hidden');
        let $mainDiv = jQuery('#main');
        $mainDiv.css('visibility', 'visible');
    }
    checkoutButtonClicked() {
        let repositoryId = -1;
        let secret = null;
        let combinedSecret = this.$codeInput.val();
        if (combinedSecret != "") {
            let tIndex = combinedSecret.indexOf('T');
            if (tIndex < 0) {
                alert("Der Code muss den Buchstaben T enthalten.");
                return;
            }
            let number = Number.parseInt(combinedSecret.substring(0, tIndex));
            if (number >= 0) {
                repositoryId = number;
                secret = combinedSecret.substring(tIndex + 1);
            }
            else {
                alert("Im Code muss vor dem T eine Zahl stehen.");
                return;
            }
        }
        else {
            let selectedItem = this.$repoListDiv.find('.active').first();
            let repoData = selectedItem.data('repoInfo');
            repositoryId = repoData.id;
        }
        let workspace = getSelectedObject(this.$workspaceDropdown);
        let request = {
            repository_id: repositoryId,
            createNewWorkspace: workspace == null,
            workspace_id: workspace == null ? null : workspace.id,
            secret: secret
        };
        let that = this;
        ajax('attachWorkspaceToRepository', request, (response) => {
            if (response.message != null) {
                alert(response.message);
                return;
            }
            if (workspace == null && response.new_workspace != null) {
                let newWorkspace = that.main.networkManager.createNewWorkspaceFromWorkspaceData(response.new_workspace);
                that.main.projectExplorer.workspaceListPanel.sortElements();
                setTimeout(() => {
                    that.main.projectExplorer.setWorkspaceActive(newWorkspace, true);
                }, 400);
                alert('Der neue Workspace ' + response.new_workspace.name + " wurde erfolgreich angelegt.");
            }
            else {
                workspace.repository_id = repositoryId;
                let explorer = that.main.projectExplorer;
                explorer.workspaceListPanel.setElementClass(workspace.panelElement, "repository");
                alert(`Der Workspace ${workspace.name} wurde erfolgreich mit dem Repository verkn端pft.`);
            }
            window.history.back();
        });
        // let updateRepositoryRequest: UpdateRepositoryRequest = {
        //     owner_id: owner.user_id,
        //     description: <string>this.$repoDescription.val(),
        //     published_to: published_to,
        //     repository_id: repoData.id
        // };
        // ajax("updateRepository", updateRepositoryRequest, (response: UpdateRepositoryResponse) => {
        //     //TODO: update user write access..
        // });
    }
    exitButtonClicked() {
        this.hide();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVwb3NpdG9yeUNoZWNrb3V0TWFuYWdlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jbGllbnQvcmVwb3NpdG9yeS91cGRhdGUvUmVwb3NpdG9yeUNoZWNrb3V0TWFuYWdlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUUsT0FBTyxFQUFjLGNBQWMsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRWxHLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztBQUt6RCxNQUFNLE9BQU8seUJBQXlCO0lBc0JsQyxZQUFtQixJQUFVO1FBQVYsU0FBSSxHQUFKLElBQUksQ0FBTTtRQXBCN0IsYUFBUSxHQUFZLEtBQUssQ0FBQztRQWExQix3QkFBbUIsR0FBRyxDQUFDLE1BQU0sRUFBRSxTQUFTLEVBQUUsNkJBQTZCLEVBQUUsNkJBQTZCLENBQUMsQ0FBQztRQUl4RyxpQkFBWSxHQUFxQixFQUFFLENBQUM7SUFJcEMsQ0FBQztJQUVELE9BQU87UUFDSCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUNyQixJQUFJLElBQUksR0FBRyxJQUFJLENBQUM7UUFDaEIsSUFBSSxZQUFZLEdBQUcsTUFBTSxDQUFDLG1CQUFtQixDQUFDLENBQUM7UUFFL0MsWUFBWSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxHQUFHLE9BQU8sQ0FBQywwQkFBMEIsRUFBRSw4QkFBOEIsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ2pILElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLDBEQUEwRCxDQUFDLENBQUMsQ0FBQztRQUN0RyxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBVyxHQUFHLE9BQU8sQ0FBQyxFQUFFLEVBQUUsbUJBQW1CLEVBQUUsMEJBQTBCLEVBQUUsRUFB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QVEsQ0FBQyxrQkFBa0IsQ0FBQyxlQUFlLENBQUMsU0FBUyxDQUFDLFlBQVksRUFBRSxZQUFZLENBQUMsQ0FBQztnQkFDbEYsS0FBSyxDQUFDLGlCQUFpQixTQUFTLENBQUMsSUFBSSxrREFBa0QsQ0FBQyxDQUFDO2FBRTVGO1lBRUQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUUxQixDQUFDLENBQUMsQ0FBQztRQUVILDJEQUEyRDtRQUMzRCwrQkFBK0I7UUFDL0Isd0RBQXdEO1FBQ3hELGtDQUFrQztRQUNsQyxpQ0FBaUM7UUFDakMsS0FBSztRQUVMLDhGQUE4RjtRQUU5Rix5Q0FBeUM7UUFHekMsTUFBTTtJQUlWLENBQUM7SUFHRCxpQkFBaUI7UUFDYixJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDaEIsQ0FBQztDQUdKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTWFpbiB9IGZyb20gXCIuLi8uLi9tYWluL01haW4uanNcIjtcclxuaW1wb3J0IHsgV29ya3NwYWNlIH0gZnJvbSBcIi4uLy4uL3dvcmtzcGFjZS9Xb3Jrc3BhY2UuanNcIjtcclxuaW1wb3J0IHsgbWFrZURpdiwgU2VsZWN0SXRlbSwgc2V0U2VsZWN0SXRlbXMsIGdldFNlbGVjdGVkT2JqZWN0IH0gZnJvbSBcIi4uLy4uL3Rvb2xzL0h0bWxUb29scy5qc1wiO1xyXG5pbXBvcnQgeyBSZXBvc2l0b3J5VXNlciwgR2V0UmVwb3NpdG9yeVJlcXVlc3QsIEdldFJlcG9zaXRvcnlSZXNwb25zZSwgR2V0UmVwb3NpdG9yeVVzZXJMaXN0UmVxdWVzdCwgR2V0UmVwb3NpdG9yeVVzZXJMaXN0UmVzcG9uc2UsIFVzZXJEYXRhLCBHZXRSZXBvc2l0b3J5TGlzdFJlcXVlc3QsIEdldFJlcG9zaXRvcnlMaXN0UmVzcG9uc2UsIFJlcG9zaXRvcnlJbmZvLCBVcGRhdGVSZXBvc2l0b3J5UmVxdWVzdCwgVXBkYXRlUmVwb3NpdG9yeVJlc3BvbnNlLCBBdHRhY2hXb3Jrc3BhY2VUb1JlcG9zaXRvcnlSZXF1ZXN0LCBXb3Jrc3BhY2VEYXRhLCBBdHRhY2hXb3Jrc3BhY2VUb1JlcG9zaXRvcnlSZXNwb25zZSB9IGZyb20gXCIuLi8uLi9jb21tdW5pY2F0aW9uL0RhdGEuanNcIjtcclxuaW1wb3J0IHsgYWpheCB9IGZyb20gXCIuLi8uLi9jb21tdW5pY2F0aW9uL0FqYXhIZWxwZXIuanNcIjtcclxuaW1wb3J0IHsgVGVhY2hlcnNXaXRoQ2xhc3Nlc01JIH0gZnJvbSBcIi4uLy4uL2FkbWluaXN0cmF0aW9uL1RlYWNoZXJzV2l0aENsYXNzZXMuanNcIjtcclxuaW1wb3J0IHsgUHJvamVjdEV4cGxvcmVyIH0gZnJvbSBcIi4uLy4uL21haW4vZ3VpL1Byb2plY3RFeHBsb3Jlci5qc1wiO1xyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBSZXBvc2l0b3J5Q2hlY2tvdXRNYW5hZ2VyIHtcclxuXHJcbiAgICBndWlSZWFkeTogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICAgICRtYWluSGVhZGluZzogSlF1ZXJ5PEhUTUxEaXZFbGVtZW50PjtcclxuXHJcbiAgICAkcmVwb0xpc3REaXY6IEpRdWVyeTxIVE1MRWxlbWVudD47XHJcblxyXG4gICAgJGV4aXRCdXR0b246IEpRdWVyeTxIVE1MRWxlbWVudD47XHJcbiAgICAkY2hlY2tvdXRCdXR0b246IEpRdWVyeTxIVE1MRWxlbWVudD47XHJcblxyXG4gICAgJHdvcmtzcGFjZURyb3Bkb3duOiBKUXVlcnk8SFRNTFNlbGVjdEVsZW1lbnQ+O1xyXG4gICAgJGZpbHRlckJ1dHRvbkRpdjogSlF1ZXJ5PEhUTUxFbGVtZW50PjtcclxuICAgICRmaWx0ZXJJbnB1dDogSlF1ZXJ5PEhUTUxJbnB1dEVsZW1lbnQ+O1xyXG5cclxuICAgIGZpbHRlcmJ1dHRvbk9wdGlvbnMgPSBbXCJhbGxlXCIsIFwicHJpdmF0ZVwiLCBcImbDvHIgZGllIEtsYXNzZSBmcmVpZ2VnZWJlbmVcIiwgXCJmw7xyIGRpZSBTY2h1bGUgZnJlaWdlZ2ViZW5lXCJdO1xyXG5cclxuICAgIHdvcmtzcGFjZTogV29ya3NwYWNlO1xyXG5cclxuICAgIHJlcG9zaXRvcmllczogUmVwb3NpdG9yeUluZm9bXSA9IFtdO1xyXG4gICAgJGNvZGVJbnB1dDogSlF1ZXJ5PEhUTUxFbGVtZW50PjtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgbWFpbjogTWFpbikge1xyXG4gICAgfVxyXG5cclxuICAgIGluaXRHVUkoKSB7XHJcbiAgICAgICAgdGhpcy5ndWlSZWFkeSA9IHRydWU7XHJcbiAgICAgICAgbGV0IHRoYXQgPSB0aGlzO1xyXG4gICAgICAgIGxldCAkY2hlY2tvdXREaXYgPSBqUXVlcnkoJyNjaGVja291dFJlcG8tZGl2Jyk7XHJcblxyXG4gICAgICAgICRjaGVja291dERpdi5hcHBlbmQodGhpcy4kbWFpbkhlYWRpbmcgPSBtYWtlRGl2KCdjaGVja291dFJlcG8tbWFpbkhlYWRpbmcnLCBcImNyZWF0ZVVwZGF0ZVJlcG8tbWFpbkhlYWRpbmdcIiwgXCJcIikpO1xyXG4gICAgICAgIHRoaXMuJG1haW5IZWFkaW5nLmFwcGVuZChtYWtlRGl2KFwiXCIsIFwiXCIsIFwiQ2hlY2tvdXQgUmVwb3NpdG9yeSAtIFdvcmtzcGFjZSBtaXQgUmVwb3NpdG9yeSB2ZXJiaW5kZW5cIikpO1xyXG4gICAgICAgIHRoaXMuJG1haW5IZWFkaW5nLmFwcGVuZCh0aGlzLiRleGl0QnV0dG9uID0gbWFrZURpdihcIlwiLCBcImpvX3N5bmNocm9fYnV0dG9uXCIsIFwiWnVyw7xjayB6dW0gUHJvZ3JhbW1pZXJlblwiLCB7IFwiYmFja2dyb3VuZC1jb2xvclwiOiBcInZhcigtLXNwZWVkY29udHJvbC1ncmlwKVwiLCBcImNvbG9yXCI6IFwidmFyKC0tZm9udENvbG9yTGlnaHQpXCIsIFwiZm9udC1zaXplXCI6IFwiMTBwdFwiIH0pKTtcclxuICAgICAgICB0aGlzLiRleGl0QnV0dG9uLm9uKFwiY2xpY2tcIiwgKCkgPT4geyB0aGF0LmV4aXRCdXR0b25DbGlja2VkKCkgfSlcclxuXHJcblxyXG4gICAgICAgIGxldCAkZGl2QmVsb3cgPSBtYWtlRGl2KFwiY2hlY2tvdXRSZXBvLWRpdkJlbG93XCIpO1xyXG4gICAgICAgICRjaGVja291dERpdi5hcHBlbmQoJGRpdkJlbG93KTtcclxuXHJcbiAgICAgICAgbGV0ICRjaG9vc2VXb3Jrc3BhY2VEaXYgPSBtYWtlRGl2KFwiXCIsIFwiY2hlY2tvdXRSZXBvLWNob29zZURpdlwiKTtcclxuICAgICAgICAkZGl2QmVsb3cuYXBwZW5kKCRjaG9vc2VXb3Jrc3BhY2VEaXYpO1xyXG4gICAgICAgICRjaG9vc2VXb3Jrc3BhY2VEaXYuYXBwZW5kKG1ha2VEaXYoXCJcIiwgXCJjaGVja291dFJlcG8tbWlub3JIZWFkaW5nXCIsIFwiRGllc2VuIFdvcnNwYWNlIG1pdCBkZW0gUmVwb3NpdG9yeSB2ZXJiaW5kZW46XCIpKTtcclxuICAgICAgICB0aGlzLiR3b3Jrc3BhY2VEcm9wZG93biA9IGpRdWVyeSgnPHNlbGVjdD48L3NlbGVjdD4nKTtcclxuICAgICAgICAkY2hvb3NlV29ya3NwYWNlRGl2LmFwcGVuZCh0aGlzLiR3b3Jrc3BhY2VEcm9wZG93bik7XHJcblxyXG4gICAgICAgIGxldCAkY29kZURpdiA9IG1ha2VEaXYoXCJcIiwgXCJjaGVja291dFJlcG8tY2hvb3NlRGl2XCIpO1xyXG4gICAgICAgICRkaXZCZWxvdy5hcHBlbmQoJGNvZGVEaXYpO1xyXG4gICAgICAgICRjb2RlRGl2LmFwcGVuZChtYWtlRGl2KFwiXCIsIFwiY2hlY2tvdXRSZXBvLW1pbm9ySGVhZGluZ1wiLCBcIkFsdGVybmF0aXYgenVyIEF1c3dhaGwgdW50ZW4gRWluZ2FiZSBlaW5lcyBSZXBvc2l0b3J5LUNvZGVzOlwiKSk7XHJcbiAgICAgICAgdGhpcy4kY29kZUlucHV0ID0galF1ZXJ5KCc8aW5wdXQgdHlwZT1cInRleHRcIj48L2lucHV0PicpO1xyXG4gICAgICAgICRjb2RlRGl2LmFwcGVuZCh0aGlzLiRjb2RlSW5wdXQpO1xyXG5cclxuICAgICAgICB0aGlzLiRjb2RlSW5wdXQub24oXCJpbnB1dFwiLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgdGV4dCA9IHRoYXQuJGNvZGVJbnB1dC52YWwoKTtcclxuICAgICAgICAgICAgaWYodGV4dCA9PSAnJyl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLiRyZXBvTGlzdERpdi5zaG93KCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLiRyZXBvTGlzdERpdi5oaWRlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgbGV0ICRwdWJsaXNoZWRUb0ZpbHRlckRpdiA9IG1ha2VEaXYoXCJcIiwgXCJjaGVja291dFJlcG8tY2hvb3NlRGl2XCIpO1xyXG4gICAgICAgICRkaXZCZWxvdy5hcHBlbmQoJHB1Ymxpc2hlZFRvRmlsdGVyRGl2KTtcclxuICAgICAgICAkcHVibGlzaGVkVG9GaWx0ZXJEaXYuYXBwZW5kKG1ha2VEaXYoXCJcIiwgXCJjaGVja291dFJlcG8tbWlub3JIZWFkaW5nXCIsIFwiRGllc2UgUmVwb3NpdG9yaWVzIGFuemVpZ2VuOlwiKSk7XHJcbiAgICAgICAgdGhpcy4kZmlsdGVyQnV0dG9uRGl2ID0galF1ZXJ5KCc8ZmllbGRzZXQ+PC9maWVsZHNldD4nKTtcclxuICAgICAgICAkcHVibGlzaGVkVG9GaWx0ZXJEaXYuYXBwZW5kKHRoaXMuJGZpbHRlckJ1dHRvbkRpdik7XHJcblxyXG4gICAgICAgIHRoaXMuZmlsdGVyYnV0dG9uT3B0aW9ucy5mb3JFYWNoKCh2YWx1ZSwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgbGV0ICRyYWRpb0J1dHRvbiA9IGpRdWVyeShgPGlucHV0IHR5cGU9XCJyYWRpb1wiIGlkPVwiYiR7aW5kZXh9XCIgbmFtZT1cInB1Ymxpc2hlZEZpbHRlclwiIHZhbHVlPVwiJHtpbmRleH1cIiAke2luZGV4ID09IDAgPyBcImNoZWNrZWRcIiA6IFwiXCJ9PmApO1xyXG4gICAgICAgICAgICAkcmFkaW9CdXR0b24uZGF0YSgndmFsdWUnLCBpbmRleCk7XHJcbiAgICAgICAgICAgICRyYWRpb0J1dHRvbi5vbihcImNoYW5nZVwiLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhhdC5zaG93UmVwb3NpdG9yaWVzKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIHRoaXMuJGZpbHRlckJ1dHRvbkRpdi5hcHBlbmQoJHJhZGlvQnV0dG9uKTtcclxuICAgICAgICAgICAgdGhpcy4kZmlsdGVyQnV0dG9uRGl2LmFwcGVuZChqUXVlcnkoYDxsYWJlbCBmb3I9XCJiJHtpbmRleH1cIj4ke3ZhbHVlfTwvbGFiZWw+YCkpO1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIGxldCAkaW5wdXRGaWx0ZXJEaXYgPSBtYWtlRGl2KFwiXCIsIFwiY2hlY2tvdXRSZXBvLWNob29zZURpdlwiKTtcclxuICAgICAgICAkZGl2QmVsb3cuYXBwZW5kKCRpbnB1dEZpbHRlckRpdik7XHJcbiAgICAgICAgJGlucHV0RmlsdGVyRGl2LmFwcGVuZChtYWtlRGl2KFwiXCIsIFwiY2hlY2tvdXRSZXBvLW1pbm9ySGVhZGluZ1wiLCBcIkZpbHRlci9TdWNoZTpcIikpO1xyXG4gICAgICAgIHRoaXMuJGZpbHRlcklucHV0ID0galF1ZXJ5KCc8aW5wdXQgdHlwZT1cInRleHRcIj48L2lucHV0PicpO1xyXG4gICAgICAgICRpbnB1dEZpbHRlckRpdi5hcHBlbmQodGhpcy4kZmlsdGVySW5wdXQpO1xyXG5cclxuICAgICAgICB0aGlzLiRmaWx0ZXJJbnB1dC5vbihcImlucHV0XCIsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIHRoYXQuc2hvd1JlcG9zaXRvcmllcygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkZGl2QmVsb3cuYXBwZW5kKG1ha2VEaXYoJycsICd1cGRhdGVSZXBvLW1pbm9ySGVhZGluZycsICdSZXBvc2l0b3JpZXM6JywgeydtYXJnaW4tYm90dG9tJzogJzEwcHgnLCAnbWFyZ2luLXRvcCc6ICcyMHB4J30pKTtcclxuXHJcbiAgICAgICAgdGhpcy4kcmVwb0xpc3REaXYgPSBtYWtlRGl2KCdjaGVja291dFJlcG8tcmVwb0xpc3REaXYnLCAnam9fc2Nyb2xsYWJsZScpO1xyXG4gICAgICAgICRkaXZCZWxvdy5hcHBlbmQodGhpcy4kcmVwb0xpc3REaXYpO1xyXG5cclxuICAgICAgICBsZXQgJGJ1dHRvbkRpdiA9IG1ha2VEaXYoXCJ1cGRhdGVSZXBvLWJ1dHRvbkRpdlwiKTtcclxuXHJcbiAgICAgICAgJGJ1dHRvbkRpdi5hcHBlbmQodGhpcy4kY2hlY2tvdXRCdXR0b24gPSBtYWtlRGl2KFwiXCIsIFwiam9fc3luY2hyb19idXR0b25cIiwgXCJDaGVja291dFwiLCB7IFwiYmFja2dyb3VuZC1jb2xvclwiOiBcInZhcigtLXVwZGF0ZUJ1dHRvbkJhY2tncm91bmQpXCIsIFwiY29sb3JcIjogXCJ2YXIoLS11cGRhdGVCdXR0b25Db2xvcilcIiB9KSk7XHJcbiAgICAgICAgdGhpcy4kY2hlY2tvdXRCdXR0b24ub24oXCJjbGlja1wiLCAoKSA9PiB7IHRoYXQuY2hlY2tvdXRCdXR0b25DbGlja2VkKCkgfSlcclxuXHJcbiAgICAgICAgJGRpdkJlbG93LmFwcGVuZCgkYnV0dG9uRGl2KTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgc2hvdyh3b3Jrc3BhY2U6IFdvcmtzcGFjZSkge1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuZ3VpUmVhZHkpIHtcclxuICAgICAgICAgICAgdGhpcy5pbml0R1VJKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgJGNoZWNrb3V0RGl2ID0galF1ZXJ5KCcjY2hlY2tvdXRSZXBvLWRpdicpO1xyXG4gICAgICAgICRjaGVja291dERpdi5jc3MoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpO1xyXG4gICAgICAgIGxldCAkbWFpbkRpdiA9IGpRdWVyeSgnI21haW4nKTtcclxuICAgICAgICAkbWFpbkRpdi5jc3MoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XHJcblxyXG4gICAgICAgIGxldCB1c2VyID0gdGhpcy5tYWluLnVzZXI7XHJcblxyXG4gICAgICAgIGxldCBncmxxOiBHZXRSZXBvc2l0b3J5TGlzdFJlcXVlc3QgPSB7XHJcbiAgICAgICAgICAgIG9ubHlPd25SZXBvc2l0b3JpZXM6IGZhbHNlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLiRyZXBvTGlzdERpdi5lbXB0eSgpO1xyXG4gICAgICAgIGxldCB0aGF0ID0gdGhpcztcclxuICAgICAgICBhamF4KCdnZXRSZXBvc2l0b3J5TGlzdCcsIGdybHEsIChyZXNwb25zZTogR2V0UmVwb3NpdG9yeUxpc3RSZXNwb25zZSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgdGhpcy5yZXBvc2l0b3JpZXMgPSByZXNwb25zZS5yZXBvc2l0b3JpZXM7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNob3dSZXBvc2l0b3JpZXMoKTtcclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIEluaXQgV29ya3NwYWNlLURyb3Bkb3duXHJcbiAgICAgICAgdGhpcy4kd29ya3NwYWNlRHJvcGRvd24uZW1wdHkoKTtcclxuICAgICAgICBzZXRTZWxlY3RJdGVtcyh0aGlzLiR3b3Jrc3BhY2VEcm9wZG93biwgW3tcclxuICAgICAgICAgICAgY2FwdGlvbjogXCJOZXVlbiBXb3Jrc3BhY2UgZXJzdGVsbGVuXCIsXHJcbiAgICAgICAgICAgIG9iamVjdDogbnVsbCxcclxuICAgICAgICAgICAgdmFsdWU6IC0xXHJcbiAgICAgICAgfV0uY29uY2F0KHRoaXMubWFpbi53b3Jrc3BhY2VMaXN0LmZpbHRlcih3cyA9PiB3cy5yZXBvc2l0b3J5X2lkID09IG51bGwgJiYgIXdzLmlzRm9sZGVyKS5tYXAod3MgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgY2FwdGlvbjogd3MubmFtZSxcclxuICAgICAgICAgICAgICAgIG9iamVjdDogd3MsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogd3MuaWRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pKVxyXG4gICAgICAgICwgLTEpO1xyXG5cclxuICAgICAgICB0aGlzLm1haW4ud2luZG93U3RhdGVNYW5hZ2VyLnJlZ2lzdGVyT25lVGltZUJhY2tCdXR0b25MaXN0ZW5lcigoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoYXQuaGlkZSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuXHJcblxyXG4gICAgc2hvd1JlcG9zaXRvcmllcygpe1xyXG5cclxuICAgICAgICBsZXQgdGhhdCA9IHRoaXM7XHJcblxyXG4gICAgICAgIHRoaXMuJHJlcG9MaXN0RGl2LmZpbmQoJy5jaGVja291dFJlcG8tcmVwb0xpc3RJdGVtJykucmVtb3ZlKCk7XHJcblxyXG4gICAgICAgIGxldCBwdWJsaXNoZWRfdG8gPSB0aGlzLiRmaWx0ZXJCdXR0b25EaXYuZmluZCgnaW5wdXQ6Y2hlY2tlZCcpLmRhdGEoJ3ZhbHVlJykgLSAxO1xyXG5cclxuICAgICAgICBsZXQgZmlsdGVyZWRSZXBvc2l0b3JpZXM6IFJlcG9zaXRvcnlJbmZvW10gPSBwdWJsaXNoZWRfdG8gPCAwID8gdGhpcy5yZXBvc2l0b3JpZXMgOlxyXG4gICAgICAgICAgICB0aGlzLnJlcG9zaXRvcmllcy5maWx0ZXIocmVwb0luZm8gPT4gcmVwb0luZm8ucHVibGlzaGVkX3RvID09IHB1Ymxpc2hlZF90byk7XHJcblxyXG4gICAgICAgIGxldCBmaWx0ZXJTZWFyY2g6IHN0cmluZyA9IDxzdHJpbmc+dGhpcy4kZmlsdGVySW5wdXQudmFsKCk7XHJcbiAgICAgICAgZmlsdGVyU2VhcmNoID0gZmlsdGVyU2VhcmNoLnRvTG9jYWxlTG93ZXJDYXNlKCk7XHJcblxyXG4gICAgICAgIGlmKGZpbHRlclNlYXJjaCAhPSBcIlwiKXtcclxuICAgICAgICAgICAgZmlsdGVyZWRSZXBvc2l0b3JpZXMgPSBmaWx0ZXJlZFJlcG9zaXRvcmllcy5maWx0ZXIoXHJcbiAgICAgICAgICAgICAgICByZXBJbmZvID0+IFtyZXBJbmZvLm93bmVyX3VzZXJuYW1lICwgcmVwSW5mby5vd25lcl9uYW1lICwgcmVwSW5mby5uYW1lICwgcmVwSW5mby5kZXNjcmlwdGlvbl0uam9pbihcIiBcIikudG9Mb2NhbGVMb3dlckNhc2UoKS5pbmRleE9mKGZpbHRlclNlYXJjaCkgPj0gMFxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmaWx0ZXJlZFJlcG9zaXRvcmllcy5mb3JFYWNoKHJlcEluZm8gPT4ge1xyXG4gICAgICAgICAgICBsZXQgJGRpdiA9IG1ha2VEaXYoJycsICdjaGVja291dFJlcG8tcmVwb0xpc3RJdGVtJyk7XHJcbiAgICAgICAgICAgIGxldCAkZGl2TGVmdCA9IG1ha2VEaXYoJycsICdjaGVja291dFJlcG8tcmVwb0xpc3RJdGVtTGVmdCcpO1xyXG4gICAgICAgICAgICAkZGl2LmFwcGVuZCgkZGl2TGVmdCk7XHJcblxyXG4gICAgICAgICAgICAkZGl2TGVmdC5hcHBlbmQobWFrZURpdignJywgJ2NoZWNrb3V0UmVwby1yZXBvTGlzdE5hbWUnLCByZXBJbmZvLm5hbWUpKTtcclxuICAgICAgICAgICAgJGRpdkxlZnQuYXBwZW5kKG1ha2VEaXYoJycsICdjaGVja291dFJlcG8tcmVwb0xpc3RPd25lcicsIHJlcEluZm8ub3duZXJfbmFtZSArIFwiIChcIiArIHJlcEluZm8ub3duZXJfdXNlcm5hbWUgKyBcIilcIikpO1xyXG5cclxuICAgICAgICAgICAgbGV0ICRkaXZSaWdodCA9IG1ha2VEaXYoJycsICdjaGVja291dFJlcG8tcmVwb0xpc3RJdGVtUmlnaHQnLCByZXBJbmZvLmRlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgJGRpdi5hcHBlbmQoJGRpdlJpZ2h0KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuJHJlcG9MaXN0RGl2LmFwcGVuZCgkZGl2KTtcclxuICAgICAgICAgICAgJGRpdi5kYXRhKCdyZXBvSW5mbycsIHJlcEluZm8pO1xyXG4gICAgICAgICAgICAkZGl2Lm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhhdC5zZWxlY3RSZXBvc2l0b3J5KCRkaXYsIHJlcEluZm8pO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLnNlbGVjdEZpcnN0UmVwb3NpdG9yeSgpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBzZWxlY3RSZXBvc2l0b3J5KCRyZXBvRGl2OiBKUXVlcnk8SFRNTERpdkVsZW1lbnQ+LCByZXBJbmZvOiBSZXBvc2l0b3J5SW5mbykge1xyXG4gICAgICAgIHRoaXMuJHJlcG9MaXN0RGl2LmZpbmQoJy5jaGVja291dFJlcG8tcmVwb0xpc3RJdGVtJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgIGlmKCRyZXBvRGl2ICE9IG51bGwpe1xyXG4gICAgICAgICAgICAkcmVwb0Rpdi5hZGRDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNlbGVjdEZpcnN0UmVwb3NpdG9yeSgpe1xyXG4gICAgICAgIHRoaXMuJHJlcG9MaXN0RGl2LmZpbmQoJy5jaGVja291dFJlcG8tcmVwb0xpc3RJdGVtJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgIHRoaXMuJHJlcG9MaXN0RGl2LmZpbmQoJy5jaGVja291dFJlcG8tcmVwb0xpc3RJdGVtJykuZmlyc3QoKS5hZGRDbGFzcygnYWN0aXZlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgaGlkZSgpIHtcclxuICAgICAgICBsZXQgJHN5bmNocm9EaXYgPSBqUXVlcnkoJyNjaGVja291dFJlcG8tZGl2Jyk7XHJcbiAgICAgICAgJHN5bmNocm9EaXYuY3NzKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xyXG4gICAgICAgIGxldCAkbWFpbkRpdiA9IGpRdWVyeSgnI21haW4nKTtcclxuICAgICAgICAkbWFpbkRpdi5jc3MoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpO1xyXG4gICAgfVxyXG5cclxuICAgIGNoZWNrb3V0QnV0dG9uQ2xpY2tlZCgpIHtcclxuXHJcbiAgICAgICAgbGV0IHJlcG9zaXRvcnlJZDogbnVtYmVyID0gLTE7XHJcbiAgICAgICAgbGV0IHNlY3JldDogc3RyaW5nID0gbnVsbDtcclxuXHJcbiAgICAgICAgbGV0IGNvbWJpbmVkU2VjcmV0ID0gPHN0cmluZz50aGlzLiRjb2RlSW5wdXQudmFsKCk7XHJcbiAgICAgICAgaWYoY29tYmluZWRTZWNyZXQgIT0gXCJcIil7XHJcbiAgICAgICAgICAgIGxldCB0SW5kZXggPSBjb21iaW5lZFNlY3JldC5pbmRleE9mKCdUJyk7XHJcbiAgICAgICAgICAgIGlmKHRJbmRleCA8IDApe1xyXG4gICAgICAgICAgICAgICAgYWxlcnQoXCJEZXIgQ29kZSBtdXNzIGRlbiBCdWNoc3RhYmVuIFQgZW50aGFsdGVuLlwiKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsZXQgbnVtYmVyID0gTnVtYmVyLnBhcnNlSW50KGNvbWJpbmVkU2VjcmV0LnN1YnN0cmluZygwLCB0SW5kZXgpKTtcclxuICAgICAgICAgICAgaWYobnVtYmVyID49IDApe1xyXG4gICAgICAgICAgICAgICAgcmVwb3NpdG9yeUlkID0gbnVtYmVyO1xyXG4gICAgICAgICAgICAgICAgc2VjcmV0ID0gY29tYmluZWRTZWNyZXQuc3Vic3RyaW5nKHRJbmRleCArIDEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYWxlcnQgKFwiSW0gQ29kZSBtdXNzIHZvciBkZW0gVCBlaW5lIFphaGwgc3RlaGVuLlwiKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGxldCBzZWxlY3RlZEl0ZW0gPSB0aGlzLiRyZXBvTGlzdERpdi5maW5kKCcuYWN0aXZlJykuZmlyc3QoKTtcclxuICAgICAgICAgICAgbGV0IHJlcG9EYXRhOiBSZXBvc2l0b3J5SW5mbyA9IDxhbnk+c2VsZWN0ZWRJdGVtLmRhdGEoJ3JlcG9JbmZvJyk7XHJcbiAgICAgICAgICAgIHJlcG9zaXRvcnlJZCA9IHJlcG9EYXRhLmlkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IHdvcmtzcGFjZTogV29ya3NwYWNlID0gZ2V0U2VsZWN0ZWRPYmplY3QodGhpcy4kd29ya3NwYWNlRHJvcGRvd24pO1xyXG5cclxuICAgICAgICBsZXQgcmVxdWVzdDogQXR0YWNoV29ya3NwYWNlVG9SZXBvc2l0b3J5UmVxdWVzdCA9IHtcclxuICAgICAgICAgICAgcmVwb3NpdG9yeV9pZDogcmVwb3NpdG9yeUlkLFxyXG4gICAgICAgICAgICBjcmVhdGVOZXdXb3Jrc3BhY2U6IHdvcmtzcGFjZSA9PSBudWxsLFxyXG4gICAgICAgICAgICB3b3Jrc3BhY2VfaWQ6IHdvcmtzcGFjZSA9PSBudWxsID8gbnVsbCA6IHdvcmtzcGFjZS5pZCxcclxuICAgICAgICAgICAgc2VjcmV0OiBzZWNyZXRcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCB0aGF0ID0gdGhpcztcclxuICAgICAgICBhamF4KCdhdHRhY2hXb3Jrc3BhY2VUb1JlcG9zaXRvcnknLCByZXF1ZXN0LCAocmVzcG9uc2U6IEF0dGFjaFdvcmtzcGFjZVRvUmVwb3NpdG9yeVJlc3BvbnNlKSA9PiB7XHJcblxyXG4gICAgICAgICAgICBpZihyZXNwb25zZS5tZXNzYWdlICE9IG51bGwpe1xyXG4gICAgICAgICAgICAgICAgYWxlcnQocmVzcG9uc2UubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmKHdvcmtzcGFjZSA9PSBudWxsICYmIHJlc3BvbnNlLm5ld193b3Jrc3BhY2UgIT0gbnVsbCl7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IG5ld1dvcmtzcGFjZSA9IHRoYXQubWFpbi5uZXR3b3JrTWFuYWdlci5jcmVhdGVOZXdXb3Jrc3BhY2VGcm9tV29ya3NwYWNlRGF0YShyZXNwb25zZS5uZXdfd29ya3NwYWNlKTtcclxuICAgICAgICAgICAgICAgIHRoYXQubWFpbi5wcm9qZWN0RXhwbG9yZXIud29ya3NwYWNlTGlzdFBhbmVsLnNvcnRFbGVtZW50cygpO1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5tYWluLnByb2plY3RFeHBsb3Jlci5zZXRXb3Jrc3BhY2VBY3RpdmUobmV3V29ya3NwYWNlLCB0cnVlKTsgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfSwgNDAwKTtcclxuXHJcbiAgICAgICAgICAgICAgICBhbGVydCgnRGVyIG5ldWUgV29ya3NwYWNlICcgKyByZXNwb25zZS5uZXdfd29ya3NwYWNlLm5hbWUgKyBcIiB3dXJkZSBlcmZvbGdyZWljaCBhbmdlbGVndC5cIik7XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgIHdvcmtzcGFjZS5yZXBvc2l0b3J5X2lkID0gcmVwb3NpdG9yeUlkO1xyXG4gICAgICAgICAgICAgICAgbGV0IGV4cGxvcmVyID0gdGhhdC5tYWluLnByb2plY3RFeHBsb3JlcjtcclxuICAgICAgICAgICAgICAgIGV4cGxvcmVyLndvcmtzcGFjZUxpc3RQYW5lbC5zZXRFbGVtZW50Q2xhc3Mod29ya3NwYWNlLnBhbmVsRWxlbWVudCwgXCJyZXBvc2l0b3J5XCIpO1xyXG4gICAgICAgICAgICAgICAgYWxlcnQoYERlciBXb3Jrc3BhY2UgJHt3b3Jrc3BhY2UubmFtZX0gd3VyZGUgZXJmb2xncmVpY2ggbWl0IGRlbSBSZXBvc2l0b3J5IHZlcmtuw7xwZnQuYCk7XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBsZXQgdXBkYXRlUmVwb3NpdG9yeVJlcXVlc3Q6IFVwZGF0ZVJlcG9zaXRvcnlSZXF1ZXN0ID0ge1xyXG4gICAgICAgIC8vICAgICBvd25lcl9pZDogb3duZXIudXNlcl9pZCxcclxuICAgICAgICAvLyAgICAgZGVzY3JpcHRpb246IDxzdHJpbmc+dGhpcy4kcmVwb0Rlc2NyaXB0aW9uLnZhbCgpLFxyXG4gICAgICAgIC8vICAgICBwdWJsaXNoZWRfdG86IHB1Ymxpc2hlZF90byxcclxuICAgICAgICAvLyAgICAgcmVwb3NpdG9yeV9pZDogcmVwb0RhdGEuaWRcclxuICAgICAgICAvLyB9O1xyXG5cclxuICAgICAgICAvLyBhamF4KFwidXBkYXRlUmVwb3NpdG9yeVwiLCB1cGRhdGVSZXBvc2l0b3J5UmVxdWVzdCwgKHJlc3BvbnNlOiBVcGRhdGVSZXBvc2l0b3J5UmVzcG9uc2UpID0+IHtcclxuXHJcbiAgICAgICAgLy8gICAgIC8vVE9ETzogdXBkYXRlIHVzZXIgd3JpdGUgYWNjZXNzLi5cclxuXHJcblxyXG4gICAgICAgIC8vIH0pO1xyXG5cclxuXHJcblxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBleGl0QnV0dG9uQ2xpY2tlZCgpIHtcclxuICAgICAgICB0aGlzLmhpZGUoKTtcclxuICAgIH1cclxuXHJcblxyXG59Il19