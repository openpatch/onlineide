import { makeDiv, setSelectItems, getSelectedObject } from "../../tools/HtmlTools.js";
import { ajax } from "../../communication/AjaxHelper.js";
export class RepositoryUpdateManager {
    constructor(main) {
        this.main = main;
        this.guiReady = false;
        this.publishedToItems = [
            { value: 0, object: 0, caption: "Keine Veröffentlichung (privates Repository)" },
            { value: 1, object: 1, caption: "Veröffentlicht für alls Schüler/innen der Klasse" },
            { value: 2, object: 2, caption: "Veröffentlicht für alls Schüler/innen der Schule" },
        ];
        this.repositoryOwnerItems = [];
        this.users = [];
    }
    initGUI() {
        this.guiReady = true;
        let that = this;
        let $updateDiv = jQuery('#updateRepo-div');
        $updateDiv.append(this.$mainHeading = makeDiv('updateRepo-mainHeading', "createUpdateRepo-mainHeading", ""));
        this.$mainHeading.append(makeDiv("", "", "Repositories verwalten"));
        this.$mainHeading.append(this.$exitButton = makeDiv("", "jo_synchro_button", "Zurück zum Programmieren", { "background-color": "var(--cancelButtonBackground)", "color": "var(--cancelButtonColor)", "font-size": "10pt" }));
        this.$exitButton.on("click", () => { that.exitButtonClicked(); });
        let $divBelow = makeDiv("updateRepo-divBelow");
        $updateDiv.append($divBelow);
        let $divLeft = makeDiv("updateRepo-divLeft");
        $divBelow.append($divLeft);
        $divLeft.append(makeDiv('', 'updateRepo-minorHeading', 'Repositories:'));
        this.$repoListDiv = makeDiv("updateRepo-repoListDiv");
        $divLeft.append(this.$repoListDiv);
        let $rightDiv = makeDiv("updateRepo-divRight");
        $divBelow.append($rightDiv);
        let $settingsDiv = makeDiv("", "createUpdateRepo-settingsDiv");
        $rightDiv.append($settingsDiv);
        $settingsDiv.append(jQuery('<div class="createUpdateRepo-settingsLabel">Name des Repositorys:</div>'));
        $settingsDiv.append(this.$repoName = jQuery('<input type="text" class="createUpdateRepo-inputcolumn"></input>'));
        $settingsDiv.append(jQuery('<div class="createUpdateRepo-settingsLabel">Beschreibung:</div>'));
        $settingsDiv.append(this.$repoDescription = jQuery('<textarea class="createUpdateRepo-inputcolumn" style="min-height: 4em"></textarea>'));
        $settingsDiv.append(jQuery('<div class="createUpdateRepo-settingsLabel">Veröffentlicht für:</div>'));
        $settingsDiv.append(this.$repoPublishedTo = jQuery('<select class="createUpdateRepo-inputcolumn"></select>'));
        setSelectItems(this.$repoPublishedTo, this.publishedToItems);
        $settingsDiv.append(jQuery('<div class="createUpdateRepo-settingsLabel">Eigentümer:</div>'));
        $settingsDiv.append(this.$repoOwner = jQuery('<select class="createUpdateRepo-inputcolumn"></select>'));
        $settingsDiv.append(this.$userlistDiv = makeDiv("updateRepo-userlistDiv"));
        this.$userlistDiv.append(makeDiv(null, "updateRepo-userlistheading", "Benutzer, die das Repository nutzen", { "grid-column": 1 }));
        this.$userlistDiv.append(makeDiv(null, "updateRepo-userlistheading", "Schreibberechtigung", { "grid-column": 2 }));
        $rightDiv.append(this.$userlistDiv);
        let $buttonDiv = makeDiv("updateRepo-buttonDiv");
        $buttonDiv.append(this.$saveButton = makeDiv("", "jo_synchro_button", "Änderungen speichern", { "background-color": "var(--updateButtonBackground)", "color": "var(--updateButtonColor)" }));
        this.$saveButton.on("click", () => { that.saveButtonClicked(); });
        $rightDiv.append($buttonDiv);
    }
    show(repository_id) {
        if (!this.guiReady) {
            this.initGUI();
        }
        let $synchroDiv = jQuery('#updateRepo-div');
        $synchroDiv.css('visibility', 'visible');
        let $mainDiv = jQuery('#main');
        $mainDiv.css('visibility', 'hidden');
        let user = this.main.user;
        this.$saveButton.show();
        let grlq = {
            onlyOwnRepositories: true
        };
        this.$repoListDiv.empty();
        let that = this;
        ajax('getRepositoryList', grlq, (response) => {
            let $firstDiv;
            let firstRepInfo;
            response.repositories.forEach(repInfo => {
                let $div = makeDiv('', 'updateRepo-repoListItem', repInfo.name);
                this.$repoListDiv.append($div);
                $div.on('click', (e) => {
                    that.selectRepository($div, repInfo);
                });
                $div.data('repoInfo', repInfo);
                if (firstRepInfo == null) {
                    firstRepInfo = repInfo;
                    $firstDiv = $div;
                }
            });
            if ($firstDiv != null) {
                this.selectRepository($firstDiv, firstRepInfo);
            }
        });
    }
    selectRepository($repoDiv, repInfo) {
        this.$repoListDiv.find('.updateRepo-repoListItem').removeClass('active');
        $repoDiv.addClass('active');
        this.$repoName.val(repInfo.name);
        this.$repoDescription.val(repInfo.description);
        this.$repoPublishedTo.val(repInfo.published_to);
        this.$repoOwner.empty();
        this.$userlistDiv.not('.updateRepo-userlistheading').remove();
        let req = { repository_id: repInfo.id };
        let that = this;
        ajax('getRepositoryUserList', req, (response) => {
            response.repositoryUserList.forEach(userData => {
                let $userDiv = makeDiv("", "updateRepo-userDiv", `${userData.firstName} ${userData.lastName} (${userData.username})`, { 'grid-column': 1 });
                let $canWriteDiv = makeDiv("", "canWriteDiv", "", { 'grid-column': 2 });
                let $canWriteCheckBox = jQuery('<input type="checkbox">');
                $canWriteDiv.append($canWriteCheckBox);
                //@ts-ignore
                $canWriteCheckBox.attr('checked', userData.canWrite);
                $canWriteCheckBox.data('user', userData);
                that.$userlistDiv.append($userDiv, $canWriteDiv);
            });
            that.$repoOwner.empty();
            setSelectItems(that.$repoOwner, response.repositoryUserList.map(userData => {
                let se = {
                    caption: `${userData.firstName} ${userData.lastName} (${userData.username})`,
                    object: userData,
                    value: userData.user_id + ""
                };
                return se;
            }));
        });
    }
    hide() {
        let $synchroDiv = jQuery('#updateRepo-div');
        $synchroDiv.css('visibility', 'hidden');
        let $mainDiv = jQuery('#main');
        $mainDiv.css('visibility', 'visible');
    }
    saveButtonClicked() {
        let selectedItem = this.$repoListDiv.find('.active').first();
        let repoData = selectedItem.data('repoInfo');
        let owner = getSelectedObject(this.$repoOwner);
        let published_to = getSelectedObject(this.$repoPublishedTo);
        let updateRepositoryRequest = {
            owner_id: owner.user_id,
            description: this.$repoDescription.val(),
            published_to: published_to,
            repository_id: repoData.id
        };
        ajax("updateRepository", updateRepositoryRequest, (response) => {
            //TODO: update user write access..
        });
    }
    exitButtonClicked() {
        this.hide();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVwb3NpdG9yeVVwZGF0ZU1hbmFnZXIgY29weS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jbGllbnQvcmVwb3NpdG9yeS91cGRhdGUvUmVwb3NpdG9yeVVwZGF0ZU1hbmFnZXIgY29weS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUUsT0FBTyxFQUFjLGNBQWMsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRWxHLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztBQUt6RCxNQUFNLE9BQU8sdUJBQXVCO0lBK0JoQyxZQUFtQixJQUFVO1FBQVYsU0FBSSxHQUFKLElBQUksQ0FBTTtRQTdCN0IsYUFBUSxHQUFZLEtBQUssQ0FBQztRQWlCMUIscUJBQWdCLEdBQWlCO1lBQzdCLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSw4Q0FBOEMsRUFBRTtZQUNoRixFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsa0RBQWtELEVBQUU7WUFDcEYsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLGtEQUFrRCxFQUFFO1NBQ3ZGLENBQUM7UUFFRix5QkFBb0IsR0FBaUIsRUFBRSxDQUFDO1FBRXhDLFVBQUssR0FBcUIsRUFBRSxDQUFDO0lBSzdCLENBQUM7SUFFRCxPQUFPO1FBQ0gsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFDckIsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLElBQUksVUFBVSxHQUFHLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBRTNDLFVBQVUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksR0FBRyxPQUFPLENBQUMsd0JBQXdCLEVBQUUsOEJBQThCLEVBQUUs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RUFBRSxDQUFDO1FBQzdELElBQUksUUFBUSxHQUF3QixZQUFZLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRWxFLElBQUksS0FBSyxHQUFtQixpQkFBaUIsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDL0QsSUFBSSxZQUFZLEdBQVcsaUJBQWlCLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFFcEUsSUFBSSx1QkFBdUIsR0FBNEI7WUFDbkQsUUFBUSxFQUFFLEtBQUssQ0FBQyxPQUFPO1lBQ3ZCLFdBQVcsRUFBVSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxFQUFFO1lBQ2hELFlBQVksRUFBRSxZQUFZO1lBQzFCLGFBQWEsRUFBRSxRQUFRLENBQUMsRUFBRTtTQUM3QixDQUFDO1FBRUYsSUFBSSxDQUFDLGtCQUFrQixFQUFFLHVCQUF1QixFQUFFLENBQUMsUUFBa0MsRUFBRSxFQUFFO1lBRXJGLGtDQUFrQztRQUd0QyxDQUFDLENBQUMsQ0FBQztJQUlQLENBQUM7SUFHRCxpQkFBaUI7UUFDYixJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDaEIsQ0FBQztDQUdKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTWFpbiB9IGZyb20gXCIuLi8uLi9tYWluL01haW4uanNcIjtcclxuaW1wb3J0IHsgV29ya3NwYWNlIH0gZnJvbSBcIi4uLy4uL3dvcmtzcGFjZS9Xb3Jrc3BhY2UuanNcIjtcclxuaW1wb3J0IHsgbWFrZURpdiwgU2VsZWN0SXRlbSwgc2V0U2VsZWN0SXRlbXMsIGdldFNlbGVjdGVkT2JqZWN0IH0gZnJvbSBcIi4uLy4uL3Rvb2xzL0h0bWxUb29scy5qc1wiO1xyXG5pbXBvcnQgeyBSZXBvc2l0b3J5VXNlciwgR2V0UmVwb3NpdG9yeVJlcXVlc3QsIEdldFJlcG9zaXRvcnlSZXNwb25zZSwgR2V0UmVwb3NpdG9yeVVzZXJMaXN0UmVxdWVzdCwgR2V0UmVwb3NpdG9yeVVzZXJMaXN0UmVzcG9uc2UsIFVzZXJEYXRhLCBHZXRSZXBvc2l0b3J5TGlzdFJlcXVlc3QsIEdldFJlcG9zaXRvcnlMaXN0UmVzcG9uc2UsIFJlcG9zaXRvcnlJbmZvLCBVcGRhdGVSZXBvc2l0b3J5UmVxdWVzdCwgVXBkYXRlUmVwb3NpdG9yeVJlc3BvbnNlIH0gZnJvbSBcIi4uLy4uL2NvbW11bmljYXRpb24vRGF0YS5qc1wiO1xyXG5pbXBvcnQgeyBhamF4IH0gZnJvbSBcIi4uLy4uL2NvbW11bmljYXRpb24vQWpheEhlbHBlci5qc1wiO1xyXG5pbXBvcnQgeyBUZWFjaGVyc1dpdGhDbGFzc2VzTUkgfSBmcm9tIFwiLi4vLi4vYWRtaW5pc3RyYXRpb24vVGVhY2hlcnNXaXRoQ2xhc3Nlcy5qc1wiO1xyXG5pbXBvcnQgeyBUaWxpbmdTcHJpdGUgfSBmcm9tIFwicGl4aS5qc1wiO1xyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBSZXBvc2l0b3J5VXBkYXRlTWFuYWdlciB7XHJcblxyXG4gICAgZ3VpUmVhZHk6IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgICAkbWFpbkhlYWRpbmc6IEpRdWVyeTxIVE1MRGl2RWxlbWVudD47XHJcblxyXG4gICAgJHJlcG9OYW1lOiBKUXVlcnk8SFRNTElucHV0RWxlbWVudD47XHJcbiAgICAkcmVwb0Rlc2NyaXB0aW9uOiBKUXVlcnk8SFRNTFRleHRBcmVhRWxlbWVudD47XHJcbiAgICAkcmVwb1B1Ymxpc2hlZFRvOiBKUXVlcnk8SFRNTFNlbGVjdEVsZW1lbnQ+O1xyXG4gICAgJHJlcG9Pd25lcjogSlF1ZXJ5PEhUTUxTZWxlY3RFbGVtZW50PjtcclxuXHJcbiAgICAkcmVwb0xpc3REaXY6IEpRdWVyeTxIVE1MRWxlbWVudD47XHJcblxyXG4gICAgJHVzZXJsaXN0RGl2OiBKUXVlcnk8SFRNTEVsZW1lbnQ+O1xyXG5cclxuICAgICRleGl0QnV0dG9uOiBKUXVlcnk8SFRNTEVsZW1lbnQ+O1xyXG4gICAgJHNhdmVCdXR0b246IEpRdWVyeTxIVE1MRWxlbWVudD47XHJcbiAgICAkZGVsZXRlQnV0dG9uOiBKUXVlcnk8SFRNTEVsZW1lbnQ+O1xyXG5cclxuICAgIHB1Ymxpc2hlZFRvSXRlbXM6IFNlbGVjdEl0ZW1bXSA9IFtcclxuICAgICAgICB7IHZhbHVlOiAwLCBvYmplY3Q6IDAsIGNhcHRpb246IFwiS2VpbmUgVmVyw7ZmZmVudGxpY2h1bmcgKHByaXZhdGVzIFJlcG9zaXRvcnkpXCIgfSxcclxuICAgICAgICB7IHZhbHVlOiAxLCBvYmplY3Q6IDEsIGNhcHRpb246IFwiVmVyw7ZmZmVudGxpY2h0IGbDvHIgYWxscyBTY2jDvGxlci9pbm5lbiBkZXIgS2xhc3NlXCIgfSxcclxuICAgICAgICB7IHZhbHVlOiAyLCBvYmplY3Q6IDIsIGNhcHRpb246IFwiVmVyw7ZmZmVudGxpY2h0IGbDvHIgYWxscyBTY2jDvGxlci9pbm5lbiBkZXIgU2NodWxlXCIgfSxcclxuICAgIF07XHJcblxyXG4gICAgcmVwb3NpdG9yeU93bmVySXRlbXM6IFNlbGVjdEl0ZW1bXSA9IFtdO1xyXG5cclxuICAgIHVzZXJzOiBSZXBvc2l0b3J5VXNlcltdID0gW107XHJcblxyXG4gICAgd29ya3NwYWNlOiBXb3Jrc3BhY2U7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHVibGljIG1haW46IE1haW4pIHtcclxuICAgIH1cclxuXHJcbiAgICBpbml0R1VJKCkge1xyXG4gICAgICAgIHRoaXMuZ3VpUmVhZHkgPSB0cnVlO1xyXG4gICAgICAgIGxldCB0aGF0ID0gdGhpcztcclxuICAgICAgICBsZXQgJHVwZGF0ZURpdiA9IGpRdWVyeSgnI3VwZGF0ZVJlcG8tZGl2Jyk7XHJcblxyXG4gICAgICAgICR1cGRhdGVEaXYuYXBwZW5kKHRoaXMuJG1haW5IZWFkaW5nID0gbWFrZURpdigndXBkYXRlUmVwby1tYWluSGVhZGluZycsIFwiY3JlYXRlVXBkYXRlUmVwby1tYWluSGVhZGluZ1wiLCBcIlwiKSk7XHJcbiAgICAgICAgdGhpcy4kbWFpbkhlYWRpbmcuYXBwZW5kKG1ha2VEaXYoXCJcIiwgXCJcIiwgXCJSZXBvc2l0b3JpZXMgdmVyd2FsdGVuXCIpKTtcclxuICAgICAgICB0aGlzLiRtYWluSGVhZGluZy5hcHBlbmQodGhpcy4kZXhpdEJ1dHRvbiA9IG1ha2VEaXYoXCJcIiwgXCJqb19zeW5jaHJvX2J1dHRvblwiLCBcIlp1csO8Y2sgenVtIFByb2dyYW1taWVyZW5cIiwgeyBcImJhY2tncm91bmQtY29sb3JcIjogXCJ2YXIoLS1jYW5jZWxCdXR0b25CYWNrZ3JvdW5kKVwiLCBcImNvbG9yXCI6IFwidmFyKC0tY2FuY2VsQnV0dG9uQ29sb3IpXCIsIFwiZm9udC1zaXplXCI6IFwiMTBwdFwiIH0pKTtcclxuICAgICAgICB0aGlzLiRleGl0QnV0dG9uLm9uKFwiY2xpY2tcIiwgKCkgPT4geyB0aGF0LmV4aXRCdXR0b25DbGlja2VkKCkgfSlcclxuXHJcblxyXG4gICAgICAgIGxldCAkZGl2QmVsb3cgPSBtYWtlRGl2KFwidXBkYXRlUmVwby1kaXZCZWxvd1wiKTtcclxuICAgICAgICAkdXBkYXRlRGl2LmFwcGVuZCgkZGl2QmVsb3cpO1xyXG5cclxuICAgICAgICBsZXQgJGRpdkxlZnQgPSBtYWtlRGl2KFwidXBkYXRlUmVwby1kaXZMZWZ0XCIpO1xyXG4gICAgICAgICRkaXZCZWxvdy5hcHBlbmQoJGRpdkxlZnQpO1xyXG5cclxuICAgICAgICAkZGl2TGVmdC5hcHBlbmQobWFrZURpdignJywgJ3VwZGF0ZVJlcG8tbWlub3JIZWFkaW5nJywgJ1JlcG9zaXRvcmllczonKSk7XHJcblxyXG4gICAgICAgIHRoaXMuJHJlcG9MaXN0RGl2ID0gbWFrZURpdihcInVwZGF0ZVJlcG8tcmVwb0xpc3REaXZcIik7XHJcbiAgICAgICAgJGRpdkxlZnQuYXBwZW5kKHRoaXMuJHJlcG9MaXN0RGl2KTtcclxuXHJcbiAgICAgICAgbGV0ICRyaWdodERpdiA9IG1ha2VEaXYoXCJ1cGRhdGVSZXBvLWRpdlJpZ2h0XCIpO1xyXG4gICAgICAgICRkaXZCZWxvdy5hcHBlbmQoJHJpZ2h0RGl2KTtcclxuXHJcbiAgICAgICAgbGV0ICRzZXR0aW5nc0RpdiA9IG1ha2VEaXYoXCJcIiwgXCJjcmVhdGVVcGRhdGVSZXBvLXNldHRpbmdzRGl2XCIpO1xyXG4gICAgICAgICRyaWdodERpdi5hcHBlbmQoJHNldHRpbmdzRGl2KTtcclxuXHJcbiAgICAgICAgJHNldHRpbmdzRGl2LmFwcGVuZChqUXVlcnkoJzxkaXYgY2xhc3M9XCJjcmVhdGVVcGRhdGVSZXBvLXNldHRpbmdzTGFiZWxcIj5OYW1lIGRlcyBSZXBvc2l0b3J5czo8L2Rpdj4nKSk7XHJcbiAgICAgICAgJHNldHRpbmdzRGl2LmFwcGVuZCh0aGlzLiRyZXBvTmFtZSA9IGpRdWVyeSgnPGlucHV0IHR5cGU9XCJ0ZXh0XCIgY2xhc3M9XCJjcmVhdGVVcGRhdGVSZXBvLWlucHV0Y29sdW1uXCI+PC9pbnB1dD4nKSk7XHJcblxyXG4gICAgICAgICRzZXR0aW5nc0Rpdi5hcHBlbmQoalF1ZXJ5KCc8ZGl2IGNsYXNzPVwiY3JlYXRlVXBkYXRlUmVwby1zZXR0aW5nc0xhYmVsXCI+QmVzY2hyZWlidW5nOjwvZGl2PicpKTtcclxuICAgICAgICAkc2V0dGluZ3NEaXYuYXBwZW5kKHRoaXMuJHJlcG9EZXNjcmlwdGlvbiA9IGpRdWVyeSgnPHRleHRhcmVhIGNsYXNzPVwiY3JlYXRlVXBkYXRlUmVwby1pbnB1dGNvbHVtblwiIHN0eWxlPVwibWluLWhlaWdodDogNGVtXCI+PC90ZXh0YXJlYT4nKSk7XHJcblxyXG4gICAgICAgICRzZXR0aW5nc0Rpdi5hcHBlbmQoalF1ZXJ5KCc8ZGl2IGNsYXNzPVwiY3JlYXRlVXBkYXRlUmVwby1zZXR0aW5nc0xhYmVsXCI+VmVyw7ZmZmVudGxpY2h0IGbDvHI6PC9kaXY+JykpO1xyXG4gICAgICAgICRzZXR0aW5nc0Rpdi5hcHBlbmQodGhpcy4kcmVwb1B1Ymxpc2hlZFRvID0galF1ZXJ5KCc8c2VsZWN0IGNsYXNzPVwiY3JlYXRlVXBkYXRlUmVwby1pbnB1dGNvbHVtblwiPjwvc2VsZWN0PicpKTtcclxuICAgICAgICBzZXRTZWxlY3RJdGVtcyh0aGlzLiRyZXBvUHVibGlzaGVkVG8sIHRoaXMucHVibGlzaGVkVG9JdGVtcyk7XHJcblxyXG4gICAgICAgICRzZXR0aW5nc0Rpdi5hcHBlbmQoalF1ZXJ5KCc8ZGl2IGNsYXNzPVwiY3JlYXRlVXBkYXRlUmVwby1zZXR0aW5nc0xhYmVsXCI+RWlnZW50w7xtZXI6PC9kaXY+JykpO1xyXG4gICAgICAgICRzZXR0aW5nc0Rpdi5hcHBlbmQodGhpcy4kcmVwb093bmVyID0galF1ZXJ5KCc8c2VsZWN0IGNsYXNzPVwiY3JlYXRlVXBkYXRlUmVwby1pbnB1dGNvbHVtblwiPjwvc2VsZWN0PicpKTtcclxuXHJcbiAgICAgICAgJHNldHRpbmdzRGl2LmFwcGVuZCh0aGlzLiR1c2VybGlzdERpdiA9IG1ha2VEaXYoXCJ1cGRhdGVSZXBvLXVzZXJsaXN0RGl2XCIpKTtcclxuXHJcbiAgICAgICAgdGhpcy4kdXNlcmxpc3REaXYuYXBwZW5kKG1ha2VEaXYobnVsbCwgXCJ1cGRhdGVSZXBvLXVzZXJsaXN0aGVhZGluZ1wiLCBcIkJlbnV0emVyLCBkaWUgZGFzIFJlcG9zaXRvcnkgbnV0emVuXCIsIHsgXCJncmlkLWNvbHVtblwiOiAxfSkpXHJcbiAgICAgICAgdGhpcy4kdXNlcmxpc3REaXYuYXBwZW5kKG1ha2VEaXYobnVsbCwgXCJ1cGRhdGVSZXBvLXVzZXJsaXN0aGVhZGluZ1wiLCBcIlNjaHJlaWJiZXJlY2h0aWd1bmdcIiwgeyBcImdyaWQtY29sdW1uXCI6IDJ9KSlcclxuICAgICAgICAkcmlnaHREaXYuYXBwZW5kKHRoaXMuJHVzZXJsaXN0RGl2KTtcclxuXHJcbiAgICAgICAgbGV0ICRidXR0b25EaXYgPSBtYWtlRGl2KFwidXBkYXRlUmVwby1idXR0b25EaXZcIik7XHJcblxyXG4gICAgICAgICRidXR0b25EaXYuYXBwZW5kKHRoaXMuJHNhdmVCdXR0b24gPSBtYWtlRGl2KFwiXCIsIFwiam9fc3luY2hyb19idXR0b25cIiwgXCLDhG5kZXJ1bmdlbiBzcGVpY2hlcm5cIiwgeyBcImJhY2tncm91bmQtY29sb3JcIjogXCJ2YXIoLS11cGRhdGVCdXR0b25CYWNrZ3JvdW5kKVwiLCBcImNvbG9yXCI6IFwidmFyKC0tdXBkYXRlQnV0dG9uQ29sb3IpXCIgfSkpO1xyXG4gICAgICAgIHRoaXMuJHNhdmVCdXR0b24ub24oXCJjbGlja1wiLCAoKSA9PiB7IHRoYXQuc2F2ZUJ1dHRvbkNsaWNrZWQoKSB9KVxyXG5cclxuICAgICAgICAkcmlnaHREaXYuYXBwZW5kKCRidXR0b25EaXYpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBzaG93KHJlcG9zaXRvcnlfaWQ6IG51bWJlcikge1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuZ3VpUmVhZHkpIHtcclxuICAgICAgICAgICAgdGhpcy5pbml0R1VJKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgJHN5bmNocm9EaXYgPSBqUXVlcnkoJyN1cGRhdGVSZXBvLWRpdicpO1xyXG4gICAgICAgICRzeW5jaHJvRGl2LmNzcygndmlzaWJpbGl0eScsICd2aXNpYmxlJyk7XHJcbiAgICAgICAgbGV0ICRtYWluRGl2ID0galF1ZXJ5KCcjbWFpbicpO1xyXG4gICAgICAgICRtYWluRGl2LmNzcygndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcclxuXHJcbiAgICAgICAgbGV0IHVzZXIgPSB0aGlzLm1haW4udXNlcjtcclxuICAgICAgICB0aGlzLiRzYXZlQnV0dG9uLnNob3coKTtcclxuXHJcbiAgICAgICAgbGV0IGdybHE6IEdldFJlcG9zaXRvcnlMaXN0UmVxdWVzdCA9IHtcclxuICAgICAgICAgICAgb25seU93blJlcG9zaXRvcmllczogdHJ1ZVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy4kcmVwb0xpc3REaXYuZW1wdHkoKTtcclxuICAgICAgICBsZXQgdGhhdCA9IHRoaXM7XHJcbiAgICAgICAgYWpheCgnZ2V0UmVwb3NpdG9yeUxpc3QnLCBncmxxLCAocmVzcG9uc2U6IEdldFJlcG9zaXRvcnlMaXN0UmVzcG9uc2UpID0+IHtcclxuXHJcbiAgICAgICAgICAgIGxldCAkZmlyc3REaXY6IEpRdWVyeTxIVE1MRGl2RWxlbWVudD47XHJcbiAgICAgICAgICAgIGxldCBmaXJzdFJlcEluZm86IFJlcG9zaXRvcnlJbmZvO1xyXG5cclxuICAgICAgICAgICAgcmVzcG9uc2UucmVwb3NpdG9yaWVzLmZvckVhY2gocmVwSW5mbyA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgJGRpdiA9IG1ha2VEaXYoJycsICd1cGRhdGVSZXBvLXJlcG9MaXN0SXRlbScsIHJlcEluZm8ubmFtZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLiRyZXBvTGlzdERpdi5hcHBlbmQoJGRpdik7XHJcbiAgICAgICAgICAgICAgICAkZGl2Lm9uKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5zZWxlY3RSZXBvc2l0b3J5KCRkaXYsIHJlcEluZm8pO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICRkaXYuZGF0YSgncmVwb0luZm8nLCByZXBJbmZvKTtcclxuICAgICAgICAgICAgICAgIGlmIChmaXJzdFJlcEluZm8gPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpcnN0UmVwSW5mbyA9IHJlcEluZm87XHJcbiAgICAgICAgICAgICAgICAgICAgJGZpcnN0RGl2ID0gJGRpdjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBpZigkZmlyc3REaXYgIT0gbnVsbCl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdFJlcG9zaXRvcnkoJGZpcnN0RGl2LCBmaXJzdFJlcEluZm8pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICB9XHJcblxyXG4gICAgc2VsZWN0UmVwb3NpdG9yeSgkcmVwb0RpdjogSlF1ZXJ5PEhUTUxEaXZFbGVtZW50PiwgcmVwSW5mbzogUmVwb3NpdG9yeUluZm8pIHtcclxuICAgICAgICB0aGlzLiRyZXBvTGlzdERpdi5maW5kKCcudXBkYXRlUmVwby1yZXBvTGlzdEl0ZW0nKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgJHJlcG9EaXYuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgIHRoaXMuJHJlcG9OYW1lLnZhbChyZXBJbmZvLm5hbWUpO1xyXG4gICAgICAgIHRoaXMuJHJlcG9EZXNjcmlwdGlvbi52YWwocmVwSW5mby5kZXNjcmlwdGlvbik7XHJcbiAgICAgICAgdGhpcy4kcmVwb1B1Ymxpc2hlZFRvLnZhbChyZXBJbmZvLnB1Ymxpc2hlZF90byk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy4kcmVwb093bmVyLmVtcHR5KCk7XHJcbiAgICAgICAgdGhpcy4kdXNlcmxpc3REaXYubm90KCcudXBkYXRlUmVwby11c2VybGlzdGhlYWRpbmcnKS5yZW1vdmUoKTtcclxuXHJcbiAgICAgICAgbGV0IHJlcTogR2V0UmVwb3NpdG9yeVVzZXJMaXN0UmVxdWVzdCA9IHtyZXBvc2l0b3J5X2lkOiByZXBJbmZvLmlkfTtcclxuICAgICAgICBsZXQgdGhhdCA9IHRoaXM7XHJcblxyXG4gICAgICAgIGFqYXgoJ2dldFJlcG9zaXRvcnlVc2VyTGlzdCcsIHJlcSwgKHJlc3BvbnNlOiBHZXRSZXBvc2l0b3J5VXNlckxpc3RSZXNwb25zZSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgcmVzcG9uc2UucmVwb3NpdG9yeVVzZXJMaXN0LmZvckVhY2godXNlckRhdGEgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCAkdXNlckRpdiA9IG1ha2VEaXYoXCJcIiwgXCJ1cGRhdGVSZXBvLXVzZXJEaXZcIiwgYCR7dXNlckRhdGEuZmlyc3ROYW1lfSAke3VzZXJEYXRhLmxhc3ROYW1lfSAoJHt1c2VyRGF0YS51c2VybmFtZX0pYCwgeyAnZ3JpZC1jb2x1bW4nOiAxIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCAkY2FuV3JpdGVEaXYgPSBtYWtlRGl2KFwiXCIsIFwiY2FuV3JpdGVEaXZcIiwgXCJcIiwgeyAnZ3JpZC1jb2x1bW4nOiAyIH0pO1xyXG4gICAgICAgICAgICAgICAgbGV0ICRjYW5Xcml0ZUNoZWNrQm94ID0galF1ZXJ5KCc8aW5wdXQgdHlwZT1cImNoZWNrYm94XCI+Jyk7XHJcbiAgICAgICAgICAgICAgICAkY2FuV3JpdGVEaXYuYXBwZW5kKCRjYW5Xcml0ZUNoZWNrQm94KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgICAgICAgICRjYW5Xcml0ZUNoZWNrQm94LmF0dHIoJ2NoZWNrZWQnLCB1c2VyRGF0YS5jYW5Xcml0ZSk7XHJcbiAgICAgICAgICAgICAgICAkY2FuV3JpdGVDaGVja0JveC5kYXRhKCd1c2VyJywgdXNlckRhdGEpO1xyXG4gICAgICAgICAgICAgICAgdGhhdC4kdXNlcmxpc3REaXYuYXBwZW5kKCR1c2VyRGl2LCAkY2FuV3JpdGVEaXYpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoYXQuJHJlcG9Pd25lci5lbXB0eSgpO1xyXG4gICAgICAgICAgICBzZXRTZWxlY3RJdGVtcyh0aGF0LiRyZXBvT3duZXIsIHJlc3BvbnNlLnJlcG9zaXRvcnlVc2VyTGlzdC5tYXAodXNlckRhdGEgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IHNlOiBTZWxlY3RJdGVtID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhcHRpb246IGAke3VzZXJEYXRhLmZpcnN0TmFtZX0gJHt1c2VyRGF0YS5sYXN0TmFtZX0gKCR7dXNlckRhdGEudXNlcm5hbWV9KWAsXHJcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0OiB1c2VyRGF0YSxcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdXNlckRhdGEudXNlcl9pZCArIFwiXCJcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBzZTtcclxuICAgICAgICAgICAgfSkpXHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICB9XHJcblxyXG4gICAgaGlkZSgpIHtcclxuICAgICAgICBsZXQgJHN5bmNocm9EaXYgPSBqUXVlcnkoJyN1cGRhdGVSZXBvLWRpdicpO1xyXG4gICAgICAgICRzeW5jaHJvRGl2LmNzcygndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcclxuICAgICAgICBsZXQgJG1haW5EaXYgPSBqUXVlcnkoJyNtYWluJyk7XHJcbiAgICAgICAgJG1haW5EaXYuY3NzKCd2aXNpYmlsaXR5JywgJ3Zpc2libGUnKTtcclxuICAgIH1cclxuXHJcbiAgICBzYXZlQnV0dG9uQ2xpY2tlZCgpIHtcclxuICAgICAgICBsZXQgc2VsZWN0ZWRJdGVtID0gdGhpcy4kcmVwb0xpc3REaXYuZmluZCgnLmFjdGl2ZScpLmZpcnN0KCk7XHJcbiAgICAgICAgbGV0IHJlcG9EYXRhOiBSZXBvc2l0b3J5SW5mbyA9IDxhbnk+c2VsZWN0ZWRJdGVtLmRhdGEoJ3JlcG9JbmZvJyk7XHJcblxyXG4gICAgICAgIGxldCBvd25lcjpSZXBvc2l0b3J5VXNlciAgPSBnZXRTZWxlY3RlZE9iamVjdCh0aGlzLiRyZXBvT3duZXIpO1xyXG4gICAgICAgIGxldCBwdWJsaXNoZWRfdG86IG51bWJlciA9IGdldFNlbGVjdGVkT2JqZWN0KHRoaXMuJHJlcG9QdWJsaXNoZWRUbyk7XHJcblxyXG4gICAgICAgIGxldCB1cGRhdGVSZXBvc2l0b3J5UmVxdWVzdDogVXBkYXRlUmVwb3NpdG9yeVJlcXVlc3QgPSB7XHJcbiAgICAgICAgICAgIG93bmVyX2lkOiBvd25lci51c2VyX2lkLFxyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogPHN0cmluZz50aGlzLiRyZXBvRGVzY3JpcHRpb24udmFsKCksXHJcbiAgICAgICAgICAgIHB1Ymxpc2hlZF90bzogcHVibGlzaGVkX3RvLFxyXG4gICAgICAgICAgICByZXBvc2l0b3J5X2lkOiByZXBvRGF0YS5pZFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGFqYXgoXCJ1cGRhdGVSZXBvc2l0b3J5XCIsIHVwZGF0ZVJlcG9zaXRvcnlSZXF1ZXN0LCAocmVzcG9uc2U6IFVwZGF0ZVJlcG9zaXRvcnlSZXNwb25zZSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgLy9UT0RPOiB1cGRhdGUgdXNlciB3cml0ZSBhY2Nlc3MuLlxyXG5cclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuXHJcbiAgICB9XHJcblxyXG5cclxuICAgIGV4aXRCdXR0b25DbGlja2VkKCkge1xyXG4gICAgICAgIHRoaXMuaGlkZSgpO1xyXG4gICAgfVxyXG5cclxuXHJcbn0iXX0=