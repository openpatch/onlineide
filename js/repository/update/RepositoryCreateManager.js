import { makeDiv, getSelectedObject, setSelectItems } from "../../tools/HtmlTools.js";
export class RepositoryCreateManager {
    constructor(main) {
        this.main = main;
        this.guiReady = false;
        this.publishedToItems = [];
    }
    initGUI() {
        this.guiReady = true;
        let that = this;
        let $updateDiv = jQuery('#createRepo-div');
        $updateDiv.append(this.$mainHeading = makeDiv('', "createUpdateRepo-mainHeading"));
        $updateDiv.append(this.$settingsDiv = makeDiv('', "createUpdateRepo-settingsDiv"));
        this.$settingsDiv.append(jQuery('<div class="createUpdateRepo-settingsLabel">Name des Repositorys:</div>'));
        this.$settingsDiv.append(this.$repoName = jQuery('<input type="text" class="createUpdateRepo-inputcolumn"></input>'));
        this.$settingsDiv.append(jQuery('<div class="createUpdateRepo-settingsLabel">Beschreibung:</div>'));
        this.$settingsDiv.append(this.$repoDescription = jQuery('<textarea class="createUpdateRepo-inputcolumn" style="min-height: 4em"></textarea>'));
        this.$settingsDiv.append(jQuery('<div class="createUpdateRepo-settingsLabel">Veröffentlicht für:</div>'));
        this.$settingsDiv.append(this.$repoPublishedTo = jQuery('<select class="createUpdateRepo-inputcolumn"></select>'));
        let $buttonDiv = makeDiv("createRepo-buttonDiv");
        $buttonDiv.append(this.$createButton = makeDiv("", "jo_synchro_button", "Repository erstellen", { "background-color": "var(--createButtonBackground)", "color": "var(--createButtonColor)" }));
        this.$createButton.on("click", () => { that.createButtonClicked(); });
        $buttonDiv.append(this.$cancelButton = makeDiv("", "jo_synchro_button", "Abbrechen", { "background-color": "var(--cancelButtonBackground)", "color": "var(--cancelButtonColor)" }));
        this.$cancelButton.on("click", () => { that.cancelButtonClicked(); });
        $updateDiv.append($buttonDiv);
    }
    show(workspace) {
        this.workspace = workspace;
        if (!this.guiReady) {
            this.initGUI();
        }
        let user = this.main.user;
        let isStudent = !(user.is_admin || user.is_schooladmin || user.is_teacher);
        this.publishedToItems =
            [
                { value: "0", object: 0, caption: "Keine Veröffentlichung (privates Repository)" },
                { value: "1", object: 1, caption: isStudent ? "Veröffentlicht für alle Schüler/innen der Klasse" : "Veröffentlicht für alle Schüler/innen der unterrichteten Klassen" },
                { value: "2", object: 2, caption: "Veröffentlicht für alle Schüler/innen der Schule" },
            ];
        setSelectItems(this.$repoPublishedTo, this.publishedToItems, "0");
        let $synchroDiv = jQuery('#createRepo-div');
        $synchroDiv.css('visibility', 'visible');
        let $mainDiv = jQuery('#main');
        $mainDiv.css('visibility', 'hidden');
        this.initCreateMode(workspace);
        let that = this;
        this.main.windowStateManager.registerOneTimeBackButtonListener(() => {
            that.hide();
        });
    }
    initCreateMode(workspace) {
        let user = this.main.user;
        let userInfo = {
            firstName: user.rufname,
            lastName: user.familienname,
            username: user.username,
            user_id: user.id,
            canWrite: true,
            klasse: ""
        };
        this.$mainHeading.text(`Repository anlegen und mit Workspace "${workspace.name}" verknüpfen:`);
        this.$createButton.show();
        this.$repoName.val(workspace.name);
    }
    hide() {
        let $synchroDiv = jQuery('#createRepo-div');
        $synchroDiv.css('visibility', 'hidden');
        let $mainDiv = jQuery('#main');
        $mainDiv.css('visibility', 'visible');
    }
    createButtonClicked() {
        let publishedTo = getSelectedObject(this.$repoPublishedTo);
        let repoName = this.$repoName.val();
        let repoDescription = this.$repoDescription.val();
        this.main.networkManager.sendCreateRepository(this.workspace, publishedTo, repoName, repoDescription, (error, repository_id) => {
            if (error == null) {
                let projectExplorer = this.main.projectExplorer;
                let element = projectExplorer.workspaceListPanel.findElement(this.workspace);
                projectExplorer.workspaceListPanel.setElementClass(element, "repository");
                this.workspace.renderSynchronizeButton(element);
                projectExplorer.showRepositoryButtonIfNeeded(this.workspace);
                window.history.back(); // close modal window
            }
            else {
                alert(error);
            }
        });
    }
    cancelButtonClicked() {
        window.history.back(); // close modal window
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVwb3NpdG9yeUNyZWF0ZU1hbmFnZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY2xpZW50L3JlcG9zaXRvcnkvdXBkYXRlL1JlcG9zaXRvcnlDcmVhdGVNYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSxPQUFPLEVBQWMsaUJBQWlCLEVBQUUsY0FBYyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFPbEcsTUFBTSxPQUFPLHVCQUF1QjtJQW1CaEMsWUFBbUIsSUFBVTtRQUFWLFNBQUksR0FBSixJQUFJLENBQU07UUFqQjdCLGFBQVEsR0FBWSxLQUFLLENBQUM7UUFhMUIscUJBQWdCLEdBQWlCLEVBQUUsQ0FBQztJQUtwQyxDQUFDO0lBRUQsT0FBTztRQUNILElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ3JCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQztRQUNoQixJQUFJLFVBQVUsR0FBRyxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUUzQyxVQUFVLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLEdBQUcsT0FBTyxDQUFDLEVBQUUsRUFBRSw4QkFBOEIsQ0FBQyxDQUFDLENBQUM7UUFFbkYsVUFBVSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxHQUFHLE9BQU8sQ0FBQyxFQUFFLEVBQUUsOEJBQThCLENBQUMsQ0FBQyxDQUFDO1FBRW5GLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyx5RUFBeUUsQ0FBQyxDQUFDLENBQUM7UUFDNUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxNQUFNLENBQUMsa0VBQWtFLENBQUMsQ0FBQyxDQUFDO1FBRXRILElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxpRUFBaUUsQ0FBQyxDQUFDLENBQUM7UUFDcEcsSUFB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LENBQUM7UUFDcEQsSUFBSSxlQUFlLEdBQW1CLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUVsRSxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsZUFBZSxFQUFFLENBQUMsS0FBYSxFQUFFLGFBQXNCLEVBQUUsRUFBRTtZQUM1SSxJQUFJLEtBQUssSUFBSSxJQUFJLEVBQUU7Z0JBQ2YsSUFBSSxlQUFlLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUM7Z0JBQ2hELElBQUksT0FBTyxHQUFHLGVBQWUsQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2dCQUM3RSxlQUFlLENBQUMsa0JBQWtCLENBQUMsZUFBZSxDQUFDLE9BQU8sRUFBRSxZQUFZLENBQUMsQ0FBQztnQkFDMUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyx1QkFBdUIsQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDaEQsZUFBZSxDQUFDLDRCQUE0QixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFDN0QsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLHFCQUFxQjthQUMvQztpQkFBTTtnQkFDSCxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDaEI7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUdQLENBQUM7SUFFRCxtQkFBbUI7UUFDZixNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMscUJBQXFCO0lBQ2hELENBQUM7Q0FJSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1haW4gfSBmcm9tIFwiLi4vLi4vbWFpbi9NYWluLmpzXCI7XHJcbmltcG9ydCB7IFdvcmtzcGFjZSB9IGZyb20gXCIuLi8uLi93b3Jrc3BhY2UvV29ya3NwYWNlLmpzXCI7XHJcbmltcG9ydCB7IG1ha2VEaXYsIFNlbGVjdEl0ZW0sIGdldFNlbGVjdGVkT2JqZWN0LCBzZXRTZWxlY3RJdGVtcyB9IGZyb20gXCIuLi8uLi90b29scy9IdG1sVG9vbHMuanNcIjtcclxuaW1wb3J0IHsgUmVwb3NpdG9yeVVzZXIsIEdldFJlcG9zaXRvcnlSZXF1ZXN0LCBHZXRSZXBvc2l0b3J5UmVzcG9uc2UsIEdldFJlcG9zaXRvcnlVc2VyTGlzdFJlcXVlc3QsIEdldFJlcG9zaXRvcnlVc2VyTGlzdFJlc3BvbnNlLCBVc2VyRGF0YSB9IGZyb20gXCIuLi8uLi9jb21tdW5pY2F0aW9uL0RhdGEuanNcIjtcclxuaW1wb3J0IHsgYWpheCB9IGZyb20gXCIuLi8uLi9jb21tdW5pY2F0aW9uL0FqYXhIZWxwZXIuanNcIjtcclxuXHJcblxyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBSZXBvc2l0b3J5Q3JlYXRlTWFuYWdlciB7XHJcblxyXG4gICAgZ3VpUmVhZHk6IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgICAkbWFpbkhlYWRpbmc6IEpRdWVyeTxIVE1MRGl2RWxlbWVudD47XHJcbiAgICAkc2V0dGluZ3NEaXY6IEpRdWVyeTxIVE1MRWxlbWVudD47XHJcblxyXG4gICAgJHJlcG9OYW1lOiBKUXVlcnk8SFRNTElucHV0RWxlbWVudD47XHJcbiAgICAkcmVwb0Rlc2NyaXB0aW9uOiBKUXVlcnk8SFRNTFRleHRBcmVhRWxlbWVudD47XHJcbiAgICAkcmVwb1B1Ymxpc2hlZFRvOiBKUXVlcnk8SFRNTFNlbGVjdEVsZW1lbnQ+O1xyXG5cclxuICAgICRjYW5jZWxCdXR0b246IEpRdWVyeTxIVE1MRWxlbWVudD47XHJcbiAgICAkY3JlYXRlQnV0dG9uOiBKUXVlcnk8SFRNTEVsZW1lbnQ+O1xyXG5cclxuXHJcbiAgICBwdWJsaXNoZWRUb0l0ZW1zOiBTZWxlY3RJdGVtW10gPSBbXTtcclxuXHJcbiAgICB3b3Jrc3BhY2U6IFdvcmtzcGFjZTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgbWFpbjogTWFpbikge1xyXG4gICAgfVxyXG5cclxuICAgIGluaXRHVUkoKSB7XHJcbiAgICAgICAgdGhpcy5ndWlSZWFkeSA9IHRydWU7XHJcbiAgICAgICAgbGV0IHRoYXQgPSB0aGlzO1xyXG4gICAgICAgIGxldCAkdXBkYXRlRGl2ID0galF1ZXJ5KCcjY3JlYXRlUmVwby1kaXYnKTtcclxuXHJcbiAgICAgICAgJHVwZGF0ZURpdi5hcHBlbmQodGhpcy4kbWFpbkhlYWRpbmcgPSBtYWtlRGl2KCcnLCBcImNyZWF0ZVVwZGF0ZVJlcG8tbWFpbkhlYWRpbmdcIikpO1xyXG5cclxuICAgICAgICAkdXBkYXRlRGl2LmFwcGVuZCh0aGlzLiRzZXR0aW5nc0RpdiA9IG1ha2VEaXYoJycsIFwiY3JlYXRlVXBkYXRlUmVwby1zZXR0aW5nc0RpdlwiKSk7XHJcblxyXG4gICAgICAgIHRoaXMuJHNldHRpbmdzRGl2LmFwcGVuZChqUXVlcnkoJzxkaXYgY2xhc3M9XCJjcmVhdGVVcGRhdGVSZXBvLXNldHRpbmdzTGFiZWxcIj5OYW1lIGRlcyBSZXBvc2l0b3J5czo8L2Rpdj4nKSk7XHJcbiAgICAgICAgdGhpcy4kc2V0dGluZ3NEaXYuYXBwZW5kKHRoaXMuJHJlcG9OYW1lID0galF1ZXJ5KCc8aW5wdXQgdHlwZT1cInRleHRcIiBjbGFzcz1cImNyZWF0ZVVwZGF0ZVJlcG8taW5wdXRjb2x1bW5cIj48L2lucHV0PicpKTtcclxuXHJcbiAgICAgICAgdGhpcy4kc2V0dGluZ3NEaXYuYXBwZW5kKGpRdWVyeSgnPGRpdiBjbGFzcz1cImNyZWF0ZVVwZGF0ZVJlcG8tc2V0dGluZ3NMYWJlbFwiPkJlc2NocmVpYnVuZzo8L2Rpdj4nKSk7XHJcbiAgICAgICAgdGhpcy4kc2V0dGluZ3NEaXYuYXBwZW5kKHRoaXMuJHJlcG9EZXNjcmlwdGlvbiA9IGpRdWVyeSgnPHRleHRhcmVhIGNsYXNzPVwiY3JlYXRlVXBkYXRlUmVwby1pbnB1dGNvbHVtblwiIHN0eWxlPVwibWluLWhlaWdodDogNGVtXCI+PC90ZXh0YXJlYT4nKSk7XHJcblxyXG4gICAgICAgIHRoaXMuJHNldHRpbmdzRGl2LmFwcGVuZChqUXVlcnkoJzxkaXYgY2xhc3M9XCJjcmVhdGVVcGRhdGVSZXBvLXNldHRpbmdzTGFiZWxcIj5WZXLDtmZmZW50bGljaHQgZsO8cjo8L2Rpdj4nKSk7XHJcbiAgICAgICAgdGhpcy4kc2V0dGluZ3NEaXYuYXBwZW5kKHRoaXMuJHJlcG9QdWJsaXNoZWRUbyA9IGpRdWVyeSgnPHNlbGVjdCBjbGFzcz1cImNyZWF0ZVVwZGF0ZVJlcG8taW5wdXRjb2x1bW5cIj48L3NlbGVjdD4nKSk7XHJcblxyXG4gICAgICAgIGxldCAkYnV0dG9uRGl2ID0gbWFrZURpdihcImNyZWF0ZVJlcG8tYnV0dG9uRGl2XCIpO1xyXG5cclxuICAgICAgICAkYnV0dG9uRGl2LmFwcGVuZCh0aGlzLiRjcmVhdGVCdXR0b24gPSBtYWtlRGl2KFwiXCIsIFwiam9fc3luY2hyb19idXR0b25cIiwgXCJSZXBvc2l0b3J5IGVyc3RlbGxlblwiLCB7IFwiYmFja2dyb3VuZC1jb2xvclwiOiBcInZhcigtLWNyZWF0ZUJ1dHRvbkJhY2tncm91bmQpXCIsIFwiY29sb3JcIjogXCJ2YXIoLS1jcmVhdGVCdXR0b25Db2xvcilcIiB9KSk7XHJcbiAgICAgICAgdGhpcy4kY3JlYXRlQnV0dG9uLm9uKFwiY2xpY2tcIiwgKCkgPT4geyB0aGF0LmNyZWF0ZUJ1dHRvbkNsaWNrZWQoKSB9KVxyXG5cclxuICAgICAgICAkYnV0dG9uRGl2LmFwcGVuZCh0aGlzLiRjYW5jZWxCdXR0b24gPSBtYWtlRGl2KFwiXCIsIFwiam9fc3luY2hyb19idXR0b25cIiwgXCJBYmJyZWNoZW5cIiwgeyBcImJhY2tncm91bmQtY29sb3JcIjogXCJ2YXIoLS1jYW5jZWxCdXR0b25CYWNrZ3JvdW5kKVwiLCBcImNvbG9yXCI6IFwidmFyKC0tY2FuY2VsQnV0dG9uQ29sb3IpXCIgfSkpO1xyXG4gICAgICAgIHRoaXMuJGNhbmNlbEJ1dHRvbi5vbihcImNsaWNrXCIsICgpID0+IHsgdGhhdC5jYW5jZWxCdXR0b25DbGlja2VkKCkgfSlcclxuXHJcbiAgICAgICAgJHVwZGF0ZURpdi5hcHBlbmQoJGJ1dHRvbkRpdik7XHJcblxyXG5cclxuICAgIH1cclxuXHJcbiAgICBzaG93KHdvcmtzcGFjZTogV29ya3NwYWNlKSB7XHJcblxyXG4gICAgICAgIHRoaXMud29ya3NwYWNlID0gd29ya3NwYWNlO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuZ3VpUmVhZHkpIHtcclxuICAgICAgICAgICAgdGhpcy5pbml0R1VJKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgdXNlciA9IHRoaXMubWFpbi51c2VyO1xyXG4gICAgICAgIGxldCBpc1N0dWRlbnQgPSAhKHVzZXIuaXNfYWRtaW4gfHwgdXNlci5pc19zY2hvb2xhZG1pbiB8fCB1c2VyLmlzX3RlYWNoZXIpO1xyXG5cclxuICAgICAgICB0aGlzLnB1Ymxpc2hlZFRvSXRlbXMgPVxyXG4gICAgICAgICAgICBbXHJcbiAgICAgICAgICAgICAgICB7IHZhbHVlOiBcIjBcIiwgb2JqZWN0OiAwLCBjYXB0aW9uOiBcIktlaW5lIFZlcsO2ZmZlbnRsaWNodW5nIChwcml2YXRlcyBSZXBvc2l0b3J5KVwiIH0sXHJcbiAgICAgICAgICAgICAgICB7IHZhbHVlOiBcIjFcIiwgb2JqZWN0OiAxLCBjYXB0aW9uOiBpc1N0dWRlbnQgPyBcIlZlcsO2ZmZlbnRsaWNodCBmw7xyIGFsbGUgU2Now7xsZXIvaW5uZW4gZGVyIEtsYXNzZVwiIDogXCJWZXLDtmZmZW50bGljaHQgZsO8ciBhbGxlIFNjaMO8bGVyL2lubmVuIGRlciB1bnRlcnJpY2h0ZXRlbiBLbGFzc2VuXCIgfSxcclxuICAgICAgICAgICAgICAgIHsgdmFsdWU6IFwiMlwiLCBvYmplY3Q6IDIsIGNhcHRpb246IFwiVmVyw7ZmZmVudGxpY2h0IGbDvHIgYWxsZSBTY2jDvGxlci9pbm5lbiBkZXIgU2NodWxlXCIgfSxcclxuICAgICAgICAgICAgXTtcclxuICAgICAgICBzZXRTZWxlY3RJdGVtcyh0aGlzLiRyZXBvUHVibGlzaGVkVG8sIHRoaXMucHVibGlzaGVkVG9JdGVtcywgXCIwXCIpO1xyXG5cclxuXHJcbiAgICAgICAgbGV0ICRzeW5jaHJvRGl2ID0galF1ZXJ5KCcjY3JlYXRlUmVwby1kaXYnKTtcclxuICAgICAgICAkc3luY2hyb0Rpdi5jc3MoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpO1xyXG4gICAgICAgIGxldCAkbWFpbkRpdiA9IGpRdWVyeSgnI21haW4nKTtcclxuICAgICAgICAkbWFpbkRpdi5jc3MoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XHJcblxyXG5cclxuICAgICAgICB0aGlzLmluaXRDcmVhdGVNb2RlKHdvcmtzcGFjZSk7XHJcblxyXG4gICAgICAgIGxldCB0aGF0ID0gdGhpcztcclxuICAgICAgICB0aGlzLm1haW4ud2luZG93U3RhdGVNYW5hZ2VyLnJlZ2lzdGVyT25lVGltZUJhY2tCdXR0b25MaXN0ZW5lcigoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoYXQuaGlkZSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBpbml0Q3JlYXRlTW9kZSh3b3Jrc3BhY2U6IFdvcmtzcGFjZSkge1xyXG4gICAgICAgIGxldCB1c2VyID0gdGhpcy5tYWluLnVzZXI7XHJcblxyXG4gICAgICAgIGxldCB1c2VySW5mbzogUmVwb3NpdG9yeVVzZXIgPSB7XHJcbiAgICAgICAgICAgIGZpcnN0TmFtZTogdXNlci5ydWZuYW1lLFxyXG4gICAgICAgICAgICBsYXN0TmFtZTogdXNlci5mYW1pbGllbm5hbWUsXHJcbiAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VyLnVzZXJuYW1lLFxyXG4gICAgICAgICAgICB1c2VyX2lkOiB1c2VyLmlkLFxyXG4gICAgICAgICAgICBjYW5Xcml0ZTogdHJ1ZSxcclxuICAgICAgICAgICAga2xhc3NlOiBcIlwiXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLiRtYWluSGVhZGluZy50ZXh0KGBSZXBvc2l0b3J5IGFubGVnZW4gdW5kIG1pdCBXb3Jrc3BhY2UgXCIke3dvcmtzcGFjZS5uYW1lfVwiIHZlcmtuw7xwZmVuOmApO1xyXG4gICAgICAgIHRoaXMuJGNyZWF0ZUJ1dHRvbi5zaG93KCk7XHJcbiAgICAgICAgdGhpcy4kcmVwb05hbWUudmFsKHdvcmtzcGFjZS5uYW1lKTtcclxuICAgIH1cclxuXHJcbiAgICBoaWRlKCkge1xyXG4gICAgICAgIGxldCAkc3luY2hyb0RpdiA9IGpRdWVyeSgnI2NyZWF0ZVJlcG8tZGl2Jyk7XHJcbiAgICAgICAgJHN5bmNocm9EaXYuY3NzKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xyXG4gICAgICAgIGxldCAkbWFpbkRpdiA9IGpRdWVyeSgnI21haW4nKTtcclxuICAgICAgICAkbWFpbkRpdi5jc3MoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUJ1dHRvbkNsaWNrZWQoKSB7XHJcblxyXG4gICAgICAgIGxldCBwdWJsaXNoZWRUbzogbnVtYmVyID0gZ2V0U2VsZWN0ZWRPYmplY3QodGhpcy4kcmVwb1B1Ymxpc2hlZFRvKTtcclxuICAgICAgICBsZXQgcmVwb05hbWU6IHN0cmluZyA9IDxzdHJpbmc+dGhpcy4kcmVwb05hbWUudmFsKCk7XHJcbiAgICAgICAgbGV0IHJlcG9EZXNjcmlwdGlvbjogc3RyaW5nID0gPHN0cmluZz50aGlzLiRyZXBvRGVzY3JpcHRpb24udmFsKCk7XHJcblxyXG4gICAgICAgIHRoaXMubWFpbi5uZXR3b3JrTWFuYWdlci5zZW5kQ3JlYXRlUmVwb3NpdG9yeSh0aGlzLndvcmtzcGFjZSwgcHVibGlzaGVkVG8sIHJlcG9OYW1lLCByZXBvRGVzY3JpcHRpb24sIChlcnJvcjogc3RyaW5nLCByZXBvc2l0b3J5X2lkPzogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlcnJvciA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcHJvamVjdEV4cGxvcmVyID0gdGhpcy5tYWluLnByb2plY3RFeHBsb3JlcjtcclxuICAgICAgICAgICAgICAgIGxldCBlbGVtZW50ID0gcHJvamVjdEV4cGxvcmVyLndvcmtzcGFjZUxpc3RQYW5lbC5maW5kRWxlbWVudCh0aGlzLndvcmtzcGFjZSk7XHJcbiAgICAgICAgICAgICAgICBwcm9qZWN0RXhwbG9yZXIud29ya3NwYWNlTGlzdFBhbmVsLnNldEVsZW1lbnRDbGFzcyhlbGVtZW50LCBcInJlcG9zaXRvcnlcIik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLndvcmtzcGFjZS5yZW5kZXJTeW5jaHJvbml6ZUJ1dHRvbihlbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIHByb2plY3RFeHBsb3Jlci5zaG93UmVwb3NpdG9yeUJ1dHRvbklmTmVlZGVkKHRoaXMud29ya3NwYWNlKTtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5oaXN0b3J5LmJhY2soKTsgLy8gY2xvc2UgbW9kYWwgd2luZG93XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBhbGVydChlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgfVxyXG5cclxuICAgIGNhbmNlbEJ1dHRvbkNsaWNrZWQoKSB7XHJcbiAgICAgICAgd2luZG93Lmhpc3RvcnkuYmFjaygpOyAvLyBjbG9zZSBtb2RhbCB3aW5kb3dcclxuICAgIH1cclxuXHJcblxyXG5cclxufSJdfQ==