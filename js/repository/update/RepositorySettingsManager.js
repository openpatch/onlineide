import { makeDiv, setSelectItems, getSelectedObject, openContextMenu, copyTextToClipboard } from "../../tools/HtmlTools.js";
import { ajax } from "../../communication/AjaxHelper.js";
export class RepositorySettingsManager {
    constructor(main) {
        this.main = main;
        this.guiReady = false;
        this.publishedToItems = [];
        this.repositoryOwnerItems = [];
        this.users = [];
    }
    initGUI() {
        this.guiReady = true;
        let that = this;
        let $updateDiv = jQuery('#updateRepo-div');
        $updateDiv.append(this.$mainHeading = makeDiv('updateRepo-mainHeading', "createUpdateRepo-mainHeading", ""));
        this.$mainHeading.append(makeDiv("", "", "Repositories verwalten"));
        this.$mainHeading.append(this.$exitButton = makeDiv("", "jo_synchro_button", "Zurück zum Programmieren", { "background-color": "var(--speedcontrol-grip)", "color": "var(--fontColorLight)", "font-size": "10pt" }));
        this.$exitButton.on("click", () => { that.exitButtonClicked(); });
        let $divBelow = makeDiv("updateRepo-divBelow");
        $updateDiv.append($divBelow);
        let $divLeft = makeDiv("updateRepo-divLeft");
        $divBelow.append($divLeft);
        $divLeft.append(makeDiv('', 'updateRepo-minorHeading', 'Repositories:'));
        this.$repoListDiv = makeDiv("updateRepo-repoListDiv");
        $divLeft.append(this.$repoListDiv);
        let $rightDiv = makeDiv("updateRepo-divRight");
        $divBelow.append($rightDiv);
        this.$settingsDiv = makeDiv("", "createUpdateRepo-settingsDiv");
        $rightDiv.append(this.$settingsDiv);
        this.$settingsDiv.append(jQuery('<div class="createUpdateRepo-settingsLabel">Name des Repositorys:</div>'));
        this.$settingsDiv.append(this.$repoName = jQuery('<input type="text" class="createUpdateRepo-inputcolumn"></input>'));
        this.$repoName.on("input", () => { that.enableSaveButton(); });
        this.$settingsDiv.append(jQuery('<div class="createUpdateRepo-settingsLabel">Beschreibung:</div>'));
        this.$settingsDiv.append(this.$repoDescription = jQuery('<textarea class="createUpdateRepo-inputcolumn" style="min-height: 4em"></textarea>'));
        this.$repoDescription.on("input", () => { that.enableSaveButton(); });
        this.$settingsDiv.append(jQuery('<div class="createUpdateRepo-settingsLabel">Veröffentlicht für:</div>'));
        this.$settingsDiv.append(this.$repoPublishedTo = jQuery('<select class="createUpdateRepo-inputcolumn"></select>'));
        this.$repoPublishedTo.on("change", () => { that.enableSaveButton(); });
        this.$settingsDiv.append(jQuery('<div class="createUpdateRepo-settingsLabel">Eigentümer:</div>'));
        this.$settingsDiv.append(this.$repoOwner = jQuery('<select class="createUpdateRepo-inputcolumn"></select>'));
        this.$repoOwner.on("change", () => { that.enableSaveButton(); });
        this.$settingsDiv.append(jQuery('<div class="createUpdateRepo-settingsLabel">Code zum lesenden Zugriff aufs Repository:</div>'));
        let $setSecrDivRead = jQuery('<div class="createUpdateRepo-settingsSecret"></div>');
        this.$settingsDiv.append($setSecrDivRead);
        this.$settingsSecretRead = jQuery('<div class="createUpdateRepo-settingsSecretSecret">---</div>');
        $setSecrDivRead.append(this.$settingsSecretRead);
        let $setSecrReadCopyButton = jQuery('<button class="jo_button jo_copy_secret_button jo_active">Kopieren</button>');
        $setSecrDivRead.append($setSecrReadCopyButton);
        $setSecrReadCopyButton.on("pointerdown", () => { copyTextToClipboard(this.$settingsSecretRead.text()); });
        let $setSecrReadButton = jQuery('<button class="jo_button jo_set_secret_button jo_active">Ändern</button>');
        $setSecrDivRead.append($setSecrReadButton);
        $setSecrReadButton.on("pointerdown", () => { that.setSecret(true, false); });
        this.$settingsDiv.append(jQuery('<div class="createUpdateRepo-settingsLabel">Code zum schreibenden Zugriff aufs Repository:</div>'));
        let $setSecrDivWrite = jQuery('<div class="createUpdateRepo-settingsSecret"></div>');
        this.$settingsDiv.append($setSecrDivWrite);
        this.$settingsSecretWrite = jQuery('<div class="createUpdateRepo-settingsSecretSecret">---</div>');
        $setSecrDivWrite.append(this.$settingsSecretWrite);
        let $setSecrWriteCopyButton = jQuery('<button class="jo_button jo_copy_secret_button jo_active">Kopieren</button>');
        $setSecrDivWrite.append($setSecrWriteCopyButton);
        $setSecrWriteCopyButton.on("pointerdown", () => { copyTextToClipboard(this.$settingsSecretWrite.text()); });
        let $setSecrWriteButton = jQuery('<button class="jo_button jo_set_secret_button jo_active">Ändern</button>');
        $setSecrDivWrite.append($setSecrWriteButton);
        $setSecrWriteButton.on("pointerdown", () => { that.setSecret(false, true); });
        $rightDiv.append(this.$userlistDiv = makeDiv("updateRepo-userlistDiv"));
        this.$userlistDiv.append(makeDiv(null, "updateRepo-userlistheading", "Benutzer, die das Repository nutzen", { "grid-column": 1 }));
        this.$userlistDiv.append(makeDiv(null, "updateRepo-userlistheading", "Schreibberechtigung", { "grid-column": 2 }));
        let $buttonDiv = makeDiv("updateRepo-buttonDiv");
        $buttonDiv.append(this.$saveButton = makeDiv("", "jo_synchro_button", "Änderungen speichern", { "background-color": "var(--updateButtonBackground)", "color": "var(--updateButtonColor)" }));
        this.$saveButton.on("click", () => { that.saveButtonClicked(); });
        this.$saveButton.hide();
        $rightDiv.append($buttonDiv);
    }
    setSecret(read, write) {
        this.main.networkManager.sendSetSecret(this.repositoryInfo.id, read, write, (response) => {
            let praefix = this.repositoryInfo.id + "T";
            this.$settingsSecretRead.text(praefix + response.secret_read);
            this.$settingsSecretWrite.text(praefix + response.secret_write);
        });
    }
    enableSaveButton() {
        this.$saveButton.show();
    }
    show(repository_id) {
        if (!this.guiReady) {
            this.initGUI();
        }
        let $synchroDiv = jQuery('#updateRepo-div');
        $synchroDiv.css('visibility', 'visible');
        let $mainDiv = jQuery('#main');
        $mainDiv.css('visibility', 'hidden');
        let user = this.main.user;
        let is_student = !(user.is_teacher || user.is_admin || user.is_schooladmin);
        this.publishedToItems = [
            { value: 0, object: 0, caption: "Keine Veröffentlichung (privates Repository)" },
            { value: 1, object: 1, caption: is_student ? "Veröffentlicht für alle Schüler/innen der Klasse" : "Veröffentlicht für alle Schüler/innen der unterrichteten Klassen" },
            { value: 2, object: 2, caption: "Veröffentlicht für alle Schüler/innen der Schule" },
        ];
        setSelectItems(this.$repoPublishedTo, this.publishedToItems, 0);
        this.$saveButton.show();
        this.showRepositoryList();
        let that = this;
        this.main.windowStateManager.registerOneTimeBackButtonListener(() => {
            that.hide();
        });
    }
    deleteRepository(repInfo) {
        let that = this;
        let request = { repository_id: repInfo.id };
        ajax('deleteRepository', request, () => {
            that.showRepositoryList();
            let workspaces = that.main.workspaceList.filter((ws) => { return ws.repository_id == repInfo.id; });
            for (let ws of workspaces) {
                ws.repository_id = null;
                ws.panelElement.iconClass = "workspace";
                ws.panelElement.$htmlFirstLine.removeClass("jo_repository");
                ws.panelElement.$htmlFirstLine.addClass("jo_workspace");
                ws.panelElement.$htmlFirstLine.find(".jo_additionalButtonRepository").empty();
            }
        });
    }
    showRepositoryList() {
        this.emptyRepositoryInfo();
        let grlq = {
            onlyOwnRepositories: true
        };
        this.$repoListDiv.empty();
        let that = this;
        ajax('getRepositoryList', grlq, (response) => {
            let $firstDiv;
            let firstRepInfo;
            if (response.repositories.length == 0) {
                alert('Sie haben noch keine Repositories, und\nkönnen daher keine verwalten.\nTipp: Ein Repository können Sie durch Rechtsklick auf einen Workspace anlegen.');
                that.exitButtonClicked();
                return;
            }
            response.repositories.forEach(repInfo => {
                let $div = makeDiv('', 'updateRepo-repoListItem');
                let $namediv = makeDiv('', '', repInfo.name);
                let $deleteDiv = jQuery('<div class="img_delete jo_button jo_active" title="Repository löschen..."></div>');
                $div.append($namediv, $deleteDiv);
                this.$repoListDiv.append($div);
                $div.on('click', (e) => {
                    that.selectRepository($div, repInfo);
                });
                $div.data('repoInfo', repInfo);
                if (firstRepInfo == null) {
                    firstRepInfo = repInfo;
                    $firstDiv = $div;
                }
                $deleteDiv.on("click", (ev) => {
                    ev.preventDefault();
                    openContextMenu([{
                            caption: "Abbrechen",
                            callback: () => { }
                        }, {
                            caption: "Ich bin mir sicher: löschen!",
                            color: "#ff6060",
                            callback: () => {
                                that.deleteRepository(repInfo);
                            }
                        }], ev.pageX + 2, ev.pageY + 2);
                    ev.stopPropagation();
                });
            });
            if ($firstDiv != null) {
                this.selectRepository($firstDiv, firstRepInfo);
            }
        }, (message) => {
            console.log(message);
            alert('Sie haben noch keine Repositories, und\nkönnen daher keine verwalten.\nTipp: Ein Repository können Sie durch Rechtsklick auf einen Workspace anlegen.');
            that.exitButtonClicked();
            return;
        });
    }
    selectRepository($repoDiv, repInfo) {
        this.repositoryInfo = repInfo;
        this.emptyRepositoryInfo();
        if (this.$saveButton.is(":visible")) {
            let selectedItem = this.$repoListDiv.find('.active').first();
            let repoData = selectedItem.data('repoInfo');
            if (repoData) {
                alert(`Deine Änderungen am Repository "${repoData.name}" wurden nicht gespeichert.`);
            }
        }
        this.$saveButton.hide();
        this.$repoListDiv.find('.updateRepo-repoListItem').removeClass('active');
        $repoDiv.addClass('active');
        this.$repoName.val(repInfo.name);
        this.$repoDescription.val(repInfo.description);
        this.$repoPublishedTo.val(repInfo.published_to);
        this.$settingsSecretRead.text(repInfo.secret_read == null ? "--------" : repInfo.id + "T" + repInfo.secret_read);
        this.$settingsSecretWrite.text(repInfo.secret_write == null ? "--------" : repInfo.id + "T" + repInfo.secret_write);
        this.$repoOwner.empty();
        this.$userlistDiv.children().not('.updateRepo-userlistheading').remove();
        let req = { repository_id: repInfo.id };
        let that = this;
        ajax('getRepositoryUserList', req, (response) => {
            response.repositoryUserList.forEach(userData => {
                let $userDiv = makeDiv("", "updateRepo-userDiv", `${userData.firstName} ${userData.lastName} (${userData.username})`, { 'grid-column': 1 });
                let $canWriteDiv = makeDiv("", "canWriteDiv", "", { 'grid-column': 2 });
                let $canWriteCheckBox = jQuery('<input type="checkbox">');
                $canWriteDiv.append($canWriteCheckBox);
                //@ts-ignore
                $canWriteCheckBox.attr('checked', userData.canWrite);
                $canWriteCheckBox.data('user', userData);
                $canWriteCheckBox.on("change", () => { that.enableSaveButton(); });
                that.$userlistDiv.append($userDiv, $canWriteDiv);
            });
            that.$repoOwner.empty();
            let selectedItems = response.repositoryUserList.map(userData => {
                let se = {
                    caption: `${userData.firstName} ${userData.lastName} (${userData.username})`,
                    object: userData,
                    value: userData.user_id + ""
                };
                return se;
            });
            if (!response.repositoryUserList.some(user => user.user_id == repInfo.owner_id)) {
                selectedItems.push({
                    caption: `${repInfo.owner_name} (${repInfo.owner_username})`,
                    object: {
                        user_id: repInfo.owner_id,
                        username: repInfo.owner_username,
                        firstName: "",
                        lastName: "",
                        klasse: "",
                        canWrite: true
                    },
                    value: repInfo.owner_id + ""
                });
            }
            setSelectItems(that.$repoOwner, selectedItems, repInfo.owner_id + "");
        });
    }
    emptyRepositoryInfo() {
        this.$repoOwner.empty();
        this.$repoName.val('');
        this.$repoDescription.val('');
        this.$userlistDiv.find('.updateRepo-userDiv').remove();
        this.$userlistDiv.find('.canWriteDiv').remove();
    }
    hide() {
        let $synchroDiv = jQuery('#updateRepo-div');
        $synchroDiv.css('visibility', 'hidden');
        let $mainDiv = jQuery('#main');
        $mainDiv.css('visibility', 'visible');
    }
    saveButtonClicked() {
        let that = this;
        let selectedItem = this.$repoListDiv.find('.active').first();
        let repoData = selectedItem.data('repoInfo');
        let name = this.$repoName.val();
        let owner = getSelectedObject(this.$repoOwner);
        let published_to = getSelectedObject(this.$repoPublishedTo);
        let updateRepositoryRequest = {
            owner_id: owner.user_id,
            description: this.$repoDescription.val(),
            published_to: published_to,
            repository_id: repoData.id,
            name: name
        };
        // update user write access:
        let writeAccessList = [];
        that.$userlistDiv.find('input').each((index, element) => {
            let $element = jQuery(element);
            let user = $element.data('user');
            writeAccessList.push({
                has_write_access: jQuery(element).is(':checked'),
                user_id: user.user_id
            });
        });
        let request = {
            repository_id: repoData.id,
            writeAccessList: writeAccessList
        };
        if (repoData.owner_id == owner.user_id ||
            confirm("Soll die Eigentümerschaft über das Repository " + repoData.name + " wirklich an " + owner.firstName + " " + owner.lastName + " übertragen werden?")) {
            ajax('updateRepositoryUserWriteAccess', request, (response) => {
                ajax("updateRepository", updateRepositoryRequest, (response) => {
                    repoData.name = name;
                    repoData.owner_id = owner.user_id;
                    repoData.owner_name = owner.firstName + " " + owner.lastName;
                    repoData.owner_username = owner.username;
                    repoData.published_to = published_to;
                    repoData.description = updateRepositoryRequest.description;
                    alert('Die Änderungen wurden erfolgreich gespeichert.');
                    that.$saveButton.hide();
                    that.showRepositoryList();
                }, (errorMessage) => {
                    alert("Fehler: " + errorMessage);
                    that.exitButtonClicked();
                });
            }, (errorMessage) => {
                alert("Fehler: " + errorMessage);
                that.exitButtonClicked();
            });
        }
        else {
            alert("Der Speichervorgang wurde nicht durchgeführt.");
        }
    }
    exitButtonClicked() {
        window.history.back();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVwb3NpdG9yeVNldHRpbmdzTWFuYWdlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jbGllbnQvcmVwb3NpdG9yeS91cGRhdGUvUmVwb3NpdG9yeVNldHRpbmdzTWFuYWdlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUUsT0FBTyxFQUFjLGNBQWMsRUFBRSxpQkFBaUIsRUFBRSxlQUFlLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUV4SSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFHekQsTUFBTSxPQUFPLHlCQUF5QjtJQWdDbEMsWUFBbUIsSUFBVTtRQUFWLFNBQUksR0FBSixJQUFJLENBQU07UUE5QjdCLGFBQVEsR0FBWSxLQUFLLENBQUM7UUFxQjFCLHFCQUFnQixHQUFpQixFQUFFLENBQUM7UUFFcEMseUJBQW9CLEdBQWlCLEVBQUUsQ0FBQztRQUV4QyxVQUFLLEdBQXFCLEVBQUUsQ0FBQztJQU03QixDQUFDO0lBRUQsT0FBTztRQUNILElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ3JCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQztRQUNoQixJQUFJLFVBQVUsR0FBRyxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUUzQyxVQUFVLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLEdBQUcsT0FBTyxDQUFDLHdCQUF3QixFQUFFLDhCQUE4QixFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDN0csSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsd0JBQXdCLENBQUMsQ0FBQyxDQUFDO1FBQ3BFLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLEdBQUcsT0FBTyxDQUFDLEVBQUUsRUFBRSxtQkFBbUIsRUFBRSwwQkFBMEIs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Ly4uL21haW4vTWFpbi5qc1wiO1xyXG5pbXBvcnQgeyBXb3Jrc3BhY2UgfSBmcm9tIFwiLi4vLi4vd29ya3NwYWNlL1dvcmtzcGFjZS5qc1wiO1xyXG5pbXBvcnQgeyBtYWtlRGl2LCBTZWxlY3RJdGVtLCBzZXRTZWxlY3RJdGVtcywgZ2V0U2VsZWN0ZWRPYmplY3QsIG9wZW5Db250ZXh0TWVudSwgY29weVRleHRUb0NsaXBib2FyZCB9IGZyb20gXCIuLi8uLi90b29scy9IdG1sVG9vbHMuanNcIjtcclxuaW1wb3J0IHsgUmVwb3NpdG9yeVVzZXIsIEdldFJlcG9zaXRvcnlSZXF1ZXN0LCBHZXRSZXBvc2l0b3J5UmVzcG9uc2UsIEdldFJlcG9zaXRvcnlVc2VyTGlzdFJlcXVlc3QsIEdldFJlcG9zaXRvcnlVc2VyTGlzdFJlc3BvbnNlLCBVc2VyRGF0YSwgR2V0UmVwb3NpdG9yeUxpc3RSZXF1ZXN0LCBHZXRSZXBvc2l0b3J5TGlzdFJlc3BvbnNlLCBSZXBvc2l0b3J5SW5mbywgVXBkYXRlUmVwb3NpdG9yeVJlcXVlc3QsIFVwZGF0ZVJlcG9zaXRvcnlSZXNwb25zZSwgUmVwb3NpdG9yeVVzZXJXcml0ZUFjY2Vzc0RhdGEsIFVwZGF0ZVJlcG9zaXRvcnlVc2VyV3JpdGVBY2Nlc3NSZXF1ZXN0LCBVcGRhdGVSZXBvc2l0b3J5VXNlcldyaXRlQWNjZXNzUmVzcG9uc2UsIERlbGV0ZVJlcG9zaXRvcnlSZXF1ZXN0IH0gZnJvbSBcIi4uLy4uL2NvbW11bmljYXRpb24vRGF0YS5qc1wiO1xyXG5pbXBvcnQgeyBhamF4IH0gZnJvbSBcIi4uLy4uL2NvbW11bmljYXRpb24vQWpheEhlbHBlci5qc1wiO1xyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBSZXBvc2l0b3J5U2V0dGluZ3NNYW5hZ2VyIHtcclxuXHJcbiAgICBndWlSZWFkeTogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICAgICRtYWluSGVhZGluZzogSlF1ZXJ5PEhUTUxEaXZFbGVtZW50PjtcclxuXHJcbiAgICAkc2V0dGluZ3NEaXY6IEpRdWVyeTxIVE1MRWxlbWVudD47XHJcbiAgICAkcmVwb05hbWU6IEpRdWVyeTxIVE1MSW5wdXRFbGVtZW50PjtcclxuICAgICRyZXBvRGVzY3JpcHRpb246IEpRdWVyeTxIVE1MVGV4dEFyZWFFbGVtZW50PjtcclxuICAgICRyZXBvUHVibGlzaGVkVG86IEpRdWVyeTxIVE1MU2VsZWN0RWxlbWVudD47XHJcbiAgICAkcmVwb093bmVyOiBKUXVlcnk8SFRNTFNlbGVjdEVsZW1lbnQ+O1xyXG5cclxuICAgICRyZXBvTGlzdERpdjogSlF1ZXJ5PEhUTUxFbGVtZW50PjtcclxuXHJcbiAgICAkdXNlcmxpc3REaXY6IEpRdWVyeTxIVE1MRWxlbWVudD47XHJcblxyXG4gICAgJGV4aXRCdXR0b246IEpRdWVyeTxIVE1MRWxlbWVudD47XHJcbiAgICAkc2F2ZUJ1dHRvbjogSlF1ZXJ5PEhUTUxFbGVtZW50PjtcclxuICAgICRkZWxldGVCdXR0b246IEpRdWVyeTxIVE1MRWxlbWVudD47XHJcblxyXG4gICAgJHNldHRpbmdzU2VjcmV0UmVhZDogSlF1ZXJ5PEhUTUxFbGVtZW50PjtcclxuICAgICRzZXR0aW5nc1NlY3JldFdyaXRlOiBKUXVlcnk8SFRNTEVsZW1lbnQ+O1xyXG5cclxuICAgIHB1Ymxpc2hlZFRvSXRlbXM6IFNlbGVjdEl0ZW1bXSA9IFtdO1xyXG5cclxuICAgIHJlcG9zaXRvcnlPd25lckl0ZW1zOiBTZWxlY3RJdGVtW10gPSBbXTtcclxuXHJcbiAgICB1c2VyczogUmVwb3NpdG9yeVVzZXJbXSA9IFtdO1xyXG5cclxuICAgIHdvcmtzcGFjZTogV29ya3NwYWNlO1xyXG4gICAgcmVwb3NpdG9yeUluZm86IFJlcG9zaXRvcnlJbmZvO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBtYWluOiBNYWluKSB7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdEdVSSgpIHtcclxuICAgICAgICB0aGlzLmd1aVJlYWR5ID0gdHJ1ZTtcclxuICAgICAgICBsZXQgdGhhdCA9IHRoaXM7XHJcbiAgICAgICAgbGV0ICR1cGRhdGVEaXYgPSBqUXVlcnkoJyN1cGRhdGVSZXBvLWRpdicpO1xyXG5cclxuICAgICAgICAkdXBkYXRlRGl2LmFwcGVuZCh0aGlzLiRtYWluSGVhZGluZyA9IG1ha2VEaXYoJ3VwZGF0ZVJlcG8tbWFpbkhlYWRpbmcnLCBcImNyZWF0ZVVwZGF0ZVJlcG8tbWFpbkhlYWRpbmdcIiwgXCJcIikpO1xyXG4gICAgICAgIHRoaXMuJG1haW5IZWFkaW5nLmFwcGVuZChtYWtlRGl2KFwiXCIsIFwiXCIsIFwiUmVwb3NpdG9yaWVzIHZlcndhbHRlblwiKSk7XHJcbiAgICAgICAgdGhpcy4kbWFpbkhlYWRpbmcuYXBwZW5kKHRoaXMuJGV4aXRCdXR0b24gPSBtYWtlRGl2KFwiXCIsIFwiam9fc3luY2hyb19idXR0b25cIiwgXCJadXLDvGNrIHp1bSBQcm9ncmFtbWllcmVuXCIsIHsgXCJiYWNrZ3JvdW5kLWNvbG9yXCI6IFwidmFyKC0tc3BlZWRjb250cm9sLWdyaXApXCIsIFwiY29sb3JcIjogXCJ2YXIoLS1mb250Q29sb3JMaWdodClcIiwgXCJmb250LXNpemVcIjogXCIxMHB0XCIgfSkpO1xyXG4gICAgICAgIHRoaXMuJGV4aXRCdXR0b24ub24oXCJjbGlja1wiLCAoKSA9PiB7IHRoYXQuZXhpdEJ1dHRvbkNsaWNrZWQoKSB9KVxyXG5cclxuXHJcbiAgICAgICAgbGV0ICRkaXZCZWxvdyA9IG1ha2VEaXYoXCJ1cGRhdGVSZXBvLWRpdkJlbG93XCIpO1xyXG4gICAgICAgICR1cGRhdGVEaXYuYXBwZW5kKCRkaXZCZWxvdyk7XHJcblxyXG4gICAgICAgIGxldCAkZGl2TGVmdCA9IG1ha2VEaXYoXCJ1cGRhdGVSZXBvLWRpdkxlZnRcIik7XHJcbiAgICAgICAgJGRpdkJlbG93LmFwcGVuZCgkZGl2TGVmdCk7XHJcblxyXG4gICAgICAgICRkaXZMZWZ0LmFwcGVuZChtYWtlRGl2KCcnLCAndXBkYXRlUmVwby1taW5vckhlYWRpbmcnLCAnUmVwb3NpdG9yaWVzOicpKTtcclxuXHJcbiAgICAgICAgdGhpcy4kcmVwb0xpc3REaXYgPSBtYWtlRGl2KFwidXBkYXRlUmVwby1yZXBvTGlzdERpdlwiKTtcclxuICAgICAgICAkZGl2TGVmdC5hcHBlbmQodGhpcy4kcmVwb0xpc3REaXYpO1xyXG5cclxuICAgICAgICBsZXQgJHJpZ2h0RGl2ID0gbWFrZURpdihcInVwZGF0ZVJlcG8tZGl2UmlnaHRcIik7XHJcbiAgICAgICAgJGRpdkJlbG93LmFwcGVuZCgkcmlnaHREaXYpO1xyXG5cclxuICAgICAgICB0aGlzLiRzZXR0aW5nc0RpdiA9IG1ha2VEaXYoXCJcIiwgXCJjcmVhdGVVcGRhdGVSZXBvLXNldHRpbmdzRGl2XCIpO1xyXG4gICAgICAgICRyaWdodERpdi5hcHBlbmQodGhpcy4kc2V0dGluZ3NEaXYpO1xyXG5cclxuICAgICAgICB0aGlzLiRzZXR0aW5nc0Rpdi5hcHBlbmQoalF1ZXJ5KCc8ZGl2IGNsYXNzPVwiY3JlYXRlVXBkYXRlUmVwby1zZXR0aW5nc0xhYmVsXCI+TmFtZSBkZXMgUmVwb3NpdG9yeXM6PC9kaXY+JykpO1xyXG4gICAgICAgIHRoaXMuJHNldHRpbmdzRGl2LmFwcGVuZCh0aGlzLiRyZXBvTmFtZSA9IGpRdWVyeSgnPGlucHV0IHR5cGU9XCJ0ZXh0XCIgY2xhc3M9XCJjcmVhdGVVcGRhdGVSZXBvLWlucHV0Y29sdW1uXCI+PC9pbnB1dD4nKSk7XHJcbiAgICAgICAgdGhpcy4kcmVwb05hbWUub24oXCJpbnB1dFwiLCAoKSA9PiB7IHRoYXQuZW5hYmxlU2F2ZUJ1dHRvbigpIH0pO1xyXG5cclxuICAgICAgICB0aGlzLiRzZXR0aW5nc0Rpdi5hcHBlbmQoalF1ZXJ5KCc8ZGl2IGNsYXNzPVwiY3JlYXRlVXBkYXRlUmVwby1zZXR0aW5nc0xhYmVsXCI+QmVzY2hyZWlidW5nOjwvZGl2PicpKTtcclxuICAgICAgICB0aGlzLiRzZXR0aW5nc0Rpdi5hcHBlbmQodGhpcy4kcmVwb0Rlc2NyaXB0aW9uID0galF1ZXJ5KCc8dGV4dGFyZWEgY2xhc3M9XCJjcmVhdGVVcGRhdGVSZXBvLWlucHV0Y29sdW1uXCIgc3R5bGU9XCJtaW4taGVpZ2h0OiA0ZW1cIj48L3RleHRhcmVhPicpKTtcclxuICAgICAgICB0aGlzLiRyZXBvRGVzY3JpcHRpb24ub24oXCJpbnB1dFwiLCAoKSA9PiB7IHRoYXQuZW5hYmxlU2F2ZUJ1dHRvbigpIH0pO1xyXG5cclxuXHJcbiAgICAgICAgdGhpcy4kc2V0dGluZ3NEaXYuYXBwZW5kKGpRdWVyeSgnPGRpdiBjbGFzcz1cImNyZWF0ZVVwZGF0ZVJlcG8tc2V0dGluZ3NMYWJlbFwiPlZlcsO2ZmZlbnRsaWNodCBmw7xyOjwvZGl2PicpKTtcclxuICAgICAgICB0aGlzLiRzZXR0aW5nc0Rpdi5hcHBlbmQodGhpcy4kcmVwb1B1Ymxpc2hlZFRvID0galF1ZXJ5KCc8c2VsZWN0IGNsYXNzPVwiY3JlYXRlVXBkYXRlUmVwby1pbnB1dGNvbHVtblwiPjwvc2VsZWN0PicpKTtcclxuICAgICAgICB0aGlzLiRyZXBvUHVibGlzaGVkVG8ub24oXCJjaGFuZ2VcIiwgKCkgPT4geyB0aGF0LmVuYWJsZVNhdmVCdXR0b24oKSB9KTtcclxuXHJcbiAgICAgICAgdGhpcy4kc2V0dGluZ3NEaXYuYXBwZW5kKGpRdWVyeSgnPGRpdiBjbGFzcz1cImNyZWF0ZVVwZGF0ZVJlcG8tc2V0dGluZ3NMYWJlbFwiPkVpZ2VudMO8bWVyOjwvZGl2PicpKTtcclxuICAgICAgICB0aGlzLiRzZXR0aW5nc0Rpdi5hcHBlbmQodGhpcy4kcmVwb093bmVyID0galF1ZXJ5KCc8c2VsZWN0IGNsYXNzPVwiY3JlYXRlVXBkYXRlUmVwby1pbnB1dGNvbHVtblwiPjwvc2VsZWN0PicpKTtcclxuICAgICAgICB0aGlzLiRyZXBvT3duZXIub24oXCJjaGFuZ2VcIiwgKCkgPT4geyB0aGF0LmVuYWJsZVNhdmVCdXR0b24oKSB9KTtcclxuXHJcbiAgICAgICAgdGhpcy4kc2V0dGluZ3NEaXYuYXBwZW5kKGpRdWVyeSgnPGRpdiBjbGFzcz1cImNyZWF0ZVVwZGF0ZVJlcG8tc2V0dGluZ3NMYWJlbFwiPkNvZGUgenVtIGxlc2VuZGVuIFp1Z3JpZmYgYXVmcyBSZXBvc2l0b3J5OjwvZGl2PicpKTtcclxuICAgICAgICBsZXQgJHNldFNlY3JEaXZSZWFkID0galF1ZXJ5KCc8ZGl2IGNsYXNzPVwiY3JlYXRlVXBkYXRlUmVwby1zZXR0aW5nc1NlY3JldFwiPjwvZGl2PicpO1xyXG4gICAgICAgIHRoaXMuJHNldHRpbmdzRGl2LmFwcGVuZCgkc2V0U2VjckRpdlJlYWQpO1xyXG4gICAgICAgIHRoaXMuJHNldHRpbmdzU2VjcmV0UmVhZCA9IGpRdWVyeSgnPGRpdiBjbGFzcz1cImNyZWF0ZVVwZGF0ZVJlcG8tc2V0dGluZ3NTZWNyZXRTZWNyZXRcIj4tLS08L2Rpdj4nKVxyXG4gICAgICAgICRzZXRTZWNyRGl2UmVhZC5hcHBlbmQodGhpcy4kc2V0dGluZ3NTZWNyZXRSZWFkKTtcclxuXHJcbiAgICAgICAgbGV0ICRzZXRTZWNyUmVhZENvcHlCdXR0b24gPSBqUXVlcnkoJzxidXR0b24gY2xhc3M9XCJqb19idXR0b24gam9fY29weV9zZWNyZXRfYnV0dG9uIGpvX2FjdGl2ZVwiPktvcGllcmVuPC9idXR0b24+Jyk7XHJcbiAgICAgICAgJHNldFNlY3JEaXZSZWFkLmFwcGVuZCgkc2V0U2VjclJlYWRDb3B5QnV0dG9uKTtcclxuICAgICAgICAkc2V0U2VjclJlYWRDb3B5QnV0dG9uLm9uKFwicG9pbnRlcmRvd25cIiwgKCkgPT4ge2NvcHlUZXh0VG9DbGlwYm9hcmQodGhpcy4kc2V0dGluZ3NTZWNyZXRSZWFkLnRleHQoKSl9KVxyXG5cclxuICAgICAgICBsZXQgJHNldFNlY3JSZWFkQnV0dG9uID0galF1ZXJ5KCc8YnV0dG9uIGNsYXNzPVwiam9fYnV0dG9uIGpvX3NldF9zZWNyZXRfYnV0dG9uIGpvX2FjdGl2ZVwiPsOEbmRlcm48L2J1dHRvbj4nKTtcclxuICAgICAgICAkc2V0U2VjckRpdlJlYWQuYXBwZW5kKCRzZXRTZWNyUmVhZEJ1dHRvbik7XHJcbiAgICAgICAgJHNldFNlY3JSZWFkQnV0dG9uLm9uKFwicG9pbnRlcmRvd25cIiwgKCkgPT4ge3RoYXQuc2V0U2VjcmV0KHRydWUsIGZhbHNlKX0pXHJcblxyXG4gICAgICAgIHRoaXMuJHNldHRpbmdzRGl2LmFwcGVuZChqUXVlcnkoJzxkaXYgY2xhc3M9XCJjcmVhdGVVcGRhdGVSZXBvLXNldHRpbmdzTGFiZWxcIj5Db2RlIHp1bSBzY2hyZWliZW5kZW4gWnVncmlmZiBhdWZzIFJlcG9zaXRvcnk6PC9kaXY+JykpO1xyXG4gICAgICAgIGxldCAkc2V0U2VjckRpdldyaXRlID0galF1ZXJ5KCc8ZGl2IGNsYXNzPVwiY3JlYXRlVXBkYXRlUmVwby1zZXR0aW5nc1NlY3JldFwiPjwvZGl2PicpO1xyXG4gICAgICAgIHRoaXMuJHNldHRpbmdzRGl2LmFwcGVuZCgkc2V0U2VjckRpdldyaXRlKTtcclxuICAgICAgICB0aGlzLiRzZXR0aW5nc1NlY3JldFdyaXRlID0galF1ZXJ5KCc8ZGl2IGNsYXNzPVwiY3JlYXRlVXBkYXRlUmVwby1zZXR0aW5nc1NlY3JldFNlY3JldFwiPi0tLTwvZGl2PicpXHJcbiAgICAgICAgJHNldFNlY3JEaXZXcml0ZS5hcHBlbmQodGhpcy4kc2V0dGluZ3NTZWNyZXRXcml0ZSk7XHJcblxyXG4gICAgICAgIGxldCAkc2V0U2VjcldyaXRlQ29weUJ1dHRvbiA9IGpRdWVyeSgnPGJ1dHRvbiBjbGFzcz1cImpvX2J1dHRvbiBqb19jb3B5X3NlY3JldF9idXR0b24gam9fYWN0aXZlXCI+S29waWVyZW48L2J1dHRvbj4nKTtcclxuICAgICAgICAkc2V0U2VjckRpdldyaXRlLmFwcGVuZCgkc2V0U2VjcldyaXRlQ29weUJ1dHRvbik7XHJcbiAgICAgICAgJHNldFNlY3JXcml0ZUNvcHlCdXR0b24ub24oXCJwb2ludGVyZG93blwiLCAoKSA9PiB7Y29weVRleHRUb0NsaXBib2FyZCh0aGlzLiRzZXR0aW5nc1NlY3JldFdyaXRlLnRleHQoKSl9KVxyXG5cclxuICAgICAgICBsZXQgJHNldFNlY3JXcml0ZUJ1dHRvbiA9IGpRdWVyeSgnPGJ1dHRvbiBjbGFzcz1cImpvX2J1dHRvbiBqb19zZXRfc2VjcmV0X2J1dHRvbiBqb19hY3RpdmVcIj7DhG5kZXJuPC9idXR0b24+Jyk7XHJcbiAgICAgICAgJHNldFNlY3JEaXZXcml0ZS5hcHBlbmQoJHNldFNlY3JXcml0ZUJ1dHRvbik7XHJcbiAgICAgICAgJHNldFNlY3JXcml0ZUJ1dHRvbi5vbihcInBvaW50ZXJkb3duXCIsICgpID0+IHt0aGF0LnNldFNlY3JldChmYWxzZSwgdHJ1ZSl9KVxyXG5cclxuICAgICAgICAkcmlnaHREaXYuYXBwZW5kKHRoaXMuJHVzZXJsaXN0RGl2ID0gbWFrZURpdihcInVwZGF0ZVJlcG8tdXNlcmxpc3REaXZcIikpO1xyXG5cclxuICAgICAgICB0aGlzLiR1c2VybGlzdERpdi5hcHBlbmQobWFrZURpdihudWxsLCBcInVwZGF0ZVJlcG8tdXNlcmxpc3RoZWFkaW5nXCIsIFwiQmVudXR6ZXIsIGRpZSBkYXMgUmVwb3NpdG9yeSBudXR6ZW5cIiwgeyBcImdyaWQtY29sdW1uXCI6IDEgfSkpXHJcbiAgICAgICAgdGhpcy4kdXNlcmxpc3REaXYuYXBwZW5kKG1ha2VEaXYobnVsbCwgXCJ1cGRhdGVSZXBvLXVzZXJsaXN0aGVhZGluZ1wiLCBcIlNjaHJlaWJiZXJlY2h0aWd1bmdcIiwgeyBcImdyaWQtY29sdW1uXCI6IDIgfSkpXHJcblxyXG4gICAgICAgIGxldCAkYnV0dG9uRGl2ID0gbWFrZURpdihcInVwZGF0ZVJlcG8tYnV0dG9uRGl2XCIpO1xyXG5cclxuICAgICAgICAkYnV0dG9uRGl2LmFwcGVuZCh0aGlzLiRzYXZlQnV0dG9uID0gbWFrZURpdihcIlwiLCBcImpvX3N5bmNocm9fYnV0dG9uXCIsIFwiw4RuZGVydW5nZW4gc3BlaWNoZXJuXCIsIHsgXCJiYWNrZ3JvdW5kLWNvbG9yXCI6IFwidmFyKC0tdXBkYXRlQnV0dG9uQmFja2dyb3VuZClcIiwgXCJjb2xvclwiOiBcInZhcigtLXVwZGF0ZUJ1dHRvbkNvbG9yKVwiIH0pKTtcclxuICAgICAgICB0aGlzLiRzYXZlQnV0dG9uLm9uKFwiY2xpY2tcIiwgKCkgPT4geyB0aGF0LnNhdmVCdXR0b25DbGlja2VkKCkgfSlcclxuICAgICAgICB0aGlzLiRzYXZlQnV0dG9uLmhpZGUoKTtcclxuXHJcbiAgICAgICAgJHJpZ2h0RGl2LmFwcGVuZCgkYnV0dG9uRGl2KTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgc2V0U2VjcmV0KHJlYWQ6IGJvb2xlYW4sIHdyaXRlOiBib29sZWFuKXtcclxuXHJcbiAgICAgICAgdGhpcy5tYWluLm5ldHdvcmtNYW5hZ2VyLnNlbmRTZXRTZWNyZXQodGhpcy5yZXBvc2l0b3J5SW5mby5pZCwgcmVhZCwgd3JpdGUsIChyZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgcHJhZWZpeCA9IHRoaXMucmVwb3NpdG9yeUluZm8uaWQgKyBcIlRcIjtcclxuICAgICAgICAgICAgdGhpcy4kc2V0dGluZ3NTZWNyZXRSZWFkLnRleHQocHJhZWZpeCArIHJlc3BvbnNlLnNlY3JldF9yZWFkKTtcclxuICAgICAgICAgICAgdGhpcy4kc2V0dGluZ3NTZWNyZXRXcml0ZS50ZXh0KHByYWVmaXggKyByZXNwb25zZS5zZWNyZXRfd3JpdGUpO1xyXG4gICAgICAgIH0pXHJcblxyXG4gICAgfVxyXG5cclxuICAgIGVuYWJsZVNhdmVCdXR0b24oKSB7XHJcbiAgICAgICAgdGhpcy4kc2F2ZUJ1dHRvbi5zaG93KCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2hvdyhyZXBvc2l0b3J5X2lkOiBudW1iZXIpIHtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmd1aVJlYWR5KSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdEdVSSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0ICRzeW5jaHJvRGl2ID0galF1ZXJ5KCcjdXBkYXRlUmVwby1kaXYnKTtcclxuICAgICAgICAkc3luY2hyb0Rpdi5jc3MoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpO1xyXG4gICAgICAgIGxldCAkbWFpbkRpdiA9IGpRdWVyeSgnI21haW4nKTtcclxuICAgICAgICAkbWFpbkRpdi5jc3MoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XHJcblxyXG4gICAgICAgIGxldCB1c2VyID0gdGhpcy5tYWluLnVzZXI7XHJcbiAgICAgICAgbGV0IGlzX3N0dWRlbnQgPSAhKHVzZXIuaXNfdGVhY2hlciB8fCB1c2VyLmlzX2FkbWluIHx8IHVzZXIuaXNfc2Nob29sYWRtaW4pO1xyXG5cclxuICAgICAgICB0aGlzLnB1Ymxpc2hlZFRvSXRlbXMgPSBbXHJcbiAgICAgICAgICAgIHsgdmFsdWU6IDAsIG9iamVjdDogMCwgY2FwdGlvbjogXCJLZWluZSBWZXLDtmZmZW50bGljaHVuZyAocHJpdmF0ZXMgUmVwb3NpdG9yeSlcIiB9LFxyXG4gICAgICAgICAgICB7IHZhbHVlOiAxLCBvYmplY3Q6IDEsIGNhcHRpb246IGlzX3N0dWRlbnQgPyBcIlZlcsO2ZmZlbnRsaWNodCBmw7xyIGFsbGUgU2Now7xsZXIvaW5uZW4gZGVyIEtsYXNzZVwiIDogXCJWZXLDtmZmZW50bGljaHQgZsO8ciBhbGxlIFNjaMO8bGVyL2lubmVuIGRlciB1bnRlcnJpY2h0ZXRlbiBLbGFzc2VuXCIgfSxcclxuICAgICAgICAgICAgeyB2YWx1ZTogMiwgb2JqZWN0OiAyLCBjYXB0aW9uOiBcIlZlcsO2ZmZlbnRsaWNodCBmw7xyIGFsbGUgU2Now7xsZXIvaW5uZW4gZGVyIFNjaHVsZVwiIH0sXHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgc2V0U2VsZWN0SXRlbXModGhpcy4kcmVwb1B1Ymxpc2hlZFRvLCB0aGlzLnB1Ymxpc2hlZFRvSXRlbXMsIDApO1xyXG5cclxuICAgICAgICB0aGlzLiRzYXZlQnV0dG9uLnNob3coKTtcclxuXHJcbiAgICAgICAgdGhpcy5zaG93UmVwb3NpdG9yeUxpc3QoKTtcclxuXHJcbiAgICAgICAgbGV0IHRoYXQgPSB0aGlzO1xyXG5cclxuICAgICAgICB0aGlzLm1haW4ud2luZG93U3RhdGVNYW5hZ2VyLnJlZ2lzdGVyT25lVGltZUJhY2tCdXR0b25MaXN0ZW5lcigoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoYXQuaGlkZSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBkZWxldGVSZXBvc2l0b3J5KHJlcEluZm86IFJlcG9zaXRvcnlJbmZvKSB7XHJcblxyXG4gICAgICAgIGxldCB0aGF0ID0gdGhpcztcclxuICAgICAgICBsZXQgcmVxdWVzdDogRGVsZXRlUmVwb3NpdG9yeVJlcXVlc3QgPSB7IHJlcG9zaXRvcnlfaWQ6IHJlcEluZm8uaWQgfTtcclxuICAgICAgICBhamF4KCdkZWxldGVSZXBvc2l0b3J5JywgcmVxdWVzdCwgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGF0LnNob3dSZXBvc2l0b3J5TGlzdCgpO1xyXG4gICAgICAgICAgICBsZXQgd29ya3NwYWNlcyA9IHRoYXQubWFpbi53b3Jrc3BhY2VMaXN0LmZpbHRlcigod3MpID0+IHtyZXR1cm4gd3MucmVwb3NpdG9yeV9pZCA9PSByZXBJbmZvLmlkfSk7XHJcbiAgICAgICAgICAgIGZvcihsZXQgd3Mgb2Ygd29ya3NwYWNlcyl7XHJcbiAgICAgICAgICAgICAgICB3cy5yZXBvc2l0b3J5X2lkID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHdzLnBhbmVsRWxlbWVudC5pY29uQ2xhc3MgPSBcIndvcmtzcGFjZVwiO1xyXG4gICAgICAgICAgICAgICAgd3MucGFuZWxFbGVtZW50LiRodG1sRmlyc3RMaW5lLnJlbW92ZUNsYXNzKFwiam9fcmVwb3NpdG9yeVwiKTtcclxuICAgICAgICAgICAgICAgIHdzLnBhbmVsRWxlbWVudC4kaHRtbEZpcnN0TGluZS5hZGRDbGFzcyhcImpvX3dvcmtzcGFjZVwiKTtcclxuICAgICAgICAgICAgICAgIHdzLnBhbmVsRWxlbWVudC4kaHRtbEZpcnN0TGluZS5maW5kKFwiLmpvX2FkZGl0aW9uYWxCdXR0b25SZXBvc2l0b3J5XCIpLmVtcHR5KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgc2hvd1JlcG9zaXRvcnlMaXN0KCkge1xyXG4gICAgICAgIHRoaXMuZW1wdHlSZXBvc2l0b3J5SW5mbygpO1xyXG4gICAgICAgIGxldCBncmxxOiBHZXRSZXBvc2l0b3J5TGlzdFJlcXVlc3QgPSB7XHJcbiAgICAgICAgICAgIG9ubHlPd25SZXBvc2l0b3JpZXM6IHRydWVcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuJHJlcG9MaXN0RGl2LmVtcHR5KCk7XHJcbiAgICAgICAgbGV0IHRoYXQgPSB0aGlzO1xyXG4gICAgICAgIGFqYXgoJ2dldFJlcG9zaXRvcnlMaXN0JywgZ3JscSwgKHJlc3BvbnNlOiBHZXRSZXBvc2l0b3J5TGlzdFJlc3BvbnNlKSA9PiB7XHJcblxyXG4gICAgICAgICAgICBsZXQgJGZpcnN0RGl2OiBKUXVlcnk8SFRNTERpdkVsZW1lbnQ+O1xyXG4gICAgICAgICAgICBsZXQgZmlyc3RSZXBJbmZvOiBSZXBvc2l0b3J5SW5mbztcclxuXHJcbiAgICAgICAgICAgIGlmKHJlc3BvbnNlLnJlcG9zaXRvcmllcy5sZW5ndGggPT0gMCl7XHJcbiAgICAgICAgICAgICAgICBhbGVydCgnU2llIGhhYmVuIG5vY2gga2VpbmUgUmVwb3NpdG9yaWVzLCB1bmRcXG5rw7ZubmVuIGRhaGVyIGtlaW5lIHZlcndhbHRlbi5cXG5UaXBwOiBFaW4gUmVwb3NpdG9yeSBrw7ZubmVuIFNpZSBkdXJjaCBSZWNodHNrbGljayBhdWYgZWluZW4gV29ya3NwYWNlIGFubGVnZW4uJyk7XHJcbiAgICAgICAgICAgICAgICB0aGF0LmV4aXRCdXR0b25DbGlja2VkKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnJlcG9zaXRvcmllcy5mb3JFYWNoKHJlcEluZm8gPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0ICRkaXYgPSBtYWtlRGl2KCcnLCAndXBkYXRlUmVwby1yZXBvTGlzdEl0ZW0nKTtcclxuICAgICAgICAgICAgICAgIGxldCAkbmFtZWRpdiA9IG1ha2VEaXYoJycsICcnLCByZXBJbmZvLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgbGV0ICRkZWxldGVEaXYgPSBqUXVlcnkoJzxkaXYgY2xhc3M9XCJpbWdfZGVsZXRlIGpvX2J1dHRvbiBqb19hY3RpdmVcIiB0aXRsZT1cIlJlcG9zaXRvcnkgbMO2c2NoZW4uLi5cIj48L2Rpdj4nKTtcclxuICAgICAgICAgICAgICAgICRkaXYuYXBwZW5kKCRuYW1lZGl2LCAkZGVsZXRlRGl2KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuJHJlcG9MaXN0RGl2LmFwcGVuZCgkZGl2KTtcclxuICAgICAgICAgICAgICAgICRkaXYub24oJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGF0LnNlbGVjdFJlcG9zaXRvcnkoJGRpdiwgcmVwSW5mbyk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgJGRpdi5kYXRhKCdyZXBvSW5mbycsIHJlcEluZm8pO1xyXG4gICAgICAgICAgICAgICAgaWYgKGZpcnN0UmVwSW5mbyA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlyc3RSZXBJbmZvID0gcmVwSW5mbztcclxuICAgICAgICAgICAgICAgICAgICAkZmlyc3REaXYgPSAkZGl2O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICRkZWxldGVEaXYub24oXCJjbGlja1wiLCAoZXYpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIG9wZW5Db250ZXh0TWVudShbe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXB0aW9uOiBcIkFiYnJlY2hlblwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogKCkgPT4geyB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXB0aW9uOiBcIkljaCBiaW4gbWlyIHNpY2hlcjogbMO2c2NoZW4hXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBcIiNmZjYwNjBcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuZGVsZXRlUmVwb3NpdG9yeShyZXBJbmZvKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1dLCBldi5wYWdlWCArIDIsIGV2LnBhZ2VZICsgMik7XHJcbiAgICAgICAgICAgICAgICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoJGZpcnN0RGl2ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0UmVwb3NpdG9yeSgkZmlyc3REaXYsIGZpcnN0UmVwSW5mbyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSwgKG1lc3NhZ2UpID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2cobWVzc2FnZSk7XHJcbiAgICAgICAgICAgIGFsZXJ0KCdTaWUgaGFiZW4gbm9jaCBrZWluZSBSZXBvc2l0b3JpZXMsIHVuZFxcbmvDtm5uZW4gZGFoZXIga2VpbmUgdmVyd2FsdGVuLlxcblRpcHA6IEVpbiBSZXBvc2l0b3J5IGvDtm5uZW4gU2llIGR1cmNoIFJlY2h0c2tsaWNrIGF1ZiBlaW5lbiBXb3Jrc3BhY2UgYW5sZWdlbi4nKTtcclxuICAgICAgICAgICAgdGhhdC5leGl0QnV0dG9uQ2xpY2tlZCgpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZWN0UmVwb3NpdG9yeSgkcmVwb0RpdjogSlF1ZXJ5PEhUTUxEaXZFbGVtZW50PiwgcmVwSW5mbzogUmVwb3NpdG9yeUluZm8pIHtcclxuICAgICAgICB0aGlzLnJlcG9zaXRvcnlJbmZvID0gcmVwSW5mbztcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLmVtcHR5UmVwb3NpdG9yeUluZm8oKTtcclxuICAgICAgICBpZiAodGhpcy4kc2F2ZUJ1dHRvbi5pcyhcIjp2aXNpYmxlXCIpKSB7XHJcbiAgICAgICAgICAgIGxldCBzZWxlY3RlZEl0ZW0gPSB0aGlzLiRyZXBvTGlzdERpdi5maW5kKCcuYWN0aXZlJykuZmlyc3QoKTtcclxuICAgICAgICAgICAgbGV0IHJlcG9EYXRhOiBSZXBvc2l0b3J5SW5mbyA9IDxhbnk+c2VsZWN0ZWRJdGVtLmRhdGEoJ3JlcG9JbmZvJyk7XHJcbiAgICAgICAgICAgIGlmIChyZXBvRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgYWxlcnQoYERlaW5lIMOEbmRlcnVuZ2VuIGFtIFJlcG9zaXRvcnkgXCIke3JlcG9EYXRhLm5hbWV9XCIgd3VyZGVuIG5pY2h0IGdlc3BlaWNoZXJ0LmApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLiRzYXZlQnV0dG9uLmhpZGUoKTtcclxuICAgICAgICB0aGlzLiRyZXBvTGlzdERpdi5maW5kKCcudXBkYXRlUmVwby1yZXBvTGlzdEl0ZW0nKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgJHJlcG9EaXYuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgIHRoaXMuJHJlcG9OYW1lLnZhbChyZXBJbmZvLm5hbWUpO1xyXG4gICAgICAgIHRoaXMuJHJlcG9EZXNjcmlwdGlvbi52YWwocmVwSW5mby5kZXNjcmlwdGlvbik7XHJcbiAgICAgICAgdGhpcy4kcmVwb1B1Ymxpc2hlZFRvLnZhbChyZXBJbmZvLnB1Ymxpc2hlZF90byk7XHJcbiAgICAgICAgdGhpcy4kc2V0dGluZ3NTZWNyZXRSZWFkLnRleHQocmVwSW5mby5zZWNyZXRfcmVhZCA9PSBudWxsID8gXCItLS0tLS0tLVwiIDogcmVwSW5mby5pZCArIFwiVFwiICsgcmVwSW5mby5zZWNyZXRfcmVhZCk7XHJcbiAgICAgICAgdGhpcy4kc2V0dGluZ3NTZWNyZXRXcml0ZS50ZXh0KHJlcEluZm8uc2VjcmV0X3dyaXRlID09IG51bGwgPyBcIi0tLS0tLS0tXCIgOiByZXBJbmZvLmlkICsgXCJUXCIgKyByZXBJbmZvLnNlY3JldF93cml0ZSk7XHJcblxyXG4gICAgICAgIHRoaXMuJHJlcG9Pd25lci5lbXB0eSgpO1xyXG4gICAgICAgIHRoaXMuJHVzZXJsaXN0RGl2LmNoaWxkcmVuKCkubm90KCcudXBkYXRlUmVwby11c2VybGlzdGhlYWRpbmcnKS5yZW1vdmUoKTtcclxuXHJcbiAgICAgICAgbGV0IHJlcTogR2V0UmVwb3NpdG9yeVVzZXJMaXN0UmVxdWVzdCA9IHsgcmVwb3NpdG9yeV9pZDogcmVwSW5mby5pZCB9O1xyXG4gICAgICAgIGxldCB0aGF0ID0gdGhpcztcclxuXHJcbiAgICAgICAgYWpheCgnZ2V0UmVwb3NpdG9yeVVzZXJMaXN0JywgcmVxLCAocmVzcG9uc2U6IEdldFJlcG9zaXRvcnlVc2VyTGlzdFJlc3BvbnNlKSA9PiB7XHJcblxyXG4gICAgICAgICAgICByZXNwb25zZS5yZXBvc2l0b3J5VXNlckxpc3QuZm9yRWFjaCh1c2VyRGF0YSA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0ICR1c2VyRGl2ID0gbWFrZURpdihcIlwiLCBcInVwZGF0ZVJlcG8tdXNlckRpdlwiLCBgJHt1c2VyRGF0YS5maXJzdE5hbWV9ICR7dXNlckRhdGEubGFzdE5hbWV9ICgke3VzZXJEYXRhLnVzZXJuYW1lfSlgLCB7ICdncmlkLWNvbHVtbic6IDEgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0ICRjYW5Xcml0ZURpdiA9IG1ha2VEaXYoXCJcIiwgXCJjYW5Xcml0ZURpdlwiLCBcIlwiLCB7ICdncmlkLWNvbHVtbic6IDIgfSk7XHJcbiAgICAgICAgICAgICAgICBsZXQgJGNhbldyaXRlQ2hlY2tCb3ggPSBqUXVlcnkoJzxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIj4nKTtcclxuICAgICAgICAgICAgICAgICRjYW5Xcml0ZURpdi5hcHBlbmQoJGNhbldyaXRlQ2hlY2tCb3gpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgICAgJGNhbldyaXRlQ2hlY2tCb3guYXR0cignY2hlY2tlZCcsIHVzZXJEYXRhLmNhbldyaXRlKTtcclxuICAgICAgICAgICAgICAgICRjYW5Xcml0ZUNoZWNrQm94LmRhdGEoJ3VzZXInLCB1c2VyRGF0YSk7XHJcbiAgICAgICAgICAgICAgICAkY2FuV3JpdGVDaGVja0JveC5vbihcImNoYW5nZVwiLCAoKSA9PiB7IHRoYXQuZW5hYmxlU2F2ZUJ1dHRvbigpIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoYXQuJHVzZXJsaXN0RGl2LmFwcGVuZCgkdXNlckRpdiwgJGNhbldyaXRlRGl2KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGF0LiRyZXBvT3duZXIuZW1wdHkoKTtcclxuICAgICAgICAgICAgbGV0IHNlbGVjdGVkSXRlbXMgPSByZXNwb25zZS5yZXBvc2l0b3J5VXNlckxpc3QubWFwKHVzZXJEYXRhID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBzZTogU2VsZWN0SXRlbSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBjYXB0aW9uOiBgJHt1c2VyRGF0YS5maXJzdE5hbWV9ICR7dXNlckRhdGEubGFzdE5hbWV9ICgke3VzZXJEYXRhLnVzZXJuYW1lfSlgLFxyXG4gICAgICAgICAgICAgICAgICAgIG9iamVjdDogdXNlckRhdGEsXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHVzZXJEYXRhLnVzZXJfaWQgKyBcIlwiXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc2U7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYoIXJlc3BvbnNlLnJlcG9zaXRvcnlVc2VyTGlzdC5zb21lKHVzZXIgPT4gdXNlci51c2VyX2lkID09IHJlcEluZm8ub3duZXJfaWQpKXtcclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkSXRlbXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FwdGlvbjogYCR7cmVwSW5mby5vd25lcl9uYW1lfSAoJHtyZXBJbmZvLm93bmVyX3VzZXJuYW1lfSlgLFxyXG4gICAgICAgICAgICAgICAgICAgIG9iamVjdDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyX2lkOiByZXBJbmZvLm93bmVyX2lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZTogcmVwSW5mby5vd25lcl91c2VybmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3ROYW1lOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0TmFtZTogXCJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAga2xhc3NlOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW5Xcml0ZTogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHJlcEluZm8ub3duZXJfaWQgKyBcIlwiXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzZXRTZWxlY3RJdGVtcyh0aGF0LiRyZXBvT3duZXIsIHNlbGVjdGVkSXRlbXMsIHJlcEluZm8ub3duZXJfaWQgKyBcIlwiKVxyXG5cclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgZW1wdHlSZXBvc2l0b3J5SW5mbygpIHtcclxuICAgICAgICB0aGlzLiRyZXBvT3duZXIuZW1wdHkoKTtcclxuICAgICAgICB0aGlzLiRyZXBvTmFtZS52YWwoJycpO1xyXG4gICAgICAgIHRoaXMuJHJlcG9EZXNjcmlwdGlvbi52YWwoJycpO1xyXG4gICAgICAgIHRoaXMuJHVzZXJsaXN0RGl2LmZpbmQoJy51cGRhdGVSZXBvLXVzZXJEaXYnKS5yZW1vdmUoKTtcclxuICAgICAgICB0aGlzLiR1c2VybGlzdERpdi5maW5kKCcuY2FuV3JpdGVEaXYnKS5yZW1vdmUoKTtcclxuICAgIH1cclxuXHJcbiAgICBoaWRlKCkge1xyXG4gICAgICAgIGxldCAkc3luY2hyb0RpdiA9IGpRdWVyeSgnI3VwZGF0ZVJlcG8tZGl2Jyk7XHJcbiAgICAgICAgJHN5bmNocm9EaXYuY3NzKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xyXG4gICAgICAgIGxldCAkbWFpbkRpdiA9IGpRdWVyeSgnI21haW4nKTtcclxuICAgICAgICAkbWFpbkRpdi5jc3MoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpO1xyXG4gICAgfVxyXG5cclxuICAgIHNhdmVCdXR0b25DbGlja2VkKCkge1xyXG5cclxuICAgICAgICBsZXQgdGhhdCA9IHRoaXM7XHJcblxyXG4gICAgICAgIGxldCBzZWxlY3RlZEl0ZW0gPSB0aGlzLiRyZXBvTGlzdERpdi5maW5kKCcuYWN0aXZlJykuZmlyc3QoKTtcclxuICAgICAgICBsZXQgcmVwb0RhdGE6IFJlcG9zaXRvcnlJbmZvID0gPGFueT5zZWxlY3RlZEl0ZW0uZGF0YSgncmVwb0luZm8nKTtcclxuXHJcbiAgICAgICAgbGV0IG5hbWU6IHN0cmluZyA9IDxzdHJpbmc+dGhpcy4kcmVwb05hbWUudmFsKCk7XHJcbiAgICAgICAgbGV0IG93bmVyOiBSZXBvc2l0b3J5VXNlciA9IGdldFNlbGVjdGVkT2JqZWN0KHRoaXMuJHJlcG9Pd25lcik7XHJcbiAgICAgICAgbGV0IHB1Ymxpc2hlZF90bzogbnVtYmVyID0gZ2V0U2VsZWN0ZWRPYmplY3QodGhpcy4kcmVwb1B1Ymxpc2hlZFRvKTtcclxuXHJcbiAgICAgICAgbGV0IHVwZGF0ZVJlcG9zaXRvcnlSZXF1ZXN0OiBVcGRhdGVSZXBvc2l0b3J5UmVxdWVzdCA9IHtcclxuICAgICAgICAgICAgb3duZXJfaWQ6IG93bmVyLnVzZXJfaWQsXHJcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiA8c3RyaW5nPnRoaXMuJHJlcG9EZXNjcmlwdGlvbi52YWwoKSxcclxuICAgICAgICAgICAgcHVibGlzaGVkX3RvOiBwdWJsaXNoZWRfdG8sXHJcbiAgICAgICAgICAgIHJlcG9zaXRvcnlfaWQ6IHJlcG9EYXRhLmlkLFxyXG4gICAgICAgICAgICBuYW1lOiBuYW1lXHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIC8vIHVwZGF0ZSB1c2VyIHdyaXRlIGFjY2VzczpcclxuXHJcbiAgICAgICAgbGV0IHdyaXRlQWNjZXNzTGlzdDogUmVwb3NpdG9yeVVzZXJXcml0ZUFjY2Vzc0RhdGFbXSA9IFtdO1xyXG5cclxuICAgICAgICB0aGF0LiR1c2VybGlzdERpdi5maW5kKCdpbnB1dCcpLmVhY2goKGluZGV4LCBlbGVtZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCAkZWxlbWVudCA9IGpRdWVyeShlbGVtZW50KTtcclxuICAgICAgICAgICAgbGV0IHVzZXI6IFJlcG9zaXRvcnlVc2VyID0gPGFueT4kZWxlbWVudC5kYXRhKCd1c2VyJyk7XHJcbiAgICAgICAgICAgIHdyaXRlQWNjZXNzTGlzdC5wdXNoKHtcclxuICAgICAgICAgICAgICAgIGhhc193cml0ZV9hY2Nlc3M6IDxhbnk+alF1ZXJ5KGVsZW1lbnQpLmlzKCc6Y2hlY2tlZCcpLFxyXG4gICAgICAgICAgICAgICAgdXNlcl9pZDogdXNlci51c2VyX2lkXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBsZXQgcmVxdWVzdDogVXBkYXRlUmVwb3NpdG9yeVVzZXJXcml0ZUFjY2Vzc1JlcXVlc3QgPSB7XHJcbiAgICAgICAgICAgIHJlcG9zaXRvcnlfaWQ6IHJlcG9EYXRhLmlkLFxyXG4gICAgICAgICAgICB3cml0ZUFjY2Vzc0xpc3Q6IHdyaXRlQWNjZXNzTGlzdFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHJlcG9EYXRhLm93bmVyX2lkID09IG93bmVyLnVzZXJfaWQgfHwgXHJcbiAgICAgICAgICAgICAgY29uZmlybShcIlNvbGwgZGllIEVpZ2VudMO8bWVyc2NoYWZ0IMO8YmVyIGRhcyBSZXBvc2l0b3J5IFwiICsgcmVwb0RhdGEubmFtZSArIFwiIHdpcmtsaWNoIGFuIFwiICsgb3duZXIuZmlyc3ROYW1lICsgXCIgXCIgKyBvd25lci5sYXN0TmFtZSArIFwiIMO8YmVydHJhZ2VuIHdlcmRlbj9cIikpIHtcclxuICAgICAgICAgICAgYWpheCgndXBkYXRlUmVwb3NpdG9yeVVzZXJXcml0ZUFjY2VzcycsIHJlcXVlc3QsIChyZXNwb25zZTogVXBkYXRlUmVwb3NpdG9yeVVzZXJXcml0ZUFjY2Vzc1Jlc3BvbnNlKSA9PiB7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGFqYXgoXCJ1cGRhdGVSZXBvc2l0b3J5XCIsIHVwZGF0ZVJlcG9zaXRvcnlSZXF1ZXN0LCAocmVzcG9uc2U6IFVwZGF0ZVJlcG9zaXRvcnlSZXNwb25zZSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXBvRGF0YS5uYW1lID0gbmFtZTtcclxuICAgICAgICAgICAgICAgICAgICByZXBvRGF0YS5vd25lcl9pZCA9IG93bmVyLnVzZXJfaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVwb0RhdGEub3duZXJfbmFtZSA9IG93bmVyLmZpcnN0TmFtZSArIFwiIFwiICsgb3duZXIubGFzdE5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVwb0RhdGEub3duZXJfdXNlcm5hbWUgPSBvd25lci51c2VybmFtZTtcclxuICAgICAgICAgICAgICAgICAgICByZXBvRGF0YS5wdWJsaXNoZWRfdG8gPSBwdWJsaXNoZWRfdG87XHJcbiAgICAgICAgICAgICAgICAgICAgcmVwb0RhdGEuZGVzY3JpcHRpb24gPSB1cGRhdGVSZXBvc2l0b3J5UmVxdWVzdC5kZXNjcmlwdGlvbjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYWxlcnQoJ0RpZSDDhG5kZXJ1bmdlbiB3dXJkZW4gZXJmb2xncmVpY2ggZ2VzcGVpY2hlcnQuJylcclxuICAgICAgICAgICAgICAgICAgICB0aGF0LiRzYXZlQnV0dG9uLmhpZGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGF0LnNob3dSZXBvc2l0b3J5TGlzdCgpO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICB9LCAoZXJyb3JNZXNzYWdlOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBhbGVydChcIkZlaGxlcjogXCIgKyBlcnJvck1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuZXhpdEJ1dHRvbkNsaWNrZWQoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgfSwgKGVycm9yTWVzc2FnZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBhbGVydChcIkZlaGxlcjogXCIgKyBlcnJvck1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgdGhhdC5leGl0QnV0dG9uQ2xpY2tlZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYWxlcnQoXCJEZXIgU3BlaWNoZXJ2b3JnYW5nIHd1cmRlIG5pY2h0IGR1cmNoZ2Vmw7xocnQuXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgZXhpdEJ1dHRvbkNsaWNrZWQoKSB7XHJcbiAgICAgICAgd2luZG93Lmhpc3RvcnkuYmFjaygpO1xyXG4gICAgfVxyXG5cclxuXHJcbn0iXX0=