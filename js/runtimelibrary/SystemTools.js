import { Method, Parameterlist } from "../compiler/types/Types.js";
import { Klass, Interface } from "../compiler/types/Class.js";
import { stringPrimitiveType, intPrimitiveType, voidPrimitiveType } from "../compiler/types/PrimitiveTypes.js";
import { RuntimeObject } from "../interpreter/RuntimeObject.js";
export class SystemToolsClass extends Klass {
    constructor(module) {
        super("SystemTools", module, "Klasse mit statischen Methoden für Systemfunktionen, z.B. Löschen der Ausgabe, Registrieren eines Tastaturlisteners usw.");
        this.setBaseClass(module.typeStore.getType("Object"));
        this.staticClass.setupAttributeIndicesRecursive();
        this.staticClass.classObject = new RuntimeObject(this.staticClass);
        this.addMethod(new Method("clearScreen", new Parameterlist([]), null, (parameters) => {
            module.main.getInterpreter().printManager.clear();
        }, false, true, "Löscht den Bildschirm"));
        this.addMethod(new Method("setSpeed", new Parameterlist([
            { identifier: "speed", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true }
        ]), null, (parameters) => {
            let speed = parameters[1].value;
            module.main.getInterpreter().controlButtons.speedControl.setSpeedInStepsPerSecond(speed >= 1 ? speed : "max");
        }, false, true, "Setzt die Ausführungsgeschwindigkeit. Der Parameter speed wir in Steps/Sekunde angegeben. Eine negative Zahl bedeutet: 'maximal'."));
        this.addMethod(new Method("getSpeed", new Parameterlist([]), intPrimitiveType, (parameters) => {
            return module.main.getInterpreter().controlButtons.speedControl.getSpeedInStepsPerSecond();
        }, false, true, "Gibt die Ausführungsgeschwindigkeit in Steps pro Sekunde zurück."));
        this.addMethod(new Method("pause", new Parameterlist([
            { identifier: "durationInMs", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true }
        ]), null, (parameters) => {
        }, false, true, "Pausiert das Programm für die angegebene Zeit in ms."));
        this.addMethod(new Method("addKeyListener", new Parameterlist([
            { identifier: "keyListener", type: module.typeStore.getType("KeyListener"), declaration: null, usagePositions: null, isFinal: true }
        ]), null, (parameters) => {
            let r = parameters[1].value;
            let method = r.class.getMethodBySignature("onKeyTyped(String)");
            if (method != null) {
                module.main.getInterpreter().keyboardTool.keyPressedCallbacks.push((key) => {
                    let program = method === null || method === void 0 ? void 0 : method.program;
                    let invoke = method === null || method === void 0 ? void 0 : method.invoke;
                    let stackElements = [
                        {
                            type: r.class,
                            value: r
                        },
                        {
                            type: stringPrimitiveType,
                            value: key
                        }
                    ];
                    if (program != null) {
                        module.main.getInterpreter().runTimer(method, stackElements, null, false);
                    }
                    else if (invoke != null) {
                        invoke([]);
                    }
                });
            }
        }, false, true, "Fügt einen KeyListener hinzu, dessen Methode keyTyped immer dann aufgerufen wird, wenn eine Taste gedrückt und anschließend losgelassen wird."));
        // this.addMethod(new Method("playSound", new Parameterlist([
        //     { identifier: "sound", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true }
        // ]), null,
        // (parameters) => {
        //     let sound: string = parameters[1].value;
        //     SoundTools.play(sound);
        // }    
        // , false, true, "Spielt einen Sound ab. Die Möglichen Sounds sind als statische Variablen der Klasse Sound hinterlegt. Tippe als Parameter also Sound gefolgt von einem Punkt ein, um eine Auswahl zu sehen!"));
    }
}
export class KeyListener extends Interface {
    constructor(module) {
        super("KeyListener", module, "Interface mit Methode onKeyTyped. Eine Klasse, die dieses Interface implementiert, kann auf Tastatureingaben reagieren. Ein Objekt dieser Klasse muss zuvor aber mit System.addKeyListener() registriert werden.");
        this.addMethod(new Method("onKeyTyped", new Parameterlist([
            { identifier: "key", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true }
        ]), voidPrimitiveType, null, // no implementation!
        false, false, "Wird aufgerufen, nachdem eine Taste gedrückt wurde."));
    }
}
export class PrintStreamClass extends Klass {
    constructor(module) {
        super("PrintStream", module, "Interne Hilfsklasse, um System.out.println zu ermöglichen. Das Objekt System.out ist von der Klasse PrintStream.");
        this.setBaseClass(module.typeStore.getType("Object"));
        this.addMethod(new Method("print", new Parameterlist([
            { identifier: "text", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true }
        ]), null, (parameters) => {
            module.main.getInterpreter().printManager.print(parameters[1].value);
        }, false, true, "Gibt den Text aus."));
        this.addMethod(new Method("println", new Parameterlist([
            { identifier: "text", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true }
        ]), null, (parameters) => {
            module.main.getInterpreter().printManager.println(parameters[1].value);
        }, false, true, "Gibt den Text aus, gefolgt von einem Zeilensprung."));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3lzdGVtVG9vbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY2xpZW50L3J1bnRpbWVsaWJyYXJ5L1N5c3RlbVRvb2xzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBUSxNQUFNLEVBQUUsYUFBYSxFQUFvQixNQUFNLDRCQUE0QixDQUFDO0FBQzNGLE9BQU8sRUFBRSxLQUFLLEVBQWMsU0FBUyxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDMUUsT0FBTyxFQUFFLG1CQUFtQixFQUEyQyxnQkFBZ0IsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHFDQUFxQyxDQUFDO0FBR3hKLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUloRSxNQUFNLE9BQU8sZ0JBQWlCLFNBQVEsS0FBSztJQUV2QyxZQUFZLE1BQWM7UUFDdEIsS0FBSyxDQUFDLGFBQWEsRUFBRSxNQUFNLEVBQUUsMEhBQTBILENBQUMsQ0FBQztRQUV6SixJQUFJLENBQUMsWUFBWSxDQUFRLE1BQU0sQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDN0QsSUFBSSxDQUFDLFdBQVcsQ0FBQyw4QkFBOEIsRUFBRSxDQUFDO1FBRWxELElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxHQUFHLElBQUksYUFBYSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUVuRSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksTUFBTSxDQUFDLGFBQWEsRUFBRSxJQUFJLGFBQWEsQ0FBQyxFQUMxRCxDQUFDLEVBQUUsSUFBSSxFQUNKLENBQUMsVUFBVSxFQUFFLEVBQUU7WUFDWCxNQUFNLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN0RCxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSx1QkFBdUIsQ0FBQyxDQUFDLENBQUM7UUFFOUMsSUFB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LCBWYWx1ZSwgQXR0cmlidXRlIH0gZnJvbSBcIi4uL2NvbXBpbGVyL3R5cGVzL1R5cGVzLmpzXCI7XHJcbmltcG9ydCB7IEtsYXNzLCBWaXNpYmlsaXR5LCBJbnRlcmZhY2UgfSBmcm9tIFwiLi4vY29tcGlsZXIvdHlwZXMvQ2xhc3MuanNcIjtcclxuaW1wb3J0IHsgc3RyaW5nUHJpbWl0aXZlVHlwZSwgZG91YmxlUHJpbWl0aXZlVHlwZSwgZmxvYXRQcmltaXRpdmVUeXBlLCBpbnRQcmltaXRpdmVUeXBlLCB2b2lkUHJpbWl0aXZlVHlwZSB9IGZyb20gXCIuLi9jb21waWxlci90eXBlcy9QcmltaXRpdmVUeXBlcy5qc1wiO1xyXG5pbXBvcnQgeyBNb2R1bGUgfSBmcm9tIFwiLi4vY29tcGlsZXIvcGFyc2VyL01vZHVsZS5qc1wiO1xyXG5pbXBvcnQgeyBQcmludE1hbmFnZXIgfSBmcm9tIFwiLi4vbWFpbi9ndWkvUHJpbnRNYW5hZ2VyLmpzXCI7XHJcbmltcG9ydCB7IFJ1bnRpbWVPYmplY3QgfSBmcm9tIFwiLi4vaW50ZXJwcmV0ZXIvUnVudGltZU9iamVjdC5qc1wiO1xyXG5pbXBvcnQgeyBFbnVtUnVudGltZU9iamVjdCB9IGZyb20gXCIuLi9jb21waWxlci90eXBlcy9FbnVtLmpzXCI7XHJcbmltcG9ydCB7IFNvdW5kVG9vbHMgfSBmcm9tIFwiLi4vdG9vbHMvU291bmRUb29scy5qc1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFN5c3RlbVRvb2xzQ2xhc3MgZXh0ZW5kcyBLbGFzcyB7XHJcblxyXG4gICAgY29uc3RydWN0b3IobW9kdWxlOiBNb2R1bGUpIHtcclxuICAgICAgICBzdXBlcihcIlN5c3RlbVRvb2xzXCIsIG1vZHVsZSwgXCJLbGFzc2UgbWl0IHN0YXRpc2NoZW4gTWV0aG9kZW4gZsO8ciBTeXN0ZW1mdW5rdGlvbmVuLCB6LkIuIEzDtnNjaGVuIGRlciBBdXNnYWJlLCBSZWdpc3RyaWVyZW4gZWluZXMgVGFzdGF0dXJsaXN0ZW5lcnMgdXN3LlwiKTtcclxuXHJcbiAgICAgICAgdGhpcy5zZXRCYXNlQ2xhc3MoPEtsYXNzPm1vZHVsZS50eXBlU3RvcmUuZ2V0VHlwZShcIk9iamVjdFwiKSk7XHJcbiAgICAgICAgdGhpcy5zdGF0aWNDbGFzcy5zZXR1cEF0dHJpYnV0ZUluZGljZXNSZWN1cnNpdmUoKTtcclxuXHJcbiAgICAgICAgdGhpcy5zdGF0aWNDbGFzcy5jbGFzc09iamVjdCA9IG5ldyBSdW50aW1lT2JqZWN0KHRoaXMuc3RhdGljQ2xhc3MpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiY2xlYXJTY3JlZW5cIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgIF0pLCBudWxsLFxyXG4gICAgICAgICAgICAocGFyYW1ldGVycykgPT4ge1xyXG4gICAgICAgICAgICAgICAgbW9kdWxlLm1haW4uZ2V0SW50ZXJwcmV0ZXIoKS5wcmludE1hbmFnZXIuY2xlYXIoKTtcclxuICAgICAgICAgICAgfSwgZmFsc2UsIHRydWUsIFwiTMO2c2NodCBkZW4gQmlsZHNjaGlybVwiKSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJzZXRTcGVlZFwiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgICAgIHtpZGVudGlmaWVyOiBcInNwZWVkXCIsIHR5cGU6IGludFByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9XHJcbiAgICAgICAgXSksIG51bGwsXHJcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgc3BlZWQ6IG51bWJlciA9IHBhcmFtZXRlcnNbMV0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICBtb2R1bGUubWFpbi5nZXRJbnRlcnByZXRlcigpLmNvbnRyb2xCdXR0b25zLnNwZWVkQ29udHJvbC5zZXRTcGVlZEluU3RlcHNQZXJTZWNvbmQoc3BlZWQgPj0gMSA/IHNwZWVkIDogXCJtYXhcIik7XHJcblxyXG4gICAgICAgICAgICB9LCBmYWxzZSwgdHJ1ZSwgXCJTZXR6dCBkaWUgQXVzZsO8aHJ1bmdzZ2VzY2h3aW5kaWdrZWl0LiBEZXIgUGFyYW1ldGVyIHNwZWVkIHdpciBpbiBTdGVwcy9TZWt1bmRlIGFuZ2VnZWJlbi4gRWluZSBuZWdhdGl2ZSBaYWhsIGJlZGV1dGV0OiAnbWF4aW1hbCcuXCIpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcImdldFNwZWVkXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICBdKSwgaW50UHJpbWl0aXZlVHlwZSxcclxuICAgICAgICAgICAgKHBhcmFtZXRlcnMpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBtb2R1bGUubWFpbi5nZXRJbnRlcnByZXRlcigpLmNvbnRyb2xCdXR0b25zLnNwZWVkQ29udHJvbC5nZXRTcGVlZEluU3RlcHNQZXJTZWNvbmQoKTtcclxuXHJcbiAgICAgICAgICAgIH0sIGZhbHNlLCB0cnVlLCBcIkdpYnQgZGllIEF1c2bDvGhydW5nc2dlc2Nod2luZGlna2VpdCBpbiBTdGVwcyBwcm8gU2VrdW5kZSB6dXLDvGNrLlwiKSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJwYXVzZVwiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgICAgIHtpZGVudGlmaWVyOiBcImR1cmF0aW9uSW5Nc1wiLCB0eXBlOiBpbnRQcmltaXRpdmVUeXBlLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfVxyXG4gICAgICAgIF0pLCBudWxsLFxyXG4gICAgICAgICAgICAocGFyYW1ldGVycykgPT4ge1xyXG5cclxuICAgICAgICAgICAgfSwgZmFsc2UsIHRydWUsIFwiUGF1c2llcnQgZGFzIFByb2dyYW1tIGbDvHIgZGllIGFuZ2VnZWJlbmUgWmVpdCBpbiBtcy5cIikpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiYWRkS2V5TGlzdGVuZXJcIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwia2V5TGlzdGVuZXJcIiwgdHlwZTogbW9kdWxlLnR5cGVTdG9yZS5nZXRUeXBlKFwiS2V5TGlzdGVuZXJcIiksIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9XHJcbiAgICAgICAgXSksIG51bGwsXHJcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcjogUnVudGltZU9iamVjdCA9IHBhcmFtZXRlcnNbMV0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICBsZXQgbWV0aG9kID0gKDxLbGFzcz5yLmNsYXNzKS5nZXRNZXRob2RCeVNpZ25hdHVyZShcIm9uS2V5VHlwZWQoU3RyaW5nKVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAobWV0aG9kICE9IG51bGwpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlLm1haW4uZ2V0SW50ZXJwcmV0ZXIoKS5rZXlib2FyZFRvb2wua2V5UHJlc3NlZENhbGxiYWNrcy5wdXNoKChrZXkpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwcm9ncmFtID0gbWV0aG9kPy5wcm9ncmFtO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgaW52b2tlID0gbWV0aG9kPy5pbnZva2U7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgc3RhY2tFbGVtZW50czogVmFsdWVbXSA9IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiByLmNsYXNzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiByXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHN0cmluZ1ByaW1pdGl2ZVR5cGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGtleVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb2dyYW0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kdWxlLm1haW4uZ2V0SW50ZXJwcmV0ZXIoKS5ydW5UaW1lcihtZXRob2QsIHN0YWNrRWxlbWVudHMsIG51bGwsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpbnZva2UgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW52b2tlKFtdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLCBmYWxzZSwgdHJ1ZSwgXCJGw7xndCBlaW5lbiBLZXlMaXN0ZW5lciBoaW56dSwgZGVzc2VuIE1ldGhvZGUga2V5VHlwZWQgaW1tZXIgZGFubiBhdWZnZXJ1ZmVuIHdpcmQsIHdlbm4gZWluZSBUYXN0ZSBnZWRyw7xja3QgdW5kIGFuc2NobGllw59lbmQgbG9zZ2VsYXNzZW4gd2lyZC5cIikpO1xyXG5cclxuICAgICAgICAvLyB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwicGxheVNvdW5kXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICAvLyAgICAgeyBpZGVudGlmaWVyOiBcInNvdW5kXCIsIHR5cGU6IHN0cmluZ1ByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9XHJcbiAgICAgICAgLy8gXSksIG51bGwsXHJcbiAgICAgICAgLy8gKHBhcmFtZXRlcnMpID0+IHtcclxuICAgICAgICAvLyAgICAgbGV0IHNvdW5kOiBzdHJpbmcgPSBwYXJhbWV0ZXJzWzFdLnZhbHVlO1xyXG4gICAgICAgIC8vICAgICBTb3VuZFRvb2xzLnBsYXkoc291bmQpO1xyXG4gICAgICAgIC8vIH0gICAgXHJcbiAgICAgICAgLy8gLCBmYWxzZSwgdHJ1ZSwgXCJTcGllbHQgZWluZW4gU291bmQgYWIuIERpZSBNw7ZnbGljaGVuIFNvdW5kcyBzaW5kIGFscyBzdGF0aXNjaGUgVmFyaWFibGVuIGRlciBLbGFzc2UgU291bmQgaGludGVybGVndC4gVGlwcGUgYWxzIFBhcmFtZXRlciBhbHNvIFNvdW5kIGdlZm9sZ3Qgdm9uIGVpbmVtIFB1bmt0IGVpbiwgdW0gZWluZSBBdXN3YWhsIHp1IHNlaGVuIVwiKSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBLZXlMaXN0ZW5lciBleHRlbmRzIEludGVyZmFjZSB7XHJcblxyXG4gICAgY29uc3RydWN0b3IobW9kdWxlOiBNb2R1bGUpIHtcclxuICAgICAgICBzdXBlcihcIktleUxpc3RlbmVyXCIsIG1vZHVsZSwgXCJJbnRlcmZhY2UgbWl0IE1ldGhvZGUgb25LZXlUeXBlZC4gRWluZSBLbGFzc2UsIGRpZSBkaWVzZXMgSW50ZXJmYWNlIGltcGxlbWVudGllcnQsIGthbm4gYXVmIFRhc3RhdHVyZWluZ2FiZW4gcmVhZ2llcmVuLiBFaW4gT2JqZWt0IGRpZXNlciBLbGFzc2UgbXVzcyB6dXZvciBhYmVyIG1pdCBTeXN0ZW0uYWRkS2V5TGlzdGVuZXIoKSByZWdpc3RyaWVydCB3ZXJkZW4uXCIpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwib25LZXlUeXBlZFwiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJrZXlcIiwgdHlwZTogc3RyaW5nUHJpbWl0aXZlVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH1cclxuICAgICAgICBdKSwgdm9pZFByaW1pdGl2ZVR5cGUsXHJcbiAgICAgICAgICAgIG51bGwsICAvLyBubyBpbXBsZW1lbnRhdGlvbiFcclxuICAgICAgICAgICAgZmFsc2UsIGZhbHNlLCBcIldpcmQgYXVmZ2VydWZlbiwgbmFjaGRlbSBlaW5lIFRhc3RlIGdlZHLDvGNrdCB3dXJkZS5cIikpO1xyXG4gICAgfVxyXG5cclxufVxyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBQcmludFN0cmVhbUNsYXNzIGV4dGVuZHMgS2xhc3Mge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKG1vZHVsZTogTW9kdWxlKSB7XHJcbiAgICAgICAgc3VwZXIoXCJQcmludFN0cmVhbVwiLCBtb2R1bGUsIFwiSW50ZXJuZSBIaWxmc2tsYXNzZSwgdW0gU3lzdGVtLm91dC5wcmludGxuIHp1IGVybcO2Z2xpY2hlbi4gRGFzIE9iamVrdCBTeXN0ZW0ub3V0IGlzdCB2b24gZGVyIEtsYXNzZSBQcmludFN0cmVhbS5cIik7XHJcblxyXG4gICAgICAgIHRoaXMuc2V0QmFzZUNsYXNzKDxLbGFzcz5tb2R1bGUudHlwZVN0b3JlLmdldFR5cGUoXCJPYmplY3RcIikpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwicHJpbnRcIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwidGV4dFwiLCB0eXBlOiBzdHJpbmdQcmltaXRpdmVUeXBlLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfVxyXG4gICAgICAgIF0pLCBudWxsLFxyXG4gICAgICAgICAgICAocGFyYW1ldGVycykgPT4ge1xyXG4gICAgICAgICAgICAgICAgbW9kdWxlLm1haW4uZ2V0SW50ZXJwcmV0ZXIoKS5wcmludE1hbmFnZXIucHJpbnQocGFyYW1ldGVyc1sxXS52YWx1ZSk7XHJcbiAgICAgICAgICAgIH0sIGZhbHNlLCB0cnVlLCBcIkdpYnQgZGVuIFRleHQgYXVzLlwiKSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJwcmludGxuXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcInRleHRcIiwgdHlwZTogc3RyaW5nUHJpbWl0aXZlVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH1cclxuICAgICAgICBdKSwgbnVsbCxcclxuICAgICAgICAgICAgKHBhcmFtZXRlcnMpID0+IHtcclxuICAgICAgICAgICAgICAgIG1vZHVsZS5tYWluLmdldEludGVycHJldGVyKCkucHJpbnRNYW5hZ2VyLnByaW50bG4ocGFyYW1ldGVyc1sxXS52YWx1ZSk7XHJcbiAgICAgICAgICAgIH0sIGZhbHNlLCB0cnVlLCBcIkdpYnQgZGVuIFRleHQgYXVzLCBnZWZvbGd0IHZvbiBlaW5lbSBaZWlsZW5zcHJ1bmcuXCIpKTtcclxuXHJcblxyXG4gICAgfVxyXG5cclxufSJdfQ==