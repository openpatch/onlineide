import { Klass } from "../../compiler/types/Class.js";
import { intPrimitiveType, stringPrimitiveType, voidPrimitiveType } from "../../compiler/types/PrimitiveTypes.js";
import { Method, Parameterlist } from "../../compiler/types/Types.js";
import { InterpreterState } from "../../interpreter/Interpreter.js";
import { RuntimeObject } from "../../interpreter/RuntimeObject.js";
import { WebSocketClientHelper } from "./WebSocketClient.js";
import { ajax } from "../../communication/AjaxHelper.js";
import { ArrayType } from "../../compiler/types/Array.js";
export class WebSocketClass extends Klass {
    constructor(module) {
        super("WebSocket", module, "Ein Objekt der Klasse WebSocket kann Daten über das Internet senden und empfangen. Um die Klasse benutzen zu können, musst Du eine eigene Klasse schreiben, die die Klasse WebSocket erweitert und die Methoden onConnect, onMessage, onOtherClientConnected und onOtherClientDisconnected überschreibt.");
        this.setBaseClass(module.typeStore.getType("Object"));
        let webSocketClientType = module.typeStore.getType("WebSocketClient");
        let systemClassType = module.typeStore.getType("System");
        this.addMethod(new Method("WebSocket", new Parameterlist([]), null, (parameters) => {
            var _a, _b;
            let o = parameters[0].value;
            let interpreter = (_b = (_a = this.module) === null || _a === void 0 ? void 0 : _a.main) === null || _b === void 0 ? void 0 : _b.getInterpreter();
            let wh = new WebSocketHelper(o, interpreter, webSocketClientType, systemClassType);
            o.intrinsicData["Helper"] = wh;
        }, false, false, 'Instanziert ein neues WebSocket-Objekt.', true));
        this.addMethod(new Method("open", new Parameterlist([
            { identifier: "sessionCode", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "nickName", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), null, (parameters) => {
            let o = parameters[0].value;
            let sessionCode = parameters[1].value;
            let nickName = parameters[2].value;
            let wh = o.intrinsicData["Helper"];
            wh.connect(sessionCode, nickName);
            o.intrinsicData["Helper"] = wh;
        }, false, false, 'Startet die Verbindung mit dem Server. Den SessionCode kannst Du frei wählen. Mit allen anderen Clients, die eine Verbindung mit demselben SessionCode aufbauen, kannst Du anschließend Daten austauschen. Auch der Nickname ist frei wählbar. Er ist für alle anderen Clients sichtbar.', false));
        this.addMethod(new Method("sendToAll", new Parameterlist([
            { identifier: "message", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "messageType", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), voidPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            let wh = o.intrinsicData["Helper"];
            let message = parameters[1].value;
            let messageType = parameters[2].value;
            wh.sendToAll(message, messageType);
        }, false, false, 'Sendet Daten (message) an alle anderen Clients. Den messageType kannst Du frei wählen. Die empfangenden Clients bekommen ihn zusammen mit den Daten übermittelt. Tipp: Du kannst auch Objekte senden, musst sie dazu aber vorher serialisieren, d.h. mithilfe der Methode toJson in eine Zeichenkette verwandeln.', false));
        this.addMethod(new Method("findClients", new Parameterlist([
            { identifier: "count", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), voidPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            let wh = o.intrinsicData["Helper"];
            let count = parameters[1].value;
            wh.findClientsFromCount(count);
        }, false, false, 'Sucht die übergebene Anzahl von "kontaktbereiten" Clients, d.h. solchen Clients, die exakt dieselbe Suchanfrage abgegeben haben. Findet der Server die Clients, so ruft er bei allen beteiligten Clients onClientsFound auf.', false));
        this.addMethod(new Method("findClients", new Parameterlist([
            { identifier: "nicknames", type: new ArrayType(stringPrimitiveType), declaration: null, usagePositions: null, isFinal: true },
        ]), voidPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            let wh = o.intrinsicData["Helper"];
            let nickNamesValues = parameters[1].value;
            let nicknames = nickNamesValues.map((nnv) => nnv.value);
            wh.findClientsFromNicknames(nicknames);
        }, false, false, 'Sucht die Clients mit den angegebenen Nicknames. Haben sie eine entsprechende Suchanfrage (d.h. dieselben Nicknames) abgegeben, so so ruft der Server bei allen beteiligten Clients onClientsFound auf.', false));
        this.addMethod(new Method("findClient", new Parameterlist([
            { identifier: "nickname", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), voidPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            let wh = o.intrinsicData["Helper"];
            let nickName = parameters[1].value;
            wh.findClientsFromNicknames([nickName]);
        }, false, false, 'Sucht den Client mit dem angegebenen Nickname. Hat er eine entsprechende Suchanfrage (d.h. mit dem Nickname DIESES clients) abgegeben, so so ruft der Server bei beiden Clients onClientsFound auf.', false));
        this.addMethod(new Method("close", new Parameterlist([]), voidPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            let wh = o.intrinsicData["Helper"];
            wh.disconnect();
        }, false, false, 'Beendet die Verbindung. Bei allen anderen Clients, die sich mit derselben sessionId verbunden haben, wird daraufhin die Methode onOtherClientDisconnected aufgerufen.', false));
        this.addMethod(new Method("onOpen", new Parameterlist([]), null, null, // no statements!
        false, false, "Wird aufgerufen, sobald die Verbindung mit dem Server zustandegekommen ist.", false));
        this.addMethod(new Method("onClose", new Parameterlist([]), null, null, // no statements!
        false, false, "Wird aufgerufen, nachdem die Verbindung geschlossen wurde.", false));
        this.addMethod(new Method("onMessage", new Parameterlist([
            { identifier: "sender", type: webSocketClientType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "message", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "messageType", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), null, null, // no statements!
        false, false, "Wird immer dann aufgerufen, wenn eine Nachricht eines anderen Clients empfangen wurde.", false));
        this.addMethod(new Method("onOtherClientConnected", new Parameterlist([
            { identifier: "otherClient", type: webSocketClientType, declaration: null, usagePositions: null, isFinal: true }
        ]), null, null, // no statements!
        false, false, "Wird immer dann aufgerufen, wenn sich ein anderer Client unter Nutzung desselben sessionCodes mit dem Server verbunden hat.", false));
        this.addMethod(new Method("onOtherClientDisconnected", new Parameterlist([
            { identifier: "otherClient", type: webSocketClientType, declaration: null, usagePositions: null, isFinal: true }
        ]), null, null, // no statements!
        false, false, "Wird immer dann aufgerufen, wenn ein anderer Client unter Nutzung desselben sessionCodes die Verbindung mit dem Server beendet hat.", false));
        this.addMethod(new Method("onClientsFound", new Parameterlist([
            { identifier: "oherClients", type: new ArrayType(webSocketClientType), declaration: null, usagePositions: null, isFinal: true },
            { identifier: "ownNumber", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true }
        ]), null, null, // no statements!
        false, false, "Wird aufgerufen, wenn die durch die Methoden findClient bzw. findClients zuvor gesuchten Clients gefunden wurden.", false));
        this.addMethod(new Method("getOtherClients", new Parameterlist([]), new ArrayType(webSocketClientType), (parameters) => {
            let o = parameters[0].value;
            let wh = o.intrinsicData["Helper"];
            let ret = wh.clientList.map(client => { return { type: webSocketClientType, value: client.runtimeObject }; });
            return ret;
        }, // no statements!
        false, false, "Gibt alle bisher bei der selben Session angemeldeten Clients zurück.", false));
    }
}
export class WebSocketHelper {
    constructor(runtimeObject, interpreter, webSocketClientType, systemClassType) {
        this.runtimeObject = runtimeObject;
        this.interpreter = interpreter;
        this.webSocketClientType = webSocketClientType;
        this.systemClassType = systemClassType;
        this.clientList = [];
        this.idToClientMap = {};
        this.isOpen = false;
        this.unsentMessages = [];
        let klass = runtimeObject.class;
        // [[Entries]]:Array(4)
        // 0:{"Test3()" => Method}
        // 1:{"onConnect()" => Method}
        // 2:{"onMessage(WebSocketClient, String, String)" => Method}
        // 3:{"toJson()" => Method}
        this.onOpenMethod = klass.methods.find(m => m.signature == "onOpen()");
        this.onCloseMethod = klass.methods.find(m => m.signature == "onClose()");
        this.onMessageMethod = klass.methods.find(m => m.signature == "onMessage(WebSocketClient, String, String)");
        this.onClientConnectedMethod = klass.methods.find(m => m.signature == "onOtherClientConnected(WebSocketClient)");
        this.onClientDisconnectedMethod = klass.methods.find(m => m.signature == "onOtherClientDisconnected(WebSocketClient)");
        this.onClientsFoundMethod = klass.methods.find(m => m.signature == "onClientsFound(WebSocketClient[], int)");
    }
    connect(sessionCode, nickName) {
        if (this.interpreter.main.isEmbedded()) {
            this.interpreter.throwException("Die Netzwerkfunktionalitäten stehen nur eingeloggten Nutzern in der Entwicklungsumgebung zur Verfügung und können daher leider hier nicht ausprobiert werden.");
            return;
        }
        ajax('getWebSocketToken', {}, (response) => {
            let url = (window.location.protocol.startsWith("https") ? "wss://" : "ws://") + window.location.host + "/servlet/websocket";
            this.connection = new WebSocket(url);
            this.connection.onerror = (error) => { this.onError(error); };
            this.connection.onclose = (event) => { this.onClose(event); };
            this.connection.onmessage = (event) => { this.onMessage(event); };
            this.connection.onopen = (event) => {
                let request = {
                    command: 1,
                    token: response.token,
                    nickname: nickName,
                    sessionCode: sessionCode
                };
                this.interpreter.webSocketsToCloseAfterProgramHalt.push(this.connection);
                this.isOpen = true;
                this.sendIntern(JSON.stringify(request));
                this.onOpen();
            };
        });
    }
    sendIntern(message) {
        if (!this.isOpen) {
            this.unsentMessages.push(message);
        }
        else {
            try {
                this.connection.send(message);
            }
            catch (exception) {
                console.log(exception);
            }
        }
    }
    onClose(event) {
        this.isOpen = false;
        this.runMethod(this.onCloseMethod, []);
    }
    sendToClient(clientId, data, dataType) {
        let message = {
            command: 3,
            data: data,
            dataType: dataType,
            recipient_id: clientId
        };
        this.sendIntern(JSON.stringify(message));
    }
    sendToAll(data, dataType) {
        let message = {
            command: 2,
            data: data,
            dataType: dataType
        };
        this.sendIntern(JSON.stringify(message));
    }
    disconnect() {
        let message = {
            command: 4
        };
        this.sendIntern(JSON.stringify(message));
        this.connection.close();
        let wtr = this.interpreter.webSocketsToCloseAfterProgramHalt;
        wtr.splice(wtr.indexOf(this.connection), 1);
    }
    onMessage(event) {
        let response = JSON.parse(event.data);
        if (response.command == undefined)
            return;
        switch (response.command) {
            case 1: // new Client
                let clientRuntimeObject = new RuntimeObject(this.webSocketClientType);
                let wch = new WebSocketClientHelper(clientRuntimeObject, this, response.user_id, response.rufname, response.familienname, response.username, response.nickname);
                clientRuntimeObject.intrinsicData["Helper"] = wch;
                this.clientList.push(wch);
                this.idToClientMap[response.user_id] = wch;
                this.runMethod(this.onClientConnectedMethod, [{ type: this.webSocketClientType, value: clientRuntimeObject }]);
                break;
            case 2: // message
                let clientHelper = this.idToClientMap[response.from_client_id];
                if (clientHelper == null)
                    return;
                this.runMethod(this.onMessageMethod, [
                    { type: this.webSocketClientType, value: clientHelper.runtimeObject },
                    { type: stringPrimitiveType, value: response.data },
                    { type: stringPrimitiveType, value: response.dataType }
                ]);
                break;
            case 3: // other client disconnected
                let clientHelper1 = this.idToClientMap[response.disconnecting_client_id];
                if (clientHelper1 == null)
                    return;
                this.clientList.splice(this.clientList.indexOf(clientHelper1), 1);
                this.idToClientMap[response.disconnecting_client_id] = undefined;
                this.runMethod(this.onClientDisconnectedMethod, [
                    { type: this.webSocketClientType, value: clientHelper1.runtimeObject }
                ]);
                break;
            case 4: // time synchronization
                this.systemClassType.deltaTimeMillis = response.currentTimeMills - Date.now();
                this.client_id = response.client_id;
                break;
            case 5: // keep alive
                break;
            case 6: // Clients found
                this.onClientsFound(response);
                break;
        }
    }
    onClientsFound(response) {
        let own_index = 0;
        let otherClients = [];
        for (let client of response.clients) {
            if (client.id == this.client_id) {
                own_index = client.index;
            }
            else {
                let otherClient = this.idToClientMap[client.id];
                if (otherClient != null) {
                    otherClient.index = client.index;
                    otherClients.push({
                        type: this.webSocketClientType,
                        value: otherClient.runtimeObject
                    });
                }
            }
        }
        let arrayValue = {
            type: new ArrayType(this.webSocketClientType),
            value: otherClients
        };
        this.runMethod(this.onClientsFoundMethod, [arrayValue, { type: intPrimitiveType, value: own_index }]);
    }
    onError(error) {
        this.interpreter.throwException("Kommunikationsfehler beim WebSocket");
    }
    onOpen() {
        this.isOpen = true;
        if (this.unsentMessages.length > 0) {
            this.unsentMessages.forEach(m => this.sendIntern(m));
            this.unsentMessages = [];
        }
        this.runMethod(this.onOpenMethod, []);
    }
    runMethod(method, stackElements) {
        if (method == null)
            return;
        stackElements.splice(0, 0, {
            type: this.runtimeObject.class,
            value: this.runtimeObject
        });
        if (this.interpreter.state == InterpreterState.waitingForInput) {
            this.interpreter.executeImmediatelyInNewStackframe(method.program, stackElements);
        }
        else {
            this.interpreter.runTimer(method, stackElements, () => { }, false);
        }
    }
    findClientsFromCount(count) {
        let message = {
            command: 6,
            count: count,
            nicknames: []
        };
        this.sendIntern(JSON.stringify(message));
    }
    findClientsFromNicknames(nicknames) {
        let message = {
            command: 6,
            count: nicknames.length,
            nicknames: nicknames
        };
        this.sendIntern(JSON.stringify(message));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV2ViU29ja2V0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NsaWVudC9ydW50aW1lbGlicmFyeS9uZXR3b3JrL1dlYlNvY2tldC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLG1CQUFtQixFQUFFLGlCQUFpQixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDbEgsT0FBTyxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQVMsTUFBTSwrQkFBK0IsQ0FBQztBQUM3RSxPQUFPLEVBQWUsZ0JBQWdCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNqRixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFFbkUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDN0QsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBRXpELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUUxRCxNQUFNLE9BQU8sY0FBZSxTQUFRLEtBQUs7SUFFckMsWUFBWSxNQUFjO1FBQ3RCLEtBQUssQ0FBQyxXQUFXLEVBQUUsTUFBTSxFQUFFLDBTQUEwUyxDQUFDLENBQUM7UUFFdlUsSUFBSSxDQUFDLFlBQVksQ0FBUSxNQUFNLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQzdELElBQUksbUJBQW1CLEdBQVUsTUFBTSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUM3RSxJQUFJLGVBQWUsR0FBZ0IsTUFBTSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFdEUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxXQUFXLEVBQUUsSUFBSSxh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b21waWxlci9wYXJzZXIvTW9kdWxlLmpzXCI7XHJcbmltcG9ydCB7IEtsYXNzIH0gZnJvbSBcIi4uLy4uL2NvbXBpbGVyL3R5cGVzL0NsYXNzLmpzXCI7XHJcbmltcG9ydCB7IGludFByaW1pdGl2ZVR5cGUsIHN0cmluZ1ByaW1pdGl2ZVR5cGUsIHZvaWRQcmltaXRpdmVUeXBlIH0gZnJvbSBcIi4uLy4uL2NvbXBpbGVyL3R5cGVzL1ByaW1pdGl2ZVR5cGVzLmpzXCI7XHJcbmltcG9ydCB7IE1ldGhvZCwgUGFyYW1ldGVybGlzdCwgVmFsdWUgfSBmcm9tIFwiLi4vLi4vY29tcGlsZXIvdHlwZXMvVHlwZXMuanNcIjtcclxuaW1wb3J0IHsgSW50ZXJwcmV0ZXIsIEludGVycHJldGVyU3RhdGUgfSBmcm9tIFwiLi4vLi4vaW50ZXJwcmV0ZXIvSW50ZXJwcmV0ZXIuanNcIjtcclxuaW1wb3J0IHsgUnVudGltZU9iamVjdCB9IGZyb20gXCIuLi8uLi9pbnRlcnByZXRlci9SdW50aW1lT2JqZWN0LmpzXCI7XHJcbmltcG9ydCB7IFdlYlNvY2tldFJlcXVlc3RDb25uZWN0LCBXZWJTb2NrZXRSZXF1ZXN0RGlzY29ubmVjdCwgV2ViU29ja2V0UmVxdWVzdFNlbmRUb0FsbCwgV2ViU29ja2V0UmVxdWVzdFNlbmRUb0NsaWVudCwgV2ViU29ja2V0UmVzcG9uc2VPdGhlckNsaWVudERpc2Nvbm5lY3RlZCwgV2ViU29ja2V0UmVzcG9uc2VNZXNzYWdlLCBXZWJTb2NrZXRSZXNwb25zZU5ld0NsaWVudCwgV2ViU29ja2V0UmVzcG9uc2UsIEdldFdlYlNvY2tldFRva2VuUmVzcG9uc2UsIFdlYlNvY2tldFJlc3BvbnNlUGFpcmluZ0ZvdW5kLCBXZWJTb2NrZXRSZXF1ZXN0RmluZFBhaXJpbmcgfSBmcm9tIFwiLi4vLi4vY29tbXVuaWNhdGlvbi9EYXRhLmpzXCI7XHJcbmltcG9ydCB7IFdlYlNvY2tldENsaWVudEhlbHBlciB9IGZyb20gXCIuL1dlYlNvY2tldENsaWVudC5qc1wiO1xyXG5pbXBvcnQgeyBhamF4IH0gZnJvbSBcIi4uLy4uL2NvbW11bmljYXRpb24vQWpheEhlbHBlci5qc1wiO1xyXG5pbXBvcnQgeyBTeXN0ZW1DbGFzcyB9IGZyb20gXCIuLi9TeXN0ZW0uanNcIjtcclxuaW1wb3J0IHsgQXJyYXlUeXBlIH0gZnJvbSBcIi4uLy4uL2NvbXBpbGVyL3R5cGVzL0FycmF5LmpzXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgV2ViU29ja2V0Q2xhc3MgZXh0ZW5kcyBLbGFzcyB7XHJcblxyXG4gICAgY29uc3RydWN0b3IobW9kdWxlOiBNb2R1bGUpIHtcclxuICAgICAgICBzdXBlcihcIldlYlNvY2tldFwiLCBtb2R1bGUsIFwiRWluIE9iamVrdCBkZXIgS2xhc3NlIFdlYlNvY2tldCBrYW5uIERhdGVuIMO8YmVyIGRhcyBJbnRlcm5ldCBzZW5kZW4gdW5kIGVtcGZhbmdlbi4gVW0gZGllIEtsYXNzZSBiZW51dHplbiB6dSBrw7ZubmVuLCBtdXNzdCBEdSBlaW5lIGVpZ2VuZSBLbGFzc2Ugc2NocmVpYmVuLCBkaWUgZGllIEtsYXNzZSBXZWJTb2NrZXQgZXJ3ZWl0ZXJ0IHVuZCBkaWUgTWV0aG9kZW4gb25Db25uZWN0LCBvbk1lc3NhZ2UsIG9uT3RoZXJDbGllbnRDb25uZWN0ZWQgdW5kIG9uT3RoZXJDbGllbnREaXNjb25uZWN0ZWQgw7xiZXJzY2hyZWlidC5cIik7XHJcblxyXG4gICAgICAgIHRoaXMuc2V0QmFzZUNsYXNzKDxLbGFzcz5tb2R1bGUudHlwZVN0b3JlLmdldFR5cGUoXCJPYmplY3RcIikpO1xyXG4gICAgICAgIGxldCB3ZWJTb2NrZXRDbGllbnRUeXBlID0gPEtsYXNzPm1vZHVsZS50eXBlU3RvcmUuZ2V0VHlwZShcIldlYlNvY2tldENsaWVudFwiKTtcclxuICAgICAgICBsZXQgc3lzdGVtQ2xhc3NUeXBlID0gPFN5c3RlbUNsYXNzPm1vZHVsZS50eXBlU3RvcmUuZ2V0VHlwZShcIlN5c3RlbVwiKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcIldlYlNvY2tldFwiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgXSksIG51bGwsXHJcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IG86IFJ1bnRpbWVPYmplY3QgPSBwYXJhbWV0ZXJzWzBdLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBpbnRlcnByZXRlciA9IHRoaXMubW9kdWxlPy5tYWluPy5nZXRJbnRlcnByZXRlcigpO1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCB3aCA9IG5ldyBXZWJTb2NrZXRIZWxwZXIobywgaW50ZXJwcmV0ZXIsIHdlYlNvY2tldENsaWVudFR5cGUsIHN5c3RlbUNsYXNzVHlwZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgby5pbnRyaW5zaWNEYXRhW1wiSGVscGVyXCJdID0gd2g7XHJcblxyXG4gICAgICAgICAgICB9LCBmYWxzZSwgZmFsc2UsICdJbnN0YW56aWVydCBlaW4gbmV1ZXMgV2ViU29ja2V0LU9iamVrdC4nLCB0cnVlKSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJvcGVuXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcInNlc3Npb25Db2RlXCIsIHR5cGU6IHN0cmluZ1ByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9LFxyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwibmlja05hbWVcIiwgdHlwZTogc3RyaW5nUHJpbWl0aXZlVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH0sXHJcbiAgICAgICAgXSksIG51bGwsXHJcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IG86IFJ1bnRpbWVPYmplY3QgPSBwYXJhbWV0ZXJzWzBdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgbGV0IHNlc3Npb25Db2RlOiBzdHJpbmcgPSBwYXJhbWV0ZXJzWzFdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgbGV0IG5pY2tOYW1lOiBzdHJpbmcgPSBwYXJhbWV0ZXJzWzJdLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCB3aDogV2ViU29ja2V0SGVscGVyID0gby5pbnRyaW5zaWNEYXRhW1wiSGVscGVyXCJdO1xyXG4gICAgICAgICAgICAgICAgd2guY29ubmVjdChzZXNzaW9uQ29kZSwgbmlja05hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIG8uaW50cmluc2ljRGF0YVtcIkhlbHBlclwiXSA9IHdoO1xyXG5cclxuICAgICAgICAgICAgfSwgZmFsc2UsIGZhbHNlLCAnU3RhcnRldCBkaWUgVmVyYmluZHVuZyBtaXQgZGVtIFNlcnZlci4gRGVuIFNlc3Npb25Db2RlIGthbm5zdCBEdSBmcmVpIHfDpGhsZW4uIE1pdCBhbGxlbiBhbmRlcmVuIENsaWVudHMsIGRpZSBlaW5lIFZlcmJpbmR1bmcgbWl0IGRlbXNlbGJlbiBTZXNzaW9uQ29kZSBhdWZiYXVlbiwga2FubnN0IER1IGFuc2NobGllw59lbmQgRGF0ZW4gYXVzdGF1c2NoZW4uIEF1Y2ggZGVyIE5pY2tuYW1lIGlzdCBmcmVpIHfDpGhsYmFyLiBFciBpc3QgZsO8ciBhbGxlIGFuZGVyZW4gQ2xpZW50cyBzaWNodGJhci4nLFxyXG4gICAgICAgICAgICBmYWxzZSkpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwic2VuZFRvQWxsXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcIm1lc3NhZ2VcIiwgdHlwZTogc3RyaW5nUHJpbWl0aXZlVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH0sXHJcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJtZXNzYWdlVHlwZVwiLCB0eXBlOiBzdHJpbmdQcmltaXRpdmVUeXBlLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfSxcclxuICAgICAgICBdKSwgdm9pZFByaW1pdGl2ZVR5cGUsXHJcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IG86IFJ1bnRpbWVPYmplY3QgPSBwYXJhbWV0ZXJzWzBdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgbGV0IHdoOiBXZWJTb2NrZXRIZWxwZXIgPSBvLmludHJpbnNpY0RhdGFbXCJIZWxwZXJcIl07XHJcbiAgICAgICAgICAgICAgICBsZXQgbWVzc2FnZTogc3RyaW5nID0gcGFyYW1ldGVyc1sxXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIGxldCBtZXNzYWdlVHlwZTogc3RyaW5nID0gcGFyYW1ldGVyc1syXS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICB3aC5zZW5kVG9BbGwobWVzc2FnZSwgbWVzc2FnZVR5cGUpO1xyXG5cclxuICAgICAgICAgICAgfSwgZmFsc2UsIGZhbHNlLCAnU2VuZGV0IERhdGVuIChtZXNzYWdlKSBhbiBhbGxlIGFuZGVyZW4gQ2xpZW50cy4gRGVuIG1lc3NhZ2VUeXBlIGthbm5zdCBEdSBmcmVpIHfDpGhsZW4uIERpZSBlbXBmYW5nZW5kZW4gQ2xpZW50cyBiZWtvbW1lbiBpaG4genVzYW1tZW4gbWl0IGRlbiBEYXRlbiDDvGJlcm1pdHRlbHQuIFRpcHA6IER1IGthbm5zdCBhdWNoIE9iamVrdGUgc2VuZGVuLCBtdXNzdCBzaWUgZGF6dSBhYmVyIHZvcmhlciBzZXJpYWxpc2llcmVuLCBkLmguIG1pdGhpbGZlIGRlciBNZXRob2RlIHRvSnNvbiBpbiBlaW5lIFplaWNoZW5rZXR0ZSB2ZXJ3YW5kZWxuLicsIGZhbHNlKSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJmaW5kQ2xpZW50c1wiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJjb3VudFwiLCB0eXBlOiBpbnRQcmltaXRpdmVUeXBlLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfSxcclxuICAgICAgICBdKSwgdm9pZFByaW1pdGl2ZVR5cGUsXHJcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IG86IFJ1bnRpbWVPYmplY3QgPSBwYXJhbWV0ZXJzWzBdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgbGV0IHdoOiBXZWJTb2NrZXRIZWxwZXIgPSBvLmludHJpbnNpY0RhdGFbXCJIZWxwZXJcIl07XHJcbiAgICAgICAgICAgICAgICBsZXQgY291bnQ6IG51bWJlciA9IHBhcmFtZXRlcnNbMV0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgd2guZmluZENsaWVudHNGcm9tQ291bnQoY291bnQpO1xyXG5cclxuICAgICAgICAgICAgfSwgZmFsc2UsIGZhbHNlLCAnU3VjaHQgZGllIMO8YmVyZ2ViZW5lIEFuemFobCB2b24gXCJrb250YWt0YmVyZWl0ZW5cIiBDbGllbnRzLCBkLmguIHNvbGNoZW4gQ2xpZW50cywgZGllIGV4YWt0IGRpZXNlbGJlIFN1Y2hhbmZyYWdlIGFiZ2VnZWJlbiBoYWJlbi4gRmluZGV0IGRlciBTZXJ2ZXIgZGllIENsaWVudHMsIHNvIHJ1ZnQgZXIgYmVpIGFsbGVuIGJldGVpbGlndGVuIENsaWVudHMgb25DbGllbnRzRm91bmQgYXVmLicsIGZhbHNlKSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJmaW5kQ2xpZW50c1wiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJuaWNrbmFtZXNcIiwgdHlwZTogbmV3IEFycmF5VHlwZShzdHJpbmdQcmltaXRpdmVUeXBlKSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH0sXHJcbiAgICAgICAgXSksIHZvaWRQcmltaXRpdmVUeXBlLFxyXG4gICAgICAgICAgICAocGFyYW1ldGVycykgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBvOiBSdW50aW1lT2JqZWN0ID0gcGFyYW1ldGVyc1swXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIGxldCB3aDogV2ViU29ja2V0SGVscGVyID0gby5pbnRyaW5zaWNEYXRhW1wiSGVscGVyXCJdO1xyXG4gICAgICAgICAgICAgICAgbGV0IG5pY2tOYW1lc1ZhbHVlczogVmFsdWVbXSA9IHBhcmFtZXRlcnNbMV0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IG5pY2tuYW1lczogc3RyaW5nW10gPSBuaWNrTmFtZXNWYWx1ZXMubWFwKChubnYpID0+IG5udi52YWx1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgd2guZmluZENsaWVudHNGcm9tTmlja25hbWVzKG5pY2tuYW1lcyk7XHJcblxyXG4gICAgICAgICAgICB9LCBmYWxzZSwgZmFsc2UsICdTdWNodCBkaWUgQ2xpZW50cyBtaXQgZGVuIGFuZ2VnZWJlbmVuIE5pY2tuYW1lcy4gSGFiZW4gc2llIGVpbmUgZW50c3ByZWNoZW5kZSBTdWNoYW5mcmFnZSAoZC5oLiBkaWVzZWxiZW4gTmlja25hbWVzKSBhYmdlZ2ViZW4sIHNvIHNvIHJ1ZnQgZGVyIFNlcnZlciBiZWkgYWxsZW4gYmV0ZWlsaWd0ZW4gQ2xpZW50cyBvbkNsaWVudHNGb3VuZCBhdWYuJywgZmFsc2UpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcImZpbmRDbGllbnRcIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwibmlja25hbWVcIiwgdHlwZTogc3RyaW5nUHJpbWl0aXZlVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH0sXHJcbiAgICAgICAgXSksIHZvaWRQcmltaXRpdmVUeXBlLFxyXG4gICAgICAgICAgICAocGFyYW1ldGVycykgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBvOiBSdW50aW1lT2JqZWN0ID0gcGFyYW1ldGVyc1swXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIGxldCB3aDogV2ViU29ja2V0SGVscGVyID0gby5pbnRyaW5zaWNEYXRhW1wiSGVscGVyXCJdO1xyXG4gICAgICAgICAgICAgICAgbGV0IG5pY2tOYW1lOiBzdHJpbmcgPSBwYXJhbWV0ZXJzWzFdLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgIHdoLmZpbmRDbGllbnRzRnJvbU5pY2tuYW1lcyhbbmlja05hbWVdKTtcclxuXHJcbiAgICAgICAgICAgIH0sIGZhbHNlLCBmYWxzZSwgJ1N1Y2h0IGRlbiBDbGllbnQgbWl0IGRlbSBhbmdlZ2ViZW5lbiBOaWNrbmFtZS4gSGF0IGVyIGVpbmUgZW50c3ByZWNoZW5kZSBTdWNoYW5mcmFnZSAoZC5oLiBtaXQgZGVtIE5pY2tuYW1lIERJRVNFUyBjbGllbnRzKSBhYmdlZ2ViZW4sIHNvIHNvIHJ1ZnQgZGVyIFNlcnZlciBiZWkgYmVpZGVuIENsaWVudHMgb25DbGllbnRzRm91bmQgYXVmLicsIGZhbHNlKSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJjbG9zZVwiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgXSksIHZvaWRQcmltaXRpdmVUeXBlLFxyXG4gICAgICAgICAgICAocGFyYW1ldGVycykgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBvOiBSdW50aW1lT2JqZWN0ID0gcGFyYW1ldGVyc1swXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIGxldCB3aDogV2ViU29ja2V0SGVscGVyID0gby5pbnRyaW5zaWNEYXRhW1wiSGVscGVyXCJdO1xyXG5cclxuICAgICAgICAgICAgICAgIHdoLmRpc2Nvbm5lY3QoKTtcclxuXHJcbiAgICAgICAgICAgIH0sIGZhbHNlLCBmYWxzZSwgJ0JlZW5kZXQgZGllIFZlcmJpbmR1bmcuIEJlaSBhbGxlbiBhbmRlcmVuIENsaWVudHMsIGRpZSBzaWNoIG1pdCBkZXJzZWxiZW4gc2Vzc2lvbklkIHZlcmJ1bmRlbiBoYWJlbiwgd2lyZCBkYXJhdWZoaW4gZGllIE1ldGhvZGUgb25PdGhlckNsaWVudERpc2Nvbm5lY3RlZCBhdWZnZXJ1ZmVuLicsIGZhbHNlKSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJvbk9wZW5cIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgIF0pLCBudWxsLFxyXG4gICAgICAgICAgICBudWxsLCAvLyBubyBzdGF0ZW1lbnRzIVxyXG4gICAgICAgICAgICBmYWxzZSwgZmFsc2UsIFwiV2lyZCBhdWZnZXJ1ZmVuLCBzb2JhbGQgZGllIFZlcmJpbmR1bmcgbWl0IGRlbSBTZXJ2ZXIgenVzdGFuZGVnZWtvbW1lbiBpc3QuXCIsIGZhbHNlKSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJvbkNsb3NlXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICBdKSwgbnVsbCxcclxuICAgICAgICAgICAgbnVsbCwgLy8gbm8gc3RhdGVtZW50cyFcclxuICAgICAgICAgICAgZmFsc2UsIGZhbHNlLCBcIldpcmQgYXVmZ2VydWZlbiwgbmFjaGRlbSBkaWUgVmVyYmluZHVuZyBnZXNjaGxvc3NlbiB3dXJkZS5cIiwgZmFsc2UpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcIm9uTWVzc2FnZVwiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJzZW5kZXJcIiwgdHlwZTogd2ViU29ja2V0Q2xpZW50VHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH0sXHJcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJtZXNzYWdlXCIsIHR5cGU6IHN0cmluZ1ByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9LFxyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwibWVzc2FnZVR5cGVcIiwgdHlwZTogc3RyaW5nUHJpbWl0aXZlVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH0sXHJcbiAgICAgICAgXSksIG51bGwsXHJcbiAgICAgICAgICAgIG51bGwsIC8vIG5vIHN0YXRlbWVudHMhXHJcbiAgICAgICAgICAgIGZhbHNlLCBmYWxzZSwgXCJXaXJkIGltbWVyIGRhbm4gYXVmZ2VydWZlbiwgd2VubiBlaW5lIE5hY2hyaWNodCBlaW5lcyBhbmRlcmVuIENsaWVudHMgZW1wZmFuZ2VuIHd1cmRlLlwiLCBmYWxzZSkpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwib25PdGhlckNsaWVudENvbm5lY3RlZFwiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJvdGhlckNsaWVudFwiLCB0eXBlOiB3ZWJTb2NrZXRDbGllbnRUeXBlLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfVxyXG4gICAgICAgIF0pLCBudWxsLFxyXG4gICAgICAgICAgICBudWxsLCAvLyBubyBzdGF0ZW1lbnRzIVxyXG4gICAgICAgICAgICBmYWxzZSwgZmFsc2UsIFwiV2lyZCBpbW1lciBkYW5uIGF1ZmdlcnVmZW4sIHdlbm4gc2ljaCBlaW4gYW5kZXJlciBDbGllbnQgdW50ZXIgTnV0enVuZyBkZXNzZWxiZW4gc2Vzc2lvbkNvZGVzIG1pdCBkZW0gU2VydmVyIHZlcmJ1bmRlbiBoYXQuXCIsIGZhbHNlKSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJvbk90aGVyQ2xpZW50RGlzY29ubmVjdGVkXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcIm90aGVyQ2xpZW50XCIsIHR5cGU6IHdlYlNvY2tldENsaWVudFR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9XHJcbiAgICAgICAgXSksIG51bGwsXHJcbiAgICAgICAgICAgIG51bGwsIC8vIG5vIHN0YXRlbWVudHMhXHJcbiAgICAgICAgICAgIGZhbHNlLCBmYWxzZSwgXCJXaXJkIGltbWVyIGRhbm4gYXVmZ2VydWZlbiwgd2VubiBlaW4gYW5kZXJlciBDbGllbnQgdW50ZXIgTnV0enVuZyBkZXNzZWxiZW4gc2Vzc2lvbkNvZGVzIGRpZSBWZXJiaW5kdW5nIG1pdCBkZW0gU2VydmVyIGJlZW5kZXQgaGF0LlwiLCBmYWxzZSkpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwib25DbGllbnRzRm91bmRcIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwib2hlckNsaWVudHNcIiwgdHlwZTogbmV3IEFycmF5VHlwZSh3ZWJTb2NrZXRDbGllbnRUeXBlKSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH0sXHJcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJvd25OdW1iZXJcIiwgdHlwZTogaW50UHJpbWl0aXZlVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH1cclxuICAgICAgICBdKSwgbnVsbCxcclxuICAgICAgICAgICAgbnVsbCwgLy8gbm8gc3RhdGVtZW50cyFcclxuICAgICAgICAgICAgZmFsc2UsIGZhbHNlLCBcIldpcmQgYXVmZ2VydWZlbiwgd2VubiBkaWUgZHVyY2ggZGllIE1ldGhvZGVuIGZpbmRDbGllbnQgYnp3LiBmaW5kQ2xpZW50cyB6dXZvciBnZXN1Y2h0ZW4gQ2xpZW50cyBnZWZ1bmRlbiB3dXJkZW4uXCIsIGZhbHNlKSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJnZXRPdGhlckNsaWVudHNcIiwgbmV3IFBhcmFtZXRlcmxpc3QoW10pLFxyXG4gICAgICAgICAgICBuZXcgQXJyYXlUeXBlKHdlYlNvY2tldENsaWVudFR5cGUpLFxyXG4gICAgICAgICAgICAocGFyYW1ldGVycykgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBvOiBSdW50aW1lT2JqZWN0ID0gcGFyYW1ldGVyc1swXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIGxldCB3aDogV2ViU29ja2V0SGVscGVyID0gby5pbnRyaW5zaWNEYXRhW1wiSGVscGVyXCJdO1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCByZXQgPSB3aC5jbGllbnRMaXN0Lm1hcChjbGllbnQgPT4ge3JldHVybiB7dHlwZTogd2ViU29ja2V0Q2xpZW50VHlwZSwgdmFsdWU6IGNsaWVudC5ydW50aW1lT2JqZWN0fX0pO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0O1xyXG5cclxuICAgICAgICAgICAgfSwgLy8gbm8gc3RhdGVtZW50cyFcclxuICAgICAgICAgICAgZmFsc2UsIGZhbHNlLCBcIkdpYnQgYWxsZSBiaXNoZXIgYmVpIGRlciBzZWxiZW4gU2Vzc2lvbiBhbmdlbWVsZGV0ZW4gQ2xpZW50cyB6dXLDvGNrLlwiLCBmYWxzZSkpO1xyXG5cclxuICAgIH1cclxuXHJcblxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgV2ViU29ja2V0SGVscGVyIHtcclxuXHJcbiAgICBvbk9wZW5NZXRob2Q6IE1ldGhvZDtcclxuICAgIG9uQ2xvc2VNZXRob2Q6IE1ldGhvZDtcclxuICAgIG9uTWVzc2FnZU1ldGhvZDogTWV0aG9kO1xyXG4gICAgb25DbGllbnRDb25uZWN0ZWRNZXRob2Q6IE1ldGhvZDtcclxuICAgIG9uQ2xpZW50RGlzY29ubmVjdGVkTWV0aG9kOiBNZXRob2Q7XHJcbiAgICBvbkNsaWVudHNGb3VuZE1ldGhvZDogTWV0aG9kO1xyXG5cclxuICAgIGNsaWVudExpc3Q6IFdlYlNvY2tldENsaWVudEhlbHBlcltdID0gW107XHJcbiAgICBpZFRvQ2xpZW50TWFwOiB7IFtpZDogbnVtYmVyXTogV2ViU29ja2V0Q2xpZW50SGVscGVyIH0gPSB7fTtcclxuXHJcbiAgICBjb25uZWN0aW9uOiBXZWJTb2NrZXQ7XHJcbiAgICBjbGllbnRfaWQ6IG51bWJlcjsgLy8gb3duIGNsaWVudC1pZFxyXG4gICAgaXNPcGVuOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBydW50aW1lT2JqZWN0OiBSdW50aW1lT2JqZWN0LCBwcml2YXRlIGludGVycHJldGVyOiBJbnRlcnByZXRlcixcclxuICAgICAgICBwcml2YXRlIHdlYlNvY2tldENsaWVudFR5cGU6IEtsYXNzLCBwcml2YXRlIHN5c3RlbUNsYXNzVHlwZTogU3lzdGVtQ2xhc3MpIHtcclxuXHJcbiAgICAgICAgbGV0IGtsYXNzOiBLbGFzcyA9IDxLbGFzcz5ydW50aW1lT2JqZWN0LmNsYXNzO1xyXG5cclxuICAgICAgICAvLyBbW0VudHJpZXNdXTpBcnJheSg0KVxyXG4gICAgICAgIC8vIDA6e1wiVGVzdDMoKVwiID0+IE1ldGhvZH1cclxuICAgICAgICAvLyAxOntcIm9uQ29ubmVjdCgpXCIgPT4gTWV0aG9kfVxyXG4gICAgICAgIC8vIDI6e1wib25NZXNzYWdlKFdlYlNvY2tldENsaWVudCwgU3RyaW5nLCBTdHJpbmcpXCIgPT4gTWV0aG9kfVxyXG4gICAgICAgIC8vIDM6e1widG9Kc29uKClcIiA9PiBNZXRob2R9XHJcblxyXG4gICAgICAgIHRoaXMub25PcGVuTWV0aG9kID0ga2xhc3MubWV0aG9kcy5maW5kKG0gPT4gbS5zaWduYXR1cmUgPT0gXCJvbk9wZW4oKVwiKTtcclxuICAgICAgICB0aGlzLm9uQ2xvc2VNZXRob2QgPSBrbGFzcy5tZXRob2RzLmZpbmQobSA9PiBtLnNpZ25hdHVyZSA9PSBcIm9uQ2xvc2UoKVwiKTtcclxuICAgICAgICB0aGlzLm9uTWVzc2FnZU1ldGhvZCA9IGtsYXNzLm1ldGhvZHMuZmluZChtID0+IG0uc2lnbmF0dXJlID09IFwib25NZXNzYWdlKFdlYlNvY2tldENsaWVudCwgU3RyaW5nLCBTdHJpbmcpXCIpO1xyXG4gICAgICAgIHRoaXMub25DbGllbnRDb25uZWN0ZWRNZXRob2QgPSBrbGFzcy5tZXRob2RzLmZpbmQobSA9PiBtLnNpZ25hdHVyZSA9PSBcIm9uT3RoZXJDbGllbnRDb25uZWN0ZWQoV2ViU29ja2V0Q2xpZW50KVwiKTtcclxuICAgICAgICB0aGlzLm9uQ2xpZW50RGlzY29ubmVjdGVkTWV0aG9kID0ga2xhc3MubWV0aG9kcy5maW5kKG0gPT4gbS5zaWduYXR1cmUgPT0gXCJvbk90aGVyQ2xpZW50RGlzY29ubmVjdGVkKFdlYlNvY2tldENsaWVudClcIik7XHJcbiAgICAgICAgdGhpcy5vbkNsaWVudHNGb3VuZE1ldGhvZCA9IGtsYXNzLm1ldGhvZHMuZmluZChtID0+IG0uc2lnbmF0dXJlID09IFwib25DbGllbnRzRm91bmQoV2ViU29ja2V0Q2xpZW50W10sIGludClcIik7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGNvbm5lY3Qoc2Vzc2lvbkNvZGU6IHN0cmluZywgbmlja05hbWU6IHN0cmluZykge1xyXG5cclxuICAgICAgICBpZih0aGlzLmludGVycHJldGVyLm1haW4uaXNFbWJlZGRlZCgpKXtcclxuICAgICAgICAgICAgdGhpcy5pbnRlcnByZXRlci50aHJvd0V4Y2VwdGlvbihcIkRpZSBOZXR6d2Vya2Z1bmt0aW9uYWxpdMOkdGVuIHN0ZWhlbiBudXIgZWluZ2Vsb2dndGVuIE51dHplcm4gaW4gZGVyIEVudHdpY2tsdW5nc3VtZ2VidW5nIHp1ciBWZXJmw7xndW5nIHVuZCBrw7ZubmVuIGRhaGVyIGxlaWRlciBoaWVyIG5pY2h0IGF1c3Byb2JpZXJ0IHdlcmRlbi5cIik7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBhamF4KCdnZXRXZWJTb2NrZXRUb2tlbicsIHt9LCAocmVzcG9uc2U6IEdldFdlYlNvY2tldFRva2VuUmVzcG9uc2UpID0+IHtcclxuXHJcbiAgICAgICAgICAgIGxldCB1cmw6IHN0cmluZyA9ICh3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wuc3RhcnRzV2l0aChcImh0dHBzXCIpID8gXCJ3c3M6Ly9cIiA6IFwid3M6Ly9cIikgKyB3aW5kb3cubG9jYXRpb24uaG9zdCArIFwiL3NlcnZsZXQvd2Vic29ja2V0XCI7XHJcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbiA9IG5ldyBXZWJTb2NrZXQodXJsKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbi5vbmVycm9yID0gKGVycm9yOiBFdmVudCkgPT4geyB0aGlzLm9uRXJyb3IoZXJyb3IpOyB9XHJcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbi5vbmNsb3NlID0gKGV2ZW50OiBDbG9zZUV2ZW50KSA9PiB7IHRoaXMub25DbG9zZShldmVudCk7IH1cclxuICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uLm9ubWVzc2FnZSA9IChldmVudDogTWVzc2FnZUV2ZW50KSA9PiB7IHRoaXMub25NZXNzYWdlKGV2ZW50KTsgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uLm9ub3BlbiA9IChldmVudDogRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCByZXF1ZXN0OiBXZWJTb2NrZXRSZXF1ZXN0Q29ubmVjdCA9IHtcclxuICAgICAgICAgICAgICAgICAgICBjb21tYW5kOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIHRva2VuOiByZXNwb25zZS50b2tlbixcclxuICAgICAgICAgICAgICAgICAgICBuaWNrbmFtZTogbmlja05hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbkNvZGU6IHNlc3Npb25Db2RlXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnRlcnByZXRlci53ZWJTb2NrZXRzVG9DbG9zZUFmdGVyUHJvZ3JhbUhhbHQucHVzaCh0aGlzLmNvbm5lY3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc09wZW4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZW5kSW50ZXJuKEpTT04uc3RyaW5naWZ5KHJlcXVlc3QpKTtcclxuICAgICAgICAgICAgICAgIHRoaXMub25PcGVuKCk7XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICB1bnNlbnRNZXNzYWdlczogc3RyaW5nW10gPSBbXTtcclxuICAgIHNlbmRJbnRlcm4obWVzc2FnZTogc3RyaW5nKSB7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5pc09wZW4pIHtcclxuICAgICAgICAgICAgdGhpcy51bnNlbnRNZXNzYWdlcy5wdXNoKG1lc3NhZ2UpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24uc2VuZChtZXNzYWdlKTtcclxuICAgICAgICAgICAgfSBjYXRjaCAoZXhjZXB0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhleGNlcHRpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uQ2xvc2UoZXZlbnQ6IENsb3NlRXZlbnQpIHtcclxuICAgICAgICB0aGlzLmlzT3BlbiA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMucnVuTWV0aG9kKHRoaXMub25DbG9zZU1ldGhvZCwgW10pO1xyXG4gICAgfVxyXG5cclxuICAgIHNlbmRUb0NsaWVudChjbGllbnRJZDogbnVtYmVyLCBkYXRhOiBzdHJpbmcsIGRhdGFUeXBlOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgbWVzc2FnZTogV2ViU29ja2V0UmVxdWVzdFNlbmRUb0NsaWVudCA9IHtcclxuICAgICAgICAgICAgY29tbWFuZDogMyxcclxuICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgZGF0YVR5cGU6IGRhdGFUeXBlLFxyXG4gICAgICAgICAgICByZWNpcGllbnRfaWQ6IGNsaWVudElkXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnNlbmRJbnRlcm4oSlNPTi5zdHJpbmdpZnkobWVzc2FnZSkpO1xyXG4gICAgfVxyXG5cclxuICAgIHNlbmRUb0FsbChkYXRhOiBzdHJpbmcsIGRhdGFUeXBlOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgbWVzc2FnZTogV2ViU29ja2V0UmVxdWVzdFNlbmRUb0FsbCA9IHtcclxuICAgICAgICAgICAgY29tbWFuZDogMixcclxuICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgZGF0YVR5cGU6IGRhdGFUeXBlXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnNlbmRJbnRlcm4oSlNPTi5zdHJpbmdpZnkobWVzc2FnZSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGRpc2Nvbm5lY3QoKSB7XHJcbiAgICAgICAgbGV0IG1lc3NhZ2U6IFdlYlNvY2tldFJlcXVlc3REaXNjb25uZWN0ID0ge1xyXG4gICAgICAgICAgICBjb21tYW5kOiA0XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnNlbmRJbnRlcm4oSlNPTi5zdHJpbmdpZnkobWVzc2FnZSkpO1xyXG4gICAgICAgIHRoaXMuY29ubmVjdGlvbi5jbG9zZSgpO1xyXG4gICAgICAgIGxldCB3dHIgPSB0aGlzLmludGVycHJldGVyLndlYlNvY2tldHNUb0Nsb3NlQWZ0ZXJQcm9ncmFtSGFsdDtcclxuICAgICAgICB3dHIuc3BsaWNlKHd0ci5pbmRleE9mKHRoaXMuY29ubmVjdGlvbiksIDEpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uTWVzc2FnZShldmVudDogTWVzc2FnZUV2ZW50KSB7XHJcblxyXG4gICAgICAgIGxldCByZXNwb25zZTogV2ViU29ja2V0UmVzcG9uc2UgPSBKU09OLnBhcnNlKGV2ZW50LmRhdGEpO1xyXG4gICAgICAgIGlmIChyZXNwb25zZS5jb21tYW5kID09IHVuZGVmaW5lZCkgcmV0dXJuO1xyXG5cclxuICAgICAgICBzd2l0Y2ggKHJlc3BvbnNlLmNvbW1hbmQpIHtcclxuICAgICAgICAgICAgY2FzZSAxOiAvLyBuZXcgQ2xpZW50XHJcbiAgICAgICAgICAgICAgICBsZXQgY2xpZW50UnVudGltZU9iamVjdCA9IG5ldyBSdW50aW1lT2JqZWN0KHRoaXMud2ViU29ja2V0Q2xpZW50VHlwZSk7XHJcbiAgICAgICAgICAgICAgICBsZXQgd2NoOiBXZWJTb2NrZXRDbGllbnRIZWxwZXIgPSBuZXcgV2ViU29ja2V0Q2xpZW50SGVscGVyKGNsaWVudFJ1bnRpbWVPYmplY3QsIHRoaXMsIHJlc3BvbnNlLnVzZXJfaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UucnVmbmFtZSwgcmVzcG9uc2UuZmFtaWxpZW5uYW1lLCByZXNwb25zZS51c2VybmFtZSwgcmVzcG9uc2Uubmlja25hbWUpO1xyXG4gICAgICAgICAgICAgICAgY2xpZW50UnVudGltZU9iamVjdC5pbnRyaW5zaWNEYXRhW1wiSGVscGVyXCJdID0gd2NoO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jbGllbnRMaXN0LnB1c2god2NoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaWRUb0NsaWVudE1hcFtyZXNwb25zZS51c2VyX2lkXSA9IHdjaDtcclxuICAgICAgICAgICAgICAgIHRoaXMucnVuTWV0aG9kKHRoaXMub25DbGllbnRDb25uZWN0ZWRNZXRob2QsIFt7IHR5cGU6IHRoaXMud2ViU29ja2V0Q2xpZW50VHlwZSwgdmFsdWU6IGNsaWVudFJ1bnRpbWVPYmplY3QgfV0pO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgMjogLy8gbWVzc2FnZVxyXG4gICAgICAgICAgICAgICAgbGV0IGNsaWVudEhlbHBlciA9IHRoaXMuaWRUb0NsaWVudE1hcFtyZXNwb25zZS5mcm9tX2NsaWVudF9pZF07XHJcbiAgICAgICAgICAgICAgICBpZiAoY2xpZW50SGVscGVyID09IG51bGwpIHJldHVybjtcclxuICAgICAgICAgICAgICAgIHRoaXMucnVuTWV0aG9kKHRoaXMub25NZXNzYWdlTWV0aG9kLCBbXHJcbiAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiB0aGlzLndlYlNvY2tldENsaWVudFR5cGUsIHZhbHVlOiBjbGllbnRIZWxwZXIucnVudGltZU9iamVjdCB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHsgdHlwZTogc3RyaW5nUHJpbWl0aXZlVHlwZSwgdmFsdWU6IHJlc3BvbnNlLmRhdGEgfSxcclxuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6IHN0cmluZ1ByaW1pdGl2ZVR5cGUsIHZhbHVlOiByZXNwb25zZS5kYXRhVHlwZSB9XHJcbiAgICAgICAgICAgICAgICBdKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDM6IC8vIG90aGVyIGNsaWVudCBkaXNjb25uZWN0ZWRcclxuICAgICAgICAgICAgICAgIGxldCBjbGllbnRIZWxwZXIxID0gdGhpcy5pZFRvQ2xpZW50TWFwW3Jlc3BvbnNlLmRpc2Nvbm5lY3RpbmdfY2xpZW50X2lkXTtcclxuICAgICAgICAgICAgICAgIGlmIChjbGllbnRIZWxwZXIxID09IG51bGwpIHJldHVybjtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xpZW50TGlzdC5zcGxpY2UodGhpcy5jbGllbnRMaXN0LmluZGV4T2YoY2xpZW50SGVscGVyMSksIDEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pZFRvQ2xpZW50TWFwW3Jlc3BvbnNlLmRpc2Nvbm5lY3RpbmdfY2xpZW50X2lkXSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIHRoaXMucnVuTWV0aG9kKHRoaXMub25DbGllbnREaXNjb25uZWN0ZWRNZXRob2QsIFtcclxuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6IHRoaXMud2ViU29ja2V0Q2xpZW50VHlwZSwgdmFsdWU6IGNsaWVudEhlbHBlcjEucnVudGltZU9iamVjdCB9XHJcbiAgICAgICAgICAgICAgICBdKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDQ6IC8vIHRpbWUgc3luY2hyb25pemF0aW9uXHJcbiAgICAgICAgICAgICAgICB0aGlzLnN5c3RlbUNsYXNzVHlwZS5kZWx0YVRpbWVNaWxsaXMgPSByZXNwb25zZS5jdXJyZW50VGltZU1pbGxzIC0gRGF0ZS5ub3coKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xpZW50X2lkID0gcmVzcG9uc2UuY2xpZW50X2lkXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSA1OiAvLyBrZWVwIGFsaXZlXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSA2OiAvLyBDbGllbnRzIGZvdW5kXHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uQ2xpZW50c0ZvdW5kKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbkNsaWVudHNGb3VuZChyZXNwb25zZTogV2ViU29ja2V0UmVzcG9uc2VQYWlyaW5nRm91bmQpIHtcclxuICAgICAgICBsZXQgb3duX2luZGV4OiBudW1iZXIgPSAwO1xyXG4gICAgICAgIGxldCBvdGhlckNsaWVudHM6IFZhbHVlW10gPSBbXTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgY2xpZW50IG9mIHJlc3BvbnNlLmNsaWVudHMpIHtcclxuICAgICAgICAgICAgaWYgKGNsaWVudC5pZCA9PSB0aGlzLmNsaWVudF9pZCkge1xyXG4gICAgICAgICAgICAgICAgb3duX2luZGV4ID0gY2xpZW50LmluZGV4O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbGV0IG90aGVyQ2xpZW50ID0gdGhpcy5pZFRvQ2xpZW50TWFwW2NsaWVudC5pZF07XHJcbiAgICAgICAgICAgICAgICBpZiAob3RoZXJDbGllbnQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG90aGVyQ2xpZW50LmluZGV4ID0gY2xpZW50LmluZGV4O1xyXG4gICAgICAgICAgICAgICAgICAgIG90aGVyQ2xpZW50cy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdGhpcy53ZWJTb2NrZXRDbGllbnRUeXBlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogb3RoZXJDbGllbnQucnVudGltZU9iamVjdFxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgYXJyYXlWYWx1ZTogVmFsdWUgPSB7XHJcbiAgICAgICAgICAgIHR5cGU6IG5ldyBBcnJheVR5cGUodGhpcy53ZWJTb2NrZXRDbGllbnRUeXBlKSxcclxuICAgICAgICAgICAgdmFsdWU6IG90aGVyQ2xpZW50c1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5ydW5NZXRob2QodGhpcy5vbkNsaWVudHNGb3VuZE1ldGhvZCwgW2FycmF5VmFsdWUsIHsgdHlwZTogaW50UHJpbWl0aXZlVHlwZSwgdmFsdWU6IG93bl9pbmRleCB9XSk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIG9uRXJyb3IoZXJyb3I6IEV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5pbnRlcnByZXRlci50aHJvd0V4Y2VwdGlvbihcIktvbW11bmlrYXRpb25zZmVobGVyIGJlaW0gV2ViU29ja2V0XCIpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uT3BlbigpIHtcclxuICAgICAgICB0aGlzLmlzT3BlbiA9IHRydWU7XHJcbiAgICAgICAgaWYodGhpcy51bnNlbnRNZXNzYWdlcy5sZW5ndGggPiAwKXtcclxuICAgICAgICAgICAgdGhpcy51bnNlbnRNZXNzYWdlcy5mb3JFYWNoKG0gPT4gdGhpcy5zZW5kSW50ZXJuKG0pKTtcclxuICAgICAgICAgICAgdGhpcy51bnNlbnRNZXNzYWdlcyA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJ1bk1ldGhvZCh0aGlzLm9uT3Blbk1ldGhvZCwgW10pO1xyXG4gICAgfVxyXG5cclxuICAgIHJ1bk1ldGhvZChtZXRob2Q6IE1ldGhvZCwgc3RhY2tFbGVtZW50czogVmFsdWVbXSkge1xyXG4gICAgICAgIGlmIChtZXRob2QgPT0gbnVsbCkgcmV0dXJuO1xyXG4gICAgICAgIHN0YWNrRWxlbWVudHMuc3BsaWNlKDAsIDAsIHtcclxuICAgICAgICAgICAgdHlwZTogdGhpcy5ydW50aW1lT2JqZWN0LmNsYXNzLFxyXG4gICAgICAgICAgICB2YWx1ZTogdGhpcy5ydW50aW1lT2JqZWN0XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmludGVycHJldGVyLnN0YXRlID09IEludGVycHJldGVyU3RhdGUud2FpdGluZ0ZvcklucHV0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW50ZXJwcmV0ZXIuZXhlY3V0ZUltbWVkaWF0ZWx5SW5OZXdTdGFja2ZyYW1lKG1ldGhvZC5wcm9ncmFtLCBzdGFja0VsZW1lbnRzKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmludGVycHJldGVyLnJ1blRpbWVyKG1ldGhvZCwgc3RhY2tFbGVtZW50cywgKCkgPT4geyB9LCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZpbmRDbGllbnRzRnJvbUNvdW50KGNvdW50OiBudW1iZXIpIHtcclxuICAgICAgICBsZXQgbWVzc2FnZTogV2ViU29ja2V0UmVxdWVzdEZpbmRQYWlyaW5nID0ge1xyXG4gICAgICAgICAgICBjb21tYW5kOiA2LFxyXG4gICAgICAgICAgICBjb3VudDogY291bnQsXHJcbiAgICAgICAgICAgIG5pY2tuYW1lczogW11cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc2VuZEludGVybihKU09OLnN0cmluZ2lmeShtZXNzYWdlKSk7XHJcbiAgICB9XHJcblxyXG4gICAgZmluZENsaWVudHNGcm9tTmlja25hbWVzKG5pY2tuYW1lczogc3RyaW5nW10pIHtcclxuICAgICAgICBsZXQgbWVzc2FnZTogV2ViU29ja2V0UmVxdWVzdEZpbmRQYWlyaW5nID0ge1xyXG4gICAgICAgICAgICBjb21tYW5kOiA2LFxyXG4gICAgICAgICAgICBjb3VudDogbmlja25hbWVzLmxlbmd0aCxcclxuICAgICAgICAgICAgbmlja25hbWVzOiBuaWNrbmFtZXNcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc2VuZEludGVybihKU09OLnN0cmluZ2lmeShtZXNzYWdlKSk7XHJcbiAgICB9XHJcblxyXG5cclxufSJdfQ==