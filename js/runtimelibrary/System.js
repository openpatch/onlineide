import { Method, Parameterlist, Attribute } from "../compiler/types/Types.js";
import { Klass, Visibility } from "../compiler/types/Class.js";
import { stringPrimitiveType, intPrimitiveType, voidPrimitiveType } from "../compiler/types/PrimitiveTypes.js";
import { RuntimeObject } from "../interpreter/RuntimeObject.js";
export class SystemClass extends Klass {
    constructor(module) {
        super("System", module, "Klasse mit statischen Methoden für Systemfunktionen, z.B. Sound, Löschen der Ausgabe usw.");
        this.deltaTimeMillis = 0; // when using WebSocket then the Server sends time synchronization
        this.printStream = new RuntimeObject(module.typeStore.getType("PrintStream"));
        this.setBaseClass(module.typeStore.getType("Object"));
        this.addAttribute(new Attribute("out", module.typeStore.getType("PrintStream"), (value) => { value.value = this.printStream; }, true, Visibility.public, true, "PrintStream-Objekt, mit dem Text ausgegeben werden kann."));
        this.staticClass.setupAttributeIndicesRecursive();
        this.staticClass.classObject = new RuntimeObject(this.staticClass);
        // this.addMethod(new Method("clearScreen", new Parameterlist([
        // ]), null,
        //     (parameters) => {
        //         module.main.getInterpreter().printManager.clear();
        //     }, false, true, "Löscht den Bildschirm"));
        // this.addMethod(new Method("addKeyListener", new Parameterlist([
        //     { identifier: "keyListener", type: module.typeStore.getType("KeyListener"), declaration: null, usagePositions: null, isFinal: true }
        // ]), null,
        // (parameters) => {
        //     let r: RuntimeObject = parameters[1].value;
        //     let method = (<Klass>r.class).getMethodBySignature("onKeyTyped(String)");
        //     if (method != null) {
        //         module.main.getInterpreter().keyboardTool.keyPressedCallbacks.push((key) => {
        //             let program = method?.program;
        //             let invoke = method?.invoke;
        //             let stackElements: Value[] = [
        //                 {
        //                     type: r.class,
        //                     value: r
        //                 },
        //                 {
        //                     type: stringPrimitiveType,
        //                     value: key
        //                 }
        //             ];
        //             if (program != null) {
        //                 module.main.getInterpreter().runTimer(method, stackElements, null, false);
        //             } else if (invoke != null) {
        //                 invoke([]);
        //             }
        //         });
        //     }
        // }    
        // , false, true, "Fügt einen KeyListener hinzu, dessen Methode keyTyped immer dann aufgerufen wird, wenn eine Taste gedrückt und anschließend losgelassen wird."));
        // this.addMethod(new Method("playSound", new Parameterlist([
        //     { identifier: "sound", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true }
        // ]), null,
        // (parameters) => {
        //     let sound: string = parameters[1].value;
        //     SoundTools.play(sound);
        // }    
        // , false, true, "Spielt einen Sound ab. Die Möglichen Sounds sind als statische Variablen der Klasse Sound hinterlegt. Tippe als Parameter also Sound gefolgt von einem Punkt ein, um eine Auswahl zu sehen!"));
        this.addMethod(new Method("currentTimeMillis", new Parameterlist([]), intPrimitiveType, (parameters) => {
            return Date.now() + this.deltaTimeMillis;
        }, false, true, "Gibt die Anzahl der Millisekunden, die seit dem 01.01.1970 00:00:00 UTC vergangen sind, zurück."));
        this.addMethod(new Method("exit", new Parameterlist([
            { identifier: "status", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true }
        ]), voidPrimitiveType, (parameters) => {
            var _a;
            let console = (_a = module.main.getBottomDiv()) === null || _a === void 0 ? void 0 : _a.console;
            if (console != null) {
                console.writeConsoleEntry("Das Programm wurde angehalten mit Statuswert: " + parameters[1].value, null, "#0000ff");
                console.showTab();
            }
            module.main.getInterpreter().stop();
        }, false, true, "Beendet das Programm und gibt den übergebenen Wert in der Konsole aus."));
    }
}
export class PrintStreamClass extends Klass {
    constructor(module) {
        super("PrintStream", module, "Interne Hilfsklasse, um System.out.println zu ermöglichen. Das Objekt System.out ist von der Klasse PrintStream.");
        this.setBaseClass(module.typeStore.getType("Object"));
        this.addMethod(new Method("print", new Parameterlist([
            { identifier: "text", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true }
        ]), null, (parameters) => {
            module.main.getInterpreter().printManager.print(parameters[1].value);
        }, false, true, "Gibt den Text aus."));
        this.addMethod(new Method("println", new Parameterlist([
            { identifier: "text", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true }
        ]), null, (parameters) => {
            module.main.getInterpreter().printManager.println(parameters[1].value);
        }, false, true, "Gibt den Text aus, gefolgt von einem Zeilensprung."));
        this.addMethod(new Method("println", new Parameterlist([]), null, (parameters) => {
            module.main.getInterpreter().printManager.println("");
        }, false, true, "Setzt den Cursor in die nächste Zeile."));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3lzdGVtLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NsaWVudC9ydW50aW1lbGlicmFyeS9TeXN0ZW0udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFRLE1BQU0sRUFBRSxhQUFhLEVBQVMsU0FBUyxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDM0YsT0FBTyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQWEsTUFBTSw0QkFBNEIsQ0FBQztBQUMxRSxPQUFPLEVBQUUsbUJBQW1CLEVBQTJDLGdCQUFnQixFQUFFLGlCQUFpQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFHeEosT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBSWhFLE1BQU0sT0FBTyxXQUFZLFNBQVEsS0FBSztJQU1sQyxZQUFZLE1BQWM7UUFDdEIsS0FBSyxDQUFDLFFBQVEsRUFBRSxNQUFNLEVBQUUsMkZBQTJGLENBQUMsQ0FBQztRQUh6SCxvQkFBZSxHQUFXLENBQUMsQ0FBQyxDQUFDLGtFQUFrRTtRQUszRixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksYUFBYSxDQUFRLE1BQU0sQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7UUFFckYsSUFBSSxDQUFDLFlBQVksQ0FBUSxNQUFNLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBRTdELElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxTQUFTLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxFQUMxRSxDQUFDLEtBQUssRUFBRSxFQUFFLEdBQUcsS0FBSyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFBLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxVQUFVLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSwwREFBMEQsQ0FBQyxDQUFDLENB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IHsgVHlwZSwgTWV0aG9kLCBQYXJhbWV0ZXJsaXN0LCBWYWx1ZSwgQXR0cmlidXRlIH0gZnJvbSBcIi4uL2NvbXBpbGVyL3R5cGVzL1R5cGVzLmpzXCI7XHJcbmltcG9ydCB7IEtsYXNzLCBWaXNpYmlsaXR5LCBJbnRlcmZhY2UgfSBmcm9tIFwiLi4vY29tcGlsZXIvdHlwZXMvQ2xhc3MuanNcIjtcclxuaW1wb3J0IHsgc3RyaW5nUHJpbWl0aXZlVHlwZSwgZG91YmxlUHJpbWl0aXZlVHlwZSwgZmxvYXRQcmltaXRpdmVUeXBlLCBpbnRQcmltaXRpdmVUeXBlLCB2b2lkUHJpbWl0aXZlVHlwZSB9IGZyb20gXCIuLi9jb21waWxlci90eXBlcy9QcmltaXRpdmVUeXBlcy5qc1wiO1xyXG5pbXBvcnQgeyBNb2R1bGUgfSBmcm9tIFwiLi4vY29tcGlsZXIvcGFyc2VyL01vZHVsZS5qc1wiO1xyXG5pbXBvcnQgeyBQcmludE1hbmFnZXIgfSBmcm9tIFwiLi4vbWFpbi9ndWkvUHJpbnRNYW5hZ2VyLmpzXCI7XHJcbmltcG9ydCB7IFJ1bnRpbWVPYmplY3QgfSBmcm9tIFwiLi4vaW50ZXJwcmV0ZXIvUnVudGltZU9iamVjdC5qc1wiO1xyXG5pbXBvcnQgeyBFbnVtUnVudGltZU9iamVjdCB9IGZyb20gXCIuLi9jb21waWxlci90eXBlcy9FbnVtLmpzXCI7XHJcbmltcG9ydCB7IFNvdW5kVG9vbHMgfSBmcm9tIFwiLi4vdG9vbHMvU291bmRUb29scy5qc1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFN5c3RlbUNsYXNzIGV4dGVuZHMgS2xhc3Mge1xyXG5cclxuICAgIHByaW50U3RyZWFtOiBSdW50aW1lT2JqZWN0O1xyXG5cclxuICAgIGRlbHRhVGltZU1pbGxpczogbnVtYmVyID0gMDsgLy8gd2hlbiB1c2luZyBXZWJTb2NrZXQgdGhlbiB0aGUgU2VydmVyIHNlbmRzIHRpbWUgc3luY2hyb25pemF0aW9uXHJcblxyXG4gICAgY29uc3RydWN0b3IobW9kdWxlOiBNb2R1bGUpIHtcclxuICAgICAgICBzdXBlcihcIlN5c3RlbVwiLCBtb2R1bGUsIFwiS2xhc3NlIG1pdCBzdGF0aXNjaGVuIE1ldGhvZGVuIGbDvHIgU3lzdGVtZnVua3Rpb25lbiwgei5CLiBTb3VuZCwgTMO2c2NoZW4gZGVyIEF1c2dhYmUgdXN3LlwiKTtcclxuXHJcbiAgICAgICAgdGhpcy5wcmludFN0cmVhbSA9IG5ldyBSdW50aW1lT2JqZWN0KDxLbGFzcz5tb2R1bGUudHlwZVN0b3JlLmdldFR5cGUoXCJQcmludFN0cmVhbVwiKSk7XHJcblxyXG4gICAgICAgIHRoaXMuc2V0QmFzZUNsYXNzKDxLbGFzcz5tb2R1bGUudHlwZVN0b3JlLmdldFR5cGUoXCJPYmplY3RcIikpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZEF0dHJpYnV0ZShuZXcgQXR0cmlidXRlKFwib3V0XCIsIG1vZHVsZS50eXBlU3RvcmUuZ2V0VHlwZShcIlByaW50U3RyZWFtXCIpLFxyXG4gICAgICAgICAgICAodmFsdWUpID0+IHsgdmFsdWUudmFsdWUgPSB0aGlzLnByaW50U3RyZWFtIH0sIHRydWUsIFZpc2liaWxpdHkucHVibGljLCB0cnVlLCBcIlByaW50U3RyZWFtLU9iamVrdCwgbWl0IGRlbSBUZXh0IGF1c2dlZ2ViZW4gd2VyZGVuIGthbm4uXCIpKTtcclxuXHJcbiAgICAgICAgdGhpcy5zdGF0aWNDbGFzcy5zZXR1cEF0dHJpYnV0ZUluZGljZXNSZWN1cnNpdmUoKTtcclxuXHJcblxyXG4gICAgICAgIHRoaXMuc3RhdGljQ2xhc3MuY2xhc3NPYmplY3QgPSBuZXcgUnVudGltZU9iamVjdCh0aGlzLnN0YXRpY0NsYXNzKTtcclxuXHJcbiAgICAgICAgLy8gdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcImNsZWFyU2NyZWVuXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICAvLyBdKSwgbnVsbCxcclxuICAgICAgICAvLyAgICAgKHBhcmFtZXRlcnMpID0+IHtcclxuICAgICAgICAvLyAgICAgICAgIG1vZHVsZS5tYWluLmdldEludGVycHJldGVyKCkucHJpbnRNYW5hZ2VyLmNsZWFyKCk7XHJcbiAgICAgICAgLy8gICAgIH0sIGZhbHNlLCB0cnVlLCBcIkzDtnNjaHQgZGVuIEJpbGRzY2hpcm1cIikpO1xyXG5cclxuICAgICAgICAvLyB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiYWRkS2V5TGlzdGVuZXJcIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgIC8vICAgICB7IGlkZW50aWZpZXI6IFwia2V5TGlzdGVuZXJcIiwgdHlwZTogbW9kdWxlLnR5cGVTdG9yZS5nZXRUeXBlKFwiS2V5TGlzdGVuZXJcIiksIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9XHJcbiAgICAgICAgLy8gXSksIG51bGwsXHJcbiAgICAgICAgLy8gKHBhcmFtZXRlcnMpID0+IHtcclxuICAgICAgICAvLyAgICAgbGV0IHI6IFJ1bnRpbWVPYmplY3QgPSBwYXJhbWV0ZXJzWzFdLnZhbHVlO1xyXG4gICAgICAgIC8vICAgICBsZXQgbWV0aG9kID0gKDxLbGFzcz5yLmNsYXNzKS5nZXRNZXRob2RCeVNpZ25hdHVyZShcIm9uS2V5VHlwZWQoU3RyaW5nKVwiKTtcclxuXHJcbiAgICAgICAgLy8gICAgIGlmIChtZXRob2QgIT0gbnVsbCkge1xyXG5cclxuICAgICAgICAvLyAgICAgICAgIG1vZHVsZS5tYWluLmdldEludGVycHJldGVyKCkua2V5Ym9hcmRUb29sLmtleVByZXNzZWRDYWxsYmFja3MucHVzaCgoa2V5KSA9PiB7XHJcblxyXG4gICAgICAgIC8vICAgICAgICAgICAgIGxldCBwcm9ncmFtID0gbWV0aG9kPy5wcm9ncmFtO1xyXG4gICAgICAgIC8vICAgICAgICAgICAgIGxldCBpbnZva2UgPSBtZXRob2Q/Lmludm9rZTtcclxuXHJcbiAgICAgICAgLy8gICAgICAgICAgICAgbGV0IHN0YWNrRWxlbWVudHM6IFZhbHVlW10gPSBbXHJcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHIuY2xhc3MsXHJcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICB2YWx1ZTogclxyXG4gICAgICAgIC8vICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgIC8vICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICB0eXBlOiBzdHJpbmdQcmltaXRpdmVUeXBlLFxyXG4gICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGtleVxyXG4gICAgICAgIC8vICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgLy8gICAgICAgICAgICAgXTtcclxuXHJcbiAgICAgICAgLy8gICAgICAgICAgICAgaWYgKHByb2dyYW0gIT0gbnVsbCkge1xyXG4gICAgICAgIC8vICAgICAgICAgICAgICAgICBtb2R1bGUubWFpbi5nZXRJbnRlcnByZXRlcigpLnJ1blRpbWVyKG1ldGhvZCwgc3RhY2tFbGVtZW50cywgbnVsbCwgZmFsc2UpO1xyXG4gICAgICAgIC8vICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW52b2tlICE9IG51bGwpIHtcclxuICAgICAgICAvLyAgICAgICAgICAgICAgICAgaW52b2tlKFtdKTtcclxuICAgICAgICAvLyAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAvLyAgICAgICAgIH0pO1xyXG4gICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgLy8gfSAgICBcclxuICAgICAgICAvLyAsIGZhbHNlLCB0cnVlLCBcIkbDvGd0IGVpbmVuIEtleUxpc3RlbmVyIGhpbnp1LCBkZXNzZW4gTWV0aG9kZSBrZXlUeXBlZCBpbW1lciBkYW5uIGF1ZmdlcnVmZW4gd2lyZCwgd2VubiBlaW5lIFRhc3RlIGdlZHLDvGNrdCB1bmQgYW5zY2hsaWXDn2VuZCBsb3NnZWxhc3NlbiB3aXJkLlwiKSk7XHJcblxyXG4gICAgICAgIC8vIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJwbGF5U291bmRcIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgIC8vICAgICB7IGlkZW50aWZpZXI6IFwic291bmRcIiwgdHlwZTogc3RyaW5nUHJpbWl0aXZlVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH1cclxuICAgICAgICAvLyBdKSwgbnVsbCxcclxuICAgICAgICAvLyAocGFyYW1ldGVycykgPT4ge1xyXG4gICAgICAgIC8vICAgICBsZXQgc291bmQ6IHN0cmluZyA9IHBhcmFtZXRlcnNbMV0udmFsdWU7XHJcbiAgICAgICAgLy8gICAgIFNvdW5kVG9vbHMucGxheShzb3VuZCk7XHJcbiAgICAgICAgLy8gfSAgICBcclxuICAgICAgICAvLyAsIGZhbHNlLCB0cnVlLCBcIlNwaWVsdCBlaW5lbiBTb3VuZCBhYi4gRGllIE3DtmdsaWNoZW4gU291bmRzIHNpbmQgYWxzIHN0YXRpc2NoZSBWYXJpYWJsZW4gZGVyIEtsYXNzZSBTb3VuZCBoaW50ZXJsZWd0LiBUaXBwZSBhbHMgUGFyYW1ldGVyIGFsc28gU291bmQgZ2Vmb2xndCB2b24gZWluZW0gUHVua3QgZWluLCB1bSBlaW5lIEF1c3dhaGwgenUgc2VoZW4hXCIpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcImN1cnJlbnRUaW1lTWlsbGlzXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICBdKSwgaW50UHJpbWl0aXZlVHlwZSxcclxuICAgICAgICAgICAgKHBhcmFtZXRlcnMpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBEYXRlLm5vdygpICsgdGhpcy5kZWx0YVRpbWVNaWxsaXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLCBmYWxzZSwgdHJ1ZSwgXCJHaWJ0IGRpZSBBbnphaGwgZGVyIE1pbGxpc2VrdW5kZW4sIGRpZSBzZWl0IGRlbSAwMS4wMS4xOTcwIDAwOjAwOjAwIFVUQyB2ZXJnYW5nZW4gc2luZCwgenVyw7xjay5cIikpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiZXhpdFwiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJzdGF0dXNcIiwgdHlwZTogaW50UHJpbWl0aXZlVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH1cclxuICAgICAgICBdKSwgdm9pZFByaW1pdGl2ZVR5cGUsXHJcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgY29uc29sZSA9IG1vZHVsZS5tYWluLmdldEJvdHRvbURpdigpPy5jb25zb2xlO1xyXG4gICAgICAgICAgICAgICAgaWYoY29uc29sZSAhPSBudWxsKXtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndyaXRlQ29uc29sZUVudHJ5KFwiRGFzIFByb2dyYW1tIHd1cmRlIGFuZ2VoYWx0ZW4gbWl0IFN0YXR1c3dlcnQ6IFwiICsgcGFyYW1ldGVyc1sxXS52YWx1ZSwgbnVsbCwgXCIjMDAwMGZmXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuc2hvd1RhYigpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbW9kdWxlLm1haW4uZ2V0SW50ZXJwcmV0ZXIoKS5zdG9wKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLCBmYWxzZSwgdHJ1ZSwgXCJCZWVuZGV0IGRhcyBQcm9ncmFtbSB1bmQgZ2lidCBkZW4gw7xiZXJnZWJlbmVuIFdlcnQgaW4gZGVyIEtvbnNvbGUgYXVzLlwiKSk7XHJcblxyXG4gICAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFByaW50U3RyZWFtQ2xhc3MgZXh0ZW5kcyBLbGFzcyB7XHJcblxyXG4gICAgY29uc3RydWN0b3IobW9kdWxlOiBNb2R1bGUpIHtcclxuICAgICAgICBzdXBlcihcIlByaW50U3RyZWFtXCIsIG1vZHVsZSwgXCJJbnRlcm5lIEhpbGZza2xhc3NlLCB1bSBTeXN0ZW0ub3V0LnByaW50bG4genUgZXJtw7ZnbGljaGVuLiBEYXMgT2JqZWt0IFN5c3RlbS5vdXQgaXN0IHZvbiBkZXIgS2xhc3NlIFByaW50U3RyZWFtLlwiKTtcclxuXHJcbiAgICAgICAgdGhpcy5zZXRCYXNlQ2xhc3MoPEtsYXNzPm1vZHVsZS50eXBlU3RvcmUuZ2V0VHlwZShcIk9iamVjdFwiKSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJwcmludFwiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJ0ZXh0XCIsIHR5cGU6IHN0cmluZ1ByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9XHJcbiAgICAgICAgXSksIG51bGwsXHJcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBtb2R1bGUubWFpbi5nZXRJbnRlcnByZXRlcigpLnByaW50TWFuYWdlci5wcmludChwYXJhbWV0ZXJzWzFdLnZhbHVlKTtcclxuICAgICAgICAgICAgfSwgZmFsc2UsIHRydWUsIFwiR2lidCBkZW4gVGV4dCBhdXMuXCIpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcInByaW50bG5cIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwidGV4dFwiLCB0eXBlOiBzdHJpbmdQcmltaXRpdmVUeXBlLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfVxyXG4gICAgICAgIF0pLCBudWxsLFxyXG4gICAgICAgICAgICAocGFyYW1ldGVycykgPT4ge1xyXG4gICAgICAgICAgICAgICAgbW9kdWxlLm1haW4uZ2V0SW50ZXJwcmV0ZXIoKS5wcmludE1hbmFnZXIucHJpbnRsbihwYXJhbWV0ZXJzWzFdLnZhbHVlKTtcclxuICAgICAgICAgICAgfSwgZmFsc2UsIHRydWUsIFwiR2lidCBkZW4gVGV4dCBhdXMsIGdlZm9sZ3Qgdm9uIGVpbmVtIFplaWxlbnNwcnVuZy5cIikpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwicHJpbnRsblwiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgXSksIG51bGwsXHJcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBtb2R1bGUubWFpbi5nZXRJbnRlcnByZXRlcigpLnByaW50TWFuYWdlci5wcmludGxuKFwiXCIpO1xyXG4gICAgICAgICAgICB9LCBmYWxzZSwgdHJ1ZSwgXCJTZXR6dCBkZW4gQ3Vyc29yIGluIGRpZSBuw6RjaHN0ZSBaZWlsZS5cIikpO1xyXG5cclxuXHJcbiAgICB9XHJcblxyXG59Il19