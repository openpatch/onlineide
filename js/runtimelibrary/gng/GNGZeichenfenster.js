import { Klass } from "../../compiler/types/Class.js";
import { intPrimitiveType, voidPrimitiveType } from "../../compiler/types/PrimitiveTypes.js";
import { Method, Parameterlist } from "../../compiler/types/Types.js";
import { RuntimeObject } from "../../interpreter/RuntimeObject.js";
import { WorldHelper } from "../graphics/World.js";
import { GNGEreignisbehandlung } from "./GNGEreignisbehandlung.js";
export class GNGZeichenfensterClass extends Klass {
    constructor(module, moduleStore) {
        super("Zeichenfenster", module, "Grafische Zeichenfläche mit Koordinatensystem");
        this.module = module;
        this.setBaseClass(moduleStore.getType("Object").type);
        let aktionsempfaengerType = module.typeStore.getType("Aktionsempfaenger");
        // this.addAttribute(new Attribute("PI", doublePrimitiveType, (object) => { return Math.PI }, true, Visibility.public, true, "Die Kreiszahl Pi (3.1415...)"));
        this.addMethod(new Method("MalflächenBreiteGeben", new Parameterlist([]), intPrimitiveType, (parameters) => {
            return Math.round(this.getWorldHelper().width);
        }, false, true, 'Gibt die Breite des Zeichenbereichs in Pixeln zurück.', false));
        this.addMethod(new Method("MalflächenHöheGeben", new Parameterlist([]), intPrimitiveType, (parameters) => {
            return Math.round(this.getWorldHelper().width);
        }, false, true, 'Gibt die Höhe des Zeichenbereichs in Pixeln zurück.', false));
        this.addMethod(new Method("AktionsEmpfängerEintragen", new Parameterlist([
            { identifier: "neu", type: aktionsempfaengerType, declaration: null, usagePositions: null, isFinal: true },
        ]), voidPrimitiveType, (parameters) => {
            let aktionsempfaenger = parameters[1].value;
            let helper = GNGEreignisbehandlung.getHelper(module);
            helper.registerEvents(aktionsempfaenger);
        }, false, true, 'Trägt einen neuen Aktionsempfänger ein.', false));
        this.addMethod(new Method("AktionsEmpfängerEntfernen", new Parameterlist([
            { identifier: "alt", type: aktionsempfaengerType, declaration: null, usagePositions: null, isFinal: true },
        ]), voidPrimitiveType, (parameters) => {
            let aktionsempfaenger = parameters[1].value;
            let helper = GNGEreignisbehandlung.getHelper(module);
            helper.unregisterEvents(aktionsempfaenger);
        }, false, true, 'Löscht einen Aktionsempfänger aus der Liste.', false));
        this.addMethod(new Method("TaktgeberStarten", new Parameterlist([]), voidPrimitiveType, (parameters) => {
            let helper = GNGEreignisbehandlung.getHelper(module);
            helper.startTimer();
        }, false, true, 'Startet den Taktgeber', false));
        this.addMethod(new Method("TaktgeberStoppen", new Parameterlist([]), voidPrimitiveType, (parameters) => {
            let helper = GNGEreignisbehandlung.getHelper(module);
            helper.stopTimer();
        }, false, true, 'Stoppt den Taktgeber', false));
        this.addMethod(new Method("TaktdauerSetzen", new Parameterlist([
            { identifier: "dauer", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), voidPrimitiveType, (parameters) => {
            let dauer = parameters[1].value;
            let helper = GNGEreignisbehandlung.getHelper(module);
            helper.taktdauer = dauer;
        }, false, true, 'Setzt die Taktdauer des Zeitgebers in Millisekunden', false));
    }
    getWorldHelper(breite = 800, höhe = 600) {
        var _a, _b, _c, _d;
        let wh = (_c = (_b = (_a = this.module) === null || _a === void 0 ? void 0 : _a.main) === null || _b === void 0 ? void 0 : _b.getInterpreter()) === null || _c === void 0 ? void 0 : _c.worldHelper;
        if (wh != null) {
            if (wh.width != breite || wh.height != höhe) {
                let ratio = Math.round(höhe / breite * 100);
                wh.$containerOuter.css('padding-bottom', ratio + "%");
                wh.stage.localTransform.scale(wh.width / breite, wh.height / höhe);
                wh.width = breite;
                wh.height = höhe;
                // this.stage.localTransform.rotate(45/180*Math.PI);
                // this.stage.localTransform.translate(400,300);
                //@ts-ignore
                wh.stage.transform.onChange();
                (_d = this.module.main.getRightDiv()) === null || _d === void 0 ? void 0 : _d.adjustWidthToWorld();
            }
            return wh;
        }
        else {
            let worldObject = new RuntimeObject(this.module.typeStore.getType("World"));
            let wh = new WorldHelper(breite, höhe, this.module, worldObject);
            worldObject.intrinsicData["World"] = wh;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiR05HWmVpY2hlbmZlbnN0ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY2xpZW50L3J1bnRpbWVsaWJyYXJ5L2duZy9HTkdaZWljaGVuZmVuc3Rlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLGlCQUFpQixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDN0YsT0FBTyxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUN0RSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDbkUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxxQkFBcUIsRUFBK0IsTUFBTSw0QkFBNEIsQ0FBQztBQUVoRyxNQUFNLE9BQU8sc0JBQXVCLFNBQVEsS0FBSztJQUU3QyxZQUFtQixNQUFjLEVBQUUsV0FBd0I7UUFFdkQsS0FBSyxDQUFDLGdCQUFnQixFQUFFLE1BQU0sRUFBRSwrQ0FBK0MsQ0FBQyxDQUFBO1FBRmpFLFdBQU0sR0FBTixNQUFNLENBQVE7UUFJN0IsSUFBSSxDQUFDLFlBQVksQ0FBUSxXQUFXLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRTdELElBQUkscUJBQXFCLEdBQTJCLE1BQU0sQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLG1CQUFtQixDQUFDLENBQUM7UUFHbEcsOEpBQThKO1FBRzlKLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxNQUFNLENBQUMsdUJBQXVCLEVBQUUsSUFBSSxhQUFhLENBQUMsRUFBRSxDQUFDLEVBQUUsZ0JBQWdCLEVBQ3RGLENBQUMsVUFBVSxFQUFFLEVBQUU7WUFFWCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRW5ELENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLHVEQUF1RCxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFFckYsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxxQkFBcUIsRUFBRSxJQUFJLGFBQWEsQ0FBQyxFQUFFLENBQUMsRUFBRSxnQkFBZ0IsRUFDcEYsQ0FBQyxVQUFVLEVBQUUsRUFBRTtZQUVYLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFbkQsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUscURBQXFELEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUVuRixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksTUFBTSxDQUFDLDJCQUEyQixFQUFFLElBQUksYUFBYSxDQUFDO1lBQ3JFLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUscUJBQXFCLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUU7U0FDN0csQ0FBQyxFQUFFLGlCQUFpQixFQUNqQixDQUFDLFVBQVUsRUFBRSxFQUFFO1lBRVgsSUFBSSxpQkFBaUIsR0FBa0IsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztZQUUzRCxJQUFJLE1BQU0sR0FBZ0MscUJBQXFCLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ2xGLE1BQU0sQ0FBQyxjQUFjLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUU3QyxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSx5Q0FBeUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBRXZFLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxNQUFNLENBQUMsMkJBQTJCLEVBQUUsSUFBSSxhQUFhLENBQUM7WUFDckUsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxxQkFBcUIsRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRTtTQUM3RyxDQUFDLEVBQUUsaUJBQWlCLEVBQ2pCLENBQUMsVUFBVSxFQUFFLEVBQUU7WUFFWCxJQUFJLGlCQUFpQixHQUFrQixVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1lBRTNELElBQUksTUFBTSxHQUFnQyxxQkFBcUIsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDbEYsTUFBTSxDQUFDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFFL0MsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsOENBQThDLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUU1RSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksTUFBTSxDQUFDLGtCQUFrQixFQUFFLElBQUksYUFBYSxDQUFDLEVBQUUsQ0FBQyxFQUFFLGlCQUFpQixFQUNsRixDQUFDLFVBQVUsRUFBRSxFQUFFO1lBRVgsSUFBSSxNQUFNLEdBQWdDLHFCQUFxQixDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNsRixNQUFNLENBQUMsVUFBVSxFQUFFLENBQUM7UUFFeEIsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsdUJBQXVCLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUVyRCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksTUFBTSxDQUFDLGtCQUFrQixFQUFFLElBQUksYUFBYSxDQUFDLEVBQUUsQ0FBQyxFQUFFLGlCQUFpQixFQUNsRixDQUFDLFVBQVUsRUFBRSxFQUFFO1lBRVgsSUFBSSxNQUFNLEdBQWdDLHFCQUFxQixDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNsRixNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7UUFFdkIsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsc0JBQXNCLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUVwRCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksTUFBTSxDQUFDLGlCQUFpQixFQUFFLElBQUksYUFBYSxDQUFDO1lBQzNELEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsZ0JBQWdCLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUU7U0FDMUcsQ0FBQyxFQUFFLGlCQUFpQixFQUNqQixDQUFDLFVBQVUsRUFBRSxFQUFFO1lBRVgsSUFBSSxLQUFLLEdBQVcsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztZQUV4QyxJQUFJLE1BQU0sR0FBZ0MscUJBQXFCLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ2xGLE1BQU0sQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO1FBRTdCLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLHFEQUFxRCxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFHdkYsQ0FBQztJQUVELGNBQWMsQ0FBQyxTQUFpQixHQUFHLEVBQUUsT0FBZSxHQUFHOztRQUVuRCxJQUFJLEVBQUUscUJBQUcsSUFBSSxDQUFDLE1BQU0sMENBQUUsSUFBSSwwQ0FBRSxjQUFjLDRDQUFJLFdBQVcsQ0FBQztRQUUxRCxJQUFJLEVBQUUsSUFBSSxJQUFJLEVBQUU7WUFFWixJQUFJLEVBQUUsQ0FBQyxLQUFLLElBQUksTUFBTSxJQUFJLEVBQUUsQ0FBQyxNQUFNLElBQUksSUFBSSxFQUFFO2dCQUV6QyxJQUFJLEtBQUssR0FBVyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksR0FBRyxNQUFNLEdBQUcsR0FBRyxDQUFDLENBQUM7Z0JBQ3BELEVBQUUsQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLEtBQUssR0FBRyxHQUFHLENBQUMsQ0FBQztnQkFFdEQsRUFBRSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxLQUFLLEdBQUcsTUFBTSxFQUFFLEVBQUUsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLENBQUM7Z0JBQ25FLEVBQUUsQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDO2dCQUNsQixFQUFFLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztnQkFDakIsb0RBQW9EO2dCQUNwRCxnREFBZ0Q7Z0JBQ2hELFlBQVk7Z0JBQ1osRUFBRSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLENBQUM7Z0JBRTlCLE1BQUEsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLDBDQUFFLGtCQUFrQixHQUFHO2FBRXhEO1lBRUQsT0FBTyxFQUFFLENBQUM7U0FFYjthQUFNO1lBQ0gsSUFBSSxXQUFXLEdBQWtCLElBQUksYUFBYSxDQUFRLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ2xHLElBQUksRUFBRSxHQUFHLElBQUksV0FBVyxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxXQUFXLENBQUMsQ0FBQztZQUNqRSxXQUFXLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQztTQUMzQztJQUVMLENBQUM7Q0FHSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1vZHVsZSwgTW9kdWxlU3RvcmUgfSBmcm9tIFwiLi4vLi4vY29tcGlsZXIvcGFyc2VyL01vZHVsZS5qc1wiO1xuaW1wb3J0IHsgS2xhc3MgfSBmcm9tIFwiLi4vLi4vY29tcGlsZXIvdHlwZXMvQ2xhc3MuanNcIjtcbmltcG9ydCB7IGludFByaW1pdGl2ZVR5cGUsIHZvaWRQcmltaXRpdmVUeXBlIH0gZnJvbSBcIi4uLy4uL2NvbXBpbGVyL3R5cGVzL1ByaW1pdGl2ZVR5cGVzLmpzXCI7XG5pbXBvcnQgeyBNZXRob2QsIFBhcmFtZXRlcmxpc3QgfSBmcm9tIFwiLi4vLi4vY29tcGlsZXIvdHlwZXMvVHlwZXMuanNcIjtcbmltcG9ydCB7IFJ1bnRpbWVPYmplY3QgfSBmcm9tIFwiLi4vLi4vaW50ZXJwcmV0ZXIvUnVudGltZU9iamVjdC5qc1wiO1xuaW1wb3J0IHsgV29ybGRIZWxwZXIgfSBmcm9tIFwiLi4vZ3JhcGhpY3MvV29ybGQuanNcIjtcbmltcG9ydCB7IEdOR0VyZWlnbmlzYmVoYW5kbHVuZywgR05HRXJlaWduaXNiZWhhbmRsdW5nSGVscGVyIH0gZnJvbSBcIi4vR05HRXJlaWduaXNiZWhhbmRsdW5nLmpzXCI7XG5cbmV4cG9ydCBjbGFzcyBHTkdaZWljaGVuZmVuc3RlckNsYXNzIGV4dGVuZHMgS2xhc3Mge1xuXG4gICAgY29uc3RydWN0b3IocHVibGljIG1vZHVsZTogTW9kdWxlLCBtb2R1bGVTdG9yZTogTW9kdWxlU3RvcmUpIHtcblxuICAgICAgICBzdXBlcihcIlplaWNoZW5mZW5zdGVyXCIsIG1vZHVsZSwgXCJHcmFmaXNjaGUgWmVpY2hlbmZsw6RjaGUgbWl0IEtvb3JkaW5hdGVuc3lzdGVtXCIpXG5cbiAgICAgICAgdGhpcy5zZXRCYXNlQ2xhc3MoPEtsYXNzPm1vZHVsZVN0b3JlLmdldFR5cGUoXCJPYmplY3RcIikudHlwZSk7XG5cbiAgICAgICAgbGV0IGFrdGlvbnNlbXBmYWVuZ2VyVHlwZSA9IDxHTkdaZWljaGVuZmVuc3RlckNsYXNzPm1vZHVsZS50eXBlU3RvcmUuZ2V0VHlwZShcIkFrdGlvbnNlbXBmYWVuZ2VyXCIpO1xuXG5cbiAgICAgICAgLy8gdGhpcy5hZGRBdHRyaWJ1dGUobmV3IEF0dHJpYnV0ZShcIlBJXCIsIGRvdWJsZVByaW1pdGl2ZVR5cGUsIChvYmplY3QpID0+IHsgcmV0dXJuIE1hdGguUEkgfSwgdHJ1ZSwgVmlzaWJpbGl0eS5wdWJsaWMsIHRydWUsIFwiRGllIEtyZWlzemFobCBQaSAoMy4xNDE1Li4uKVwiKSk7XG5cblxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiTWFsZmzDpGNoZW5CcmVpdGVHZWJlblwiLCBuZXcgUGFyYW1ldGVybGlzdChbXSksIGludFByaW1pdGl2ZVR5cGUsXG4gICAgICAgICAgICAocGFyYW1ldGVycykgPT4ge1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQodGhpcy5nZXRXb3JsZEhlbHBlcigpLndpZHRoKTtcblxuICAgICAgICAgICAgfSwgZmFsc2UsIHRydWUsICdHaWJ0IGRpZSBCcmVpdGUgZGVzIFplaWNoZW5iZXJlaWNocyBpbiBQaXhlbG4genVyw7xjay4nLCBmYWxzZSkpO1xuXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJNYWxmbMOkY2hlbkjDtmhlR2ViZW5cIiwgbmV3IFBhcmFtZXRlcmxpc3QoW10pLCBpbnRQcmltaXRpdmVUeXBlLFxuICAgICAgICAgICAgKHBhcmFtZXRlcnMpID0+IHtcblxuICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKHRoaXMuZ2V0V29ybGRIZWxwZXIoKS53aWR0aCk7XG5cbiAgICAgICAgICAgIH0sIGZhbHNlLCB0cnVlLCAnR2lidCBkaWUgSMO2aGUgZGVzIFplaWNoZW5iZXJlaWNocyBpbiBQaXhlbG4genVyw7xjay4nLCBmYWxzZSkpO1xuXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJBa3Rpb25zRW1wZsOkbmdlckVpbnRyYWdlblwiLCBuZXcgUGFyYW1ldGVybGlzdChbXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwibmV1XCIsIHR5cGU6IGFrdGlvbnNlbXBmYWVuZ2VyVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH0sXG4gICAgICAgIF0pLCB2b2lkUHJpbWl0aXZlVHlwZSxcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XG5cbiAgICAgICAgICAgICAgICBsZXQgYWt0aW9uc2VtcGZhZW5nZXI6IFJ1bnRpbWVPYmplY3QgPSBwYXJhbWV0ZXJzWzFdLnZhbHVlO1xuXG4gICAgICAgICAgICAgICAgbGV0IGhlbHBlcjogR05HRXJlaWduaXNiZWhhbmRsdW5nSGVscGVyID0gR05HRXJlaWduaXNiZWhhbmRsdW5nLmdldEhlbHBlcihtb2R1bGUpO1xuICAgICAgICAgICAgICAgIGhlbHBlci5yZWdpc3RlckV2ZW50cyhha3Rpb25zZW1wZmFlbmdlcik7XG5cbiAgICAgICAgICAgIH0sIGZhbHNlLCB0cnVlLCAnVHLDpGd0IGVpbmVuIG5ldWVuIEFrdGlvbnNlbXBmw6RuZ2VyIGVpbi4nLCBmYWxzZSkpO1xuXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJBa3Rpb25zRW1wZsOkbmdlckVudGZlcm5lblwiLCBuZXcgUGFyYW1ldGVybGlzdChbXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwiYWx0XCIsIHR5cGU6IGFrdGlvbnNlbXBmYWVuZ2VyVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH0sXG4gICAgICAgIF0pLCB2b2lkUHJpbWl0aXZlVHlwZSxcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XG5cbiAgICAgICAgICAgICAgICBsZXQgYWt0aW9uc2VtcGZhZW5nZXI6IFJ1bnRpbWVPYmplY3QgPSBwYXJhbWV0ZXJzWzFdLnZhbHVlO1xuXG4gICAgICAgICAgICAgICAgbGV0IGhlbHBlcjogR05HRXJlaWduaXNiZWhhbmRsdW5nSGVscGVyID0gR05HRXJlaWduaXNiZWhhbmRsdW5nLmdldEhlbHBlcihtb2R1bGUpO1xuICAgICAgICAgICAgICAgIGhlbHBlci51bnJlZ2lzdGVyRXZlbnRzKGFrdGlvbnNlbXBmYWVuZ2VyKTtcblxuICAgICAgICAgICAgfSwgZmFsc2UsIHRydWUsICdMw7ZzY2h0IGVpbmVuIEFrdGlvbnNlbXBmw6RuZ2VyIGF1cyBkZXIgTGlzdGUuJywgZmFsc2UpKTtcblxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiVGFrdGdlYmVyU3RhcnRlblwiLCBuZXcgUGFyYW1ldGVybGlzdChbXSksIHZvaWRQcmltaXRpdmVUeXBlLFxuICAgICAgICAgICAgKHBhcmFtZXRlcnMpID0+IHtcblxuICAgICAgICAgICAgICAgIGxldCBoZWxwZXI6IEdOR0VyZWlnbmlzYmVoYW5kbHVuZ0hlbHBlciA9IEdOR0VyZWlnbmlzYmVoYW5kbHVuZy5nZXRIZWxwZXIobW9kdWxlKTtcbiAgICAgICAgICAgICAgICBoZWxwZXIuc3RhcnRUaW1lcigpO1xuXG4gICAgICAgICAgICB9LCBmYWxzZSwgdHJ1ZSwgJ1N0YXJ0ZXQgZGVuIFRha3RnZWJlcicsIGZhbHNlKSk7XG5cbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcIlRha3RnZWJlclN0b3BwZW5cIiwgbmV3IFBhcmFtZXRlcmxpc3QoW10pLCB2b2lkUHJpbWl0aXZlVHlwZSxcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XG5cbiAgICAgICAgICAgICAgICBsZXQgaGVscGVyOiBHTkdFcmVpZ25pc2JlaGFuZGx1bmdIZWxwZXIgPSBHTkdFcmVpZ25pc2JlaGFuZGx1bmcuZ2V0SGVscGVyKG1vZHVsZSk7XG4gICAgICAgICAgICAgICAgaGVscGVyLnN0b3BUaW1lcigpO1xuXG4gICAgICAgICAgICB9LCBmYWxzZSwgdHJ1ZSwgJ1N0b3BwdCBkZW4gVGFrdGdlYmVyJywgZmFsc2UpKTtcblxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiVGFrdGRhdWVyU2V0emVuXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJkYXVlclwiLCB0eXBlOiBpbnRQcmltaXRpdmVUeXBlLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfSxcbiAgICAgICAgXSksIHZvaWRQcmltaXRpdmVUeXBlLFxuICAgICAgICAgICAgKHBhcmFtZXRlcnMpID0+IHtcblxuICAgICAgICAgICAgICAgIGxldCBkYXVlcjogbnVtYmVyID0gcGFyYW1ldGVyc1sxXS52YWx1ZTtcblxuICAgICAgICAgICAgICAgIGxldCBoZWxwZXI6IEdOR0VyZWlnbmlzYmVoYW5kbHVuZ0hlbHBlciA9IEdOR0VyZWlnbmlzYmVoYW5kbHVuZy5nZXRIZWxwZXIobW9kdWxlKTtcbiAgICAgICAgICAgICAgICBoZWxwZXIudGFrdGRhdWVyID0gZGF1ZXI7XG5cbiAgICAgICAgICAgIH0sIGZhbHNlLCB0cnVlLCAnU2V0enQgZGllIFRha3RkYXVlciBkZXMgWmVpdGdlYmVycyBpbiBNaWxsaXNla3VuZGVuJywgZmFsc2UpKTtcblxuXG4gICAgfVxuXG4gICAgZ2V0V29ybGRIZWxwZXIoYnJlaXRlOiBudW1iZXIgPSA4MDAsIGjDtmhlOiBudW1iZXIgPSA2MDApOiBXb3JsZEhlbHBlciB7XG5cbiAgICAgICAgbGV0IHdoID0gdGhpcy5tb2R1bGU/Lm1haW4/LmdldEludGVycHJldGVyKCk/LndvcmxkSGVscGVyO1xuXG4gICAgICAgIGlmICh3aCAhPSBudWxsKSB7XG5cbiAgICAgICAgICAgIGlmICh3aC53aWR0aCAhPSBicmVpdGUgfHwgd2guaGVpZ2h0ICE9IGjDtmhlKSB7XG5cbiAgICAgICAgICAgICAgICBsZXQgcmF0aW86IG51bWJlciA9IE1hdGgucm91bmQoaMO2aGUgLyBicmVpdGUgKiAxMDApO1xuICAgICAgICAgICAgICAgIHdoLiRjb250YWluZXJPdXRlci5jc3MoJ3BhZGRpbmctYm90dG9tJywgcmF0aW8gKyBcIiVcIik7XG5cbiAgICAgICAgICAgICAgICB3aC5zdGFnZS5sb2NhbFRyYW5zZm9ybS5zY2FsZSh3aC53aWR0aCAvIGJyZWl0ZSwgd2guaGVpZ2h0IC8gaMO2aGUpO1xuICAgICAgICAgICAgICAgIHdoLndpZHRoID0gYnJlaXRlO1xuICAgICAgICAgICAgICAgIHdoLmhlaWdodCA9IGjDtmhlO1xuICAgICAgICAgICAgICAgIC8vIHRoaXMuc3RhZ2UubG9jYWxUcmFuc2Zvcm0ucm90YXRlKDQ1LzE4MCpNYXRoLlBJKTtcbiAgICAgICAgICAgICAgICAvLyB0aGlzLnN0YWdlLmxvY2FsVHJhbnNmb3JtLnRyYW5zbGF0ZSg0MDAsMzAwKTtcbiAgICAgICAgICAgICAgICAvL0B0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICB3aC5zdGFnZS50cmFuc2Zvcm0ub25DaGFuZ2UoKTtcblxuICAgICAgICAgICAgICAgIHRoaXMubW9kdWxlLm1haW4uZ2V0UmlnaHREaXYoKT8uYWRqdXN0V2lkdGhUb1dvcmxkKCk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHdoO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsZXQgd29ybGRPYmplY3Q6IFJ1bnRpbWVPYmplY3QgPSBuZXcgUnVudGltZU9iamVjdCg8S2xhc3M+dGhpcy5tb2R1bGUudHlwZVN0b3JlLmdldFR5cGUoXCJXb3JsZFwiKSk7XG4gICAgICAgICAgICBsZXQgd2ggPSBuZXcgV29ybGRIZWxwZXIoYnJlaXRlLCBow7ZoZSwgdGhpcy5tb2R1bGUsIHdvcmxkT2JqZWN0KTtcbiAgICAgICAgICAgIHdvcmxkT2JqZWN0LmludHJpbnNpY0RhdGFbXCJXb3JsZFwiXSA9IHdoO1xuICAgICAgICB9XG5cbiAgICB9XG5cblxufVxuXG4iXX0=