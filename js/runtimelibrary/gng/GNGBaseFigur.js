import { Klass, Visibility } from "../../compiler/types/Class.js";
import { booleanPrimitiveType, intPrimitiveType, stringPrimitiveType } from "../../compiler/types/PrimitiveTypes.js";
import { Attribute, Method, Parameterlist } from "../../compiler/types/Types.js";
import { GNGFarben } from "./GNGFarben.js";
export class GNGBaseFigurClass extends Klass {
    constructor(module, moduleStore) {
        super("GNGBaseFigur", module, "Oberklasse der graphischen Elemente in der Graphics'n Games-Bibliothek (Cornelsen-Verlag)");
        let objectType = moduleStore.getType("Object").type;
        this.setBaseClass(objectType);
        this.addAttribute(new Attribute("farbe", stringPrimitiveType, (value) => {
            let farbe = value.object.intrinsicData["Farbe"];
            value.value = farbe == null ? "schwarz" : farbe;
        }, false, Visibility.protected, false, "Farbe des Grafikobjekts"));
        this.addAttribute(new Attribute("x", intPrimitiveType, (value) => {
            let sh = value.object.intrinsicData["Actor"];
            value.value = Math.round(sh.getCenterX());
        }, false, Visibility.protected, false, "x-Position des Grafikobjekts"));
        this.addAttribute(new Attribute("y", intPrimitiveType, (value) => {
            let sh = value.object.intrinsicData["Actor"];
            value.value = Math.round(sh.getCenterY());
        }, false, Visibility.protected, false, "y-Position des Grafikobjekts"));
        this.addAttribute(new Attribute("winkel", intPrimitiveType, (value) => {
            value.value = value.object.intrinsicData["Actor"].angle;
        }, false, Visibility.protected, false, "Blickrichtung des Grafikobjekts in Grad"));
        this.addAttribute(new Attribute("größe", intPrimitiveType, (value) => {
            value.value = Math.round(value.object.intrinsicData["Actor"].scaleFactor * 100);
        }, false, Visibility.protected, false, "Größe des Grafikobjekts (100 entspricht 'normalgroß')"));
        this.addAttribute(new Attribute("sichtbar", booleanPrimitiveType, (value) => {
            var _a;
            value.value = (_a = value.object.intrinsicData["Actor"].displayObject) === null || _a === void 0 ? void 0 : _a.visible;
        }, false, Visibility.protected, false, "true, wenn das Grafikobjekt sichtbar ist"));
        this.setupAttributeIndicesRecursive();
        this.addMethod(new Method("PositionSetzen", new Parameterlist([
            { identifier: "x", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "y", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true }
        ]), null, (parameters) => {
            let o = parameters[0].value;
            let sh = o.intrinsicData["Actor"];
            let x = parameters[1].value;
            let y = parameters[2].value;
            if (sh.testdestroyed("PositionSetzen"))
                return;
            let moveAnchor = o.intrinsicData["moveAnchor"];
            let p = new PIXI.Point(moveAnchor.x, moveAnchor.y);
            sh.displayObject.updateTransform();
            sh.displayObject.transform.worldTransform.apply(p, p);
            sh.move(x - p.x, y - p.y);
        }, false, false, "Verschiebt das Rechteck so, dass seine linke obere Ecke bei (x,y) zu liegen kommt.", false));
        this.addMethod(new Method("Verschieben", new Parameterlist([
            { identifier: "deltaX", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "deltaY", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true }
        ]), null, (parameters) => {
            let o = parameters[0].value;
            let sh = o.intrinsicData["Actor"];
            let x = parameters[1].value;
            let y = parameters[2].value;
            if (sh.testdestroyed("Verschieben"))
                return;
            sh.move(x, y);
        }, false, false, "Verschiebt die Figur um (x, y)", false));
        this.addMethod(new Method("Drehen", new Parameterlist([
            { identifier: "grad", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true }
        ]), null, (parameters) => {
            let o = parameters[0].value;
            let sh = o.intrinsicData["Actor"];
            let grad = parameters[1].value;
            if (sh.testdestroyed("Drehen"))
                return;
            sh.rotate(grad);
        }, false, false, "Dreht die Figur um den angegebenen Winkel. Drehpunkt ist der Diagonalenschnittpunkt der kleinsten achsenparallelen Bounding Box um die Figur.", false));
        this.addMethod(new Method("FarbeSetzen", new Parameterlist([
            { identifier: "farbe", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), null, (parameters) => {
            let o = parameters[0].value;
            let sh = o.intrinsicData["Actor"];
            let farbe = parameters[1].value;
            o.intrinsicData["Farbe"] = farbe;
            let color = GNGFarben[farbe.toLocaleLowerCase()];
            if (color == null)
                color = 0x000000; // default: schwarz
            if (sh.testdestroyed("FarbeSetzen"))
                return;
            sh.setFillColor(color);
            sh.render();
        }, false, false, "Setzt die Farbe der Figur.", false));
        this.addMethod(new Method("WinkelSetzen", new Parameterlist([
            { identifier: "winkel", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), null, (parameters) => {
            let o = parameters[0].value;
            let sh = o.intrinsicData["Actor"];
            let winkel = parameters[1].value;
            if (sh.testdestroyed("WinkelSetzen"))
                return;
            sh.rotate(winkel - sh.angle);
        }, false, false, "Setzt den Drehwinkel der Figur. Der Winkel wird in Grad angegebenen, positive Werte bedeuten eine Drehung gegen den Uhrzeigersinn.", false));
        this.addMethod(new Method("SichtbarkeitSetzen", new Parameterlist([
            { identifier: "sichtbarkeit", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), null, (parameters) => {
            let o = parameters[0].value;
            let sh = o.intrinsicData["Actor"];
            let sichtbarkeit = parameters[1].value;
            if (sh.testdestroyed("SichtbarkeitSetzen"))
                return;
            sh.setVisible(sichtbarkeit);
        }, false, false, "Schaltet die Sichtbarkeit der Figur ein oder aus.", false));
        this.addMethod(new Method("Entfernen", new Parameterlist([]), null, (parameters) => {
            let o = parameters[0].value;
            let sh = o.intrinsicData["Actor"];
            if (sh.testdestroyed("Entfernen"))
                return;
            sh.destroy();
        }, false, false, "Zerstört das Objekt.", false));
        this.addMethod(new Method("GanzNachVornBringen", new Parameterlist([]), null, (parameters) => {
            let o = parameters[0].value;
            let sh = o.intrinsicData["Actor"];
            if (sh.testdestroyed("GanzNachVornBringen"))
                return;
            return sh.bringToFront();
        }, false, false, 'Setzt das Grafikobjekt vor alle anderen.', false));
        this.addMethod(new Method("GanzNachHintenBringen", new Parameterlist([]), null, (parameters) => {
            let o = parameters[0].value;
            let sh = o.intrinsicData["Actor"];
            if (sh.testdestroyed("GanzNachHintenBringen"))
                return;
            return sh.sendToBack();
        }, false, false, 'Setzt das Grafikobjekt hinter alle anderen.', false));
        this.addMethod(new Method("NachVornBringen", new Parameterlist([]), null, (parameters) => {
            let o = parameters[0].value;
            let sh = o.intrinsicData["Actor"];
            if (sh.testdestroyed("NachVornBringen"))
                return;
            return sh.bringOnePlaneFurtherToFront();
        }, false, false, 'Setzt das Grafikobjekt eine Ebene nach vorne.', false));
        this.addMethod(new Method("NachHintenBringen", new Parameterlist([]), null, (parameters) => {
            let o = parameters[0].value;
            let sh = o.intrinsicData["Actor"];
            if (sh.testdestroyed("NachHintenBringen"))
                return;
            return sh.bringOnePlaneFurtherToBack();
        }, false, false, 'Setzt das Grafikobjekt eine Ebene nach hinten.', false));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiR05HQmFzZUZpZ3VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NsaWVudC9ydW50aW1lbGlicmFyeS9nbmcvR05HQmFzZUZpZ3VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDbEUsT0FBTyxFQUFFLG9CQUFvQixFQUF1QixnQkFBZ0IsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQzFJLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLGFBQWEsRUFBUyxNQUFNLCtCQUErQixDQUFDO0FBS3hGLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUUzQyxNQUFNLE9BQU8saUJBQWtCLFNBQVEsS0FBSztJQUV4QyxZQUFZLE1BQWMsRUFBRSxXQUF3QjtRQUVoRCxLQUFLLENBQUMsY0FBYyxFQUFFLE1BQU0sRUFBRSwyRkFBMkYsQ0FBQyxDQUFDO1FBRTNILElBQUksVUFBVSxHQUFVLFdBQVcsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDO1FBQzNELElBQUksQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFOUIsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLFNBQVMsQ0FBQyxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsQ0FBQyxLQUFZLEVBQUUsRUFBRTtZQUMzRSxJQUFJLEtBQUssR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNoRCxLQUFLLENBQUMsS0FBSyxHQUFHLEtBQUssSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1FBQ3BELENBQUMsRUFBRSxLQUFLLEVBQUUsVUFBVSxDQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUseUJBQXlCLENBQUMs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LENBQUMsU0FBUyxDQUFDLElBQUksTUFBTSxDQUFDLG1CQUFtQixFQUFFLElBQUksYUFBYSxDQUFDLEVBQ2hFLENBQUMsRUFBRSxJQUFJLEVBQ0osQ0FBQyxVQUFVLEVBQUUsRUFBRTtZQUVYLElBQUksQ0FBQyxHQUFrQixVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1lBQzNDLElBQUksRUFBRSxHQUFzQixDQUFDLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRXJELElBQUksRUFBRSxDQUFDLGFBQWEsQ0FBQyxtQkFBbUIsQ0FBQztnQkFBRSxPQUFPO1lBRWxELE9BQU8sRUFBRSxDQUFDLDBCQUEwQixFQUFFLENBQUM7UUFFM0MsQ0FBQyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsZ0RBQWdELEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUluRixDQUFDO0NBRUoiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNb2R1bGUsIE1vZHVsZVN0b3JlIH0gZnJvbSBcIi4uLy4uL2NvbXBpbGVyL3BhcnNlci9Nb2R1bGUuanNcIjtcbmltcG9ydCB7IEtsYXNzLCBWaXNpYmlsaXR5IH0gZnJvbSBcIi4uLy4uL2NvbXBpbGVyL3R5cGVzL0NsYXNzLmpzXCI7XG5pbXBvcnQgeyBib29sZWFuUHJpbWl0aXZlVHlwZSwgZG91YmxlUHJpbWl0aXZlVHlwZSwgaW50UHJpbWl0aXZlVHlwZSwgc3RyaW5nUHJpbWl0aXZlVHlwZSB9IGZyb20gXCIuLi8uLi9jb21waWxlci90eXBlcy9QcmltaXRpdmVUeXBlcy5qc1wiO1xuaW1wb3J0IHsgQXR0cmlidXRlLCBNZXRob2QsIFBhcmFtZXRlcmxpc3QsIFZhbHVlIH0gZnJvbSBcIi4uLy4uL2NvbXBpbGVyL3R5cGVzL1R5cGVzLmpzXCI7XG5pbXBvcnQgeyBSdW50aW1lT2JqZWN0IH0gZnJvbSBcIi4uLy4uL2ludGVycHJldGVyL1J1bnRpbWVPYmplY3QuanNcIjtcbmltcG9ydCB7IEludGVycHJldGVyIH0gZnJvbSBcIi4uLy4uL2ludGVycHJldGVyL0ludGVycHJldGVyLmpzXCI7XG5pbXBvcnQgeyBSZWN0YW5nbGVIZWxwZXIgfSBmcm9tIFwiLi4vZ3JhcGhpY3MvUmVjdGFuZ2xlLmpzXCI7XG5pbXBvcnQgeyBGaWxsZWRTaGFwZUhlbHBlciB9IGZyb20gXCIuLi9ncmFwaGljcy9GaWxsZWRTaGFwZS5qc1wiO1xuaW1wb3J0IHsgR05HRmFyYmVuIH0gZnJvbSBcIi4vR05HRmFyYmVuLmpzXCI7XG5cbmV4cG9ydCBjbGFzcyBHTkdCYXNlRmlndXJDbGFzcyBleHRlbmRzIEtsYXNzIHtcblxuICAgIGNvbnN0cnVjdG9yKG1vZHVsZTogTW9kdWxlLCBtb2R1bGVTdG9yZTogTW9kdWxlU3RvcmUpIHtcblxuICAgICAgICBzdXBlcihcIkdOR0Jhc2VGaWd1clwiLCBtb2R1bGUsIFwiT2JlcmtsYXNzZSBkZXIgZ3JhcGhpc2NoZW4gRWxlbWVudGUgaW4gZGVyIEdyYXBoaWNzJ24gR2FtZXMtQmlibGlvdGhlayAoQ29ybmVsc2VuLVZlcmxhZylcIik7XG5cbiAgICAgICAgbGV0IG9iamVjdFR5cGUgPSA8S2xhc3M+bW9kdWxlU3RvcmUuZ2V0VHlwZShcIk9iamVjdFwiKS50eXBlO1xuICAgICAgICB0aGlzLnNldEJhc2VDbGFzcyhvYmplY3RUeXBlKTtcblxuICAgICAgICB0aGlzLmFkZEF0dHJpYnV0ZShuZXcgQXR0cmlidXRlKFwiZmFyYmVcIiwgc3RyaW5nUHJpbWl0aXZlVHlwZSwgKHZhbHVlOiBWYWx1ZSkgPT4geyBcbiAgICAgICAgICAgIGxldCBmYXJiZSA9IHZhbHVlLm9iamVjdC5pbnRyaW5zaWNEYXRhW1wiRmFyYmVcIl07XG4gICAgICAgICAgICB2YWx1ZS52YWx1ZSA9IGZhcmJlID09IG51bGwgPyBcInNjaHdhcnpcIiA6IGZhcmJlO1xuICAgICAgICB9LCBmYWxzZSwgVmlzaWJpbGl0eS5wcm90ZWN0ZWQsIGZhbHNlLCBcIkZhcmJlIGRlcyBHcmFmaWtvYmpla3RzXCIpKTtcblxuICAgICAgICB0aGlzLmFkZEF0dHJpYnV0ZShuZXcgQXR0cmlidXRlKFwieFwiLCBpbnRQcmltaXRpdmVUeXBlLCAodmFsdWU6IFZhbHVlKSA9PiB7IFxuICAgICAgICAgICAgbGV0IHNoID0gdmFsdWUub2JqZWN0LmludHJpbnNpY0RhdGFbXCJBY3RvclwiXTtcbiAgICAgICAgICAgIHZhbHVlLnZhbHVlID0gTWF0aC5yb3VuZChzaC5nZXRDZW50ZXJYKCkpOyBcbiAgICAgICAgfSwgZmFsc2UsIFZpc2liaWxpdHkucHJvdGVjdGVkLCBmYWxzZSwgXCJ4LVBvc2l0aW9uIGRlcyBHcmFmaWtvYmpla3RzXCIpKTtcbiAgICAgICAgdGhpcy5hZGRBdHRyaWJ1dGUobmV3IEF0dHJpYnV0ZShcInlcIiwgaW50UHJpbWl0aXZlVHlwZSwgKHZhbHVlOiBWYWx1ZSkgPT4geyBcbiAgICAgICAgICAgIGxldCBzaCA9IHZhbHVlLm9iamVjdC5pbnRyaW5zaWNEYXRhW1wiQWN0b3JcIl07XG4gICAgICAgICAgICB2YWx1ZS52YWx1ZSA9IE1hdGgucm91bmQoc2guZ2V0Q2VudGVyWSgpKTsgXG4gICAgICAgIH0sIGZhbHNlLCBWaXNpYmlsaXR5LnByb3RlY3RlZCwgZmFsc2UsIFwieS1Qb3NpdGlvbiBkZXMgR3JhZmlrb2JqZWt0c1wiKSk7XG5cbiAgICAgICAgdGhpcy5hZGRBdHRyaWJ1dGUobmV3IEF0dHJpYnV0ZShcIndpbmtlbFwiLCBpbnRQcmltaXRpdmVUeXBlLCAodmFsdWU6IFZhbHVlKSA9PiB7IFxuICAgICAgICAgICAgdmFsdWUudmFsdWUgPSB2YWx1ZS5vYmplY3QuaW50cmluc2ljRGF0YVtcIkFjdG9yXCJdLmFuZ2xlIFxuICAgICAgICB9LCBmYWxzZSwgVmlzaWJpbGl0eS5wcm90ZWN0ZWQsIGZhbHNlLCBcIkJsaWNrcmljaHR1bmcgZGVzIEdyYWZpa29iamVrdHMgaW4gR3JhZFwiKSk7XG5cbiAgICAgICAgdGhpcy5hZGRBdHRyaWJ1dGUobmV3IEF0dHJpYnV0ZShcImdyw7bDn2VcIiwgaW50UHJpbWl0aXZlVHlwZSwgKHZhbHVlOiBWYWx1ZSkgPT4geyBcbiAgICAgICAgICAgIHZhbHVlLnZhbHVlID0gTWF0aC5yb3VuZCh2YWx1ZS5vYmplY3QuaW50cmluc2ljRGF0YVtcIkFjdG9yXCJdLnNjYWxlRmFjdG9yKjEwMCkgXG4gICAgICAgIH0sIGZhbHNlLCBWaXNpYmlsaXR5LnByb3RlY3RlZCwgZmFsc2UsIFwiR3LDtsOfZSBkZXMgR3JhZmlrb2JqZWt0cyAoMTAwIGVudHNwcmljaHQgJ25vcm1hbGdyb8OfJylcIikpO1xuXG4gICAgICAgIHRoaXMuYWRkQXR0cmlidXRlKG5ldyBBdHRyaWJ1dGUoXCJzaWNodGJhclwiLCBib29sZWFuUHJpbWl0aXZlVHlwZSwgKHZhbHVlOiBWYWx1ZSkgPT4geyBcbiAgICAgICAgICAgIHZhbHVlLnZhbHVlID0gdmFsdWUub2JqZWN0LmludHJpbnNpY0RhdGFbXCJBY3RvclwiXS5kaXNwbGF5T2JqZWN0Py52aXNpYmxlIFxuICAgICAgICB9LCBmYWxzZSwgVmlzaWJpbGl0eS5wcm90ZWN0ZWQsIGZhbHNlLCBcInRydWUsIHdlbm4gZGFzIEdyYWZpa29iamVrdCBzaWNodGJhciBpc3RcIikpO1xuXG4gICAgICAgIHRoaXMuc2V0dXBBdHRyaWJ1dGVJbmRpY2VzUmVjdXJzaXZlKCk7XG5cbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcIlBvc2l0aW9uU2V0emVuXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJ4XCIsIHR5cGU6IGludFByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9LFxuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcInlcIiwgdHlwZTogaW50UHJpbWl0aXZlVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH1cbiAgICAgICAgXSksIG51bGwsXG4gICAgICAgICAgICAocGFyYW1ldGVycykgPT4ge1xuXG4gICAgICAgICAgICAgICAgbGV0IG86IFJ1bnRpbWVPYmplY3QgPSBwYXJhbWV0ZXJzWzBdLnZhbHVlO1xuICAgICAgICAgICAgICAgIGxldCBzaDogRmlsbGVkU2hhcGVIZWxwZXIgPSBvLmludHJpbnNpY0RhdGFbXCJBY3RvclwiXTtcbiAgICAgICAgICAgICAgICBsZXQgeDogbnVtYmVyID0gcGFyYW1ldGVyc1sxXS52YWx1ZTtcbiAgICAgICAgICAgICAgICBsZXQgeTogbnVtYmVyID0gcGFyYW1ldGVyc1syXS52YWx1ZTtcblxuICAgICAgICAgICAgICAgIGlmIChzaC50ZXN0ZGVzdHJveWVkKFwiUG9zaXRpb25TZXR6ZW5cIikpIHJldHVybjtcblxuICAgICAgICAgICAgICAgIGxldCBtb3ZlQW5jaG9yOiB7eDogbnVtYmVyLCB5OiBudW1iZXJ9ID0gby5pbnRyaW5zaWNEYXRhW1wibW92ZUFuY2hvclwiXTtcblxuICAgICAgICAgICAgICAgIGxldCBwOiBQSVhJLlBvaW50ID0gbmV3IFBJWEkuUG9pbnQobW92ZUFuY2hvci54LCBtb3ZlQW5jaG9yLnkpO1xuICAgICAgICAgICAgICAgIHNoLmRpc3BsYXlPYmplY3QudXBkYXRlVHJhbnNmb3JtKCk7XG4gICAgICAgICAgICAgICAgc2guZGlzcGxheU9iamVjdC50cmFuc2Zvcm0ud29ybGRUcmFuc2Zvcm0uYXBwbHkocCwgcCk7XG4gICAgICAgIFxuICAgICAgICAgICAgICAgIHNoLm1vdmUoeCAtIHAueCwgeSAtIHAueSk7XG5cbiAgICAgICAgICAgIH0sIGZhbHNlLCBmYWxzZSwgXCJWZXJzY2hpZWJ0IGRhcyBSZWNodGVjayBzbywgZGFzcyBzZWluZSBsaW5rZSBvYmVyZSBFY2tlIGJlaSAoeCx5KSB6dSBsaWVnZW4ga29tbXQuXCIsIGZhbHNlKSk7XG5cblxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiVmVyc2NoaWViZW5cIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcImRlbHRhWFwiLCB0eXBlOiBpbnRQcmltaXRpdmVUeXBlLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfSxcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJkZWx0YVlcIiwgdHlwZTogaW50UHJpbWl0aXZlVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH1cbiAgICAgICAgXSksIG51bGwsXG4gICAgICAgICAgICAocGFyYW1ldGVycykgPT4ge1xuXG4gICAgICAgICAgICAgICAgbGV0IG86IFJ1bnRpbWVPYmplY3QgPSBwYXJhbWV0ZXJzWzBdLnZhbHVlO1xuICAgICAgICAgICAgICAgIGxldCBzaDogRmlsbGVkU2hhcGVIZWxwZXIgPSBvLmludHJpbnNpY0RhdGFbXCJBY3RvclwiXTtcbiAgICAgICAgICAgICAgICBsZXQgeDogbnVtYmVyID0gcGFyYW1ldGVyc1sxXS52YWx1ZTtcbiAgICAgICAgICAgICAgICBsZXQgeTogbnVtYmVyID0gcGFyYW1ldGVyc1syXS52YWx1ZTtcblxuICAgICAgICAgICAgICAgIGlmIChzaC50ZXN0ZGVzdHJveWVkKFwiVmVyc2NoaWViZW5cIikpIHJldHVybjtcblxuICAgICAgICAgICAgICAgIHNoLm1vdmUoeCwgeSk7XG5cbiAgICAgICAgICAgIH0sIGZhbHNlLCBmYWxzZSwgXCJWZXJzY2hpZWJ0IGRpZSBGaWd1ciB1bSAoeCwgeSlcIiwgZmFsc2UpKTtcblxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiRHJlaGVuXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJncmFkXCIsIHR5cGU6IGludFByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9XG4gICAgICAgIF0pLCBudWxsLFxuICAgICAgICAgICAgKHBhcmFtZXRlcnMpID0+IHtcblxuICAgICAgICAgICAgICAgIGxldCBvOiBSdW50aW1lT2JqZWN0ID0gcGFyYW1ldGVyc1swXS52YWx1ZTtcbiAgICAgICAgICAgICAgICBsZXQgc2g6IEZpbGxlZFNoYXBlSGVscGVyID0gby5pbnRyaW5zaWNEYXRhW1wiQWN0b3JcIl07XG4gICAgICAgICAgICAgICAgbGV0IGdyYWQ6IG51bWJlciA9IHBhcmFtZXRlcnNbMV0udmFsdWU7XG5cbiAgICAgICAgICAgICAgICBpZiAoc2gudGVzdGRlc3Ryb3llZChcIkRyZWhlblwiKSkgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgc2gucm90YXRlKGdyYWQpO1xuXG4gICAgICAgICAgICB9LCBmYWxzZSwgZmFsc2UsIFwiRHJlaHQgZGllIEZpZ3VyIHVtIGRlbiBhbmdlZ2ViZW5lbiBXaW5rZWwuIERyZWhwdW5rdCBpc3QgZGVyIERpYWdvbmFsZW5zY2huaXR0cHVua3QgZGVyIGtsZWluc3RlbiBhY2hzZW5wYXJhbGxlbGVuIEJvdW5kaW5nIEJveCB1bSBkaWUgRmlndXIuXCIsIGZhbHNlKSk7XG5cblxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiRmFyYmVTZXR6ZW5cIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcImZhcmJlXCIsIHR5cGU6IHN0cmluZ1ByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9LFxuICAgICAgICBdKSwgbnVsbCxcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XG5cbiAgICAgICAgICAgICAgICBsZXQgbzogUnVudGltZU9iamVjdCA9IHBhcmFtZXRlcnNbMF0udmFsdWU7XG4gICAgICAgICAgICAgICAgbGV0IHNoOiBGaWxsZWRTaGFwZUhlbHBlciA9IG8uaW50cmluc2ljRGF0YVtcIkFjdG9yXCJdO1xuICAgICAgICAgICAgICAgIGxldCBmYXJiZTogc3RyaW5nID0gcGFyYW1ldGVyc1sxXS52YWx1ZTtcblxuICAgICAgICAgICAgICAgIG8uaW50cmluc2ljRGF0YVtcIkZhcmJlXCJdID0gZmFyYmU7XG5cbiAgICAgICAgICAgICAgICBsZXQgY29sb3I6IG51bWJlciA9IEdOR0ZhcmJlbltmYXJiZS50b0xvY2FsZUxvd2VyQ2FzZSgpXTtcbiAgICAgICAgICAgICAgICBpZiAoY29sb3IgPT0gbnVsbCkgY29sb3IgPSAweDAwMDAwMDsgLy8gZGVmYXVsdDogc2Nod2FyelxuXG4gICAgICAgICAgICAgICAgaWYgKHNoLnRlc3RkZXN0cm95ZWQoXCJGYXJiZVNldHplblwiKSkgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgc2guc2V0RmlsbENvbG9yKGNvbG9yKTtcbiAgICAgICAgICAgICAgICBzaC5yZW5kZXIoKTtcblxuICAgICAgICAgICAgfSwgZmFsc2UsIGZhbHNlLCBcIlNldHp0IGRpZSBGYXJiZSBkZXIgRmlndXIuXCIsIGZhbHNlKSk7XG5cbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcIldpbmtlbFNldHplblwiLCBuZXcgUGFyYW1ldGVybGlzdChbXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwid2lua2VsXCIsIHR5cGU6IGludFByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9LFxuICAgICAgICBdKSwgbnVsbCxcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XG5cbiAgICAgICAgICAgICAgICBsZXQgbzogUnVudGltZU9iamVjdCA9IHBhcmFtZXRlcnNbMF0udmFsdWU7XG4gICAgICAgICAgICAgICAgbGV0IHNoOiBGaWxsZWRTaGFwZUhlbHBlciA9IG8uaW50cmluc2ljRGF0YVtcIkFjdG9yXCJdO1xuICAgICAgICAgICAgICAgIGxldCB3aW5rZWw6IG51bWJlciA9IHBhcmFtZXRlcnNbMV0udmFsdWU7XG5cbiAgICAgICAgICAgICAgICBpZiAoc2gudGVzdGRlc3Ryb3llZChcIldpbmtlbFNldHplblwiKSkgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgc2gucm90YXRlKHdpbmtlbCAtIHNoLmFuZ2xlKTtcblxuICAgICAgICAgICAgfSwgZmFsc2UsIGZhbHNlLCBcIlNldHp0IGRlbiBEcmVod2lua2VsIGRlciBGaWd1ci4gRGVyIFdpbmtlbCB3aXJkIGluIEdyYWQgYW5nZWdlYmVuZW4sIHBvc2l0aXZlIFdlcnRlIGJlZGV1dGVuIGVpbmUgRHJlaHVuZyBnZWdlbiBkZW4gVWhyemVpZ2Vyc2lubi5cIiwgZmFsc2UpKTtcblxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiU2ljaHRiYXJrZWl0U2V0emVuXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJzaWNodGJhcmtlaXRcIiwgdHlwZTogaW50UHJpbWl0aXZlVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH0sXG4gICAgICAgIF0pLCBudWxsLFxuICAgICAgICAgICAgKHBhcmFtZXRlcnMpID0+IHtcblxuICAgICAgICAgICAgICAgIGxldCBvOiBSdW50aW1lT2JqZWN0ID0gcGFyYW1ldGVyc1swXS52YWx1ZTtcbiAgICAgICAgICAgICAgICBsZXQgc2g6IEZpbGxlZFNoYXBlSGVscGVyID0gby5pbnRyaW5zaWNEYXRhW1wiQWN0b3JcIl07XG4gICAgICAgICAgICAgICAgbGV0IHNpY2h0YmFya2VpdDogYm9vbGVhbiA9IHBhcmFtZXRlcnNbMV0udmFsdWU7XG5cbiAgICAgICAgICAgICAgICBpZiAoc2gudGVzdGRlc3Ryb3llZChcIlNpY2h0YmFya2VpdFNldHplblwiKSkgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgc2guc2V0VmlzaWJsZShzaWNodGJhcmtlaXQpO1xuXG4gICAgICAgICAgICB9LCBmYWxzZSwgZmFsc2UsIFwiU2NoYWx0ZXQgZGllIFNpY2h0YmFya2VpdCBkZXIgRmlndXIgZWluIG9kZXIgYXVzLlwiLCBmYWxzZSkpO1xuXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJFbnRmZXJuZW5cIiwgbmV3IFBhcmFtZXRlcmxpc3QoW10pLCBudWxsLFxuICAgICAgICAgICAgKHBhcmFtZXRlcnMpID0+IHtcblxuICAgICAgICAgICAgICAgIGxldCBvOiBSdW50aW1lT2JqZWN0ID0gcGFyYW1ldGVyc1swXS52YWx1ZTtcbiAgICAgICAgICAgICAgICBsZXQgc2g6IEZpbGxlZFNoYXBlSGVscGVyID0gby5pbnRyaW5zaWNEYXRhW1wiQWN0b3JcIl07XG5cbiAgICAgICAgICAgICAgICBpZiAoc2gudGVzdGRlc3Ryb3llZChcIkVudGZlcm5lblwiKSkgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgc2guZGVzdHJveSgpO1xuXG4gICAgICAgICAgICB9LCBmYWxzZSwgZmFsc2UsIFwiWmVyc3TDtnJ0IGRhcyBPYmpla3QuXCIsIGZhbHNlKSk7XG5cbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcIkdhbnpOYWNoVm9ybkJyaW5nZW5cIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xuICAgICAgICBdKSwgbnVsbCxcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XG5cbiAgICAgICAgICAgICAgICBsZXQgbzogUnVudGltZU9iamVjdCA9IHBhcmFtZXRlcnNbMF0udmFsdWU7XG4gICAgICAgICAgICAgICAgbGV0IHNoOiBGaWxsZWRTaGFwZUhlbHBlciA9IG8uaW50cmluc2ljRGF0YVtcIkFjdG9yXCJdO1xuXG4gICAgICAgICAgICAgICAgaWYgKHNoLnRlc3RkZXN0cm95ZWQoXCJHYW56TmFjaFZvcm5CcmluZ2VuXCIpKSByZXR1cm47XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gc2guYnJpbmdUb0Zyb250KCk7XG5cbiAgICAgICAgICAgIH0sIGZhbHNlLCBmYWxzZSwgJ1NldHp0IGRhcyBHcmFmaWtvYmpla3Qgdm9yIGFsbGUgYW5kZXJlbi4nLCBmYWxzZSkpO1xuXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJHYW56TmFjaEhpbnRlbkJyaW5nZW5cIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xuICAgICAgICBdKSwgbnVsbCxcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XG5cbiAgICAgICAgICAgICAgICBsZXQgbzogUnVudGltZU9iamVjdCA9IHBhcmFtZXRlcnNbMF0udmFsdWU7XG4gICAgICAgICAgICAgICAgbGV0IHNoOiBGaWxsZWRTaGFwZUhlbHBlciA9IG8uaW50cmluc2ljRGF0YVtcIkFjdG9yXCJdO1xuXG4gICAgICAgICAgICAgICAgaWYgKHNoLnRlc3RkZXN0cm95ZWQoXCJHYW56TmFjaEhpbnRlbkJyaW5nZW5cIikpIHJldHVybjtcblxuICAgICAgICAgICAgICAgIHJldHVybiBzaC5zZW5kVG9CYWNrKCk7XG5cbiAgICAgICAgICAgIH0sIGZhbHNlLCBmYWxzZSwgJ1NldHp0IGRhcyBHcmFmaWtvYmpla3QgaGludGVyIGFsbGUgYW5kZXJlbi4nLCBmYWxzZSkpO1xuXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJOYWNoVm9ybkJyaW5nZW5cIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xuICAgICAgICBdKSwgbnVsbCxcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XG5cbiAgICAgICAgICAgICAgICBsZXQgbzogUnVudGltZU9iamVjdCA9IHBhcmFtZXRlcnNbMF0udmFsdWU7XG4gICAgICAgICAgICAgICAgbGV0IHNoOiBGaWxsZWRTaGFwZUhlbHBlciA9IG8uaW50cmluc2ljRGF0YVtcIkFjdG9yXCJdO1xuXG4gICAgICAgICAgICAgICAgaWYgKHNoLnRlc3RkZXN0cm95ZWQoXCJOYWNoVm9ybkJyaW5nZW5cIikpIHJldHVybjtcblxuICAgICAgICAgICAgICAgIHJldHVybiBzaC5icmluZ09uZVBsYW5lRnVydGhlclRvRnJvbnQoKTtcblxuICAgICAgICAgICAgfSwgZmFsc2UsIGZhbHNlLCAnU2V0enQgZGFzIEdyYWZpa29iamVrdCBlaW5lIEViZW5lIG5hY2ggdm9ybmUuJywgZmFsc2UpKTtcblxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiTmFjaEhpbnRlbkJyaW5nZW5cIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xuICAgICAgICBdKSwgbnVsbCxcbiAgICAgICAgICAgIChwYXJhbWV0ZXJzKSA9PiB7XG5cbiAgICAgICAgICAgICAgICBsZXQgbzogUnVudGltZU9iamVjdCA9IHBhcmFtZXRlcnNbMF0udmFsdWU7XG4gICAgICAgICAgICAgICAgbGV0IHNoOiBGaWxsZWRTaGFwZUhlbHBlciA9IG8uaW50cmluc2ljRGF0YVtcIkFjdG9yXCJdO1xuXG4gICAgICAgICAgICAgICAgaWYgKHNoLnRlc3RkZXN0cm95ZWQoXCJOYWNoSGludGVuQnJpbmdlblwiKSkgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNoLmJyaW5nT25lUGxhbmVGdXJ0aGVyVG9CYWNrKCk7XG5cbiAgICAgICAgICAgIH0sIGZhbHNlLCBmYWxzZSwgJ1NldHp0IGRhcyBHcmFmaWtvYmpla3QgZWluZSBFYmVuZSBuYWNoIGhpbnRlbi4nLCBmYWxzZSkpO1xuXG5cblxuICAgIH1cblxufVxuIl19