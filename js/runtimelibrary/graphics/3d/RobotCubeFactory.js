import { Boxes3d } from "./Boxes3d.js";
export function getSpritesheetTexture(identifier, copy = false, renderer = null) {
    let sheet = PIXI.Loader.shared.resources["spritesheet"].spritesheet;
    let texture = sheet.textures[identifier];
    if (copy) {
        let sprite = new PIXI.Sprite(texture);
        let dynamicTexture1 = PIXI.RenderTexture.create({
            width: sprite.width,
            height: sprite.height,
            scaleMode: PIXI.SCALE_MODES.NEAREST,
            wrapMode: PIXI.WRAP_MODES.REPEAT
        });
        renderer.render(sprite, {
            renderTexture: dynamicTexture1
        });
        return new Pixi3d.StandardMaterialTexture(dynamicTexture1.baseTexture);
    }
    else {
        let smt = new Pixi3d.StandardMaterialTexture(texture.baseTexture);
        smt.transform = new Pixi3d.TextureTransform();
        smt.transform.offset.set((texture.frame.x + 0) / texture.baseTexture.width, (texture.frame.y + 0) / texture.baseTexture.height);
        smt.transform.scale.set(texture.frame.width / texture.baseTexture.width, texture.frame.height / texture.baseTexture.height);
        return smt;
    }
}
export class RobotMarker extends Pixi3d.Mesh3D {
    constructor(geometry, material, farbe) {
        super(geometry, material);
        this.farbe = farbe;
    }
}
export class RobotBrick extends Pixi3d.Mesh3D {
    constructor(geometry, material, farbe) {
        super(geometry, material);
        this.farbe = farbe;
    }
}
export class RobotCubeFactory {
    constructor(worldHelper, camera) {
        this.worldHelper = worldHelper;
        this.camera = camera;
        this.farben = ["rot", "gelb", "grün", "blau"];
        this.farbeToColorInfoMap = {
            "rot": [1.0, 0.0, 0.0],
            "gelb": [1.0, 1.0, 0.0],
            "grün": [0.0, 1.0, 0.0],
            "blau": [0.0, 0.0, 1.0]
        };
        this.farbeToMarkerMaterialMap = {};
        this.farbeToBrickMaterialMap = {};
        this.planeMaterial = {};
        let renderer = worldHelper.app.renderer;
        this.light1 = Object.assign(new Pixi3d.Light(), {
            type: Pixi3d.LightType.ambient,
            range: 100,
            intensity: 30,
            color: new Pixi3d.Color(1, 1, 1)
        });
        this.light1.position.set(-4, 4, 4);
        this.light2 = Object.assign(new Pixi3d.Light(), {
            type: Pixi3d.LightType.directional,
            range: 600,
            intensity: 4,
            color: new Pixi3d.Color(1, 1, 1)
        });
        this.light2.position.set(12, 16, -12);
        this.light2.rotationQuaternion.setEulerAngles(25, 45, 0);
        this.lightingEnvironment = new Pixi3d.LightingEnvironment(worldHelper.app.renderer);
        this.lightingEnvironment.lights.push(this.light1, this.light2);
        this.grassBrickMaterial = new Pixi3d.StandardMaterial();
        this.initMaterial(this.grassBrickMaterial);
        this.grassBrickMaterial.baseColorTexture = getSpritesheetTexture("robot#0");
        this.cloudMaterial = new Pixi3d.StandardMaterial();
        this.initMaterial(this.cloudMaterial);
        this.cloudMaterial.baseColor = new Pixi3d.Color(1.0, 1.0, 1.0, 0.5);
        this.groundPlaneMaterial = new Pixi3d.StandardMaterial();
        this.initMaterial(this.groundPlaneMaterial);
        this.groundPlaneMaterial.baseColorTexture = getSpritesheetTexture("robot#2", true, renderer);
        for (let farbe of this.farben) {
            let material = new Pixi3d.StandardMaterial();
            this.initMaterial(material);
            let colorInfo = this.farbeToColorInfoMap[farbe];
            material.baseColor = new Pixi3d.Color(colorInfo[0], colorInfo[1], colorInfo[2], 1);
            this.farbeToMarkerMaterialMap[farbe] = material;
            let brickMaterial = new Pixi3d.StandardMaterial();
            this.initMaterial(brickMaterial);
            let index = this.farben.indexOf(farbe) + 4;
            brickMaterial.baseColorTexture = getSpritesheetTexture("robot#" + index);
            this.farbeToBrickMaterialMap[farbe] = brickMaterial;
        }
    }
    getBrick(farbe) {
        return new RobotBrick(Boxes3d.createHalfheightCube3dMesh(), this.farbeToBrickMaterialMap[farbe], farbe);
    }
    getGrassBrick() {
        return new Pixi3d.Mesh3D(Boxes3d.createCube3dMesh(), this.grassBrickMaterial);
    }
    getGrassPlane(x, z) {
        let mesh = new Pixi3d.Mesh3D(Boxes3d.createPlane3dMesh(x, z), this.groundPlaneMaterial);
        mesh.scale.x = x;
        mesh.scale.z = z;
        mesh.x += x - 1;
        mesh.z += z - 1;
        //let plane = Pixi3d.Mesh3D.createPlane();
        // (<Pixi3d.StandardMaterial>plane.material).baseColor = new Pixi3d.Color(0, 1, 0, 1); // The base color will be blended together with base color texture (if available).
        // plane.y = -0.5;
        // plane.scale.set(10);
        return mesh;
    }
    makePlane(container, x, y, z, widthX, widthZ, spriteOrColor) {
        let material;
        if (typeof spriteOrColor == "string") {
            material = this.getPlaneMaterial(spriteOrColor);
        }
        else {
            material = new Pixi3d.StandardMaterial();
            this.initMaterial(material);
            material.baseColor = spriteOrColor;
        }
        let mesh = new Pixi3d.Mesh3D(Boxes3d.createPlane3dMesh(widthX, widthZ), material);
        mesh.y = y;
        mesh.x = x;
        mesh.z = z;
        mesh.scale.set(widthX, 1, widthZ);
        container.addChild(mesh);
    }
    getMarker(farbe) {
        let marker = new RobotMarker(Boxes3d.createCube3dMesh(), this.farbeToMarkerMaterialMap[farbe], farbe);
        marker.scale.set(0.9, 0.1, 0.9);
        return marker;
    }
    getSidePlanes(worldX, worldY, sideSprite, radius, deep) {
        let planes = [];
        let sideMaterial = this.getPlaneMaterial(sideSprite); //3d#3
        let mesh1 = new Pixi3d.Mesh3D(Boxes3d.createPlane3dMesh(worldX, 1), sideMaterial);
        mesh1.scale.x = worldX + 2 * radius;
        mesh1.x += worldX - 1;
        mesh1.y -= 1 + 2 * deep;
        mesh1.z -= 1 + 2 * radius;
        mesh1.rotationQuaternion.setEulerAngles(-90, 0, 180);
        planes.push(mesh1);
        let mesh2 = new Pixi3d.Mesh3D(Boxes3d.createPlane3dMesh(worldX, 1), sideMaterial);
        mesh2.scale.x = worldX + 2 * radius;
        mesh2.x += worldX - 1;
        mesh2.y -= 1 + 2 * deep;
        mesh2.z += 2 * worldY - 1 + 2 * radius;
        mesh2.rotationQuaternion.setEulerAngles(90, 0, 0);
        planes.push(mesh2);
        let mesh3 = new Pixi3d.Mesh3D(Boxes3d.createPlane3dMesh(worldY, 1), sideMaterial);
        mesh3.scale.x = worldY + 2 * radius;
        mesh3.y -= 1 + 2 * deep;
        mesh3.x -= 1 + 2 * radius;
        mesh3.z += worldY - 1;
        mesh3.rotationQuaternion.setEulerAngles(90, -90, 0);
        planes.push(mesh3);
        let mesh4 = new Pixi3d.Mesh3D(Boxes3d.createPlane3dMesh(worldY, 1), sideMaterial);
        mesh4.scale.x = worldY + 2 * radius;
        mesh4.y -= 1 + 2 * deep;
        mesh4.x += 2 * worldX - 1 + 2 * radius;
        mesh4.z += worldY - 1;
        mesh4.rotationQuaternion.setEulerAngles(90, 90, 0);
        planes.push(mesh4);
        return planes;
    }
    getHorizontalPlanes(worldX, worldY, topSprite, radius, deep) {
        let planes = [];
        let topMaterial = this.getPlaneMaterial(topSprite);
        let mesh5 = new Pixi3d.Mesh3D(Boxes3d.createPlane3dMesh(worldY, 1), topMaterial);
        mesh5.scale.x = worldX + 2 * radius;
        mesh5.x += worldX - 1;
        mesh5.y -= 2 + 2 * deep;
        mesh5.z -= 2 + 2 * radius;
        mesh5.rotationQuaternion.setEulerAngles(180, 0, 180);
        planes.push(mesh5);
        let mesh6 = new Pixi3d.Mesh3D(Boxes3d.createPlane3dMesh(worldX, 1), topMaterial);
        mesh6.scale.x = worldX + 2 * radius;
        mesh6.x += worldX - 1;
        mesh6.y -= 2 + 2 * deep;
        mesh6.z += 2 * worldY + 2 * radius;
        mesh6.rotationQuaternion.setEulerAngles(0, 0, 0);
        planes.push(mesh6);
        let mesh7 = new Pixi3d.Mesh3D(Boxes3d.createPlane3dMesh(worldY, 1), topMaterial);
        mesh7.scale.x = worldY + 2 * radius + 2;
        mesh7.y -= 2 + 2 * deep;
        mesh7.x -= 2 + 2 * radius;
        mesh7.z += worldY - 1;
        mesh7.rotationQuaternion.setEulerAngles(0, -90, 0);
        planes.push(mesh7);
        let mesh8 = new Pixi3d.Mesh3D(Boxes3d.createPlane3dMesh(worldY, 1), topMaterial);
        mesh8.scale.x = worldY + 2 * radius + 2;
        mesh8.y -= 2 + 2 * deep;
        mesh8.x += 2 * worldX + 2 * radius;
        mesh8.z += worldY - 1;
        mesh8.rotationQuaternion.setEulerAngles(0, 90, 0);
        planes.push(mesh8);
        return planes;
    }
    makeClouds(container, height, originX, originZ) {
        let count = 200;
        let numberOfBatches = 10;
        let todo = count;
        let f = () => {
            if (todo <= 0)
                return;
            let radius = 1500;
            let maxWidth = 20;
            for (let i = 0; i < count / numberOfBatches; i++) {
                todo--;
                let distance = Math.sqrt(Math.random()) * radius;
                let angle = Math.random() * 2 * Math.PI;
                let x1 = Math.floor(distance * Math.cos(angle)) + originX;
                let z1 = Math.floor(distance * Math.sin(angle)) + originZ;
                let count = Math.random() * 10 + 2;
                for (let j = 0; j < count; j++) {
                    let mesh = Boxes3d.createCube3d(this.cloudMaterial);
                    let scaleX = Math.floor(Math.random() * maxWidth + 2);
                    let scaleY = Math.floor(Math.random() * maxWidth / 4 + 2);
                    let scaleZ = Math.floor(Math.random() * maxWidth + 2);
                    let dx = Math.floor(Math.random() * 3 * (5 + count + scaleX));
                    let dz = Math.floor(Math.random() * 3 * (5 + count + scaleZ));
                    mesh.x = x1 + dx;
                    mesh.z = z1 + dz;
                    mesh.y = height + scaleY / 2;
                    mesh.scale.set(scaleX, scaleY, scaleZ);
                    container.addChild(mesh);
                }
            }
            setTimeout(f, 100);
        };
        f();
    }
    initMaterial(material) {
        material.camera = this.camera;
        material.exposure = 1;
        material.roughness = 0.9;
        material.lightingEnvironment = this.lightingEnvironment;
    }
    getPlaneMaterial(spriteKey) {
        let renderer = this.worldHelper.app.renderer;
        if (this.planeMaterial[spriteKey] != null)
            return this.planeMaterial[spriteKey];
        let material = new Pixi3d.StandardMaterial();
        this.initMaterial(material);
        material.baseColorTexture = getSpritesheetTexture(spriteKey, true, renderer);
        // material.doubleSided = true;
        this.planeMaterial[spriteKey] = material;
        return material;
    }
    makeSprite3d(textureKey, container) {
        let material = new Pixi3d.StandardMaterial();
        this.initMaterial(material);
        material.baseColorTexture = getSpritesheetTexture(textureKey, false);
        material.alphaMode = Pixi3d.StandardMaterialAlphaMode.mask;
        let sprite = Boxes3d.createPlane3d(1, 1, material);
        container.addChild(sprite);
        return sprite;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUm9ib3RDdWJlRmFjdG9yeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9jbGllbnQvcnVudGltZWxpYnJhcnkvZ3JhcGhpY3MvM2QvUm9ib3RDdWJlRmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRXZDLE1BQU0sVUFBVSxxQkFBcUIsQ0FBQyxVQUFrQixFQUFFLE9BQWdCLEtBQUssRUFBRSxXQUEwQixJQUFJO0lBQzNHLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxXQUFXLENBQUM7SUFDcEUsSUFBSSxPQUFPLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUV6QyxJQUFJLElBQUksRUFBRTtRQUNOLElBQUksTUFBTSxHQUFHLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUV0QyxJQUFJLGVBQWUsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQztZQUM1QyxLQUFLLEVBQUUsTUFBTSxDQUFDLEtBQUs7WUFDbkIsTUFBTSxFQUFFLE1BQU0sQ0FBQyxNQUFNO1lBQ3JCLFNBQVMsRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU87WUFDbkMsUUFBUSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTTtTQUNuQyxDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRTtZQUNwQixhQUFhLEVBQUUsZUFBZTtTQUNqQyxDQUFDLENBQUM7UUFFSCxPQUFPLElBQUksTUFBTSxDQUFDLHVCQUF1QixDQUFDLGVBQWUsQ0FBQyxXQUFXLENBQUMsQ0FBQztLQUMxRTtTQUFNO1FBQ0gsSUFBSSxHQUFHLEdBQUcsSUFBSSxNQUFNLENBQUMsdUJBQXVCLENBQUMs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QWtCLEVBQUUsU0FBNkI7UUFDMUQsSUFBSSxRQUFRLEdBQUcsSUFBSSxNQUFNLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUM3QyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzVCLFFBQVEsQ0FBQyxnQkFBZ0IsR0FBRyxxQkFBcUIsQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDckUsUUFBUSxDQUFDLFNBQVMsR0FBRyxNQUFNLENBQUMseUJBQXlCLENBQUMsSUFBSSxDQUFDO1FBQzNELElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUNuRCxTQUFTLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzNCLE9BQU8sTUFBTSxDQUFDO0lBQ2xCLENBQUM7Q0FFSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFdvcmxkSGVscGVyIH0gZnJvbSBcIi4uL1dvcmxkLmpzXCI7XHJcbmltcG9ydCB7IEJveGVzM2QgfSBmcm9tIFwiLi9Cb3hlczNkLmpzXCI7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0U3ByaXRlc2hlZXRUZXh0dXJlKGlkZW50aWZpZXI6IHN0cmluZywgY29weTogYm9vbGVhbiA9IGZhbHNlLCByZW5kZXJlcjogUElYSS5SZW5kZXJlciA9IG51bGwpIHtcclxuICAgIGxldCBzaGVldCA9IFBJWEkuTG9hZGVyLnNoYXJlZC5yZXNvdXJjZXNbXCJzcHJpdGVzaGVldFwiXS5zcHJpdGVzaGVldDtcclxuICAgIGxldCB0ZXh0dXJlID0gc2hlZXQudGV4dHVyZXNbaWRlbnRpZmllcl07XHJcblxyXG4gICAgaWYgKGNvcHkpIHtcclxuICAgICAgICBsZXQgc3ByaXRlID0gbmV3IFBJWEkuU3ByaXRlKHRleHR1cmUpO1xyXG5cclxuICAgICAgICBsZXQgZHluYW1pY1RleHR1cmUxID0gUElYSS5SZW5kZXJUZXh0dXJlLmNyZWF0ZSh7XHJcbiAgICAgICAgICAgIHdpZHRoOiBzcHJpdGUud2lkdGgsXHJcbiAgICAgICAgICAgIGhlaWdodDogc3ByaXRlLmhlaWdodCxcclxuICAgICAgICAgICAgc2NhbGVNb2RlOiBQSVhJLlNDQUxFX01PREVTLk5FQVJFU1QsXHJcbiAgICAgICAgICAgIHdyYXBNb2RlOiBQSVhJLldSQVBfTU9ERVMuUkVQRUFUXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJlbmRlcmVyLnJlbmRlcihzcHJpdGUsIHtcclxuICAgICAgICAgICAgcmVuZGVyVGV4dHVyZTogZHluYW1pY1RleHR1cmUxXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgUGl4aTNkLlN0YW5kYXJkTWF0ZXJpYWxUZXh0dXJlKGR5bmFtaWNUZXh0dXJlMS5iYXNlVGV4dHVyZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxldCBzbXQgPSBuZXcgUGl4aTNkLlN0YW5kYXJkTWF0ZXJpYWxUZXh0dXJlKHRleHR1cmUuYmFzZVRleHR1cmUpO1xyXG4gICAgICAgIHNtdC50cmFuc2Zvcm0gPSBuZXcgUGl4aTNkLlRleHR1cmVUcmFuc2Zvcm0oKVxyXG4gICAgICAgIHNtdC50cmFuc2Zvcm0ub2Zmc2V0LnNldChcclxuICAgICAgICAgICAgKHRleHR1cmUuZnJhbWUueCArIDApIC8gdGV4dHVyZS5iYXNlVGV4dHVyZS53aWR0aCxcclxuICAgICAgICAgICAgKHRleHR1cmUuZnJhbWUueSArIDApIC8gdGV4dHVyZS5iYXNlVGV4dHVyZS5oZWlnaHRcclxuICAgICAgICApXHJcbiAgICAgICAgc210LnRyYW5zZm9ybS5zY2FsZS5zZXQoXHJcbiAgICAgICAgICAgIHRleHR1cmUuZnJhbWUud2lkdGggLyB0ZXh0dXJlLmJhc2VUZXh0dXJlLndpZHRoLFxyXG4gICAgICAgICAgICB0ZXh0dXJlLmZyYW1lLmhlaWdodCAvIHRleHR1cmUuYmFzZVRleHR1cmUuaGVpZ2h0XHJcbiAgICAgICAgKVxyXG4gICAgICAgIHJldHVybiBzbXQ7XHJcblxyXG4gICAgfVxyXG5cclxuXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBSb2JvdE1hcmtlciBleHRlbmRzIFBpeGkzZC5NZXNoM0Qge1xyXG4gICAgY29uc3RydWN0b3IoZ2VvbWV0cnk6IFBpeGkzZC5NZXNoR2VvbWV0cnkzRCwgbWF0ZXJpYWw6IFBpeGkzZC5NYXRlcmlhbCwgcHVibGljIGZhcmJlOiBzdHJpbmcpIHtcclxuICAgICAgICBzdXBlcihnZW9tZXRyeSwgbWF0ZXJpYWwpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgUm9ib3RCcmljayBleHRlbmRzIFBpeGkzZC5NZXNoM0Qge1xyXG4gICAgY29uc3RydWN0b3IoZ2VvbWV0cnk6IFBpeGkzZC5NZXNoR2VvbWV0cnkzRCwgbWF0ZXJpYWw6IFBpeGkzZC5NYXRlcmlhbCwgcHVibGljIGZhcmJlOiBzdHJpbmcpIHtcclxuICAgICAgICBzdXBlcihnZW9tZXRyeSwgbWF0ZXJpYWwpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgUm9ib3RDdWJlRmFjdG9yeSB7XHJcblxyXG4gICAgZmFyYmVuOiBzdHJpbmdbXSA9IFtcInJvdFwiLCBcImdlbGJcIiwgXCJncsO8blwiLCBcImJsYXVcIl07XHJcbiAgICBmYXJiZVRvQ29sb3JJbmZvTWFwOiB7IFtmYXJiZTogc3RyaW5nXTogbnVtYmVyW10gfSA9IHtcclxuICAgICAgICBcInJvdFwiOiBbMS4wLCAwLjAsIDAuMF0sXHJcbiAgICAgICAgXCJnZWxiXCI6IFsxLjAsIDEuMCwgMC4wXSxcclxuICAgICAgICBcImdyw7xuXCI6IFswLjAsIDEuMCwgMC4wXSxcclxuICAgICAgICBcImJsYXVcIjogWzAuMCwgMC4wLCAxLjBdXHJcbiAgICB9XHJcbiAgICBmYXJiZVRvTWFya2VyTWF0ZXJpYWxNYXA6IHsgW2ZhcmJlOiBzdHJpbmddOiBQaXhpM2QuU3RhbmRhcmRNYXRlcmlhbCB9ID0ge307XHJcbiAgICBmYXJiZVRvQnJpY2tNYXRlcmlhbE1hcDogeyBbZmFyYmU6IHN0cmluZ106IFBpeGkzZC5TdGFuZGFyZE1hdGVyaWFsIH0gPSB7fTtcclxuXHJcblxyXG4gICAgZ3Jhc3NCcmlja01hdGVyaWFsOiBQaXhpM2QuU3RhbmRhcmRNYXRlcmlhbDtcclxuICAgIGdyb3VuZFBsYW5lTWF0ZXJpYWw6IFBpeGkzZC5TdGFuZGFyZE1hdGVyaWFsO1xyXG5cclxuICAgIHBsYW5lTWF0ZXJpYWw6IHsgW2tleTogc3RyaW5nXTogUGl4aTNkLlN0YW5kYXJkTWF0ZXJpYWwgfSA9IHt9O1xyXG5cclxuICAgIGNsb3VkTWF0ZXJpYWw6IFBpeGkzZC5TdGFuZGFyZE1hdGVyaWFsO1xyXG5cclxuICAgIGxpZ2h0MTogUGl4aTNkLkxpZ2h0O1xyXG4gICAgbGlnaHQyOiBQaXhpM2QuTGlnaHQ7XHJcbiAgICBsaWdodGluZ0Vudmlyb25tZW50OiBQaXhpM2QuTGlnaHRpbmdFbnZpcm9ubWVudDtcclxuXHJcblxyXG5cclxuICAgIGdldEJyaWNrKGZhcmJlOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFJvYm90QnJpY2soQm94ZXMzZC5jcmVhdGVIYWxmaGVpZ2h0Q3ViZTNkTWVzaCgpLCB0aGlzLmZhcmJlVG9Ccmlja01hdGVyaWFsTWFwW2ZhcmJlXSwgZmFyYmUpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEdyYXNzQnJpY2soKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQaXhpM2QuTWVzaDNEKEJveGVzM2QuY3JlYXRlQ3ViZTNkTWVzaCgpLCB0aGlzLmdyYXNzQnJpY2tNYXRlcmlhbCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0R3Jhc3NQbGFuZSh4OiBudW1iZXIsIHo6IG51bWJlcikge1xyXG4gICAgICAgIGxldCBtZXNoID0gbmV3IFBpeGkzZC5NZXNoM0QoQm94ZXMzZC5jcmVhdGVQbGFuZTNkTWVzaCh4LCB6KSwgdGhpcy5ncm91bmRQbGFuZU1hdGVyaWFsKTtcclxuICAgICAgICBtZXNoLnNjYWxlLnggPSB4O1xyXG4gICAgICAgIG1lc2guc2NhbGUueiA9IHo7XHJcbiAgICAgICAgbWVzaC54ICs9IHggLSAxO1xyXG4gICAgICAgIG1lc2gueiArPSB6IC0gMTtcclxuICAgICAgICAvL2xldCBwbGFuZSA9IFBpeGkzZC5NZXNoM0QuY3JlYXRlUGxhbmUoKTtcclxuICAgICAgICAvLyAoPFBpeGkzZC5TdGFuZGFyZE1hdGVyaWFsPnBsYW5lLm1hdGVyaWFsKS5iYXNlQ29sb3IgPSBuZXcgUGl4aTNkLkNvbG9yKDAsIDEsIDAsIDEpOyAvLyBUaGUgYmFzZSBjb2xvciB3aWxsIGJlIGJsZW5kZWQgdG9nZXRoZXIgd2l0aCBiYXNlIGNvbG9yIHRleHR1cmUgKGlmIGF2YWlsYWJsZSkuXHJcbiAgICAgICAgLy8gcGxhbmUueSA9IC0wLjU7XHJcbiAgICAgICAgLy8gcGxhbmUuc2NhbGUuc2V0KDEwKTtcclxuICAgICAgICByZXR1cm4gbWVzaDtcclxuICAgIH1cclxuXHJcbiAgICBtYWtlUGxhbmUoY29udGFpbmVyOiBQaXhpM2QuQ29udGFpbmVyM0QsIHg6IG51bWJlciwgeTogbnVtYmVyLCB6OiBudW1iZXIsIHdpZHRoWDogbnVtYmVyLCB3aWR0aFo6IG51bWJlciwgc3ByaXRlT3JDb2xvcjogc3RyaW5nIHwgUGl4aTNkLkNvbG9yKSB7XHJcbiAgICAgICAgbGV0IG1hdGVyaWFsOiBQaXhpM2QuU3RhbmRhcmRNYXRlcmlhbDtcclxuICAgICAgICBpZiAodHlwZW9mIHNwcml0ZU9yQ29sb3IgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICBtYXRlcmlhbCA9IHRoaXMuZ2V0UGxhbmVNYXRlcmlhbChzcHJpdGVPckNvbG9yKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBtYXRlcmlhbCA9IG5ldyBQaXhpM2QuU3RhbmRhcmRNYXRlcmlhbCgpO1xyXG4gICAgICAgICAgICB0aGlzLmluaXRNYXRlcmlhbChtYXRlcmlhbCk7XHJcbiAgICAgICAgICAgIG1hdGVyaWFsLmJhc2VDb2xvciA9IHNwcml0ZU9yQ29sb3I7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBtZXNoID0gbmV3IFBpeGkzZC5NZXNoM0QoQm94ZXMzZC5jcmVhdGVQbGFuZTNkTWVzaCh3aWR0aFgsIHdpZHRoWiksIG1hdGVyaWFsKTtcclxuICAgICAgICBtZXNoLnkgPSB5O1xyXG4gICAgICAgIG1lc2gueCA9IHg7XHJcbiAgICAgICAgbWVzaC56ID0gejtcclxuICAgICAgICBtZXNoLnNjYWxlLnNldCh3aWR0aFgsIDEsIHdpZHRoWik7XHJcbiAgICAgICAgY29udGFpbmVyLmFkZENoaWxkKG1lc2gpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldE1hcmtlcihmYXJiZTogc3RyaW5nKSB7XHJcbiAgICAgICAgbGV0IG1hcmtlciA9IG5ldyBSb2JvdE1hcmtlcihCb3hlczNkLmNyZWF0ZUN1YmUzZE1lc2goKSwgdGhpcy5mYXJiZVRvTWFya2VyTWF0ZXJpYWxNYXBbZmFyYmVdLCBmYXJiZSk7XHJcbiAgICAgICAgbWFya2VyLnNjYWxlLnNldCgwLjksIDAuMSwgMC45KTtcclxuICAgICAgICByZXR1cm4gbWFya2VyO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFNpZGVQbGFuZXMod29ybGRYOiBudW1iZXIsIHdvcmxkWTogbnVtYmVyLCBzaWRlU3ByaXRlOiBzdHJpbmcsIHJhZGl1czogbnVtYmVyLCBkZWVwOiBudW1iZXIpOiBQaXhpM2QuTWVzaDNEW10ge1xyXG4gICAgICAgIGxldCBwbGFuZXM6IFBpeGkzZC5NZXNoM0RbXSA9IFtdO1xyXG5cclxuICAgICAgICBsZXQgc2lkZU1hdGVyaWFsID0gdGhpcy5nZXRQbGFuZU1hdGVyaWFsKHNpZGVTcHJpdGUpOyAvLzNkIzNcclxuXHJcbiAgICAgICAgbGV0IG1lc2gxID0gbmV3IFBpeGkzZC5NZXNoM0QoQm94ZXMzZC5jcmVhdGVQbGFuZTNkTWVzaCh3b3JsZFgsIDEpLCBzaWRlTWF0ZXJpYWwpO1xyXG4gICAgICAgIG1lc2gxLnNjYWxlLnggPSB3b3JsZFggKyAyICogcmFkaXVzO1xyXG4gICAgICAgIG1lc2gxLnggKz0gd29ybGRYIC0gMTtcclxuICAgICAgICBtZXNoMS55IC09IDEgKyAyICogZGVlcDtcclxuICAgICAgICBtZXNoMS56IC09IDEgKyAyICogcmFkaXVzO1xyXG4gICAgICAgIG1lc2gxLnJvdGF0aW9uUXVhdGVybmlvbi5zZXRFdWxlckFuZ2xlcygtOTAsIDAsIDE4MCk7XHJcbiAgICAgICAgcGxhbmVzLnB1c2gobWVzaDEpO1xyXG5cclxuICAgICAgICBsZXQgbWVzaDIgPSBuZXcgUGl4aTNkLk1lc2gzRChCb3hlczNkLmNyZWF0ZVBsYW5lM2RNZXNoKHdvcmxkWCwgMSksIHNpZGVNYXRlcmlhbCk7XHJcbiAgICAgICAgbWVzaDIuc2NhbGUueCA9IHdvcmxkWCArIDIgKiByYWRpdXM7XHJcbiAgICAgICAgbWVzaDIueCArPSB3b3JsZFggLSAxO1xyXG4gICAgICAgIG1lc2gyLnkgLT0gMSArIDIgKiBkZWVwO1xyXG4gICAgICAgIG1lc2gyLnogKz0gMiAqIHdvcmxkWSAtIDEgKyAyICogcmFkaXVzO1xyXG4gICAgICAgIG1lc2gyLnJvdGF0aW9uUXVhdGVybmlvbi5zZXRFdWxlckFuZ2xlcyg5MCwgMCwgMCk7XHJcbiAgICAgICAgcGxhbmVzLnB1c2gobWVzaDIpO1xyXG5cclxuICAgICAgICBsZXQgbWVzaDMgPSBuZXcgUGl4aTNkLk1lc2gzRChCb3hlczNkLmNyZWF0ZVBsYW5lM2RNZXNoKHdvcmxkWSwgMSksIHNpZGVNYXRlcmlhbCk7XHJcbiAgICAgICAgbWVzaDMuc2NhbGUueCA9IHdvcmxkWSArIDIgKiByYWRpdXM7XHJcbiAgICAgICAgbWVzaDMueSAtPSAxICsgMiAqIGRlZXA7XHJcbiAgICAgICAgbWVzaDMueCAtPSAxICsgMiAqIHJhZGl1cztcclxuICAgICAgICBtZXNoMy56ICs9IHdvcmxkWSAtIDE7XHJcbiAgICAgICAgbWVzaDMucm90YXRpb25RdWF0ZXJuaW9uLnNldEV1bGVyQW5nbGVzKDkwLCAtOTAsIDApO1xyXG4gICAgICAgIHBsYW5lcy5wdXNoKG1lc2gzKTtcclxuXHJcbiAgICAgICAgbGV0IG1lc2g0ID0gbmV3IFBpeGkzZC5NZXNoM0QoQm94ZXMzZC5jcmVhdGVQbGFuZTNkTWVzaCh3b3JsZFksIDEpLCBzaWRlTWF0ZXJpYWwpO1xyXG4gICAgICAgIG1lc2g0LnNjYWxlLnggPSB3b3JsZFkgKyAyICogcmFkaXVzO1xyXG4gICAgICAgIG1lc2g0LnkgLT0gMSArIDIgKiBkZWVwO1xyXG4gICAgICAgIG1lc2g0LnggKz0gMiAqIHdvcmxkWCAtIDEgKyAyICogcmFkaXVzO1xyXG4gICAgICAgIG1lc2g0LnogKz0gd29ybGRZIC0gMTtcclxuICAgICAgICBtZXNoNC5yb3RhdGlvblF1YXRlcm5pb24uc2V0RXVsZXJBbmdsZXMoOTAsIDkwLCAwKTtcclxuICAgICAgICBwbGFuZXMucHVzaChtZXNoNCk7XHJcblxyXG4gICAgICAgIHJldHVybiBwbGFuZXM7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0SG9yaXpvbnRhbFBsYW5lcyh3b3JsZFg6IG51bWJlciwgd29ybGRZOiBudW1iZXIsIHRvcFNwcml0ZTogc3RyaW5nLCByYWRpdXM6IG51bWJlciwgZGVlcDogbnVtYmVyKTogUGl4aTNkLk1lc2gzRFtdIHtcclxuICAgICAgICBsZXQgcGxhbmVzOiBQaXhpM2QuTWVzaDNEW10gPSBbXTtcclxuXHJcbiAgICAgICAgbGV0IHRvcE1hdGVyaWFsID0gdGhpcy5nZXRQbGFuZU1hdGVyaWFsKHRvcFNwcml0ZSk7XHJcblxyXG4gICAgICAgIGxldCBtZXNoNSA9IG5ldyBQaXhpM2QuTWVzaDNEKEJveGVzM2QuY3JlYXRlUGxhbmUzZE1lc2god29ybGRZLCAxKSwgdG9wTWF0ZXJpYWwpO1xyXG4gICAgICAgIG1lc2g1LnNjYWxlLnggPSB3b3JsZFggKyAyICogcmFkaXVzO1xyXG4gICAgICAgIG1lc2g1LnggKz0gd29ybGRYIC0gMTtcclxuICAgICAgICBtZXNoNS55IC09IDIgKyAyICogZGVlcDtcclxuICAgICAgICBtZXNoNS56IC09IDIgKyAyICogcmFkaXVzO1xyXG4gICAgICAgIG1lc2g1LnJvdGF0aW9uUXVhdGVybmlvbi5zZXRFdWxlckFuZ2xlcygxODAsIDAsIDE4MCk7XHJcbiAgICAgICAgcGxhbmVzLnB1c2gobWVzaDUpO1xyXG5cclxuICAgICAgICBsZXQgbWVzaDYgPSBuZXcgUGl4aTNkLk1lc2gzRChCb3hlczNkLmNyZWF0ZVBsYW5lM2RNZXNoKHdvcmxkWCwgMSksIHRvcE1hdGVyaWFsKTtcclxuICAgICAgICBtZXNoNi5zY2FsZS54ID0gd29ybGRYICsgMiAqIHJhZGl1cztcclxuICAgICAgICBtZXNoNi54ICs9IHdvcmxkWCAtIDE7XHJcbiAgICAgICAgbWVzaDYueSAtPSAyICsgMiAqIGRlZXA7XHJcbiAgICAgICAgbWVzaDYueiArPSAyICogd29ybGRZICsgMiAqIHJhZGl1cztcclxuICAgICAgICBtZXNoNi5yb3RhdGlvblF1YXRlcm5pb24uc2V0RXVsZXJBbmdsZXMoMCwgMCwgMCk7XHJcbiAgICAgICAgcGxhbmVzLnB1c2gobWVzaDYpO1xyXG5cclxuICAgICAgICBsZXQgbWVzaDcgPSBuZXcgUGl4aTNkLk1lc2gzRChCb3hlczNkLmNyZWF0ZVBsYW5lM2RNZXNoKHdvcmxkWSwgMSksIHRvcE1hdGVyaWFsKTtcclxuICAgICAgICBtZXNoNy5zY2FsZS54ID0gd29ybGRZICsgMiAqIHJhZGl1cyArIDI7XHJcbiAgICAgICAgbWVzaDcueSAtPSAyICsgMiAqIGRlZXA7XHJcbiAgICAgICAgbWVzaDcueCAtPSAyICsgMiAqIHJhZGl1cztcclxuICAgICAgICBtZXNoNy56ICs9IHdvcmxkWSAtIDE7XHJcbiAgICAgICAgbWVzaDcucm90YXRpb25RdWF0ZXJuaW9uLnNldEV1bGVyQW5nbGVzKDAsIC05MCwgMCk7XHJcbiAgICAgICAgcGxhbmVzLnB1c2gobWVzaDcpO1xyXG5cclxuICAgICAgICBsZXQgbWVzaDggPSBuZXcgUGl4aTNkLk1lc2gzRChCb3hlczNkLmNyZWF0ZVBsYW5lM2RNZXNoKHdvcmxkWSwgMSksIHRvcE1hdGVyaWFsKTtcclxuICAgICAgICBtZXNoOC5zY2FsZS54ID0gd29ybGRZICsgMiAqIHJhZGl1cyArIDI7XHJcbiAgICAgICAgbWVzaDgueSAtPSAyICsgMiAqIGRlZXA7XHJcbiAgICAgICAgbWVzaDgueCArPSAyICogd29ybGRYICsgMiAqIHJhZGl1cztcclxuICAgICAgICBtZXNoOC56ICs9IHdvcmxkWSAtIDE7XHJcbiAgICAgICAgbWVzaDgucm90YXRpb25RdWF0ZXJuaW9uLnNldEV1bGVyQW5nbGVzKDAsIDkwLCAwKTtcclxuICAgICAgICBwbGFuZXMucHVzaChtZXNoOCk7XHJcblxyXG4gICAgICAgIHJldHVybiBwbGFuZXM7XHJcbiAgICB9XHJcblxyXG4gICAgbWFrZUNsb3Vkcyhjb250YWluZXI6IFBpeGkzZC5Db250YWluZXIzRCwgaGVpZ2h0OiBudW1iZXIsIG9yaWdpblg6IG51bWJlciwgb3JpZ2luWjogbnVtYmVyKSB7XHJcbiAgICAgICAgbGV0IGNvdW50ID0gMjAwO1xyXG4gICAgICAgIGxldCBudW1iZXJPZkJhdGNoZXMgPSAxMDtcclxuICAgICAgICBsZXQgdG9kbyA9IGNvdW50O1xyXG5cclxuICAgICAgICBsZXQgZiA9ICgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRvZG8gPD0gMCkgcmV0dXJuO1xyXG4gICAgICAgICAgICBsZXQgcmFkaXVzID0gMTUwMDtcclxuICAgICAgICAgICAgbGV0IG1heFdpZHRoID0gMjA7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQgLyBudW1iZXJPZkJhdGNoZXM7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdG9kby0tO1xyXG4gICAgICAgICAgICAgICAgbGV0IGRpc3RhbmNlID0gTWF0aC5zcXJ0KE1hdGgucmFuZG9tKCkpICogcmFkaXVzO1xyXG4gICAgICAgICAgICAgICAgbGV0IGFuZ2xlID0gTWF0aC5yYW5kb20oKSAqIDIgKiBNYXRoLlBJO1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCB4MSA9IE1hdGguZmxvb3IoZGlzdGFuY2UgKiBNYXRoLmNvcyhhbmdsZSkpICsgb3JpZ2luWDtcclxuICAgICAgICAgICAgICAgIGxldCB6MSA9IE1hdGguZmxvb3IoZGlzdGFuY2UgKiBNYXRoLnNpbihhbmdsZSkpICsgb3JpZ2luWjtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgY291bnQgPSBNYXRoLnJhbmRvbSgpICogMTAgKyAyO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY291bnQ7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBtZXNoID0gQm94ZXMzZC5jcmVhdGVDdWJlM2QodGhpcy5jbG91ZE1hdGVyaWFsKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHNjYWxlWCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG1heFdpZHRoICsgMik7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHNjYWxlWSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG1heFdpZHRoIC8gNCArIDIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBzY2FsZVogPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtYXhXaWR0aCArIDIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBsZXQgZHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAzICogKDUgKyBjb3VudCArIHNjYWxlWCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBkeiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDMgKiAoNSArIGNvdW50ICsgc2NhbGVaKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIG1lc2gueCA9IHgxICsgZHg7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzaC56ID0gejEgKyBkejtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbWVzaC55ID0gaGVpZ2h0ICsgc2NhbGVZIC8gMjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbWVzaC5zY2FsZS5zZXQoc2NhbGVYLCBzY2FsZVksIHNjYWxlWik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hZGRDaGlsZChtZXNoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGYsIDEwMCk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZigpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHdvcmxkSGVscGVyOiBXb3JsZEhlbHBlciwgcHJpdmF0ZSBjYW1lcmE6IFBpeGkzZC5DYW1lcmEpIHtcclxuXHJcbiAgICAgICAgbGV0IHJlbmRlcmVyID0gPFBJWEkuUmVuZGVyZXI+d29ybGRIZWxwZXIuYXBwLnJlbmRlcmVyO1xyXG5cclxuICAgICAgICB0aGlzLmxpZ2h0MSA9IE9iamVjdC5hc3NpZ24obmV3IFBpeGkzZC5MaWdodCgpLCB7XHJcbiAgICAgICAgICAgIHR5cGU6IFBpeGkzZC5MaWdodFR5cGUuYW1iaWVudCxcclxuICAgICAgICAgICAgcmFuZ2U6IDEwMCxcclxuICAgICAgICAgICAgaW50ZW5zaXR5OiAzMCxcclxuICAgICAgICAgICAgY29sb3I6IG5ldyBQaXhpM2QuQ29sb3IoMSwgMSwgMSlcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmxpZ2h0MS5wb3NpdGlvbi5zZXQoLTQsIDQsIDQpO1xyXG5cclxuICAgICAgICB0aGlzLmxpZ2h0MiA9IE9iamVjdC5hc3NpZ24obmV3IFBpeGkzZC5MaWdodCgpLCB7XHJcbiAgICAgICAgICAgIHR5cGU6IFBpeGkzZC5MaWdodFR5cGUuZGlyZWN0aW9uYWwsXHJcbiAgICAgICAgICAgIHJhbmdlOiA2MDAsXHJcbiAgICAgICAgICAgIGludGVuc2l0eTogNCxcclxuICAgICAgICAgICAgY29sb3I6IG5ldyBQaXhpM2QuQ29sb3IoMSwgMSwgMSlcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmxpZ2h0Mi5wb3NpdGlvbi5zZXQoMTIsIDE2LCAtMTIpO1xyXG4gICAgICAgIHRoaXMubGlnaHQyLnJvdGF0aW9uUXVhdGVybmlvbi5zZXRFdWxlckFuZ2xlcygyNSwgNDUsIDApO1xyXG5cclxuICAgICAgICB0aGlzLmxpZ2h0aW5nRW52aXJvbm1lbnQgPSBuZXcgUGl4aTNkLkxpZ2h0aW5nRW52aXJvbm1lbnQoPFBJWEkuUmVuZGVyZXI+d29ybGRIZWxwZXIuYXBwLnJlbmRlcmVyKTtcclxuICAgICAgICB0aGlzLmxpZ2h0aW5nRW52aXJvbm1lbnQubGlnaHRzLnB1c2godGhpcy5saWdodDEsIHRoaXMubGlnaHQyKTtcclxuXHJcblxyXG4gICAgICAgIHRoaXMuZ3Jhc3NCcmlja01hdGVyaWFsID0gbmV3IFBpeGkzZC5TdGFuZGFyZE1hdGVyaWFsKCk7XHJcbiAgICAgICAgdGhpcy5pbml0TWF0ZXJpYWwodGhpcy5ncmFzc0JyaWNrTWF0ZXJpYWwpO1xyXG4gICAgICAgIHRoaXMuZ3Jhc3NCcmlja01hdGVyaWFsLmJhc2VDb2xvclRleHR1cmUgPSBnZXRTcHJpdGVzaGVldFRleHR1cmUoXCJyb2JvdCMwXCIpO1xyXG5cclxuICAgICAgICB0aGlzLmNsb3VkTWF0ZXJpYWwgPSBuZXcgUGl4aTNkLlN0YW5kYXJkTWF0ZXJpYWwoKTtcclxuICAgICAgICB0aGlzLmluaXRNYXRlcmlhbCh0aGlzLmNsb3VkTWF0ZXJpYWwpO1xyXG4gICAgICAgIHRoaXMuY2xvdWRNYXRlcmlhbC5iYXNlQ29sb3IgPSBuZXcgUGl4aTNkLkNvbG9yKDEuMCwgMS4wLCAxLjAsIDAuNSk7XHJcblxyXG4gICAgICAgIHRoaXMuZ3JvdW5kUGxhbmVNYXRlcmlhbCA9IG5ldyBQaXhpM2QuU3RhbmRhcmRNYXRlcmlhbCgpO1xyXG4gICAgICAgIHRoaXMuaW5pdE1hdGVyaWFsKHRoaXMuZ3JvdW5kUGxhbmVNYXRlcmlhbCk7XHJcbiAgICAgICAgdGhpcy5ncm91bmRQbGFuZU1hdGVyaWFsLmJhc2VDb2xvclRleHR1cmUgPSBnZXRTcHJpdGVzaGVldFRleHR1cmUoXCJyb2JvdCMyXCIsIHRydWUsIHJlbmRlcmVyKTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgZmFyYmUgb2YgdGhpcy5mYXJiZW4pIHtcclxuICAgICAgICAgICAgbGV0IG1hdGVyaWFsID0gbmV3IFBpeGkzZC5TdGFuZGFyZE1hdGVyaWFsKCk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdE1hdGVyaWFsKG1hdGVyaWFsKTtcclxuICAgICAgICAgICAgbGV0IGNvbG9ySW5mbyA9IHRoaXMuZmFyYmVUb0NvbG9ySW5mb01hcFtmYXJiZV07XHJcbiAgICAgICAgICAgIG1hdGVyaWFsLmJhc2VDb2xvciA9IG5ldyBQaXhpM2QuQ29sb3IoY29sb3JJbmZvWzBdLCBjb2xvckluZm9bMV0sIGNvbG9ySW5mb1syXSwgMSk7XHJcbiAgICAgICAgICAgIHRoaXMuZmFyYmVUb01hcmtlck1hdGVyaWFsTWFwW2ZhcmJlXSA9IG1hdGVyaWFsO1xyXG5cclxuICAgICAgICAgICAgbGV0IGJyaWNrTWF0ZXJpYWwgPSBuZXcgUGl4aTNkLlN0YW5kYXJkTWF0ZXJpYWwoKTtcclxuICAgICAgICAgICAgdGhpcy5pbml0TWF0ZXJpYWwoYnJpY2tNYXRlcmlhbCk7XHJcbiAgICAgICAgICAgIGxldCBpbmRleCA9IHRoaXMuZmFyYmVuLmluZGV4T2YoZmFyYmUpICsgNDtcclxuICAgICAgICAgICAgYnJpY2tNYXRlcmlhbC5iYXNlQ29sb3JUZXh0dXJlID0gZ2V0U3ByaXRlc2hlZXRUZXh0dXJlKFwicm9ib3QjXCIgKyBpbmRleCk7XHJcbiAgICAgICAgICAgIHRoaXMuZmFyYmVUb0JyaWNrTWF0ZXJpYWxNYXBbZmFyYmVdID0gYnJpY2tNYXRlcmlhbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGluaXRNYXRlcmlhbChtYXRlcmlhbDogUGl4aTNkLlN0YW5kYXJkTWF0ZXJpYWwpIHtcclxuICAgICAgICBtYXRlcmlhbC5jYW1lcmEgPSB0aGlzLmNhbWVyYTtcclxuICAgICAgICBtYXRlcmlhbC5leHBvc3VyZSA9IDE7XHJcbiAgICAgICAgbWF0ZXJpYWwucm91Z2huZXNzID0gMC45O1xyXG4gICAgICAgIG1hdGVyaWFsLmxpZ2h0aW5nRW52aXJvbm1lbnQgPSB0aGlzLmxpZ2h0aW5nRW52aXJvbm1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0UGxhbmVNYXRlcmlhbChzcHJpdGVLZXk6IHN0cmluZyk6IFBpeGkzZC5TdGFuZGFyZE1hdGVyaWFsIHtcclxuICAgICAgICBsZXQgcmVuZGVyZXIgPSA8UElYSS5SZW5kZXJlcj50aGlzLndvcmxkSGVscGVyLmFwcC5yZW5kZXJlcjtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMucGxhbmVNYXRlcmlhbFtzcHJpdGVLZXldICE9IG51bGwpIHJldHVybiB0aGlzLnBsYW5lTWF0ZXJpYWxbc3ByaXRlS2V5XTtcclxuXHJcbiAgICAgICAgbGV0IG1hdGVyaWFsID0gbmV3IFBpeGkzZC5TdGFuZGFyZE1hdGVyaWFsKCk7XHJcbiAgICAgICAgdGhpcy5pbml0TWF0ZXJpYWwobWF0ZXJpYWwpO1xyXG4gICAgICAgIG1hdGVyaWFsLmJhc2VDb2xvclRleHR1cmUgPSBnZXRTcHJpdGVzaGVldFRleHR1cmUoc3ByaXRlS2V5LCB0cnVlLCByZW5kZXJlcik7XHJcbiAgICAgICAgLy8gbWF0ZXJpYWwuZG91YmxlU2lkZWQgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMucGxhbmVNYXRlcmlhbFtzcHJpdGVLZXldID0gbWF0ZXJpYWw7XHJcblxyXG4gICAgICAgIHJldHVybiBtYXRlcmlhbDtcclxuICAgIH1cclxuXHJcbiAgICBtYWtlU3ByaXRlM2QodGV4dHVyZUtleTogc3RyaW5nLCBjb250YWluZXI6IFBpeGkzZC5Db250YWluZXIzRCl7XHJcbiAgICAgICAgbGV0IG1hdGVyaWFsID0gbmV3IFBpeGkzZC5TdGFuZGFyZE1hdGVyaWFsKCk7XHJcbiAgICAgICAgdGhpcy5pbml0TWF0ZXJpYWwobWF0ZXJpYWwpO1xyXG4gICAgICAgIG1hdGVyaWFsLmJhc2VDb2xvclRleHR1cmUgPSBnZXRTcHJpdGVzaGVldFRleHR1cmUodGV4dHVyZUtleSwgZmFsc2UpO1xyXG4gICAgICAgIG1hdGVyaWFsLmFscGhhTW9kZSA9IFBpeGkzZC5TdGFuZGFyZE1hdGVyaWFsQWxwaGFNb2RlLm1hc2s7XHJcbiAgICAgICAgbGV0IHNwcml0ZSA9IEJveGVzM2QuY3JlYXRlUGxhbmUzZCgxLCAxLCBtYXRlcmlhbCk7XHJcbiAgICAgICAgY29udGFpbmVyLmFkZENoaWxkKHNwcml0ZSk7XHJcbiAgICAgICAgcmV0dXJuIHNwcml0ZTtcclxuICAgIH1cclxuXHJcbn0iXX0=