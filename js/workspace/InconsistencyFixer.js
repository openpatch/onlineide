import { Workspace } from "./Workspace.js";
export class InconsistencyFixer {
    start(workspaceList, networkManager, main) {
        let updateNeeded = false;
        // is there a folder which contains files?
        for (let ws of workspaceList) {
            if (ws.isFolder && ws.moduleStore.getModules(false).length > 0) {
                console.log("Folder " + ws.path + "/" + ws.name + " contains files. -> Make new folder and transforming existing one to workspace.");
                // create new Folder
                let newFolder = new Workspace(ws.name, main, ws.owner_id);
                newFolder.isFolder = true;
                newFolder.path = ws.path;
                workspaceList.push(newFolder);
                networkManager.sendCreateWorkspace(newFolder, newFolder.owner_id, (error) => {
                    if (error == null || error == "") {
                        console.log("Successfully created new Folder.");
                    }
                    else {
                        console.log("Error creating folder: " + error);
                    }
                });
                // transform old folder into real workspace
                ws.isFolder = false;
                ws.name += " (ws)";
                ws.saved = false;
                updateNeeded = true;
            }
        }
        // Are there several folders with identical path and name?
        let folderList = workspaceList.filter(ws => ws.isFolder);
        for (let ws1 of folderList) {
            let identicalFolders = [];
            for (let ws2 of folderList) {
                if (ws2 != ws1 && ws2.path == ws1.path && ws2.name == ws1.name) {
                    identicalFolders.push(ws2);
                }
            }
            if (identicalFolders.length > 0) {
                console.log("" + (identicalFolders.length + 1) + " folders with name " + ws1.path + "/" + ws1.name + "=> renaming them with suffixes (1), (2), ...");
                for (let i = 0; i < identicalFolders.length; i++) {
                    identicalFolders[i].name += " (" + (i + 1) + ")";
                    identicalFolders[i].saved = false;
                }
                updateNeeded = true;
            }
        }
        // Is there a workspace which belongs to a folder that doesn't exist?
        let folderPathAndNames = [];
        for (let folder of folderList) {
            let fnap = folder.path;
            if (fnap != "" && !fnap.endsWith("/"))
                fnap += "/";
            fnap += folder.name;
            folderPathAndNames.push(fnap);
        }
        for (let ws of workspaceList) {
            if (!ws.isFolder && ws.path != "" && ws.path != null && folderPathAndNames.indexOf(ws.path) < 0) {
                console.log("Found workspace (" + ws.path + "/" + ws.name + ") with path not corresponding to any folder => Set path = ''.");
                ws.path = "";
                ws.saved = false;
                updateNeeded = true;
            }
        }
        if (updateNeeded) {
            networkManager.sendUpdates(() => { }, true);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW5jb25zaXN0ZW5jeUZpeGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NsaWVudC93b3Jrc3BhY2UvSW5jb25zaXN0ZW5jeUZpeGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUUzQyxNQUFNLE9BQU8sa0JBQWtCO0lBQzNCLEtBQUssQ0FBQyxhQUEwQixFQUFFLGNBQThCLEVBQUUsSUFBYztRQUM1RSxJQUFJLFlBQVksR0FBWSxLQUFLLENBQUM7UUFFbEMsMENBQTBDO1FBQzFDLEtBQUssSUFBSSxFQUFFLElBQUksYUFBYSxFQUFFO1lBQzFCLElBQUksRUFBRSxDQUFDLFFBQVEsSUFBSSxFQUFFLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUU1RCxPQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUMsSUFBSSxHQUFHLEdBQUcsR0FBRyxFQUFFLENBQUMsSUFBSSxHQUFHLGlGQUFpRixDQUFDLENBQUE7Z0JBRXBJLG9CQUFvQjtnQkFDcEIsSUFBSSxTQUFTLEdBQWMsSUFBSSxTQUFTLENBQUMsRUFBRSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUNyRSxTQUFTLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztnQkFDMUIsU0FBUyxDQUFDLElBQUksR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDO2dCQUN6QixhQUFhLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2dCQUU5QixjQUFjLENBQUMsbUJBQW1CLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxLQUFhLEVBQUUsRUFBRTtvQkFDaEYsSUFBRyxLQUFLLElBQUksSUFBSSxJQUFJLEtBQUssSUFBSSxFQUFFLEVBQUM7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QUFHLEtBQUssQ0FBQztnQkFDakIsWUFBWSxHQUFHLElBQUksQ0FBQzthQUN2QjtTQUNKO1FBR0QsSUFBRyxZQUFZLEVBQUM7WUFDWixjQUFjLENBQUMsV0FBVyxDQUFDLEdBQUUsRUFBRSxHQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztTQUM3QztJQUVMLENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5ldHdvcmtNYW5hZ2VyIH0gZnJvbSBcIi4uL2NvbW11bmljYXRpb24vTmV0d29ya01hbmFnZXIuanNcIjtcclxuaW1wb3J0IHsgTWFpbkJhc2UgfSBmcm9tIFwiLi4vbWFpbi9NYWluQmFzZS5qc1wiO1xyXG5pbXBvcnQgeyBXb3Jrc3BhY2UgfSBmcm9tIFwiLi9Xb3Jrc3BhY2UuanNcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBJbmNvbnNpc3RlbmN5Rml4ZXIge1xyXG4gICAgc3RhcnQod29ya3NwYWNlTGlzdDogV29ya3NwYWNlW10sIG5ldHdvcmtNYW5hZ2VyOiBOZXR3b3JrTWFuYWdlciwgbWFpbjogTWFpbkJhc2UpIHtcclxuICAgICAgICBsZXQgdXBkYXRlTmVlZGVkOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gICAgICAgIC8vIGlzIHRoZXJlIGEgZm9sZGVyIHdoaWNoIGNvbnRhaW5zIGZpbGVzP1xyXG4gICAgICAgIGZvciAobGV0IHdzIG9mIHdvcmtzcGFjZUxpc3QpIHtcclxuICAgICAgICAgICAgaWYgKHdzLmlzRm9sZGVyICYmIHdzLm1vZHVsZVN0b3JlLmdldE1vZHVsZXMoZmFsc2UpLmxlbmd0aCA+IDApIHtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkZvbGRlciBcIiArIHdzLnBhdGggKyBcIi9cIiArIHdzLm5hbWUgKyBcIiBjb250YWlucyBmaWxlcy4gLT4gTWFrZSBuZXcgZm9sZGVyIGFuZCB0cmFuc2Zvcm1pbmcgZXhpc3Rpbmcgb25lIHRvIHdvcmtzcGFjZS5cIilcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgbmV3IEZvbGRlclxyXG4gICAgICAgICAgICAgICAgbGV0IG5ld0ZvbGRlcjogV29ya3NwYWNlID0gbmV3IFdvcmtzcGFjZSh3cy5uYW1lLCBtYWluLCB3cy5vd25lcl9pZCk7XHJcbiAgICAgICAgICAgICAgICBuZXdGb2xkZXIuaXNGb2xkZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgbmV3Rm9sZGVyLnBhdGggPSB3cy5wYXRoO1xyXG4gICAgICAgICAgICAgICAgd29ya3NwYWNlTGlzdC5wdXNoKG5ld0ZvbGRlcik7XHJcblxyXG4gICAgICAgICAgICAgICAgbmV0d29ya01hbmFnZXIuc2VuZENyZWF0ZVdvcmtzcGFjZShuZXdGb2xkZXIsIG5ld0ZvbGRlci5vd25lcl9pZCwgKGVycm9yOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZihlcnJvciA9PSBudWxsIHx8IGVycm9yID09IFwiXCIpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlN1Y2Nlc3NmdWxseSBjcmVhdGVkIG5ldyBGb2xkZXIuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3IgY3JlYXRpbmcgZm9sZGVyOiBcIiArIGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyB0cmFuc2Zvcm0gb2xkIGZvbGRlciBpbnRvIHJlYWwgd29ya3NwYWNlXHJcbiAgICAgICAgICAgICAgICB3cy5pc0ZvbGRlciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgd3MubmFtZSArPSBcIiAod3MpXCI7XHJcbiAgICAgICAgICAgICAgICB3cy5zYXZlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlTmVlZGVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEFyZSB0aGVyZSBzZXZlcmFsIGZvbGRlcnMgd2l0aCBpZGVudGljYWwgcGF0aCBhbmQgbmFtZT9cclxuICAgICAgICBsZXQgZm9sZGVyTGlzdCA9IHdvcmtzcGFjZUxpc3QuZmlsdGVyKHdzID0+IHdzLmlzRm9sZGVyKTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgd3MxIG9mIGZvbGRlckxpc3QpIHtcclxuICAgICAgICAgICAgbGV0IGlkZW50aWNhbEZvbGRlcnM6IFdvcmtzcGFjZVtdID0gW107XHJcbiAgICAgICAgICAgIGZvciAobGV0IHdzMiBvZiBmb2xkZXJMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAod3MyICE9IHdzMSAmJiB3czIucGF0aCA9PSB3czEucGF0aCAmJiB3czIubmFtZSA9PSB3czEubmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkZW50aWNhbEZvbGRlcnMucHVzaCh3czIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpZGVudGljYWxGb2xkZXJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiXCIgKyAoaWRlbnRpY2FsRm9sZGVycy5sZW5ndGggKyAxKSArIFwiIGZvbGRlcnMgd2l0aCBuYW1lIFwiICsgd3MxLnBhdGggKyBcIi9cIiArIHdzMS5uYW1lICsgXCI9PiByZW5hbWluZyB0aGVtIHdpdGggc3VmZml4ZXMgKDEpLCAoMiksIC4uLlwiKTtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaWRlbnRpY2FsRm9sZGVycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkZW50aWNhbEZvbGRlcnNbaV0ubmFtZSArPSBcIiAoXCIgKyAoaSArIDEpICsgXCIpXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgaWRlbnRpY2FsRm9sZGVyc1tpXS5zYXZlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdXBkYXRlTmVlZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gSXMgdGhlcmUgYSB3b3Jrc3BhY2Ugd2hpY2ggYmVsb25ncyB0byBhIGZvbGRlciB0aGF0IGRvZXNuJ3QgZXhpc3Q/XHJcbiAgICAgICAgbGV0IGZvbGRlclBhdGhBbmROYW1lczogc3RyaW5nW10gPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBmb2xkZXIgb2YgZm9sZGVyTGlzdCkge1xyXG4gICAgICAgICAgICBsZXQgZm5hcCA9IGZvbGRlci5wYXRoO1xyXG4gICAgICAgICAgICBpZiAoZm5hcCAhPSBcIlwiICYmICFmbmFwLmVuZHNXaXRoKFwiL1wiKSkgZm5hcCArPSBcIi9cIjtcclxuICAgICAgICAgICAgZm5hcCArPSBmb2xkZXIubmFtZTtcclxuICAgICAgICAgICAgZm9sZGVyUGF0aEFuZE5hbWVzLnB1c2goZm5hcCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGxldCB3cyBvZiB3b3Jrc3BhY2VMaXN0KSB7XHJcbiAgICAgICAgICAgIGlmICghd3MuaXNGb2xkZXIgJiYgd3MucGF0aCAhPSBcIlwiICYmIHdzLnBhdGggIT0gbnVsbCAmJiBmb2xkZXJQYXRoQW5kTmFtZXMuaW5kZXhPZih3cy5wYXRoKSA8IDApIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRm91bmQgd29ya3NwYWNlIChcIiArIHdzLnBhdGggKyBcIi9cIiArIHdzLm5hbWUgKyBcIikgd2l0aCBwYXRoIG5vdCBjb3JyZXNwb25kaW5nIHRvIGFueSBmb2xkZXIgPT4gU2V0IHBhdGggPSAnJy5cIik7XHJcbiAgICAgICAgICAgICAgICB3cy5wYXRoID0gXCJcIjtcclxuICAgICAgICAgICAgICAgIHdzLnNhdmVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVOZWVkZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgaWYodXBkYXRlTmVlZGVkKXsgXHJcbiAgICAgICAgICAgIG5ldHdvcmtNYW5hZ2VyLnNlbmRVcGRhdGVzKCgpPT4ge30sIHRydWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbn0iXX0=