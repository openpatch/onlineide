import { booleanPrimitiveType, charPrimitiveType, doublePrimitiveType, floatPrimitiveType, intPrimitiveType, stringPrimitiveType, voidPrimitiveType } from "../compiler/types/PrimitiveTypes.js";
import { BaseModule } from "../compiler/parser/Module.js";
import { Klass, Interface, Visibility } from "../compiler/types/Class.js";
import { Enum } from "../compiler/types/Enum.js";
import { getDeclarationAsString } from "../compiler/types/DeclarationHelper.js";
import { defineMyJava } from "../main/gui/MyJava.js";
export class ApiDoc {
    start() {
        this.initEditor();
        this.initTypes();
        this.initClassDocumentation();
    }
    initEditor() {
        defineMyJava();
        monaco.editor.defineTheme('myCustomThemeDark', {
            base: 'vs-dark',
            inherit: true,
            rules: [
                { token: 'method', foreground: 'dcdcaa', fontStyle: 'italic' },
                { token: 'print', foreground: 'dcdcaa', fontStyle: 'italic bold' },
                { token: 'class', foreground: '3DC9B0' },
                { token: 'number', foreground: 'b5cea8' },
                { token: 'type', foreground: '499cd6' },
                { token: 'identifier', foreground: '9cdcfe' },
                { token: 'statement', foreground: 'bb96c0', fontStyle: 'bold' },
                { token: 'keyword', foreground: '68bed4', fontStyle: 'bold' },
            ],
            colors: {
                "editor.background": "#1e1e1e"
            }
        });
        monaco.editor.setTheme('myCustomThemeDark');
        monaco.editor.create(jQuery('#editordiv')[0], {
            language: "myJava"
        });
    }
    initClassDocumentation() {
        let b = booleanPrimitiveType;
        let basemodule = new BaseModule(null);
        let that = this;
        let typeList = basemodule.typeStore.typeList.filter((a) => a.identifier != null)
            .sort((a, b) => a.identifier.localeCompare(b.identifier));
        typeList.filter((type) => type instanceof Klass && !(type instanceof Enum)).forEach((type, index) => {
            let $menuItem = jQuery('<div class="jo_menu-class">' + type.identifier + '</div>');
            jQuery('#classes').append($menuItem);
            $menuItem.on('click', () => {
                that.showAPIHelp(type);
            });
        });
        typeList.filter((type) => type instanceof Interface).forEach((type, index) => {
            let $menuItem = jQuery('<div class="jo_menu-class">' + type.identifier + '</div>');
            jQuery('#interfaces').append($menuItem);
            $menuItem.on('click', () => {
                that.showAPIHelp(type);
            });
        });
        typeList.filter((type) => type instanceof Enum).forEach((type, index) => {
            let $menuItem = jQuery('<div class="jo_menu-class">' + type.identifier + '</div>');
            jQuery('#enums').append($menuItem);
            $menuItem.on('click', () => {
                that.showAPIHelp(type);
            });
        });
    }
    showAPIHelp(type) {
        let $main = jQuery('#main');
        $main.empty();
        let t = type;
        let $caption = jQuery('<div class="jo_type"></div>');
        $main.append($caption);
        monaco.editor.colorize(getDeclarationAsString(t, "", true), "myJava", {}).then((html) => { $caption.append(jQuery(html)); });
        if (t instanceof Klass)
            this.showConstructors(t);
        this.showMethods(t);
        if (t instanceof Klass)
            this.showAttributes(t);
    }
    showConstructors(t) {
        let $main = jQuery('#main');
        $main.append(jQuery('<div class="jo_constructor-heading">Konstruktoren:</div>'));
        let methods = t.methods.filter((m) => m.isConstructor);
        while (methods.length == 0 && t.baseClass != null) {
            t = t.baseClass;
            methods = methods.concat(t.getMethods(Visibility.protected).filter((m) => m.isConstructor));
        }
        methods.sort((a, b) => a.identifier.localeCompare(b.identifier));
        if (methods.length == 0) {
            $main.append(jQuery('<div class="jo_method">Keine</div>'));
        }
        else {
            for (let method of methods) {
                let $caption = jQuery(jQuery('<div class="jo_method"></div>'));
                $main.append($caption);
                monaco.editor.colorize(getDeclarationAsString(method, "", true), "myJava", {}).then((html) => { $caption.append(jQuery(html)); });
                if (method.documentation != null && method.documentation != "") {
                    $main.append(jQuery('<div class="jo_documentation">' + method.documentation + '</div>'));
                }
            }
        }
    }
    showMethods(t) {
        let $main = jQuery('#main');
        $main.append(jQuery('<div class="jo_method-heading">Methoden:</div>'));
        let methods;
        if (t instanceof Interface) {
            methods = t.methods.slice(0);
        }
        else {
            methods = t.getMethods(Visibility.protected).filter((m) => !m.isConstructor);
        }
        if (t instanceof Klass && t.staticClass != null) {
            methods = methods.concat(t.staticClass.getMethods(Visibility.protected).filter((m) => !m.isConstructor));
        }
        methods.sort((a, b) => a.identifier.localeCompare(b.identifier));
        if (methods.length == 0) {
            $main.append(jQuery('<div class="jo_method">Keine</div>'));
        }
        else {
            for (let method of methods) {
                let $caption = jQuery(jQuery('<div class="jo_method"></div>'));
                $main.append($caption);
                monaco.editor.colorize(getDeclarationAsString(method, "", true), "myJava", {}).then((html) => { $caption.append(jQuery(html)); });
                if (method.documentation != null && method.documentation != "") {
                    $main.append(jQuery('<div class="jo_documentation">' + method.documentation + '</div>'));
                }
            }
        }
    }
    showAttributes(t) {
        let $main = jQuery('#main');
        $main.append(jQuery('<div class="jo_attribute-heading">Attribute:</div>'));
        let attributes = t.getAttributes(Visibility.protected);
        if (t instanceof Klass && t.staticClass != null) {
            attributes = attributes.concat(t.staticClass.getAttributes(Visibility.protected));
        }
        attributes.sort((a, b) => a.identifier.localeCompare(b.identifier));
        if (attributes.length == 0) {
            $main.append(jQuery('<div class="jo_method">Keine</div>'));
        }
        else {
            for (let attribute of attributes) {
                let $caption = jQuery(jQuery('<div class="jo_method"></div>'));
                $main.append($caption);
                monaco.editor.colorize(getDeclarationAsString(attribute, "", true), "myJava", {}).then((html) => { $caption.append(jQuery(html)); });
                if (attribute.documentation != null && attribute.documentation != "") {
                    $main.append(jQuery('<div class="jo_documentation">' + attribute.documentation + '</div>'));
                }
            }
        }
    }
    initTypes() {
        voidPrimitiveType.init();
        intPrimitiveType.init();
        floatPrimitiveType.init();
        doublePrimitiveType.init();
        booleanPrimitiveType.init();
        stringPrimitiveType.init();
        charPrimitiveType.init();
    }
}
jQuery(() => {
    //@ts-ignore
    window.require.config({ paths: { 'vs': 'lib/monaco-editor/dev/vs' } });
    //@ts-ignore
    window.require.config({
        'vs/nls': {
            availableLanguages: {
                '*': 'de'
            }
        },
        ignoreDuplicateModules: ["vs/editor/editor.main"]
    });
    //@ts-ignore
    window.require(['vs/editor/editor.main'], function () {
        new ApiDoc().start();
        // main.loadWorkspace();
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXBpRG9jLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NsaWVudC9oZWxwL0FwaURvYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsaUJBQWlCLEVBQUUsbUJBQW1CLEVBQUUsa0JBQWtCLEVBQUUsZ0JBQWdCLEVBQUUsbUJBQW1CLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUNqTSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDMUQsT0FBTyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFFMUUsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQ2hGLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUVyRCxNQUFNLE9BQU8sTUFBTTtJQUNmLEtBQUs7UUFDRCxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDbEIsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO0lBQ2xDLENBQUM7SUFFRCxVQUFVO1FBRU4sWUFBWSxFQUFFLENBQUM7UUFFZixNQUFNLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxtQkFBbUIsRUFBRTtZQUMzQyxJQUFJLEVBQUUsU0FBUztZQUNmLE9BQU8sRUFBRSxJQUFJO1lBQ2IsS0FBSyxFQUFFO2dCQUNILEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUU7Z0JBQzlELEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxhQUFhLEVBQUU7Z0JBQ2xFLEVBQUUsS0FB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ZXNDb250ZW50IjpbImltcG9ydCB7IGJvb2xlYW5QcmltaXRpdmVUeXBlLCBjaGFyUHJpbWl0aXZlVHlwZSwgZG91YmxlUHJpbWl0aXZlVHlwZSwgZmxvYXRQcmltaXRpdmVUeXBlLCBpbnRQcmltaXRpdmVUeXBlLCBzdHJpbmdQcmltaXRpdmVUeXBlLCB2b2lkUHJpbWl0aXZlVHlwZSB9IGZyb20gXCIuLi9jb21waWxlci90eXBlcy9QcmltaXRpdmVUeXBlcy5qc1wiO1xyXG5pbXBvcnQgeyBCYXNlTW9kdWxlIH0gZnJvbSBcIi4uL2NvbXBpbGVyL3BhcnNlci9Nb2R1bGUuanNcIjtcclxuaW1wb3J0IHsgS2xhc3MsIEludGVyZmFjZSwgVmlzaWJpbGl0eSB9IGZyb20gXCIuLi9jb21waWxlci90eXBlcy9DbGFzcy5qc1wiO1xyXG5pbXBvcnQgeyBNZXRob2QsIFR5cGUgfSBmcm9tIFwiLi4vY29tcGlsZXIvdHlwZXMvVHlwZXMuanNcIjtcclxuaW1wb3J0IHsgRW51bSB9IGZyb20gXCIuLi9jb21waWxlci90eXBlcy9FbnVtLmpzXCI7XHJcbmltcG9ydCB7IGdldERlY2xhcmF0aW9uQXNTdHJpbmcgfSBmcm9tIFwiLi4vY29tcGlsZXIvdHlwZXMvRGVjbGFyYXRpb25IZWxwZXIuanNcIjtcclxuaW1wb3J0IHsgZGVmaW5lTXlKYXZhIH0gZnJvbSBcIi4uL21haW4vZ3VpL015SmF2YS5qc1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEFwaURvYyB7XHJcbiAgICBzdGFydCgpIHtcclxuICAgICAgICB0aGlzLmluaXRFZGl0b3IoKTtcclxuICAgICAgICB0aGlzLmluaXRUeXBlcygpO1xyXG4gICAgICAgIHRoaXMuaW5pdENsYXNzRG9jdW1lbnRhdGlvbigpO1xyXG4gICAgfVxyXG5cclxuICAgIGluaXRFZGl0b3IoKXtcclxuXHJcbiAgICAgICAgZGVmaW5lTXlKYXZhKCk7XHJcblxyXG4gICAgICAgIG1vbmFjby5lZGl0b3IuZGVmaW5lVGhlbWUoJ215Q3VzdG9tVGhlbWVEYXJrJywge1xyXG4gICAgICAgICAgICBiYXNlOiAndnMtZGFyaycsIC8vIGNhbiBhbHNvIGJlIHZzLWRhcmsgb3IgaGMtYmxhY2tcclxuICAgICAgICAgICAgaW5oZXJpdDogdHJ1ZSwgLy8gY2FuIGFsc28gYmUgZmFsc2UgdG8gY29tcGxldGVseSByZXBsYWNlIHRoZSBidWlsdGluIHJ1bGVzXHJcbiAgICAgICAgICAgIHJ1bGVzOiBbXHJcbiAgICAgICAgICAgICAgICB7IHRva2VuOiAnbWV0aG9kJywgZm9yZWdyb3VuZDogJ2RjZGNhYScsIGZvbnRTdHlsZTogJ2l0YWxpYycgfSxcclxuICAgICAgICAgICAgICAgIHsgdG9rZW46ICdwcmludCcsIGZvcmVncm91bmQ6ICdkY2RjYWEnLCBmb250U3R5bGU6ICdpdGFsaWMgYm9sZCcgfSxcclxuICAgICAgICAgICAgICAgIHsgdG9rZW46ICdjbGFzcycsIGZvcmVncm91bmQ6ICczREM5QjAnIH0sXHJcbiAgICAgICAgICAgICAgICB7IHRva2VuOiAnbnVtYmVyJywgZm9yZWdyb3VuZDogJ2I1Y2VhOCcgfSxcclxuICAgICAgICAgICAgICAgIHsgdG9rZW46ICd0eXBlJywgZm9yZWdyb3VuZDogJzQ5OWNkNicgfSxcclxuICAgICAgICAgICAgICAgIHsgdG9rZW46ICdpZGVudGlmaWVyJywgZm9yZWdyb3VuZDogJzljZGNmZScgfSxcclxuICAgICAgICAgICAgICAgIHsgdG9rZW46ICdzdGF0ZW1lbnQnLCBmb3JlZ3JvdW5kOiAnYmI5NmMwJywgZm9udFN0eWxlOiAnYm9sZCcgfSxcclxuICAgICAgICAgICAgICAgIHsgdG9rZW46ICdrZXl3b3JkJywgZm9yZWdyb3VuZDogJzY4YmVkNCcsIGZvbnRTdHlsZTogJ2JvbGQnIH0sXHJcbiAgICAgICAgICAgICAgICAvLyB7IHRva2VuOiAnY29tbWVudC5qcycsIGZvcmVncm91bmQ6ICcwMDg4MDAnLCBmb250U3R5bGU6ICdib2xkIGl0YWxpYyB1bmRlcmxpbmUnIH0sXHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgIGNvbG9yczoge1xyXG4gICAgICAgICAgICAgICAgXCJlZGl0b3IuYmFja2dyb3VuZFwiOiBcIiMxZTFlMWVcIlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIG1vbmFjby5lZGl0b3Iuc2V0VGhlbWUoJ215Q3VzdG9tVGhlbWVEYXJrJyk7XHJcblxyXG4gICAgICAgIG1vbmFjby5lZGl0b3IuY3JlYXRlKGpRdWVyeSgnI2VkaXRvcmRpdicpWzBdLCB7XHJcbiAgICAgICAgICAgIGxhbmd1YWdlOiBcIm15SmF2YVwiXHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuICAgIH1cclxuXHJcbiAgICBpbml0Q2xhc3NEb2N1bWVudGF0aW9uKCkge1xyXG4gICAgICAgIGxldCBiID0gYm9vbGVhblByaW1pdGl2ZVR5cGU7XHJcbiAgICAgICAgbGV0IGJhc2Vtb2R1bGU6IEJhc2VNb2R1bGUgPSBuZXcgQmFzZU1vZHVsZShudWxsKTtcclxuICAgICAgICBsZXQgdGhhdCA9IHRoaXM7XHJcblxyXG4gICAgICAgIGxldCB0eXBlTGlzdCA9IGJhc2Vtb2R1bGUudHlwZVN0b3JlLnR5cGVMaXN0LmZpbHRlcigoYTogVHlwZSkgPT4gYS5pZGVudGlmaWVyICE9IG51bGwpXHJcbiAgICAgICAgICAgIC5zb3J0KFxyXG4gICAgICAgICAgICAgICAgKGE6IFR5cGUsIGI6IFR5cGUpID0+IGEuaWRlbnRpZmllci5sb2NhbGVDb21wYXJlKGIuaWRlbnRpZmllcikpO1xyXG5cclxuXHJcbiAgICAgICAgdHlwZUxpc3QuZmlsdGVyKCh0eXBlKSA9PiB0eXBlIGluc3RhbmNlb2YgS2xhc3MgJiYgISh0eXBlIGluc3RhbmNlb2YgRW51bSkpLmZvckVhY2goKHR5cGU6IFR5cGUsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCAkbWVudUl0ZW0gPSBqUXVlcnkoJzxkaXYgY2xhc3M9XCJqb19tZW51LWNsYXNzXCI+JyArIHR5cGUuaWRlbnRpZmllciArICc8L2Rpdj4nKTtcclxuICAgICAgICAgICAgalF1ZXJ5KCcjY2xhc3NlcycpLmFwcGVuZCgkbWVudUl0ZW0pXHJcbiAgICAgICAgICAgICRtZW51SXRlbS5vbignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGF0LnNob3dBUElIZWxwKHR5cGUpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0eXBlTGlzdC5maWx0ZXIoKHR5cGUpID0+IHR5cGUgaW5zdGFuY2VvZiBJbnRlcmZhY2UpLmZvckVhY2goKHR5cGU6IFR5cGUsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCAkbWVudUl0ZW0gPSBqUXVlcnkoJzxkaXYgY2xhc3M9XCJqb19tZW51LWNsYXNzXCI+JyArIHR5cGUuaWRlbnRpZmllciArICc8L2Rpdj4nKTtcclxuICAgICAgICAgICAgalF1ZXJ5KCcjaW50ZXJmYWNlcycpLmFwcGVuZCgkbWVudUl0ZW0pXHJcbiAgICAgICAgICAgICRtZW51SXRlbS5vbignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGF0LnNob3dBUElIZWxwKHR5cGUpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0eXBlTGlzdC5maWx0ZXIoKHR5cGUpID0+IHR5cGUgaW5zdGFuY2VvZiBFbnVtKS5mb3JFYWNoKCh0eXBlOiBUeXBlLCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgJG1lbnVJdGVtID0galF1ZXJ5KCc8ZGl2IGNsYXNzPVwiam9fbWVudS1jbGFzc1wiPicgKyB0eXBlLmlkZW50aWZpZXIgKyAnPC9kaXY+Jyk7XHJcbiAgICAgICAgICAgIGpRdWVyeSgnI2VudW1zJykuYXBwZW5kKCRtZW51SXRlbSlcclxuICAgICAgICAgICAgJG1lbnVJdGVtLm9uKCdjbGljaycsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoYXQuc2hvd0FQSUhlbHAodHlwZSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuICAgIH1cclxuXHJcbiAgICBzaG93QVBJSGVscCh0eXBlOiBUeXBlKSB7XHJcbiAgICAgICAgbGV0ICRtYWluID0galF1ZXJ5KCcjbWFpbicpO1xyXG4gICAgICAgICRtYWluLmVtcHR5KCk7XHJcblxyXG4gICAgICAgIGxldCB0ID0gPEtsYXNzIHwgSW50ZXJmYWNlIHwgRW51bT50eXBlO1xyXG4gICAgICAgIGxldCAkY2FwdGlvbiA9IGpRdWVyeSgnPGRpdiBjbGFzcz1cImpvX3R5cGVcIj48L2Rpdj4nKTtcclxuICAgICAgICAkbWFpbi5hcHBlbmQoJGNhcHRpb24pO1xyXG4gICAgICAgIG1vbmFjby5lZGl0b3IuY29sb3JpemUoZ2V0RGVjbGFyYXRpb25Bc1N0cmluZyh0LCBcIlwiLCB0cnVlKSwgXCJteUphdmFcIiwge30pLnRoZW4oXHJcbiAgICAgICAgICAgIChodG1sKSA9PiB7JGNhcHRpb24uYXBwZW5kKGpRdWVyeShodG1sKSl9XHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgaWYodCBpbnN0YW5jZW9mIEtsYXNzKSB0aGlzLnNob3dDb25zdHJ1Y3RvcnModCk7XHJcbiAgICAgICAgdGhpcy5zaG93TWV0aG9kcyh0KTtcclxuICAgICAgICBpZih0IGluc3RhbmNlb2YgS2xhc3MpIHRoaXMuc2hvd0F0dHJpYnV0ZXModCk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHNob3dDb25zdHJ1Y3RvcnModDogS2xhc3Mpe1xyXG4gICAgICAgIGxldCAkbWFpbiA9IGpRdWVyeSgnI21haW4nKTtcclxuICAgICAgICAkbWFpbi5hcHBlbmQoalF1ZXJ5KCc8ZGl2IGNsYXNzPVwiam9fY29uc3RydWN0b3ItaGVhZGluZ1wiPktvbnN0cnVrdG9yZW46PC9kaXY+JykpO1xyXG4gICAgICAgIGxldCBtZXRob2RzID0gdC5tZXRob2RzLmZpbHRlcigobSkgPT4gbS5pc0NvbnN0cnVjdG9yKTtcclxuXHJcbiAgICAgICAgd2hpbGUobWV0aG9kcy5sZW5ndGggPT0gMCAmJiB0LmJhc2VDbGFzcyAhPSBudWxsKXtcclxuICAgICAgICAgICAgdCA9IHQuYmFzZUNsYXNzO1xyXG4gICAgICAgICAgICBtZXRob2RzID0gbWV0aG9kcy5jb25jYXQodC5nZXRNZXRob2RzKFZpc2liaWxpdHkucHJvdGVjdGVkKS5maWx0ZXIoKG0pID0+IG0uaXNDb25zdHJ1Y3RvcikpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbWV0aG9kcy5zb3J0KChhLCBiKSA9PiBhLmlkZW50aWZpZXIubG9jYWxlQ29tcGFyZShiLmlkZW50aWZpZXIpKTtcclxuXHJcbiAgICAgICAgaWYobWV0aG9kcy5sZW5ndGggPT0gMCl7XHJcbiAgICAgICAgICAgICRtYWluLmFwcGVuZChqUXVlcnkoJzxkaXYgY2xhc3M9XCJqb19tZXRob2RcIj5LZWluZTwvZGl2PicpKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBmb3IobGV0IG1ldGhvZCBvZiBtZXRob2RzKXtcclxuICAgICAgICAgICAgICAgIGxldCAkY2FwdGlvbiA9IGpRdWVyeShqUXVlcnkoJzxkaXYgY2xhc3M9XCJqb19tZXRob2RcIj48L2Rpdj4nKSk7XHJcbiAgICAgICAgICAgICAgICAkbWFpbi5hcHBlbmQoJGNhcHRpb24pO1xyXG4gICAgICAgICAgICAgICAgbW9uYWNvLmVkaXRvci5jb2xvcml6ZShnZXREZWNsYXJhdGlvbkFzU3RyaW5nKG1ldGhvZCwgXCJcIiwgdHJ1ZSksIFwibXlKYXZhXCIsIHt9KS50aGVuKFxyXG4gICAgICAgICAgICAgICAgICAgIChodG1sKSA9PiB7JGNhcHRpb24uYXBwZW5kKGpRdWVyeShodG1sKSl9XHJcbiAgICAgICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmKG1ldGhvZC5kb2N1bWVudGF0aW9uICE9IG51bGwgJiYgbWV0aG9kLmRvY3VtZW50YXRpb24gIT0gXCJcIil7XHJcbiAgICAgICAgICAgICAgICAgICAgJG1haW4uYXBwZW5kKGpRdWVyeSgnPGRpdiBjbGFzcz1cImpvX2RvY3VtZW50YXRpb25cIj4nICsgbWV0aG9kLmRvY3VtZW50YXRpb24gKyAnPC9kaXY+JykpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgc2hvd01ldGhvZHModDogS2xhc3MgfCBJbnRlcmZhY2UgfCBFbnVtKXtcclxuICAgICAgICBsZXQgJG1haW4gPSBqUXVlcnkoJyNtYWluJyk7XHJcbiAgICAgICAgJG1haW4uYXBwZW5kKGpRdWVyeSgnPGRpdiBjbGFzcz1cImpvX21ldGhvZC1oZWFkaW5nXCI+TWV0aG9kZW46PC9kaXY+JykpO1xyXG4gICAgICAgIGxldCBtZXRob2RzOiBNZXRob2RbXTtcclxuICAgICAgICBpZih0IGluc3RhbmNlb2YgSW50ZXJmYWNlKXtcclxuICAgICAgICAgICAgbWV0aG9kcyA9IHQubWV0aG9kcy5zbGljZSgwKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBtZXRob2RzID0gdC5nZXRNZXRob2RzKFZpc2liaWxpdHkucHJvdGVjdGVkKS5maWx0ZXIoKG0pID0+ICFtLmlzQ29uc3RydWN0b3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZih0IGluc3RhbmNlb2YgS2xhc3MgJiYgdC5zdGF0aWNDbGFzcyAhPSBudWxsKXtcclxuICAgICAgICAgICAgbWV0aG9kcyA9IG1ldGhvZHMuY29uY2F0KHQuc3RhdGljQ2xhc3MuZ2V0TWV0aG9kcyhWaXNpYmlsaXR5LnByb3RlY3RlZCkuZmlsdGVyKChtKSA9PiAhbS5pc0NvbnN0cnVjdG9yKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBtZXRob2RzLnNvcnQoKGEsIGIpID0+IGEuaWRlbnRpZmllci5sb2NhbGVDb21wYXJlKGIuaWRlbnRpZmllcikpO1xyXG5cclxuICAgICAgICBpZihtZXRob2RzLmxlbmd0aCA9PSAwKXtcclxuICAgICAgICAgICAgJG1haW4uYXBwZW5kKGpRdWVyeSgnPGRpdiBjbGFzcz1cImpvX21ldGhvZFwiPktlaW5lPC9kaXY+JykpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGZvcihsZXQgbWV0aG9kIG9mIG1ldGhvZHMpe1xyXG4gICAgICAgICAgICAgICAgbGV0ICRjYXB0aW9uID0galF1ZXJ5KGpRdWVyeSgnPGRpdiBjbGFzcz1cImpvX21ldGhvZFwiPjwvZGl2PicpKTtcclxuICAgICAgICAgICAgICAgICRtYWluLmFwcGVuZCgkY2FwdGlvbik7XHJcbiAgICAgICAgICAgICAgICBtb25hY28uZWRpdG9yLmNvbG9yaXplKGdldERlY2xhcmF0aW9uQXNTdHJpbmcobWV0aG9kLCBcIlwiLCB0cnVlKSwgXCJteUphdmFcIiwge30pLnRoZW4oXHJcbiAgICAgICAgICAgICAgICAgICAgKGh0bWwpID0+IHskY2FwdGlvbi5hcHBlbmQoalF1ZXJ5KGh0bWwpKX1cclxuICAgICAgICAgICAgICAgICk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYobWV0aG9kLmRvY3VtZW50YXRpb24gIT0gbnVsbCAmJiBtZXRob2QuZG9jdW1lbnRhdGlvbiAhPSBcIlwiKXtcclxuICAgICAgICAgICAgICAgICAgICAkbWFpbi5hcHBlbmQoalF1ZXJ5KCc8ZGl2IGNsYXNzPVwiam9fZG9jdW1lbnRhdGlvblwiPicgKyBtZXRob2QuZG9jdW1lbnRhdGlvbiArICc8L2Rpdj4nKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9ICAgICBcclxuICAgIH1cclxuXHJcbiAgICBzaG93QXR0cmlidXRlcyh0OiBLbGFzcyl7XHJcbiAgICAgICAgbGV0ICRtYWluID0galF1ZXJ5KCcjbWFpbicpO1xyXG4gICAgICAgICRtYWluLmFwcGVuZChqUXVlcnkoJzxkaXYgY2xhc3M9XCJqb19hdHRyaWJ1dGUtaGVhZGluZ1wiPkF0dHJpYnV0ZTo8L2Rpdj4nKSk7XHJcbiAgICAgICAgbGV0IGF0dHJpYnV0ZXMgPSB0LmdldEF0dHJpYnV0ZXMoVmlzaWJpbGl0eS5wcm90ZWN0ZWQpO1xyXG4gICAgICAgIGlmKHQgaW5zdGFuY2VvZiBLbGFzcyAmJiB0LnN0YXRpY0NsYXNzICE9IG51bGwpe1xyXG4gICAgICAgICAgICBhdHRyaWJ1dGVzID0gYXR0cmlidXRlcy5jb25jYXQodC5zdGF0aWNDbGFzcy5nZXRBdHRyaWJ1dGVzKFZpc2liaWxpdHkucHJvdGVjdGVkKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhdHRyaWJ1dGVzLnNvcnQoKGEsIGIpID0+IGEuaWRlbnRpZmllci5sb2NhbGVDb21wYXJlKGIuaWRlbnRpZmllcikpO1xyXG5cclxuICAgICAgICBpZihhdHRyaWJ1dGVzLmxlbmd0aCA9PSAwKXtcclxuICAgICAgICAgICAgJG1haW4uYXBwZW5kKGpRdWVyeSgnPGRpdiBjbGFzcz1cImpvX21ldGhvZFwiPktlaW5lPC9kaXY+JykpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGZvcihsZXQgYXR0cmlidXRlIG9mIGF0dHJpYnV0ZXMpe1xyXG4gICAgICAgICAgICAgICAgbGV0ICRjYXB0aW9uID0galF1ZXJ5KGpRdWVyeSgnPGRpdiBjbGFzcz1cImpvX21ldGhvZFwiPjwvZGl2PicpKTtcclxuICAgICAgICAgICAgICAgICRtYWluLmFwcGVuZCgkY2FwdGlvbik7XHJcbiAgICAgICAgICAgICAgICBtb25hY28uZWRpdG9yLmNvbG9yaXplKGdldERlY2xhcmF0aW9uQXNTdHJpbmcoYXR0cmlidXRlLCBcIlwiLCB0cnVlKSwgXCJteUphdmFcIiwge30pLnRoZW4oXHJcbiAgICAgICAgICAgICAgICAgICAgKGh0bWwpID0+IHskY2FwdGlvbi5hcHBlbmQoalF1ZXJ5KGh0bWwpKX1cclxuICAgICAgICAgICAgICAgICk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYoYXR0cmlidXRlLmRvY3VtZW50YXRpb24gIT0gbnVsbCAmJiBhdHRyaWJ1dGUuZG9jdW1lbnRhdGlvbiAhPSBcIlwiKXtcclxuICAgICAgICAgICAgICAgICAgICAkbWFpbi5hcHBlbmQoalF1ZXJ5KCc8ZGl2IGNsYXNzPVwiam9fZG9jdW1lbnRhdGlvblwiPicgKyBhdHRyaWJ1dGUuZG9jdW1lbnRhdGlvbiArICc8L2Rpdj4nKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9ICAgICBcclxuICAgIH1cclxuXHJcbiAgICBpbml0VHlwZXMoKSB7XHJcbiAgICAgICAgdm9pZFByaW1pdGl2ZVR5cGUuaW5pdCgpO1xyXG4gICAgICAgIGludFByaW1pdGl2ZVR5cGUuaW5pdCgpO1xyXG4gICAgICAgIGZsb2F0UHJpbWl0aXZlVHlwZS5pbml0KCk7XHJcbiAgICAgICAgZG91YmxlUHJpbWl0aXZlVHlwZS5pbml0KCk7XHJcbiAgICAgICAgYm9vbGVhblByaW1pdGl2ZVR5cGUuaW5pdCgpO1xyXG4gICAgICAgIHN0cmluZ1ByaW1pdGl2ZVR5cGUuaW5pdCgpO1xyXG4gICAgICAgIGNoYXJQcmltaXRpdmVUeXBlLmluaXQoKTtcclxuICAgIH1cclxuXHJcbn1cclxuXHJcbmpRdWVyeSgoKSA9PiB7IFxyXG4gICAgXHJcbiAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgd2luZG93LnJlcXVpcmUuY29uZmlnKHsgcGF0aHM6IHsgJ3ZzJzogJ2xpYi9tb25hY28tZWRpdG9yL2Rldi92cycgfSB9KTtcclxuICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICB3aW5kb3cucmVxdWlyZS5jb25maWcoe1xyXG4gICAgICAgICAgICAndnMvbmxzJzoge1xyXG4gICAgICAgICAgICAgICAgYXZhaWxhYmxlTGFuZ3VhZ2VzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgJyonOiAnZGUnXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGlnbm9yZUR1cGxpY2F0ZU1vZHVsZXM6IFtcInZzL2VkaXRvci9lZGl0b3IubWFpblwiXVxyXG4gICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgd2luZG93LnJlcXVpcmUoWyd2cy9lZGl0b3IvZWRpdG9yLm1haW4nXSwgZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgbmV3IEFwaURvYygpLnN0YXJ0KCk7IFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIG1haW4ubG9hZFdvcmtzcGFjZSgpO1xyXG4gICAgXHJcbiAgICBcclxuICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgXHJcbiAgICBcclxufSk7Il19