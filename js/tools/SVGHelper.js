export class SVGHelper {
    constructor(width = "0", height = "0") {
        this.inlineStyles = {};
        let ns = 'http://www.w3.org/2000/svg';
        this.svg = document.createElementNS(ns, 'svg');
        jQuery(this.svg).css('pointer-events', 'none');
        this.setTopLeft("0", "0");
        this.svg.setAttributeNS(null, 'width', width);
        this.svg.setAttributeNS(null, 'height', height);
    }
    find(selector) {
        return jQuery(this.svg).find(selector);
    }
    getSVG() {
        return this.svg;
    }
    /**
     * Inserts new SVG Element into given htmlElement
     */
    appendToHtmlElement(htmlElement) {
        // this.svg.setAttributeNS(null, 'id', 'svgtest');
        //xmlns="http://www.w3.org/2000/svg" version="1.1"
        //this.svg.setAttributeNS(null, "xmlns", "http://www.w3.org/2000/svg");
        //this.svg.setAttributeNS(null, "version", "1.1");
        htmlElement.appendChild(this.svg);
        return this;
    }
    setTopLeft(top, left) {
        let $svg = jQuery(this.svg);
        $svg.css({
            top: top,
            left: left,
            position: "absolute"
        });
    }
    setSize(width, height) {
        let $svg = jQuery(this.svg);
        $svg.css({
            width: width,
            height: height
        });
    }
    setAttributes(element = null, attributes) {
        if (element == null) {
            element = this.svg;
        }
        for (let key in attributes) {
            element.setAttributeNS(null, key, attributes[key]);
        }
        ;
    }
    insertElement(name, parent = null, attributes) {
        let ns = 'http://www.w3.org/2000/svg';
        let element = document.createElementNS(ns, name);
        if (parent == null) {
            parent = this.svg;
        }
        this.setAttributes(element, attributes);
        parent.appendChild(element);
        return element;
    }
    insertStyleElement(styles = null) {
        let ns = 'http://www.w3.org/2000/svg';
        if (this.style == null) {
            this.defs = document.createElementNS(ns, 'defs');
            this.style = document.createElementNS(ns, 'style');
            this.defs.appendChild(this.style);
            this.svg.appendChild(this.defs);
        }
        if (styles != null) {
            this.inlineStyles = styles;
            this.refreshInlineStyles();
        }
        return this;
    }
    refreshInlineStyles() {
        let s = "";
        for (let selector in this.inlineStyles) {
            let stylesForSelector = this.inlineStyles[selector];
            if (stylesForSelector != null) {
                s += selector + "{\n";
                for (let key in stylesForSelector) {
                    s += "   " + key + ":" + stylesForSelector[key] + ";\n";
                }
                s += "}\n";
            }
            else {
                s += selector + "\n";
            }
        }
        this.style.textContent = s;
    }
    setStyle(selector, key, value, refresh = true) {
        if (this.style == null) {
            this.insertStyleElement();
        }
        this.setStyleIntern(selector, key, value, refresh);
    }
    setStyleIntern(selector, key, value, refresh = true) {
        let styleForSelector = this.inlineStyles[selector];
        if (styleForSelector == null) {
            this.inlineStyles[selector] = {};
        }
        this.inlineStyles[selector][key] = value;
        if (refresh) {
            this.refreshInlineStyles();
        }
    }
    setStyles(styles = null) {
        if (this.style == null) {
            this.insertStyleElement();
        }
        for (let selector in styles) {
            let stylesForSelector = styles[selector];
            for (let key in stylesForSelector) {
                let value = stylesForSelector[key];
                this.setStyleIntern(selector, key, value, false);
            }
        }
        this.refreshInlineStyles();
        return this;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU1ZHSGVscGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NsaWVudC90b29scy9TVkdIZWxwZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTSxPQUFPLFNBQVM7SUFnQmxCLFlBQVksUUFBZ0IsR0FBRyxFQUFFLFNBQWlCLEdBQUc7UUFWckQsaUJBQVksR0FBc0QsRUFBRSxDQUFDO1FBV2pFLElBQUksRUFBRSxHQUFHLDRCQUE0QixDQUFDO1FBQ3RDLElBQUksQ0FBQyxHQUFHLEdBQUcsUUFBUSxDQUFDLGVBQWUsQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDL0MsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFFL0MsSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFFMUIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQztRQUM5QyxJQUFJLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFqQk0sSUFBSSxDQUFDLFFBQWdCO1FBQ3hCLE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDM0MsQ0FBQztJQUVNLE1BQU07UUFDVCxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUM7SUFDcEIsQ0FBQztJQWFEOztPQUVHO0lBQ0ksbUJBQW1CLENBQUMsV0FBb0I7UUFHM0Msa0RBQWtEO1FBQ2xELGtEQUFrRDtRQUNsRCx1RUFBdUU7UUFDdkUsa0RBQWtEO1FBQ2xELFdBQVcsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRWxDLE9B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R0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFekMsS0FBSyxJQUFJLEdBQUcsSUFBSSxpQkFBaUIsRUFBRTtnQkFDL0IsSUFBSSxLQUFLLEdBQUcsaUJBQWlCLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ25DLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7YUFDcEQ7U0FFSjtRQUVELElBQUksQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO1FBRTNCLE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7Q0FLSiIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBTVkdIZWxwZXIge1xyXG5cclxuICAgIHN2ZzogRWxlbWVudDtcclxuICAgIGRlZnM6IEVsZW1lbnQ7XHJcbiAgICBzdHlsZTogRWxlbWVudDtcclxuXHJcbiAgICBpbmxpbmVTdHlsZXM6IHsgW3NlbGVjdG9yOiBzdHJpbmddOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9IH0gPSB7fTtcclxuXHJcbiAgICBwdWJsaWMgZmluZChzZWxlY3Rvcjogc3RyaW5nKTogSlF1ZXJ5PEVsZW1lbnQ+IHtcclxuICAgICAgICByZXR1cm4galF1ZXJ5KHRoaXMuc3ZnKS5maW5kKHNlbGVjdG9yKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0U1ZHKCk6IEVsZW1lbnQge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnN2ZztcclxuICAgIH1cclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih3aWR0aDogc3RyaW5nID0gXCIwXCIsIGhlaWdodDogc3RyaW5nID0gXCIwXCIpIHtcclxuICAgICAgICBsZXQgbnMgPSAnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnO1xyXG4gICAgICAgIHRoaXMuc3ZnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKG5zLCAnc3ZnJyk7XHJcbiAgICAgICAgalF1ZXJ5KHRoaXMuc3ZnKS5jc3MoJ3BvaW50ZXItZXZlbnRzJywgJ25vbmUnKTtcclxuXHJcbiAgICAgICAgdGhpcy5zZXRUb3BMZWZ0KFwiMFwiLCBcIjBcIik7XHJcblxyXG4gICAgICAgIHRoaXMuc3ZnLnNldEF0dHJpYnV0ZU5TKG51bGwsICd3aWR0aCcsIHdpZHRoKTtcclxuICAgICAgICB0aGlzLnN2Zy5zZXRBdHRyaWJ1dGVOUyhudWxsLCAnaGVpZ2h0JywgaGVpZ2h0KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEluc2VydHMgbmV3IFNWRyBFbGVtZW50IGludG8gZ2l2ZW4gaHRtbEVsZW1lbnRcclxuICAgICAqL1xyXG4gICAgcHVibGljIGFwcGVuZFRvSHRtbEVsZW1lbnQoaHRtbEVsZW1lbnQ6IEVsZW1lbnQpOiBTVkdIZWxwZXIge1xyXG5cclxuXHJcbiAgICAgICAgLy8gdGhpcy5zdmcuc2V0QXR0cmlidXRlTlMobnVsbCwgJ2lkJywgJ3N2Z3Rlc3QnKTtcclxuICAgICAgICAvL3htbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB2ZXJzaW9uPVwiMS4xXCJcclxuICAgICAgICAvL3RoaXMuc3ZnLnNldEF0dHJpYnV0ZU5TKG51bGwsIFwieG1sbnNcIiwgXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiKTtcclxuICAgICAgICAvL3RoaXMuc3ZnLnNldEF0dHJpYnV0ZU5TKG51bGwsIFwidmVyc2lvblwiLCBcIjEuMVwiKTtcclxuICAgICAgICBodG1sRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLnN2Zyk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0VG9wTGVmdCh0b3A6IHN0cmluZywgbGVmdDogc3RyaW5nKSB7XHJcbiAgICAgICAgbGV0ICRzdmcgPSBqUXVlcnkodGhpcy5zdmcpO1xyXG4gICAgICAgICRzdmcuY3NzKHtcclxuICAgICAgICAgICAgdG9wOiB0b3AsXHJcbiAgICAgICAgICAgIGxlZnQ6IGxlZnQsXHJcbiAgICAgICAgICAgIHBvc2l0aW9uOiBcImFic29sdXRlXCJcclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldFNpemUod2lkdGg6IHN0cmluZywgaGVpZ2h0OiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgJHN2ZyA9IGpRdWVyeSh0aGlzLnN2Zyk7XHJcbiAgICAgICAgJHN2Zy5jc3Moe1xyXG4gICAgICAgICAgICB3aWR0aDogd2lkdGgsXHJcbiAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldEF0dHJpYnV0ZXMoZWxlbWVudDogRWxlbWVudCA9IG51bGwsIGF0dHJpYnV0ZXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0pIHtcclxuICAgICAgICBpZiAoZWxlbWVudCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGVsZW1lbnQgPSB0aGlzLnN2ZztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAobGV0IGtleSBpbiBhdHRyaWJ1dGVzKSB7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlTlMobnVsbCwga2V5LCBhdHRyaWJ1dGVzW2tleV0pO1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgaW5zZXJ0RWxlbWVudChuYW1lOiBzdHJpbmcsIHBhcmVudDogRWxlbWVudCA9IG51bGwsIGF0dHJpYnV0ZXM/OiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9KTogRWxlbWVudCB7XHJcblxyXG4gICAgICAgIGxldCBucyA9ICdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zyc7XHJcbiAgICAgICAgbGV0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMobnMsIG5hbWUpO1xyXG5cclxuICAgICAgICBpZiAocGFyZW50ID09IG51bGwpIHtcclxuICAgICAgICAgICAgcGFyZW50ID0gdGhpcy5zdmc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZXMoZWxlbWVudCwgYXR0cmlidXRlcyk7XHJcblxyXG4gICAgICAgIHBhcmVudC5hcHBlbmRDaGlsZChlbGVtZW50KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBpbnNlcnRTdHlsZUVsZW1lbnQoc3R5bGVzOiB7IFtzZWxlY3Rvcjogc3RyaW5nXTogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSB9ID0gbnVsbCk6IFNWR0hlbHBlciB7XHJcblxyXG4gICAgICAgIGxldCBucyA9ICdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zyc7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnN0eWxlID09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5kZWZzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKG5zLCAnZGVmcycpO1xyXG4gICAgICAgICAgICB0aGlzLnN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKG5zLCAnc3R5bGUnKTtcclxuICAgICAgICAgICAgdGhpcy5kZWZzLmFwcGVuZENoaWxkKHRoaXMuc3R5bGUpO1xyXG4gICAgICAgICAgICB0aGlzLnN2Zy5hcHBlbmRDaGlsZCh0aGlzLmRlZnMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHN0eWxlcyAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5saW5lU3R5bGVzID0gc3R5bGVzO1xyXG4gICAgICAgICAgICB0aGlzLnJlZnJlc2hJbmxpbmVTdHlsZXMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVmcmVzaElubGluZVN0eWxlcygpIHtcclxuXHJcbiAgICAgICAgbGV0IHM6IHN0cmluZyA9IFwiXCI7XHJcblxyXG4gICAgICAgIGZvciAobGV0IHNlbGVjdG9yIGluIHRoaXMuaW5saW5lU3R5bGVzKSB7XHJcbiAgICAgICAgICAgIGxldCBzdHlsZXNGb3JTZWxlY3RvciA9IHRoaXMuaW5saW5lU3R5bGVzW3NlbGVjdG9yXTtcclxuICAgICAgICAgICAgaWYgKHN0eWxlc0ZvclNlbGVjdG9yICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHMgKz0gc2VsZWN0b3IgKyBcIntcXG5cIjtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGtleSBpbiBzdHlsZXNGb3JTZWxlY3Rvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHMgKz0gXCIgICBcIiArIGtleSArIFwiOlwiICsgc3R5bGVzRm9yU2VsZWN0b3Jba2V5XSArIFwiO1xcblwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcyArPSBcIn1cXG5cIjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHMgKz0gc2VsZWN0b3IgKyBcIlxcblwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnN0eWxlLnRleHRDb250ZW50ID0gcztcclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldFN0eWxlKHNlbGVjdG9yOiBzdHJpbmcsIGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nLCByZWZyZXNoOiBib29sZWFuID0gdHJ1ZSkge1xyXG5cclxuICAgICAgICBpZiAodGhpcy5zdHlsZSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zZXJ0U3R5bGVFbGVtZW50KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnNldFN0eWxlSW50ZXJuKHNlbGVjdG9yLCBrZXksIHZhbHVlLCByZWZyZXNoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldFN0eWxlSW50ZXJuKHNlbGVjdG9yOiBzdHJpbmcsIGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nLCByZWZyZXNoOiBib29sZWFuID0gdHJ1ZSkge1xyXG5cclxuICAgICAgICBsZXQgc3R5bGVGb3JTZWxlY3RvciA9IHRoaXMuaW5saW5lU3R5bGVzW3NlbGVjdG9yXTtcclxuICAgICAgICBpZiAoc3R5bGVGb3JTZWxlY3RvciA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5saW5lU3R5bGVzW3NlbGVjdG9yXSA9IHt9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5pbmxpbmVTdHlsZXNbc2VsZWN0b3JdW2tleV0gPSB2YWx1ZTtcclxuXHJcbiAgICAgICAgaWYgKHJlZnJlc2gpIHtcclxuICAgICAgICAgICAgdGhpcy5yZWZyZXNoSW5saW5lU3R5bGVzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0U3R5bGVzKHN0eWxlczogeyBbc2VsZWN0b3I6IHN0cmluZ106IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0gfSA9IG51bGwpOiBTVkdIZWxwZXIge1xyXG5cclxuICAgICAgICBpZiAodGhpcy5zdHlsZSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zZXJ0U3R5bGVFbGVtZW50KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGxldCBzZWxlY3RvciBpbiBzdHlsZXMpIHtcclxuICAgICAgICAgICAgbGV0IHN0eWxlc0ZvclNlbGVjdG9yID0gc3R5bGVzW3NlbGVjdG9yXTtcclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IGtleSBpbiBzdHlsZXNGb3JTZWxlY3Rvcikge1xyXG4gICAgICAgICAgICAgICAgbGV0IHZhbHVlID0gc3R5bGVzRm9yU2VsZWN0b3Jba2V5XTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3R5bGVJbnRlcm4oc2VsZWN0b3IsIGtleSwgdmFsdWUsIGZhbHNlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMucmVmcmVzaElubGluZVN0eWxlcygpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcblxyXG5cclxuXHJcbn0iXX0=