import { TokenType } from "../lexer/Token.js";
import { ArrayType } from "../types/Array.js";
import { stringPrimitiveType } from "../types/PrimitiveTypes.js";
export class NewCodeGenerator {
    start(module, moduleStore) {
        this.moduleStore = moduleStore;
        this.module = module;
        this.symbolTableStack = [];
        this.currentSymbolTable = null;
        this.currentProgram = null;
        this.errorList = [];
        this.nextFreeRelativeStackPos = 0;
        if (this.module.tokenList.length > 0) {
            let lastToken = this.module.tokenList[this.module.tokenList.length - 1];
            this.module.mainSymbolTable.positionTo = { line: lastToken.position.line, column: lastToken.position.column + 1, length: 1 };
        }
        this.symbolTableStack.push(this.module.mainSymbolTable);
        this.currentSymbolTable = this.module.mainSymbolTable;
        this.generateMain();
        this.generateClasses();
        this.lookForStaticVoidMain();
        this.module.errors[3] = this.errorList;
    }
    lookForStaticVoidMain() {
        let mainProgram = this.module.newMainProgram;
        if (mainProgram != null && mainProgram.statements.length > 2)
            return;
        let mainMethod = null;
        let staticClass = null;
        let classNode1;
        for (let classNode of this.module.classDefinitionsAST) {
            if (classNode.type == TokenType.keywordClass) {
                let ct = classNode.resolvedType;
                for (let m of ct.staticClass.methods) {
                    if (m.identifier == "main" && m.parameterlist.parameters.length == 1) {
                        let pt = m.parameterlist.parameters[0];
                        if (pt.type instanceof ArrayType && pt.type.arrayOfType == stringPrimitiveType) {
                            if (mainMethod != null) {
                                this.pushError("Es existieren mehrere Klassen mit statischen main-Methoden.", classNode.position);
                            }
                            else {
                                mainMethod = m;
                                staticClass = ct.staticClass;
                                classNode1 = classNode;
                            }
                        }
                    }
                }
            }
        }
        if (mainMethod != null) {
            let position = mainMethod.usagePositions[0];
            if (mainMethod.program != null && mainMethod.program.statements.length > 0) {
                position = mainMethod.program.statements[0].position;
            }
            this.initCurrentProgram();
            this.module.newMainProgram = this.currentProgram;
            this.pushStatements([{
                    type: TokenType.callMainMethod,
                    position: position,
                    stepFinished: false,
                    method: mainMethod,
                    staticClass: staticClass
                }, {
                    type: TokenType.closeStackframe,
                    position: mainMethod.usagePositions.get(this.module)[0]
                }
            ], false);
        }
    }
    pushError(text, position, errorLevel = "error", quickFix) {
        this.errorList.push({
            text: text,
            position: position,
            quickFix: quickFix,
            level: errorLevel
        });
    }
}
NewCodeGenerator.assignmentOperators = [TokenType.assignment, TokenType.plusAssignment, TokenType.minusAssignment,
    TokenType.multiplicationAssignment, TokenType.divisionAssignment, TokenType.ANDAssigment, TokenType.ORAssigment,
    TokenType.XORAssigment, TokenType.shiftLeftAssigment, TokenType.shiftRightAssigment, TokenType.shiftRightUnsignedAssigment];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTmV3Q29kZUdlbmVyYXRvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jbGllbnQvY29tcGlsZXIvcGFyc2VyL05ld0NvZGVHZW5lcmF0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFnQixTQUFTLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUM1RCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFOUMsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFPakUsTUFBTSxPQUFPLGdCQUFnQjtJQXFCekIsS0FBSyxDQUFDLE1BQWMsRUFBRSxXQUF3QjtRQUUxQyxJQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztRQUMvQixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUVyQixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsRUFBRSxDQUFDO1FBQzNCLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUM7UUFFL0IsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUM7UUFDM0IsSUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7UUFFcEIsSUFBSSxDQUFDLHdCQUF3QixHQUFHLENBQUMsQ0FBQztRQUVsQyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDbEMsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3hFLElBQUksQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDLFVBQVUsR0FBRyxFQUFFLElBQUksRUFBRSxTQUFTLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsU0FBUyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FB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QVEsRUFBRSxVQUFVLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO2lCQUMxRDthQUNBLEVBQUUsS0FBSyxDQUFDLENBQUM7U0FFYjtJQUVMLENBQUM7SUFFRCxTQUFTLENBQUMsSUFBWSxFQUFFLFFBQXNCLEVBQUUsYUFBeUIsT0FBTyxFQUFFLFFBQW1CO1FBQ2pHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDO1lBQ2hCLElBQUksRUFBRSxJQUFJO1lBQ1YsUUFBUSxFQUFFLFFBQVE7WUFDbEIsUUFBUSxFQUFFLFFBQVE7WUFDbEIsS0FBSyxFQUFFLFVBQVU7U0FDcEIsQ0FBQyxDQUFDO0lBQ1AsQ0FBQzs7QUF0SE0sb0NBQW1CLEdBQUcsQ0FBQyxTQUFTLENBQUMsVUFBVSxFQUFFLFNBQVMsQ0FBQyxjQUFjLEVBQUUsU0FBUyxDQUFDLGVBQWU7SUFDdkcsU0FBUyxDQUFDLHdCQUF3QixFQUFFLFNBQVMsQ0FBQyxrQkFBa0IsRUFBRSxTQUFTLENBQUMsWUFBWSxFQUFFLFNBQVMsQ0FBQyxXQUFXO0lBQy9HLFNBQVMsQ0FBQyxZQUFZLEVBQUUsU0FBUyxDQUFDLGtCQUFrQixFQUFFLFNBQVMsQ0FBQyxtQkFBbUIsRUFBRSxTQUFTLENBQUMsMkJBQTJCLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVycm9yIH0gZnJvbSBcIi4uL2xleGVyL0xleGVyLmpzXCI7XHJcbmltcG9ydCB7IFRleHRQb3NpdGlvbiwgVG9rZW5UeXBlIH0gZnJvbSBcIi4uL2xleGVyL1Rva2VuLmpzXCI7XHJcbmltcG9ydCB7IEFycmF5VHlwZSB9IGZyb20gXCIuLi90eXBlcy9BcnJheS5qc1wiO1xyXG5pbXBvcnQgeyBTdGF0aWNDbGFzcyB9IGZyb20gXCIuLi90eXBlcy9DbGFzcy5qc1wiO1xyXG5pbXBvcnQgeyBzdHJpbmdQcmltaXRpdmVUeXBlIH0gZnJvbSBcIi4uL3R5cGVzL1ByaW1pdGl2ZVR5cGVzLmpzXCI7XHJcbmltcG9ydCB7IEhlYXAsIE1ldGhvZCB9IGZyb20gXCIuLi90eXBlcy9UeXBlcy5qc1wiO1xyXG5pbXBvcnQgeyBBU1ROb2RlIH0gZnJvbSBcIi4vQVNULmpzXCI7XHJcbmltcG9ydCB7IE1vZHVsZSwgTW9kdWxlU3RvcmUgfSBmcm9tIFwiLi9Nb2R1bGUuanNcIjtcclxuaW1wb3J0IHsgTmV3UHJvZ3JhbSB9IGZyb20gXCIuL25ld1Byb2dyYW0uanNcIjtcclxuaW1wb3J0IHsgU3ltYm9sVGFibGUgfSBmcm9tIFwiLi9TeW1ib2xUYWJsZS5qc1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIE5ld0NvZGVHZW5lcmF0b3Ige1xyXG5cclxuICAgIHN0YXRpYyBhc3NpZ25tZW50T3BlcmF0b3JzID0gW1Rva2VuVHlwZS5hc3NpZ25tZW50LCBUb2tlblR5cGUucGx1c0Fzc2lnbm1lbnQsIFRva2VuVHlwZS5taW51c0Fzc2lnbm1lbnQsXHJcbiAgICBUb2tlblR5cGUubXVsdGlwbGljYXRpb25Bc3NpZ25tZW50LCBUb2tlblR5cGUuZGl2aXNpb25Bc3NpZ25tZW50LCBUb2tlblR5cGUuQU5EQXNzaWdtZW50LCBUb2tlblR5cGUuT1JBc3NpZ21lbnQsXHJcbiAgICBUb2tlblR5cGUuWE9SQXNzaWdtZW50LCBUb2tlblR5cGUuc2hpZnRMZWZ0QXNzaWdtZW50LCBUb2tlblR5cGUuc2hpZnRSaWdodEFzc2lnbWVudCwgVG9rZW5UeXBlLnNoaWZ0UmlnaHRVbnNpZ25lZEFzc2lnbWVudF07XHJcblxyXG4gICAgbW9kdWxlU3RvcmU6IE1vZHVsZVN0b3JlO1xyXG4gICAgbW9kdWxlOiBNb2R1bGU7XHJcblxyXG4gICAgc3ltYm9sVGFibGVTdGFjazogU3ltYm9sVGFibGVbXTtcclxuICAgIGN1cnJlbnRTeW1ib2xUYWJsZTogU3ltYm9sVGFibGU7XHJcblxyXG4gICAgaGVhcDogSGVhcDtcclxuXHJcbiAgICBjdXJyZW50UHJvZ3JhbTogTmV3UHJvZ3JhbTtcclxuXHJcbiAgICBlcnJvckxpc3Q6IEVycm9yW107XHJcblxyXG4gICAgbmV4dEZyZWVSZWxhdGl2ZVN0YWNrUG9zOiBudW1iZXI7XHJcblxyXG5cclxuICAgIHN0YXJ0KG1vZHVsZTogTW9kdWxlLCBtb2R1bGVTdG9yZTogTW9kdWxlU3RvcmUpIHtcclxuXHJcbiAgICAgICAgdGhpcy5tb2R1bGVTdG9yZSA9IG1vZHVsZVN0b3JlO1xyXG4gICAgICAgIHRoaXMubW9kdWxlID0gbW9kdWxlO1xyXG5cclxuICAgICAgICB0aGlzLnN5bWJvbFRhYmxlU3RhY2sgPSBbXTtcclxuICAgICAgICB0aGlzLmN1cnJlbnRTeW1ib2xUYWJsZSA9IG51bGw7XHJcblxyXG4gICAgICAgIHRoaXMuY3VycmVudFByb2dyYW0gPSBudWxsO1xyXG4gICAgICAgIHRoaXMuZXJyb3JMaXN0ID0gW107XHJcblxyXG4gICAgICAgIHRoaXMubmV4dEZyZWVSZWxhdGl2ZVN0YWNrUG9zID0gMDtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMubW9kdWxlLnRva2VuTGlzdC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGxldCBsYXN0VG9rZW4gPSB0aGlzLm1vZHVsZS50b2tlbkxpc3RbdGhpcy5tb2R1bGUudG9rZW5MaXN0Lmxlbmd0aCAtIDFdO1xyXG4gICAgICAgICAgICB0aGlzLm1vZHVsZS5tYWluU3ltYm9sVGFibGUucG9zaXRpb25UbyA9IHsgbGluZTogbGFzdFRva2VuLnBvc2l0aW9uLmxpbmUsIGNvbHVtbjogbGFzdFRva2VuLnBvc2l0aW9uLmNvbHVtbiArIDEsIGxlbmd0aDogMSB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5zeW1ib2xUYWJsZVN0YWNrLnB1c2godGhpcy5tb2R1bGUubWFpblN5bWJvbFRhYmxlKTtcclxuICAgICAgICB0aGlzLmN1cnJlbnRTeW1ib2xUYWJsZSA9IHRoaXMubW9kdWxlLm1haW5TeW1ib2xUYWJsZTtcclxuXHJcbiAgICAgICAgdGhpcy5nZW5lcmF0ZU1haW4oKTtcclxuXHJcbiAgICAgICAgdGhpcy5nZW5lcmF0ZUNsYXNzZXMoKTtcclxuXHJcbiAgICAgICAgdGhpcy5sb29rRm9yU3RhdGljVm9pZE1haW4oKTtcclxuXHJcbiAgICAgICAgdGhpcy5tb2R1bGUuZXJyb3JzWzNdID0gdGhpcy5lcnJvckxpc3Q7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGxvb2tGb3JTdGF0aWNWb2lkTWFpbigpIHtcclxuXHJcbiAgICAgICAgbGV0IG1haW5Qcm9ncmFtID0gdGhpcy5tb2R1bGUubmV3TWFpblByb2dyYW07XHJcblxyXG4gICAgICAgIGlmIChtYWluUHJvZ3JhbSAhPSBudWxsICYmIG1haW5Qcm9ncmFtLnN0YXRlbWVudHMubGVuZ3RoID4gMikgcmV0dXJuO1xyXG5cclxuICAgICAgICBsZXQgbWFpbk1ldGhvZDogTWV0aG9kID0gbnVsbDtcclxuICAgICAgICBsZXQgc3RhdGljQ2xhc3M6IFN0YXRpY0NsYXNzID0gbnVsbDtcclxuICAgICAgICBsZXQgY2xhc3NOb2RlMTogQVNUTm9kZTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgY2xhc3NOb2RlIG9mIHRoaXMubW9kdWxlLmNsYXNzRGVmaW5pdGlvbnNBU1QpIHtcclxuICAgICAgICAgICAgaWYgKGNsYXNzTm9kZS50eXBlID09IFRva2VuVHlwZS5rZXl3b3JkQ2xhc3MpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgY3QgPSBjbGFzc05vZGUucmVzb2x2ZWRUeXBlO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAobGV0IG0gb2YgY3Quc3RhdGljQ2xhc3MubWV0aG9kcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChtLmlkZW50aWZpZXIgPT0gXCJtYWluXCIgJiYgbS5wYXJhbWV0ZXJsaXN0LnBhcmFtZXRlcnMubGVuZ3RoID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHB0ID0gbS5wYXJhbWV0ZXJsaXN0LnBhcmFtZXRlcnNbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwdC50eXBlIGluc3RhbmNlb2YgQXJyYXlUeXBlICYmIHB0LnR5cGUuYXJyYXlPZlR5cGUgPT0gc3RyaW5nUHJpbWl0aXZlVHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1haW5NZXRob2QgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHVzaEVycm9yKFwiRXMgZXhpc3RpZXJlbiBtZWhyZXJlIEtsYXNzZW4gbWl0IHN0YXRpc2NoZW4gbWFpbi1NZXRob2Rlbi5cIiwgY2xhc3NOb2RlLnBvc2l0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbk1ldGhvZCA9IG07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGljQ2xhc3MgPSBjdC5zdGF0aWNDbGFzcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05vZGUxID0gY2xhc3NOb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAobWFpbk1ldGhvZCAhPSBudWxsKSB7XHJcblxyXG4gICAgICAgICAgICBsZXQgcG9zaXRpb246IFRleHRQb3NpdGlvbiA9IG1haW5NZXRob2QudXNhZ2VQb3NpdGlvbnNbMF07XHJcbiAgICAgICAgICAgIGlmIChtYWluTWV0aG9kLnByb2dyYW0gIT0gbnVsbCAmJiBtYWluTWV0aG9kLnByb2dyYW0uc3RhdGVtZW50cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IG1haW5NZXRob2QucHJvZ3JhbS5zdGF0ZW1lbnRzWzBdLnBvc2l0aW9uO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmluaXRDdXJyZW50UHJvZ3JhbSgpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5tb2R1bGUubmV3TWFpblByb2dyYW0gPSB0aGlzLmN1cnJlbnRQcm9ncmFtO1xyXG5cclxuICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICB0aGlzLnB1c2hTdGF0ZW1lbnRzKFt7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBUb2tlblR5cGUuY2FsbE1haW5NZXRob2QsXHJcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogcG9zaXRpb24sXHJcbiAgICAgICAgICAgICAgICBzdGVwRmluaXNoZWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiBtYWluTWV0aG9kLFxyXG4gICAgICAgICAgICAgICAgc3RhdGljQ2xhc3M6IHN0YXRpY0NsYXNzXHJcbiAgICAgICAgICAgIH0sIHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IFRva2VuVHlwZS5jbG9zZVN0YWNrZnJhbWUsXHJcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogbWFpbk1ldGhvZC51c2FnZVBvc2l0aW9ucy5nZXQodGhpcy5tb2R1bGUpWzBdXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXSwgZmFsc2UpO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHB1c2hFcnJvcih0ZXh0OiBzdHJpbmcsIHBvc2l0aW9uOiBUZXh0UG9zaXRpb24sIGVycm9yTGV2ZWw6IEVycm9yTGV2ZWwgPSBcImVycm9yXCIsIHF1aWNrRml4PzogUXVpY2tGaXgpIHtcclxuICAgICAgICB0aGlzLmVycm9yTGlzdC5wdXNoKHtcclxuICAgICAgICAgICAgdGV4dDogdGV4dCxcclxuICAgICAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uLFxyXG4gICAgICAgICAgICBxdWlja0ZpeDogcXVpY2tGaXgsXHJcbiAgICAgICAgICAgIGxldmVsOiBlcnJvckxldmVsXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG5cclxuXHJcbn0iXX0=