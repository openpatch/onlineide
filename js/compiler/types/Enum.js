import { Klass, Visibility } from "./Class.js";
import { Attribute, Method, Parameterlist } from "./Types.js";
import { RuntimeObject } from "../../interpreter/RuntimeObject.js";
import { ArrayType } from "./Array.js";
import { stringPrimitiveType, intPrimitiveType, objectType } from "./PrimitiveTypes.js";
export class EnumRuntimeObject extends RuntimeObject {
    constructor(en, enumValue) {
        super(en);
        this.enumValue = enumValue;
    }
}
export class Enum extends Klass {
    constructor(identifier, module, enumValueNodes) {
        super(identifier, module);
        this.enumInfoList = [];
        this.identifierToInfoMap = {};
        this.indexToInfoMap = {};
        this.valueList = null;
        this.baseClass = objectType;
        let i = 0;
        for (let evn of enumValueNodes) {
            let attribute = new Attribute(evn.identifier, this, null, true, Visibility.public, true);
            if (evn.position != null) {
                attribute.declaration = {
                    module: module,
                    position: evn.position
                };
                attribute.usagePositions.set(module, [evn.position]);
            }
            this.staticClass.addAttribute(attribute);
            let ev = {
                identifier: evn.identifier,
                ordinal: i++
            };
            this.enumInfoList.push(ev);
            this.identifierToInfoMap[evn.identifier] = ev;
            this.indexToInfoMap[ev.ordinal] = ev;
        }
        if (module.isSystemModule) {
            this.valueList = {
                type: new ArrayType(this),
                value: []
            };
            for (let ei of this.enumInfoList) {
                ei.object = new EnumRuntimeObject(this, ei);
                this.valueList.value.push({
                    type: this,
                    value: ei.object
                });
            }
        }
        let that = this;
        this.staticClass.addMethod(new Method("getValues", new Parameterlist([]), new ArrayType(this), (parameters) => {
            if (this.valueList == null) {
                let values = [];
                for (let vi of this.enumInfoList) {
                    values.push({
                        type: that,
                        value: vi.object
                    });
                }
                this.valueList = {
                    type: new ArrayType(that),
                    value: values
                };
            }
            return this.valueList.value;
        }, false, true));
        this.addMethod(new Method("toString", new Parameterlist([]), stringPrimitiveType, (parameters) => {
            let erto = (parameters[0].value);
            return erto.enumValue.identifier;
        }, false, false));
        this.addMethod(new Method("toOrdinal", new Parameterlist([]), intPrimitiveType, (parameters) => {
            let erto = (parameters[0].value);
            return erto.enumValue.ordinal;
        }, false, false));
    }
    getOrdinal(valueIdentifier) {
        let enumInfo = this.identifierToInfoMap[valueIdentifier];
        if (enumInfo == null)
            return -1;
        return enumInfo.ordinal;
    }
    debugOutput(value, maxLength = 40) {
        let enumObject = value.value;
        return this.identifier + "." + enumObject.enumValue.identifier;
    }
    canCastTo(type) {
        if (type == intPrimitiveType) {
            return true;
        }
        return super.canCastTo(type);
    }
    castTo(value, type) {
        if (type == intPrimitiveType) {
            let en = value.value;
            return {
                type: intPrimitiveType,
                value: en.enumValue.ordinal
            };
        }
        return super.castTo(value, type);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW51bS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jbGllbnQvY29tcGlsZXIvdHlwZXMvRW51bS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUMvQyxPQUFPLEVBQVMsU0FBUyxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQVEsTUFBTSxZQUFZLENBQUM7QUFFM0UsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQ25FLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFHdkMsT0FBTyxFQUFFLG1CQUFtQixFQUFFLGdCQUFnQixFQUFFLFVBQVUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRXhGLE1BQU0sT0FBTyxpQkFBa0IsU0FBUSxhQUFhO0lBSWhELFlBQVksRUFBUSxFQUFFLFNBQW1CO1FBQ3JDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNWLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO0lBQy9CLENBQUM7Q0FFSjtBQVdELE1BQU0sT0FBTyxJQUFLLFNBQVEsS0FBSztJQXFCM0IsWUFBWSxVQUFrQixFQUFFLE1BQWMsRUFBRSxjQUErQjtRQUUzRSxLQUFLLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBckI5QixpQkFBWSxHQUFlLEVBQUUsQ0FBQztRQUM5Qix3QkFBbUIsR0FBdUMsRUFBRSxDQUFDO1FBQzdELG1CQUFjLEdBQWtDLEVBQUUsQ0FBQztRQUVuRCxjQUFTLEdBQVUsSUFBSSxDQUFDO1FBa0JwQixJQUFJLENBQUMsU0FBUyxHQUFHLFVBQVUsQ0FBQztRQUU1QixJQUFJLENBQUMsR0FBVyxDQUFDLENBQUM7UUFFbEIsS0FBSyxJQUFJLEdBQUcsSUFBSSxjQUFjLEVBQUU7WUFFNUIsSUFBSSxTQUFTLEdBQWMsSUFBSSxTQUFTLENBQUMsR0FBRyxD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Q3hDLE9BQU87Z0JBQ0gsSUFBSSxFQUFFLGdCQUFnQjtnQkFDdEIsS0FBSyxFQUFFLEVBQUUsQ0FBQyxTQUFTLENBQUMsT0FBTzthQUM5QixDQUFDO1NBQ0w7UUFFRCxPQUFPLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3JDLENBQUM7Q0FHSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByb2dyYW0gfSBmcm9tIFwiLi4vcGFyc2VyL1Byb2dyYW0uanNcIjtcclxuaW1wb3J0IHsgS2xhc3MsIFZpc2liaWxpdHkgfSBmcm9tIFwiLi9DbGFzcy5qc1wiO1xyXG5pbXBvcnQgeyBWYWx1ZSwgQXR0cmlidXRlLCBNZXRob2QsIFBhcmFtZXRlcmxpc3QsIFR5cGUgfSBmcm9tIFwiLi9UeXBlcy5qc1wiO1xyXG5pbXBvcnQgeyBNb2R1bGUgfSBmcm9tIFwiLi4vcGFyc2VyL01vZHVsZS5qc1wiO1xyXG5pbXBvcnQgeyBSdW50aW1lT2JqZWN0IH0gZnJvbSBcIi4uLy4uL2ludGVycHJldGVyL1J1bnRpbWVPYmplY3QuanNcIjtcclxuaW1wb3J0IHsgQXJyYXlUeXBlIH0gZnJvbSBcIi4vQXJyYXkuanNcIjtcclxuaW1wb3J0IHsgVGV4dFBvc2l0aW9uIH0gZnJvbSBcIi4uL2xleGVyL1Rva2VuLmpzXCI7XHJcbmltcG9ydCB7IEVudW1WYWx1ZU5vZGUgfSBmcm9tIFwiLi4vcGFyc2VyL0FTVC5qc1wiO1xyXG5pbXBvcnQgeyBzdHJpbmdQcmltaXRpdmVUeXBlLCBpbnRQcmltaXRpdmVUeXBlLCBvYmplY3RUeXBlIH0gZnJvbSBcIi4vUHJpbWl0aXZlVHlwZXMuanNcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBFbnVtUnVudGltZU9iamVjdCBleHRlbmRzIFJ1bnRpbWVPYmplY3Qge1xyXG5cclxuICAgIGVudW1WYWx1ZTogRW51bUluZm87XHJcblxyXG4gICAgY29uc3RydWN0b3IoZW46IEVudW0sIGVudW1WYWx1ZTogRW51bUluZm8pIHtcclxuICAgICAgICBzdXBlcihlbik7XHJcbiAgICAgICAgdGhpcy5lbnVtVmFsdWUgPSBlbnVtVmFsdWU7XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgdHlwZSBFbnVtSW5mbyA9IHtcclxuICAgIGlkZW50aWZpZXI6IHN0cmluZyxcclxuICAgIG9yZGluYWw6IG51bWJlcixcclxuICAgIHBvc2l0aW9uPzogVGV4dFBvc2l0aW9uLFxyXG4gICAgb2JqZWN0PzogRW51bVJ1bnRpbWVPYmplY3QsXHJcbiAgICBjb25zdHJ1Y3RvckNhbGxQcm9ncmFtPzogUHJvZ3JhbVxyXG59XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIEVudW0gZXh0ZW5kcyBLbGFzcyB7XHJcblxyXG4gICAgZW51bUluZm9MaXN0OiBFbnVtSW5mb1tdID0gW107XHJcbiAgICBpZGVudGlmaWVyVG9JbmZvTWFwOiB7IFtpZGVudGlmaWVyOiBzdHJpbmddOiBFbnVtSW5mbyB9ID0ge307XHJcbiAgICBpbmRleFRvSW5mb01hcDogeyBbaW5kZXg6IG51bWJlcl06IEVudW1JbmZvIH0gPSB7fTtcclxuXHJcbiAgICB2YWx1ZUxpc3Q6IFZhbHVlID0gbnVsbDtcclxuXHJcbiAgICBnZXRPcmRpbmFsKHZhbHVlSWRlbnRpZmllcjogc3RyaW5nKTogbnVtYmVyIHtcclxuXHJcbiAgICAgICAgbGV0IGVudW1JbmZvOiBFbnVtSW5mbyA9IHRoaXMuaWRlbnRpZmllclRvSW5mb01hcFt2YWx1ZUlkZW50aWZpZXJdO1xyXG4gICAgICAgIGlmIChlbnVtSW5mbyA9PSBudWxsKSByZXR1cm4gLTE7XHJcbiAgICAgICAgcmV0dXJuIGVudW1JbmZvLm9yZGluYWw7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBkZWJ1Z091dHB1dCh2YWx1ZTogVmFsdWUsIG1heExlbmd0aDogbnVtYmVyID0gNDApOiBzdHJpbmcge1xyXG4gICAgICAgIGxldCBlbnVtT2JqZWN0ID0gPEVudW1SdW50aW1lT2JqZWN0PnZhbHVlLnZhbHVlO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmlkZW50aWZpZXIgKyBcIi5cIiArIGVudW1PYmplY3QuZW51bVZhbHVlLmlkZW50aWZpZXI7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3RydWN0b3IoaWRlbnRpZmllcjogc3RyaW5nLCBtb2R1bGU6IE1vZHVsZSwgZW51bVZhbHVlTm9kZXM6IEVudW1WYWx1ZU5vZGVbXSkge1xyXG5cclxuICAgICAgICBzdXBlcihpZGVudGlmaWVyLCBtb2R1bGUpO1xyXG4gICAgICAgIHRoaXMuYmFzZUNsYXNzID0gb2JqZWN0VHlwZTtcclxuXHJcbiAgICAgICAgbGV0IGk6IG51bWJlciA9IDA7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGV2biBvZiBlbnVtVmFsdWVOb2Rlcykge1xyXG5cclxuICAgICAgICAgICAgbGV0IGF0dHJpYnV0ZTogQXR0cmlidXRlID0gbmV3IEF0dHJpYnV0ZShldm4uaWRlbnRpZmllciwgdGhpcywgbnVsbCwgdHJ1ZSwgVmlzaWJpbGl0eS5wdWJsaWMsIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGV2bi5wb3NpdGlvbiAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGUuZGVjbGFyYXRpb24gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlOiBtb2R1bGUsXHJcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGV2bi5wb3NpdGlvblxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZS51c2FnZVBvc2l0aW9ucy5zZXQobW9kdWxlLCBbZXZuLnBvc2l0aW9uXSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuc3RhdGljQ2xhc3MuYWRkQXR0cmlidXRlKFxyXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlXHJcbiAgICAgICAgICAgICk7XHJcblxyXG5cclxuICAgICAgICAgICAgbGV0IGV2OiBFbnVtSW5mbyA9IHtcclxuICAgICAgICAgICAgICAgIGlkZW50aWZpZXI6IGV2bi5pZGVudGlmaWVyLFxyXG4gICAgICAgICAgICAgICAgb3JkaW5hbDogaSsrXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuZW51bUluZm9MaXN0LnB1c2goZXYpO1xyXG4gICAgICAgICAgICB0aGlzLmlkZW50aWZpZXJUb0luZm9NYXBbZXZuLmlkZW50aWZpZXJdID0gZXY7XHJcbiAgICAgICAgICAgIHRoaXMuaW5kZXhUb0luZm9NYXBbZXYub3JkaW5hbF0gPSBldjtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZihtb2R1bGUuaXNTeXN0ZW1Nb2R1bGUpe1xyXG4gICAgICAgICAgICB0aGlzLnZhbHVlTGlzdCA9IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IG5ldyBBcnJheVR5cGUodGhpcyksXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogW11cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgZm9yKGxldCBlaSBvZiB0aGlzLmVudW1JbmZvTGlzdCl7XHJcblxyXG4gICAgICAgICAgICAgICAgZWkub2JqZWN0ID0gbmV3IEVudW1SdW50aW1lT2JqZWN0KHRoaXMsIGVpKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlTGlzdC52YWx1ZS5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiB0aGlzLFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBlaS5vYmplY3RcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCB0aGF0ID0gdGhpcztcclxuXHJcbiAgICAgICAgdGhpcy5zdGF0aWNDbGFzcy5hZGRNZXRob2QobmV3IE1ldGhvZChcImdldFZhbHVlc1wiLFxyXG4gICAgICAgICAgICBuZXcgUGFyYW1ldGVybGlzdChbXSksIG5ldyBBcnJheVR5cGUodGhpcyksIChwYXJhbWV0ZXJzOiBWYWx1ZVtdKSA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudmFsdWVMaXN0ID09IG51bGwpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHZhbHVlcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHZpIG9mIHRoaXMuZW51bUluZm9MaXN0KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB0aGF0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZpLm9iamVjdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnZhbHVlTGlzdCA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogbmV3IEFycmF5VHlwZSh0aGF0KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlc1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudmFsdWVMaXN0LnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgfSwgZmFsc2UsIHRydWUpXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcInRvU3RyaW5nXCIsXHJcbiAgICAgICAgICAgIG5ldyBQYXJhbWV0ZXJsaXN0KFtdKSwgc3RyaW5nUHJpbWl0aXZlVHlwZSwgKHBhcmFtZXRlcnM6IFZhbHVlW10pID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgZXJ0bzogRW51bVJ1bnRpbWVPYmplY3QgPSA8RW51bVJ1bnRpbWVPYmplY3Q+KHBhcmFtZXRlcnNbMF0udmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnRvLmVudW1WYWx1ZS5pZGVudGlmaWVyO1xyXG5cclxuICAgICAgICAgICAgfSwgZmFsc2UsIGZhbHNlKVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJ0b09yZGluYWxcIixcclxuICAgICAgICAgICAgbmV3IFBhcmFtZXRlcmxpc3QoW10pLCBpbnRQcmltaXRpdmVUeXBlLCAocGFyYW1ldGVyczogVmFsdWVbXSkgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBlcnRvOiBFbnVtUnVudGltZU9iamVjdCA9IDxFbnVtUnVudGltZU9iamVjdD4ocGFyYW1ldGVyc1swXS52YWx1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVydG8uZW51bVZhbHVlLm9yZGluYWw7XHJcblxyXG4gICAgICAgICAgICB9LCBmYWxzZSwgZmFsc2UpXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNhbkNhc3RUbyh0eXBlOiBUeXBlKTogYm9vbGVhbiB7XHJcblxyXG4gICAgICAgIGlmICh0eXBlID09IGludFByaW1pdGl2ZVR5cGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc3VwZXIuY2FuQ2FzdFRvKHR5cGUpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2FzdFRvKHZhbHVlOiBWYWx1ZSwgdHlwZTogVHlwZSk6IFZhbHVlIHtcclxuXHJcbiAgICAgICAgaWYgKHR5cGUgPT0gaW50UHJpbWl0aXZlVHlwZSkge1xyXG4gICAgICAgICAgICBsZXQgZW4gPSA8RW51bVJ1bnRpbWVPYmplY3Q+dmFsdWUudmFsdWU7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBpbnRQcmltaXRpdmVUeXBlLFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IGVuLmVudW1WYWx1ZS5vcmRpbmFsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc3VwZXIuY2FzdFRvKHZhbHVlLCB0eXBlKTtcclxuICAgIH1cclxuXHJcblxyXG59XHJcbiJdfQ==