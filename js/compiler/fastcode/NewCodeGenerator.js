import { TokenType } from "../lexer/Token.js";
import { ArrayType } from "../types/Array.js";
import { stringPrimitiveType } from "../types/PrimitiveTypes.js";
export class NewCodeGenerator {
    start(module, moduleStore) {
        this.moduleStore = moduleStore;
        this.module = module;
        this.symbolTableStack = [];
        this.currentSymbolTable = null;
        this.currentProgram = null;
        this.errorList = [];
        this.nextFreeRelativeStackPos = 0;
        if (this.module.tokenList.length > 0) {
            let lastToken = this.module.tokenList[this.module.tokenList.length - 1];
            this.module.mainSymbolTable.positionTo = { line: lastToken.position.line, column: lastToken.position.column + 1, length: 1 };
        }
        this.symbolTableStack.push(this.module.mainSymbolTable);
        this.currentSymbolTable = this.module.mainSymbolTable;
        this.generateMain();
        this.generateClasses();
        this.lookForStaticVoidMain();
        this.module.errors[3] = this.errorList;
    }
    lookForStaticVoidMain() {
        let mainProgram = this.module.newMainProgram;
        if (mainProgram != null && mainProgram.statements.length > 2)
            return;
        let mainMethod = null;
        let staticClass = null;
        let classNode1;
        for (let classNode of this.module.classDefinitionsAST) {
            if (classNode.type == TokenType.keywordClass) {
                let ct = classNode.resolvedType;
                for (let m of ct.staticClass.methods) {
                    if (m.identifier == "main" && m.parameterlist.parameters.length == 1) {
                        let pt = m.parameterlist.parameters[0];
                        if (pt.type instanceof ArrayType && pt.type.arrayOfType == stringPrimitiveType) {
                            if (mainMethod != null) {
                                this.pushError("Es existieren mehrere Klassen mit statischen main-Methoden.", classNode.position);
                            }
                            else {
                                mainMethod = m;
                                staticClass = ct.staticClass;
                                classNode1 = classNode;
                            }
                        }
                    }
                }
            }
        }
        if (mainMethod != null) {
            let position = mainMethod.usagePositions[0];
            if (mainMethod.program != null && mainMethod.program.statements.length > 0) {
                position = mainMethod.program.statements[0].position;
            }
            this.initCurrentProgram();
            this.module.newMainProgram = this.currentProgram;
            this.pushStatements([{
                    type: TokenType.callMainMethod,
                    position: position,
                    stepFinished: false,
                    method: mainMethod,
                    staticClass: staticClass
                }, {
                    type: TokenType.closeStackframe,
                    position: mainMethod.usagePositions.get(this.module)[0]
                }
            ], false);
        }
    }
    initCurrentProgram() {
        this.currentProgram = {
            module: this.module,
            statements: [],
        };
    }
    pushError(text, position, errorLevel = "error", quickFix) {
        this.errorList.push({
            text: text,
            position: position,
            quickFix: quickFix,
            level: errorLevel
        });
    }
}
NewCodeGenerator.assignmentOperators = [TokenType.assignment, TokenType.plusAssignment, TokenType.minusAssignment,
    TokenType.multiplicationAssignment, TokenType.divisionAssignment, TokenType.ANDAssigment, TokenType.ORAssigment,
    TokenType.XORAssigment, TokenType.shiftLeftAssigment, TokenType.shiftRightAssigment, TokenType.shiftRightUnsignedAssigment];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTmV3Q29kZUdlbmVyYXRvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jbGllbnQvY29tcGlsZXIvZmFzdGNvZGUvTmV3Q29kZUdlbmVyYXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQWdCLFNBQVMsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQzVELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUU5QyxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQWVqRSxNQUFNLE9BQU8sZ0JBQWdCO0lBcUJ6QixLQUFLLENBQUMsTUFBYyxFQUFFLFdBQXdCO1FBRTFDLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1FBQy9CLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBRXJCLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxFQUFFLENBQUM7UUFDM0IsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksQ0FBQztRQUUvQixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQztRQUMzQixJQUFJLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztRQUVwQixJQUFJLENBQUMsd0JBQXdCLEdBQUcsQ0FBQyxDQUFDO1FBRWxDLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNsQyxJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDeEUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsVUFBVSxHQUFHLEVBQUUsSUFBSSxFQUFFLFNBQVMsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxTQUFTLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxD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UUFBUSxFQUFFLFVBQVUsQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQzFEO2FBQ0EsRUFBRSxLQUFLLENBQUMsQ0FBQztTQUViO0lBRUwsQ0FBQztJQUVELGtCQUFrQjtRQUVkLElBQUksQ0FBQyxjQUFjLEdBQUc7WUFDbEIsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNO1lBQ25CLFVBQVUsRUFBRSxFQUFFO1NBQ2pCLENBQUM7SUFFTixDQUFDO0lBR0QsU0FBUyxDQUFDLElBQVksRUFBRSxRQUFzQixFQUFFLGFBQXlCLE9BQU8sRUFBRSxRQUFtQjtRQUNqRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQztZQUNoQixJQUFJLEVBQUUsSUFBSTtZQUNWLFFBQVEsRUFBRSxRQUFRO1lBQ2xCLFFBQVEsRUFBRSxRQUFRO1lBQ2xCLEtBQUssRUFBRSxVQUFVO1NBQ3BCLENBQUMsQ0FBQztJQUNQLENBQUM7O0FBaElNLG9DQUFtQixHQUFHLENBQUMsU0FBUyxDQUFDLFVBQVUsRUFBRSxTQUFTLENBQUMsY0FBYyxFQUFFLFNBQVMsQ0FBQyxlQUFlO0lBQ3ZHLFNBQVMsQ0FBQyx3QkFBd0IsRUFBRSxTQUFTLENBQUMsa0JBQWtCLEVBQUUsU0FBUyxDQUFDLFlBQVksRUFBRSxTQUFTLENBQUMsV0FBVztJQUMvRyxTQUFTLENBQUMsWUFBWSxFQUFFLFNBQVMsQ0FBQyxrQkFBa0IsRUFBRSxTQUFTLENBQUMsbUJBQW1CLEVBQUUsU0FBUyxDQUFDLDJCQUEyQixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFcnJvciB9IGZyb20gXCIuLi9sZXhlci9MZXhlci5qc1wiO1xyXG5pbXBvcnQgeyBUZXh0UG9zaXRpb24sIFRva2VuVHlwZSB9IGZyb20gXCIuLi9sZXhlci9Ub2tlbi5qc1wiO1xyXG5pbXBvcnQgeyBBcnJheVR5cGUgfSBmcm9tIFwiLi4vdHlwZXMvQXJyYXkuanNcIjtcclxuaW1wb3J0IHsgU3RhdGljQ2xhc3MgfSBmcm9tIFwiLi4vdHlwZXMvQ2xhc3MuanNcIjtcclxuaW1wb3J0IHsgc3RyaW5nUHJpbWl0aXZlVHlwZSB9IGZyb20gXCIuLi90eXBlcy9QcmltaXRpdmVUeXBlcy5qc1wiO1xyXG5pbXBvcnQgeyBIZWFwLCBNZXRob2QsIFR5cGUgfSBmcm9tIFwiLi4vdHlwZXMvVHlwZXMuanNcIjtcclxuaW1wb3J0IHsgQVNUTm9kZSB9IGZyb20gXCIuLi9wYXJzZXIvQVNULmpzXCI7XHJcbmltcG9ydCB7IE1vZHVsZSwgTW9kdWxlU3RvcmUgfSBmcm9tIFwiLi4vcGFyc2VyL01vZHVsZS5qc1wiO1xyXG5pbXBvcnQgeyBOZXdQcm9ncmFtLCBOZXdTdGVwIH0gZnJvbSBcIi4vTmV3UHJvZ3JhbS5qc1wiO1xyXG5pbXBvcnQgeyBTeW1ib2xUYWJsZSB9IGZyb20gXCIuLi9wYXJzZXIvU3ltYm9sVGFibGUuanNcIjtcclxuXHJcblxyXG50eXBlIFRlcm0gPSB7XHJcbiAgICB0eXBlOiBUeXBlO1xyXG4gICAgaW5pdGlhbFN0ZXBzOiBOZXdTdGVwO1xyXG4gICAgXHJcbn1cclxuXHJcblxyXG5leHBvcnQgY2xhc3MgTmV3Q29kZUdlbmVyYXRvciB7XHJcblxyXG4gICAgc3RhdGljIGFzc2lnbm1lbnRPcGVyYXRvcnMgPSBbVG9rZW5UeXBlLmFzc2lnbm1lbnQsIFRva2VuVHlwZS5wbHVzQXNzaWdubWVudCwgVG9rZW5UeXBlLm1pbnVzQXNzaWdubWVudCxcclxuICAgIFRva2VuVHlwZS5tdWx0aXBsaWNhdGlvbkFzc2lnbm1lbnQsIFRva2VuVHlwZS5kaXZpc2lvbkFzc2lnbm1lbnQsIFRva2VuVHlwZS5BTkRBc3NpZ21lbnQsIFRva2VuVHlwZS5PUkFzc2lnbWVudCxcclxuICAgIFRva2VuVHlwZS5YT1JBc3NpZ21lbnQsIFRva2VuVHlwZS5zaGlmdExlZnRBc3NpZ21lbnQsIFRva2VuVHlwZS5zaGlmdFJpZ2h0QXNzaWdtZW50LCBUb2tlblR5cGUuc2hpZnRSaWdodFVuc2lnbmVkQXNzaWdtZW50XTtcclxuXHJcbiAgICBtb2R1bGVTdG9yZTogTW9kdWxlU3RvcmU7XHJcbiAgICBtb2R1bGU6IE1vZHVsZTtcclxuXHJcbiAgICBzeW1ib2xUYWJsZVN0YWNrOiBTeW1ib2xUYWJsZVtdO1xyXG4gICAgY3VycmVudFN5bWJvbFRhYmxlOiBTeW1ib2xUYWJsZTtcclxuXHJcbiAgICBoZWFwOiBIZWFwO1xyXG5cclxuICAgIGN1cnJlbnRQcm9ncmFtOiBOZXdQcm9ncmFtO1xyXG5cclxuICAgIGVycm9yTGlzdDogRXJyb3JbXTtcclxuXHJcbiAgICBuZXh0RnJlZVJlbGF0aXZlU3RhY2tQb3M6IG51bWJlcjtcclxuXHJcblxyXG4gICAgc3RhcnQobW9kdWxlOiBNb2R1bGUsIG1vZHVsZVN0b3JlOiBNb2R1bGVTdG9yZSkge1xyXG5cclxuICAgICAgICB0aGlzLm1vZHVsZVN0b3JlID0gbW9kdWxlU3RvcmU7XHJcbiAgICAgICAgdGhpcy5tb2R1bGUgPSBtb2R1bGU7XHJcblxyXG4gICAgICAgIHRoaXMuc3ltYm9sVGFibGVTdGFjayA9IFtdO1xyXG4gICAgICAgIHRoaXMuY3VycmVudFN5bWJvbFRhYmxlID0gbnVsbDtcclxuXHJcbiAgICAgICAgdGhpcy5jdXJyZW50UHJvZ3JhbSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5lcnJvckxpc3QgPSBbXTtcclxuXHJcbiAgICAgICAgdGhpcy5uZXh0RnJlZVJlbGF0aXZlU3RhY2tQb3MgPSAwO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5tb2R1bGUudG9rZW5MaXN0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgbGV0IGxhc3RUb2tlbiA9IHRoaXMubW9kdWxlLnRva2VuTGlzdFt0aGlzLm1vZHVsZS50b2tlbkxpc3QubGVuZ3RoIC0gMV07XHJcbiAgICAgICAgICAgIHRoaXMubW9kdWxlLm1haW5TeW1ib2xUYWJsZS5wb3NpdGlvblRvID0geyBsaW5lOiBsYXN0VG9rZW4ucG9zaXRpb24ubGluZSwgY29sdW1uOiBsYXN0VG9rZW4ucG9zaXRpb24uY29sdW1uICsgMSwgbGVuZ3RoOiAxIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnN5bWJvbFRhYmxlU3RhY2sucHVzaCh0aGlzLm1vZHVsZS5tYWluU3ltYm9sVGFibGUpO1xyXG4gICAgICAgIHRoaXMuY3VycmVudFN5bWJvbFRhYmxlID0gdGhpcy5tb2R1bGUubWFpblN5bWJvbFRhYmxlO1xyXG5cclxuICAgICAgICB0aGlzLmdlbmVyYXRlTWFpbigpO1xyXG5cclxuICAgICAgICB0aGlzLmdlbmVyYXRlQ2xhc3NlcygpO1xyXG5cclxuICAgICAgICB0aGlzLmxvb2tGb3JTdGF0aWNWb2lkTWFpbigpO1xyXG5cclxuICAgICAgICB0aGlzLm1vZHVsZS5lcnJvcnNbM10gPSB0aGlzLmVycm9yTGlzdDtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgbG9va0ZvclN0YXRpY1ZvaWRNYWluKCkge1xyXG5cclxuICAgICAgICBsZXQgbWFpblByb2dyYW0gPSB0aGlzLm1vZHVsZS5uZXdNYWluUHJvZ3JhbTtcclxuXHJcbiAgICAgICAgaWYgKG1haW5Qcm9ncmFtICE9IG51bGwgJiYgbWFpblByb2dyYW0uc3RhdGVtZW50cy5sZW5ndGggPiAyKSByZXR1cm47XHJcblxyXG4gICAgICAgIGxldCBtYWluTWV0aG9kOiBNZXRob2QgPSBudWxsO1xyXG4gICAgICAgIGxldCBzdGF0aWNDbGFzczogU3RhdGljQ2xhc3MgPSBudWxsO1xyXG4gICAgICAgIGxldCBjbGFzc05vZGUxOiBBU1ROb2RlO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBjbGFzc05vZGUgb2YgdGhpcy5tb2R1bGUuY2xhc3NEZWZpbml0aW9uc0FTVCkge1xyXG4gICAgICAgICAgICBpZiAoY2xhc3NOb2RlLnR5cGUgPT0gVG9rZW5UeXBlLmtleXdvcmRDbGFzcykge1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBjdCA9IGNsYXNzTm9kZS5yZXNvbHZlZFR5cGU7XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgbSBvZiBjdC5zdGF0aWNDbGFzcy5tZXRob2RzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG0uaWRlbnRpZmllciA9PSBcIm1haW5cIiAmJiBtLnBhcmFtZXRlcmxpc3QucGFyYW1ldGVycy5sZW5ndGggPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgcHQgPSBtLnBhcmFtZXRlcmxpc3QucGFyYW1ldGVyc1swXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHB0LnR5cGUgaW5zdGFuY2VvZiBBcnJheVR5cGUgJiYgcHQudHlwZS5hcnJheU9mVHlwZSA9PSBzdHJpbmdQcmltaXRpdmVUeXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWFpbk1ldGhvZCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wdXNoRXJyb3IoXCJFcyBleGlzdGllcmVuIG1laHJlcmUgS2xhc3NlbiBtaXQgc3RhdGlzY2hlbiBtYWluLU1ldGhvZGVuLlwiLCBjbGFzc05vZGUucG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluTWV0aG9kID0gbTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0aWNDbGFzcyA9IGN0LnN0YXRpY0NsYXNzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTm9kZTEgPSBjbGFzc05vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChtYWluTWV0aG9kICE9IG51bGwpIHtcclxuXHJcbiAgICAgICAgICAgIGxldCBwb3NpdGlvbjogVGV4dFBvc2l0aW9uID0gbWFpbk1ldGhvZC51c2FnZVBvc2l0aW9uc1swXTtcclxuICAgICAgICAgICAgaWYgKG1haW5NZXRob2QucHJvZ3JhbSAhPSBudWxsICYmIG1haW5NZXRob2QucHJvZ3JhbS5zdGF0ZW1lbnRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gbWFpbk1ldGhvZC5wcm9ncmFtLnN0YXRlbWVudHNbMF0ucG9zaXRpb247XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuaW5pdEN1cnJlbnRQcm9ncmFtKCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLm1vZHVsZS5uZXdNYWluUHJvZ3JhbSA9IHRoaXMuY3VycmVudFByb2dyYW07XHJcblxyXG4gICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIHRoaXMucHVzaFN0YXRlbWVudHMoW3tcclxuICAgICAgICAgICAgICAgIHR5cGU6IFRva2VuVHlwZS5jYWxsTWFpbk1ldGhvZCxcclxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbixcclxuICAgICAgICAgICAgICAgIHN0ZXBGaW5pc2hlZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6IG1haW5NZXRob2QsXHJcbiAgICAgICAgICAgICAgICBzdGF0aWNDbGFzczogc3RhdGljQ2xhc3NcclxuICAgICAgICAgICAgfSwge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogVG9rZW5UeXBlLmNsb3NlU3RhY2tmcmFtZSxcclxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBtYWluTWV0aG9kLnVzYWdlUG9zaXRpb25zLmdldCh0aGlzLm1vZHVsZSlbMF1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgaW5pdEN1cnJlbnRQcm9ncmFtKCkge1xyXG5cclxuICAgICAgICB0aGlzLmN1cnJlbnRQcm9ncmFtID0ge1xyXG4gICAgICAgICAgICBtb2R1bGU6IHRoaXMubW9kdWxlLFxyXG4gICAgICAgICAgICBzdGF0ZW1lbnRzOiBbXSxcclxuICAgICAgICB9O1xyXG5cclxuICAgIH1cclxuXHJcblxyXG4gICAgcHVzaEVycm9yKHRleHQ6IHN0cmluZywgcG9zaXRpb246IFRleHRQb3NpdGlvbiwgZXJyb3JMZXZlbDogRXJyb3JMZXZlbCA9IFwiZXJyb3JcIiwgcXVpY2tGaXg/OiBRdWlja0ZpeCkge1xyXG4gICAgICAgIHRoaXMuZXJyb3JMaXN0LnB1c2goe1xyXG4gICAgICAgICAgICB0ZXh0OiB0ZXh0LFxyXG4gICAgICAgICAgICBwb3NpdGlvbjogcG9zaXRpb24sXHJcbiAgICAgICAgICAgIHF1aWNrRml4OiBxdWlja0ZpeCxcclxuICAgICAgICAgICAgbGV2ZWw6IGVycm9yTGV2ZWxcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcblxyXG5cclxufSJdfQ==